/*! For license information please see main.8861ab69.js.LICENSE.txt */
(()=>{var e={0:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/warehouse.1cb4ade32cd0ad58466d.png"},108:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/prison.0d21bd8cbc048286abd2.png"},119:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/oracle.e5de6afd5191ff2fce0c.png"},174:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/colossus.8b8c9ac2d081e021d01d.png"},198:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/roman_archer.eb142cbc735da0fe1529.png"},232:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/villages.69b4512ccd4539f93449.png"},292:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/zeus.3b1eff5ea591026fe951.png"},326:(e,t,n)=>{var s={"./academy.png":3207,"./barracks.png":4828,"./cave.png":3718,"./city_wall.png":3641,"./divine_temple.png":8562,"./farm.png":5041,"./heroes_altar.png":8456,"./hospital.png":7635,"./lumber_mill.png":7527,"./market.png":8781,"./prison.png":108,"./senate.png":4143,"./shipyard.png":9283,"./silver_mines.png":5387,"./stone_quarry.png":5459,"./temple.png":4858,"./warehouse.png":0};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=326},402:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athena.588a064c4fb3f10c11de.png"},403:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/Sphinx.52c789e1f2379ec41359.png"},481:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/trade.4dbb3c9e11f814762efe.png"},490:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/silver.6a5956a44492bcf20e1c.png"},579:(e,t,n)=>{"use strict";e.exports=n(1153)},611:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/great_lighthouse.be8f0031bab0ba94952c.png"},634:(e,t,n)=>{var s={"./population.png":3448,"./resources.png":1230,"./silver.png":490,"./stone.png":1826,"./wood.png":5982};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=634},640:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/city_modal.5489deddfe406b2d154a.png"},643:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athenian_archer.2ef917d9a8e780c7a01d.png"},792:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/logistics.81b596c52c644a029647.png"},882:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/corinthian_hoplite.9ed94f65830824f70f1f.png"},1153:(e,t,n)=>{"use strict";var s=n(5043),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var s,i={},c=null,u=null;for(s in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,s)&&!l.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===i[s]&&(i[s]=t[s]);return{$$typeof:r,type:e,key:c,ref:u,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},1230:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/resources.a415b0e617506e297337.png"},1290:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/medusa.3ad796e19a8a5c568443.png"},1442:(e,t,n)=>{var s={"./architecture.png":6864,"./ballistics.png":3053,"./logistics.png":792,"./phalanx.png":6779,"./shipwright.png":9088};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=1442},1476:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spartan_hoplite_elite.14fec174d7504430026f.png"},1518:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/naval_superiority.780c37eb057dc3ee97ad.png"},1538:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spells.182223c8cbbfcdee8d0b.png"},1826:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/stone.377e3cc035d2f254673f.png"},1985:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athenian_hoplite.f2f0691a13aa3683ca5c.png"},2052:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/fast_transport_ship.2c424fd025391bb3758d.png"},2201:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/legionary.7f8ff895d14dce65b6d2.png"},2393:(e,t,n)=>{var s={"./master_spy.png":6975,"./naval_superiority.png":1518,"./rapid_mobilization.png":3524,"./warcry.png":5156};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=2393},2459:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/trireme.154a9cd975aebb3f7876.png"},2532:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/helmet.85304e075cdd06bad052.png"},2537:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/corinthian_marine.64c30cd5da1d55c6fa5e.png"},2561:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/juno.40918431d63647706c2b.png"},2601:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/logout.399ce36f0b5776b4e69a.png"},2730:(e,t,n)=>{"use strict";var s=n(5043),r=n(8853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function f(e,t,n,s,r,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,n,s){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:s||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,s){if(null===t||"undefined"===typeof t||function(e,t,n,s){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!s&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,s))return!0;if(s)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,s)&&(n=null),s||null===r?function(e){return!!d.call(p,e)||!d.call(m,e)&&(h.test(e)?p[e]=!0:(m[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,s=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),_=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var R,L=Object.assign;function $(e){if(void 0===R)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);R=t&&t[1]||""}return"\n"+R+e}var F=!1;function U(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var s=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){s=c}e.call(t.prototype)}else{try{throw Error()}catch(c){s=c}e()}}catch(c){if(c&&s&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),i=s.stack.split("\n"),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==i[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?$(e):""}function V(e){switch(e.tag){case 5:return $(e.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function B(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case N:return"Fragment";case k:return"Portal";case C:return"Profiler";case j:return"StrictMode";case I:return"Suspense";case E:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case _:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:B(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return B(e(t))}catch(n){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return B(t);case 8:return t===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){s=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=W(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return L({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,s=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function J(e,t){X(e,t);var n=q(t.value),s=t.type;if(null!=n)"number"===s?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===s||"reset"===s)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!("submit"!==s&&"reset"!==s||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(s&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return L({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function ie(e,t){var n=q(t.value),s=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=s&&(e.defaultValue=""+s)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var s=0===n.indexOf("--"),r=fe(n,t[n],s);"float"===n&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}Object.keys(me).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]})});var ve=L({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Ne=null,je=null;function Ce(e){if(e=xr(e)){if("function"!==typeof ke)throw Error(i(280));var t=e.stateNode;t&&(t=wr(t),ke(e.stateNode,e.type,t))}}function Se(e){Ne?je?je.push(e):je=[e]:Ne=e}function _e(){if(Ne){var e=Ne,t=je;if(je=Ne=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Te(e,t){return e(t)}function Ie(){}var Ee=!1;function Ae(e,t,n){if(Ee)return e(t,n);Ee=!0;try{return Te(e,t,n)}finally{Ee=!1,(null!==Ne||null!==je)&&(Ie(),_e())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var s=wr(n);if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Me=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){Me=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ue){Me=!1}function Oe(e,t,n,s,r,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Re=!1,Le=null,$e=!1,Fe=null,Ue={onError:function(e){Re=!0,Le=e}};function Ve(e,t,n,s,r,i,a,o,l){Re=!1,Le=null,Oe.apply(Ue,arguments)}function Be(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Be(e)!==e)throw Error(i(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(s=r.return)){n=s;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return qe(r),e;if(a===s)return qe(r),t;a=a.sibling}throw Error(i(188))}if(n.return!==s.return)n=r,s=a;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,s=a;break}if(l===s){o=!0,s=r,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,s=r;break}if(l===s){o=!0,s=a,n=r;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==s)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Ge=r.unstable_scheduleCallback,Qe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Xe=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,st=r.unstable_IdlePriority,rt=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var s=0,r=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?s=dt(o):0!==(i&=a)&&(s=dt(i))}else 0!==(a=n&~r)?s=dt(a):0!==i&&(s=dt(i));if(0===s)return 0;if(0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(i=t&-t)||16===r&&0!==(4194240&i)))return t;if(0!==(4&s)&&(s|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=s;0<t;)r=1<<(n=31-at(t)),s|=e[n],t&=~r;return s}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-at(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,kt,Nt,jt,Ct,St=!1,_t=[],Tt=null,It=null,Et=null,At=new Map,Pt=new Map,Mt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Et=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Rt(e,t,n,s,r,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},null!==t&&(null!==(t=xr(t))&&kt(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Lt(e){var t=yr(e.target);if(null!==t){var n=Be(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ze(n)))return e.blockedOn=t,void Ct(e.priority,function(){Nt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function $t(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xr(n))&&kt(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);be=s,n.target.dispatchEvent(s),be=null,t.shift()}return!0}function Ft(e,t,n){$t(e)&&n.delete(t)}function Ut(){St=!1,null!==Tt&&$t(Tt)&&(Tt=null),null!==It&&$t(It)&&(It=null),null!==Et&&$t(Et)&&(Et=null),At.forEach(Ft),Pt.forEach(Ft)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ut)))}function Bt(e){function t(t){return Vt(t,e)}if(0<_t.length){Vt(_t[0],e);for(var n=1;n<_t.length;n++){var s=_t[n];s.blockedOn===e&&(s.blockedOn=null)}}for(null!==Tt&&Vt(Tt,e),null!==It&&Vt(It,e),null!==Et&&Vt(Et,e),At.forEach(t),Pt.forEach(t),n=0;n<Mt.length;n++)(s=Mt[n]).blockedOn===e&&(s.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Lt(n),null===n.blockedOn&&Mt.shift()}var zt=b.ReactCurrentBatchConfig,qt=!0;function Wt(e,t,n,s){var r=xt,i=zt.transition;zt.transition=null;try{xt=1,Gt(e,t,n,s)}finally{xt=r,zt.transition=i}}function Ht(e,t,n,s){var r=xt,i=zt.transition;zt.transition=null;try{xt=4,Gt(e,t,n,s)}finally{xt=r,zt.transition=i}}function Gt(e,t,n,s){if(qt){var r=Yt(e,t,n,s);if(null===r)qs(e,t,s,Qt,n),Ot(e,s);else if(function(e,t,n,s,r){switch(t){case"focusin":return Tt=Rt(Tt,e,t,n,s,r),!0;case"dragenter":return It=Rt(It,e,t,n,s,r),!0;case"mouseover":return Et=Rt(Et,e,t,n,s,r),!0;case"pointerover":var i=r.pointerId;return At.set(i,Rt(At.get(i)||null,e,t,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Pt.set(i,Rt(Pt.get(i)||null,e,t,n,s,r)),!0}return!1}(r,e,t,n,s))s.stopPropagation();else if(Ot(e,s),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var i=xr(r);if(null!==i&&wt(i),null===(i=Yt(e,t,n,s))&&qs(e,t,s,Qt,n),i===r)break;r=i}null!==r&&s.stopPropagation()}else qs(e,t,s,null,n)}}var Qt=null;function Yt(e,t,n,s){if(Qt=null,null!==(e=yr(e=we(s))))if(null===(t=Be(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case st:return 536870912;default:return 16}default:return 16}}var Xt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,s=n.length,r="value"in Xt?Xt.value:Xt.textContent,i=r.length;for(e=0;e<s&&n[e]===r[e];e++);var a=s-e;for(t=1;t<=a&&n[s-t]===r[i-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,s,r,i){for(var a in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return L(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=rn(cn),dn=L({},cn,{view:0,detail:0}),hn=rn(dn),mn=L({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=rn(mn),fn=rn(L({},mn,{dataTransfer:0})),gn=rn(L({},dn,{relatedTarget:0})),vn=rn(L({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=L({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=rn(yn),bn=rn(L({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Nn[e])&&!!t[e]}function Cn(){return jn}var Sn=L({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),_n=rn(Sn),Tn=rn(L({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(L({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),En=rn(L({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=L({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=rn(An),Mn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode);var Rn=u&&"TextEvent"in window&&!On,Ln=u&&(!Dn||On&&8<On&&11>=On),$n=String.fromCharCode(32),Fn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Wn(e,t,n,s){Se(s),0<(t=Hs(t,"onChange")).length&&(n=new un("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Hn=null,Gn=null;function Qn(e){$s(e,0)}function Yn(e){if(G(br(e)))return e}function Kn(e,t){if("change"===e)return t}var Xn=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var es=document.createElement("div");es.setAttribute("oninput","return;"),Zn="function"===typeof es.oninput}Jn=Zn}else Jn=!1;Xn=Jn&&(!document.documentMode||9<document.documentMode)}function ts(){Hn&&(Hn.detachEvent("onpropertychange",ns),Gn=Hn=null)}function ns(e){if("value"===e.propertyName&&Yn(Gn)){var t=[];Wn(t,Gn,e,we(e)),Ae(Qn,t)}}function ss(e,t,n){"focusin"===e?(ts(),Gn=n,(Hn=t).attachEvent("onpropertychange",ns)):"focusout"===e&&ts()}function rs(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Gn)}function is(e,t){if("click"===e)return Yn(t)}function as(e,t){if("input"===e||"change"===e)return Yn(t)}var os="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ls(e,t){if(os(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!d.call(t,r)||!os(e[r],t[r]))return!1}return!0}function cs(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function us(e,t){var n,s=cs(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=cs(s)}}function ds(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ds(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hs(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function ms(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ps(e){var t=hs(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ds(n.ownerDocument.documentElement,n)){if(null!==s&&ms(n))if(t=s.start,void 0===(e=s.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=void 0===s.end?i:Math.min(s.end,r),!e.extend&&i>s&&(r=s,s=i,i=r),r=us(n,i);var a=us(n,s);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fs=u&&"documentMode"in document&&11>=document.documentMode,gs=null,vs=null,ys=null,xs=!1;function bs(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xs||null==gs||gs!==Q(s)||("selectionStart"in(s=gs)&&ms(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},ys&&ls(ys,s)||(ys=s,0<(s=Hs(vs,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=gs)))}function ws(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ks={animationend:ws("Animation","AnimationEnd"),animationiteration:ws("Animation","AnimationIteration"),animationstart:ws("Animation","AnimationStart"),transitionend:ws("Transition","TransitionEnd")},Ns={},js={};function Cs(e){if(Ns[e])return Ns[e];if(!ks[e])return e;var t,n=ks[e];for(t in n)if(n.hasOwnProperty(t)&&t in js)return Ns[e]=n[t];return e}u&&(js=document.createElement("div").style,"AnimationEvent"in window||(delete ks.animationend.animation,delete ks.animationiteration.animation,delete ks.animationstart.animation),"TransitionEvent"in window||delete ks.transitionend.transition);var Ss=Cs("animationend"),_s=Cs("animationiteration"),Ts=Cs("animationstart"),Is=Cs("transitionend"),Es=new Map,As="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ps(e,t){Es.set(e,t),l(t,[e])}for(var Ms=0;Ms<As.length;Ms++){var Ds=As[Ms];Ps(Ds.toLowerCase(),"on"+(Ds[0].toUpperCase()+Ds.slice(1)))}Ps(Ss,"onAnimationEnd"),Ps(_s,"onAnimationIteration"),Ps(Ts,"onAnimationStart"),Ps("dblclick","onDoubleClick"),Ps("focusin","onFocus"),Ps("focusout","onBlur"),Ps(Is,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Os="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Rs=new Set("cancel close invalid load scroll toggle".split(" ").concat(Os));function Ls(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,s,r,a,o,l,c){if(Ve.apply(this,arguments),Re){if(!Re)throw Error(i(198));var u=Le;Re=!1,Le=null,$e||($e=!0,Fe=u)}}(s,t,void 0,e),e.currentTarget=null}function $s(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var o=s[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&r.isPropagationStopped())break e;Ls(r,o,c),i=l}else for(a=0;a<s.length;a++){if(l=(o=s[a]).instance,c=o.currentTarget,o=o.listener,l!==i&&r.isPropagationStopped())break e;Ls(r,o,c),i=l}}}if($e)throw e=Fe,$e=!1,Fe=null,e}function Fs(e,t){var n=t[fr];void 0===n&&(n=t[fr]=new Set);var s=e+"__bubble";n.has(s)||(zs(t,e,2,!1),n.add(s))}function Us(e,t,n){var s=0;t&&(s|=4),zs(n,e,s,t)}var Vs="_reactListening"+Math.random().toString(36).slice(2);function Bs(e){if(!e[Vs]){e[Vs]=!0,a.forEach(function(t){"selectionchange"!==t&&(Rs.has(t)||Us(t,!1,e),Us(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vs]||(t[Vs]=!0,Us("selectionchange",!1,t))}}function zs(e,t,n,s){switch(Kt(t)){case 1:var r=Wt;break;case 4:r=Ht;break;default:r=Gt}n=r.bind(null,t,n,e),r=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),s?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qs(e,t,n,s,r){var i=s;if(0===(1&t)&&0===(2&t)&&null!==s)e:for(;;){if(null===s)return;var a=s.tag;if(3===a||4===a){var o=s.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=s.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){s=i=a;continue e}o=o.parentNode}}s=s.return}Ae(function(){var s=i,r=we(n),a=[];e:{var o=Es.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=_n;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ss:case _s:case Ts:l=vn;break;case Is:l=En;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Tn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var m,p=s;null!==p;){var f=(m=p).stateNode;if(5===m.tag&&null!==f&&(m=f,null!==h&&(null!=(f=Pe(p,h))&&u.push(Ws(p,f,m)))),d)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[pr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=s,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(d=Be(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=s),l!==c)){if(u=pn,f="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Tn,f="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?o:br(l),m=null==c?o:br(c),(o=new u(f,p+"leave",l,n,r)).target=d,o.relatedTarget=m,f=null,yr(r)===s&&((u=new u(h,p+"enter",c,n,r)).target=m,u.relatedTarget=d,f=u),d=f,l&&c)e:{for(h=c,p=0,m=u=l;m;m=Gs(m))p++;for(m=0,f=h;f;f=Gs(f))m++;for(;0<p-m;)u=Gs(u),p--;for(;0<m-p;)h=Gs(h),m--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gs(u),h=Gs(h)}u=null}else u=null;null!==l&&Qs(a,o,l,u,!1),null!==c&&null!==d&&Qs(a,d,c,u,!0)}if("select"===(l=(o=s?br(s):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Kn;else if(qn(o))if(Xn)g=as;else{g=rs;var v=ss}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=is);switch(g&&(g=g(e,s))?Wn(a,g,n,r):(v&&v(e,o,s),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=s?br(s):window,e){case"focusin":(qn(v)||"true"===v.contentEditable)&&(gs=v,vs=s,ys=null);break;case"focusout":ys=vs=gs=null;break;case"mousedown":xs=!0;break;case"contextmenu":case"mouseup":case"dragend":xs=!1,bs(a,n,r);break;case"selectionchange":if(fs)break;case"keydown":case"keyup":bs(a,n,r)}var y;if(Dn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Bn?Un(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Ln&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Bn&&(y=en()):(Jt="value"in(Xt=r)?Xt.value:Xt.textContent,Bn=!0)),0<(v=Hs(s,x)).length&&(x=new bn(x,e,null,n,r),a.push({event:x,listeners:v}),y?x.data=y:null!==(y=Vn(n))&&(x.data=y))),(y=Rn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Fn=!0,$n);case"textInput":return(e=t.data)===$n&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!Dn&&Un(e,t)?(e=en(),Zt=Jt=Xt=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(s=Hs(s,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:s}),r.data=y))}$s(a,t)})}function Ws(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hs(e,t){for(var n=t+"Capture",s=[];null!==e;){var r=e,i=r.stateNode;5===r.tag&&null!==i&&(r=i,null!=(i=Pe(e,n))&&s.unshift(Ws(e,i,r)),null!=(i=Pe(e,t))&&s.push(Ws(e,i,r))),e=e.return}return s}function Gs(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Qs(e,t,n,s,r){for(var i=t._reactName,a=[];null!==n&&n!==s;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===s)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Pe(n,i))&&a.unshift(Ws(n,l,o)):r||null!=(l=Pe(n,i))&&a.push(Ws(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Ys=/\r\n?/g,Ks=/\u0000|\uFFFD/g;function Xs(e){return("string"===typeof e?e:""+e).replace(Ys,"\n").replace(Ks,"")}function Js(e,t,n){if(t=Xs(t),Xs(e)!==t&&n)throw Error(i(425))}function Zs(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var sr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ir="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ir?function(e){return ir.resolve(null).then(e).catch(or)}:sr;function or(e){setTimeout(function(){throw e})}function lr(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===s)return e.removeChild(r),void Bt(t);s--}else"$"!==n&&"$?"!==n&&"$!"!==n||s++;n=r}while(n);Bt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,mr="__reactProps$"+dr,pr="__reactContainer$"+dr,fr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function xr(e){return!(e=e[hr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function br(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wr(e){return e[mr]||null}var kr=[],Nr=-1;function jr(e){return{current:e}}function Cr(e){0>Nr||(e.current=kr[Nr],kr[Nr]=null,Nr--)}function Sr(e,t){Nr++,kr[Nr]=e.current,e.current=t}var _r={},Tr=jr(_r),Ir=jr(!1),Er=_r;function Ar(e,t){var n=e.type.contextTypes;if(!n)return _r;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r,i={};for(r in n)i[r]=t[r];return s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Pr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mr(){Cr(Ir),Cr(Tr)}function Dr(e,t,n){if(Tr.current!==_r)throw Error(i(168));Sr(Tr,t),Sr(Ir,n)}function Or(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,"function"!==typeof s.getChildContext)return n;for(var r in s=s.getChildContext())if(!(r in t))throw Error(i(108,z(e)||"Unknown",r));return L({},n,s)}function Rr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_r,Er=Tr.current,Sr(Tr,e),Sr(Ir,Ir.current),!0}function Lr(e,t,n){var s=e.stateNode;if(!s)throw Error(i(169));n?(e=Or(e,t,Er),s.__reactInternalMemoizedMergedChildContext=e,Cr(Ir),Cr(Tr),Sr(Tr,e)):Cr(Ir),Sr(Ir,n)}var $r=null,Fr=!1,Ur=!1;function Vr(e){null===$r?$r=[e]:$r.push(e)}function Br(){if(!Ur&&null!==$r){Ur=!0;var e=0,t=xt;try{var n=$r;for(xt=1;e<n.length;e++){var s=n[e];do{s=s(!0)}while(null!==s)}$r=null,Fr=!1}catch(r){throw null!==$r&&($r=$r.slice(e+1)),Ge(Ze,Br),r}finally{xt=t,Ur=!1}}return null}var zr=[],qr=0,Wr=null,Hr=0,Gr=[],Qr=0,Yr=null,Kr=1,Xr="";function Jr(e,t){zr[qr++]=Hr,zr[qr++]=Wr,Wr=e,Hr=t}function Zr(e,t,n){Gr[Qr++]=Kr,Gr[Qr++]=Xr,Gr[Qr++]=Yr,Yr=e;var s=Kr;e=Xr;var r=32-at(s)-1;s&=~(1<<r),n+=1;var i=32-at(t)+r;if(30<i){var a=r-r%5;i=(s&(1<<a)-1).toString(32),s>>=a,r-=a,Kr=1<<32-at(t)+r|n<<r|s,Xr=i+e}else Kr=1<<i|n<<r|s,Xr=e}function ei(e){null!==e.return&&(Jr(e,1),Zr(e,1,0))}function ti(e){for(;e===Wr;)Wr=zr[--qr],zr[qr]=null,Hr=zr[--qr],zr[qr]=null;for(;e===Yr;)Yr=Gr[--Qr],Gr[Qr]=null,Xr=Gr[--Qr],Gr[Qr]=null,Kr=Gr[--Qr],Gr[Qr]=null}var ni=null,si=null,ri=!1,ii=null;function ai(e,t){var n=Ac(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oi(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,si=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,si=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Kr,overflow:Xr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ac(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,si=null,!0);default:return!1}}function li(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ri){var t=si;if(t){var n=t;if(!oi(e,t)){if(li(e))throw Error(i(418));t=cr(n.nextSibling);var s=ni;t&&oi(e,t)?ai(s,n):(e.flags=-4097&e.flags|2,ri=!1,ni=e)}}else{if(li(e))throw Error(i(418));e.flags=-4097&e.flags|2,ri=!1,ni=e}}}function ui(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function di(e){if(e!==ni)return!1;if(!ri)return ui(e),ri=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=si)){if(li(e))throw hi(),Error(i(418));for(;t;)ai(e,t),t=cr(t.nextSibling)}if(ui(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){si=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}si=null}}else si=ni?cr(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=si;e;)e=cr(e.nextSibling)}function mi(){si=ni=null,ri=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var fi=b.ReactCurrentBatchConfig;function gi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var s=n.stateNode}if(!s)throw Error(i(147,e));var r=s,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function xi(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function s(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function a(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=2,n):s:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,s){return null===t||6!==t.tag?((t=Lc(n,e.mode,s)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,s){var i=n.type;return i===N?d(e,t,n.props.children,s,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===P&&yi(i)===t.type)?((s=r(t,n.props)).ref=gi(e,t,n),s.return=e,s):((s=Dc(n.type,n.key,n.props,null,e.mode,s)).ref=gi(e,t,n),s.return=e,s)}function u(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=$c(n,e.mode,s)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,s,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,s,i)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Lc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Dc(t.type,t.key,t.props,null,e.mode,n)).ref=gi(e,null,t),n.return=e,n;case k:return(t=$c(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;vi(e,t)}return null}function m(e,t,n,s){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===r?c(e,t,n,s):null;case k:return n.key===r?u(e,t,n,s):null;case P:return m(e,t,(r=n._init)(n._payload),s)}if(te(n)||O(n))return null!==r?null:d(e,t,n,s,null);vi(e,n)}return null}function p(e,t,n,s,r){if("string"===typeof s&&""!==s||"number"===typeof s)return l(t,e=e.get(n)||null,""+s,r);if("object"===typeof s&&null!==s){switch(s.$$typeof){case w:return c(t,e=e.get(null===s.key?n:s.key)||null,s,r);case k:return u(t,e=e.get(null===s.key?n:s.key)||null,s,r);case P:return p(e,t,n,(0,s._init)(s._payload),r)}if(te(s)||O(s))return d(t,e=e.get(n)||null,s,r,null);vi(t,s)}return null}function f(r,i,o,l){for(var c=null,u=null,d=i,f=i=0,g=null;null!==d&&f<o.length;f++){d.index>f?(g=d,d=null):g=d.sibling;var v=m(r,d,o[f],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),i=a(v,i,f),null===u?c=v:u.sibling=v,u=v,d=g}if(f===o.length)return n(r,d),ri&&Jr(r,f),c;if(null===d){for(;f<o.length;f++)null!==(d=h(r,o[f],l))&&(i=a(d,i,f),null===u?c=d:u.sibling=d,u=d);return ri&&Jr(r,f),c}for(d=s(r,d);f<o.length;f++)null!==(g=p(d,r,f,o[f],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?f:g.key),i=a(g,i,f),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),ri&&Jr(r,f),c}function g(r,o,l,c){var u=O(l);if("function"!==typeof u)throw Error(i(150));if(null==(l=u.call(l)))throw Error(i(151));for(var d=u=null,f=o,g=o=0,v=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(v=f,f=null):v=f.sibling;var x=m(r,f,y.value,c);if(null===x){null===f&&(f=v);break}e&&f&&null===x.alternate&&t(r,f),o=a(x,o,g),null===d?u=x:d.sibling=x,d=x,f=v}if(y.done)return n(r,f),ri&&Jr(r,g),u;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return ri&&Jr(r,g),u}for(f=s(r,f);!y.done;g++,y=l.next())null!==(y=p(f,r,g,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return e&&f.forEach(function(e){return t(r,e)}),ri&&Jr(r,g),u}return function e(s,i,a,l){if("object"===typeof a&&null!==a&&a.type===N&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:e:{for(var c=a.key,u=i;null!==u;){if(u.key===c){if((c=a.type)===N){if(7===u.tag){n(s,u.sibling),(i=r(u,a.props.children)).return=s,s=i;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&yi(c)===u.type){n(s,u.sibling),(i=r(u,a.props)).ref=gi(s,u,a),i.return=s,s=i;break e}n(s,u);break}t(s,u),u=u.sibling}a.type===N?((i=Oc(a.props.children,s.mode,l,a.key)).return=s,s=i):((l=Dc(a.type,a.key,a.props,null,s.mode,l)).ref=gi(s,i,a),l.return=s,s=l)}return o(s);case k:e:{for(u=a.key;null!==i;){if(i.key===u){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(s,i.sibling),(i=r(i,a.children||[])).return=s,s=i;break e}n(s,i);break}t(s,i),i=i.sibling}(i=$c(a,s.mode,l)).return=s,s=i}return o(s);case P:return e(s,i,(u=a._init)(a._payload),l)}if(te(a))return f(s,i,a,l);if(O(a))return g(s,i,a,l);vi(s,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(s,i.sibling),(i=r(i,a)).return=s,s=i):(n(s,i),(i=Lc(a,s.mode,l)).return=s,s=i),o(s)):n(s,i)}}var bi=xi(!0),wi=xi(!1),ki=jr(null),Ni=null,ji=null,Ci=null;function Si(){Ci=ji=Ni=null}function _i(e){var t=ki.current;Cr(ki),e._currentValue=t}function Ti(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t){Ni=e,Ci=ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xo=!0),e.firstContext=null)}function Ei(e){var t=e._currentValue;if(Ci!==e)if(e={context:e,memoizedValue:t,next:null},null===ji){if(null===Ni)throw Error(i(308));ji=e,Ni.dependencies={lanes:0,firstContext:e}}else ji=ji.next=e;return t}var Ai=null;function Pi(e){null===Ai?Ai=[e]:Ai.push(e)}function Mi(e,t,n,s){var r=t.interleaved;return null===r?(n.next=n,Pi(t)):(n.next=r.next,r.next=n),t.interleaved=n,Di(e,s)}function Di(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oi=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Li(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function $i(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fi(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,0!==(2&Tl)){var r=s.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Di(e,n)}return null===(r=s.interleaved)?(t.next=t,Pi(s)):(t.next=r.next,r.next=t),s.interleaved=t,Di(e,n)}function Ui(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Vi(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var r=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?r=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?r=i=t:i=i.next=t}else r=i=t;return n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bi(e,t,n,s){var r=e.updateQueue;Oi=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==i){var d=r.baseState;for(a=0,u=c=l=null,o=i;;){var h=o.lane,m=o.eventTime;if((s&h)===h){null!==u&&(u=u.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,f=o;switch(h=t,m=n,f.tag){case 1:if("function"===typeof(p=f.payload)){d=p.call(m,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=f.payload)?p.call(m,d,h):p)||void 0===h)break e;d=L({},d,h);break e;case 2:Oi=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=m,l=d):u=u.next=m,a|=h;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===i&&(r.shared.lanes=0);Rl|=a,e.lanes=a,e.memoizedState=d}}function zi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(null!==r){if(s.callback=null,s=n,"function"!==typeof r)throw Error(i(191,r));r.call(s)}}}var qi={},Wi=jr(qi),Hi=jr(qi),Gi=jr(qi);function Qi(e){if(e===qi)throw Error(i(174));return e}function Yi(e,t){switch(Sr(Gi,t),Sr(Hi,e),Sr(Wi,qi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Cr(Wi),Sr(Wi,t)}function Ki(){Cr(Wi),Cr(Hi),Cr(Gi)}function Xi(e){Qi(Gi.current);var t=Qi(Wi.current),n=le(t,e.type);t!==n&&(Sr(Hi,e),Sr(Wi,n))}function Ji(e){Hi.current===e&&(Cr(Wi),Cr(Hi))}var Zi=jr(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var sa=b.ReactCurrentDispatcher,ra=b.ReactCurrentBatchConfig,ia=0,aa=null,oa=null,la=null,ca=!1,ua=!1,da=0,ha=0;function ma(){throw Error(i(321))}function pa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!os(e[n],t[n]))return!1;return!0}function fa(e,t,n,s,r,a){if(ia=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sa.current=null===e||null===e.memoizedState?Ja:Za,e=n(s,r),ua){a=0;do{if(ua=!1,da=0,25<=a)throw Error(i(301));a+=1,la=oa=null,t.updateQueue=null,sa.current=eo,e=n(s,r)}while(ua)}if(sa.current=Xa,t=null!==oa&&null!==oa.next,ia=0,la=oa=aa=null,ca=!1,t)throw Error(i(300));return e}function ga(){var e=0!==da;return da=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function xa(e,t){return"function"===typeof t?t(e):t}function ba(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var s=oa,r=s.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}s.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,s=s.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((ia&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=s):c=c.next=h,aa.lanes|=d,Rl|=d}u=u.next}while(null!==u&&u!==a);null===c?o=s:c.next=l,os(s,t.memoizedState)||(xo=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=c,n.lastRenderedState=s}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Rl|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wa(e){var t=ya(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);os(a,t.memoizedState)||(xo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,s]}function ka(){}function Na(e,t){var n=aa,s=ya(),r=t(),a=!os(s.memoizedState,r);if(a&&(s.memoizedState=r,xo=!0),s=s.queue,Oa(Sa.bind(null,n,s,e),[e]),s.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Ea(9,Ca.bind(null,n,s,r,t),void 0,null),null===Il)throw Error(i(349));0!==(30&ia)||ja(n,t,r)}return r}function ja(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ca(e,t,n,s){t.value=n,t.getSnapshot=s,_a(t)&&Ta(e)}function Sa(e,t,n){return n(function(){_a(t)&&Ta(e)})}function _a(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!os(e,n)}catch(s){return!0}}function Ta(e){var t=Di(e,1);null!==t&&nc(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:e},t.queue=e,e=e.dispatch=Ga.bind(null,aa,e),[t.memoizedState,e]}function Ea(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function Aa(){return ya().memoizedState}function Pa(e,t,n,s){var r=va();aa.flags|=e,r.memoizedState=Ea(1|t,n,void 0,void 0===s?null:s)}function Ma(e,t,n,s){var r=ya();s=void 0===s?null:s;var i=void 0;if(null!==oa){var a=oa.memoizedState;if(i=a.destroy,null!==s&&pa(s,a.deps))return void(r.memoizedState=Ea(t,n,i,s))}aa.flags|=e,r.memoizedState=Ea(1|t,n,i,s)}function Da(e,t){return Pa(8390656,8,e,t)}function Oa(e,t){return Ma(2048,8,e,t)}function Ra(e,t){return Ma(4,2,e,t)}function La(e,t){return Ma(4,4,e,t)}function $a(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ma(4,4,$a.bind(null,t,e),n)}function Ua(){}function Va(e,t){var n=ya();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&pa(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Ba(e,t){var n=ya();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&pa(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function za(e,t,n){return 0===(21&ia)?(e.baseState&&(e.baseState=!1,xo=!0),e.memoizedState=n):(os(n,t)||(n=ft(),aa.lanes|=n,Rl|=n,e.baseState=!0),t)}function qa(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var s=ra.transition;ra.transition={};try{e(!1),t()}finally{xt=n,ra.transition=s}}function Wa(){return ya().memoizedState}function Ha(e,t,n){var s=tc(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Qa(e))Ya(t,n);else if(null!==(n=Mi(e,t,n,s))){nc(n,e,s,ec()),Ka(n,t,s)}}function Ga(e,t,n){var s=tc(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qa(e))Ya(t,r);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,n);if(r.hasEagerState=!0,r.eagerState=o,os(o,a)){var l=t.interleaved;return null===l?(r.next=r,Pi(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Mi(e,t,r,s))&&(nc(n,e,s,r=ec()),Ka(n,t,s))}}function Qa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Ya(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ka(e,t,n){if(0!==(4194240&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Xa={readContext:Ei,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},Ja={readContext:Ei,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Ei,useEffect:Da,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,$a.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=va();return t=void 0!==n?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=Ha.bind(null,aa,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:Ua,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=qa.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=aa,r=va();if(ri){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Il)throw Error(i(349));0!==(30&ia)||ja(s,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Da(Sa.bind(null,s,a,e),[e]),s.flags|=2048,Ea(9,Ca.bind(null,s,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Il.identifierPrefix;if(ri){var n=Xr;t=":"+t+"R"+(n=(Kr&~(1<<32-at(Kr)-1)).toString(32)+n),0<(n=da++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:Ei,useCallback:Va,useContext:Ei,useEffect:Oa,useImperativeHandle:Fa,useInsertionEffect:Ra,useLayoutEffect:La,useMemo:Ba,useReducer:ba,useRef:Aa,useState:function(){return ba(xa)},useDebugValue:Ua,useDeferredValue:function(e){return za(ya(),oa.memoizedState,e)},useTransition:function(){return[ba(xa)[0],ya().memoizedState]},useMutableSource:ka,useSyncExternalStore:Na,useId:Wa,unstable_isNewReconciler:!1},eo={readContext:Ei,useCallback:Va,useContext:Ei,useEffect:Oa,useImperativeHandle:Fa,useInsertionEffect:Ra,useLayoutEffect:La,useMemo:Ba,useReducer:wa,useRef:Aa,useState:function(){return wa(xa)},useDebugValue:Ua,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:za(t,oa.memoizedState,e)},useTransition:function(){return[wa(xa)[0],ya().memoizedState]},useMutableSource:ka,useSyncExternalStore:Na,useId:Wa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=L({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,s){n=null===(n=n(s,t=e.memoizedState))||void 0===n?t:L({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var so={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=ec(),r=tc(e),i=$i(s,r);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Fi(e,i,r))&&(nc(t,e,r,s),Ui(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=ec(),r=tc(e),i=$i(s,r);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Fi(e,i,r))&&(nc(t,e,r,s),Ui(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),s=tc(e),r=$i(n,s);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Fi(e,r,s))&&(nc(t,e,s,n),Ui(t,e,s))}};function ro(e,t,n,s,r,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!ls(n,s)||!ls(r,i))}function io(e,t,n){var s=!1,r=_r,i=t.contextType;return"object"===typeof i&&null!==i?i=Ei(i):(r=Pr(t)?Er:Tr.current,i=(s=null!==(s=t.contextTypes)&&void 0!==s)?Ar(e,r):_r),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=so,e.stateNode=t,t._reactInternals=e,s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=i),t}function ao(e,t,n,s){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&so.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?r.context=Ei(i):(i=Pr(t)?Er:Tr.current,r.context=Ar(e,i)),r.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(no(e,t,i,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&so.enqueueReplaceState(r,r.state,null),Bi(e,n,r,s),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",s=t;do{n+=V(s),s=s.return}while(s);var r=n}catch(i){r="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=$i(-1,n)).tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){ql||(ql=!0,Wl=s),uo(0,t)},n}function po(e,t,n){(n=$i(-1,n)).tag=3;var s=e.type.getDerivedStateFromError;if("function"===typeof s){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof s&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new ho;var r=new Set;s.set(t,r)}else void 0===(r=s.get(t))&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,s,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=$i(-1,1)).tag=2,Fi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=b.ReactCurrentOwner,xo=!1;function bo(e,t,n,s){t.child=null===e?wi(t,null,n,s):bi(t,e.child,n,s)}function wo(e,t,n,s,r){n=n.render;var i=t.ref;return Ii(t,r),s=fa(e,t,n,s,i,r),n=ga(),null===e||xo?(ri&&n&&ei(t),t.flags|=1,bo(e,t,s,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function ko(e,t,n,s,r){if(null===e){var i=n.type;return"function"!==typeof i||Pc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dc(n.type,null,s,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,No(e,t,i,s,r))}if(i=e.child,0===(e.lanes&r)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:ls)(a,s)&&e.ref===t.ref)return qo(e,t,r)}return t.flags|=1,(e=Mc(i,s)).ref=t.ref,e.return=t,t.child=e}function No(e,t,n,s,r){if(null!==e){var i=e.memoizedProps;if(ls(i,s)&&e.ref===t.ref){if(xo=!1,t.pendingProps=s=i,0===(e.lanes&r))return t.lanes=e.lanes,qo(e,t,r);0!==(131072&e.flags)&&(xo=!0)}}return So(e,t,n,s,r)}function jo(e,t,n){var s=t.pendingProps,r=s.children,i=null!==e?e.memoizedState:null;if("hidden"===s.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Sr(Ml,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Sr(Ml,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=null!==i?i.baseLanes:n,Sr(Ml,Pl),Pl|=s}else null!==i?(s=i.baseLanes|n,t.memoizedState=null):s=n,Sr(Ml,Pl),Pl|=s;return bo(e,t,r,n),t.child}function Co(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function So(e,t,n,s,r){var i=Pr(n)?Er:Tr.current;return i=Ar(t,i),Ii(t,r),n=fa(e,t,n,s,i,r),s=ga(),null===e||xo?(ri&&s&&ei(t),t.flags|=1,bo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function _o(e,t,n,s,r){if(Pr(n)){var i=!0;Rr(t)}else i=!1;if(Ii(t,r),null===t.stateNode)zo(e,t),io(t,n,s),oo(t,n,s,r),s=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ei(c):c=Ar(t,c=Pr(n)?Er:Tr.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==s||l!==c)&&ao(t,a,s,c),Oi=!1;var h=t.memoizedState;a.state=h,Bi(t,s,a,r),l=t.memoizedState,o!==s||h!==l||Ir.current||Oi?("function"===typeof u&&(no(t,n,u,s),l=t.memoizedState),(o=Oi||ro(t,n,o,s,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=l),a.props=s,a.state=l,a.context=c,s=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Li(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ei(l):l=Ar(t,l=Pr(n)?Er:Tr.current);var m=n.getDerivedStateFromProps;(u="function"===typeof m||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&ao(t,a,s,l),Oi=!1,h=t.memoizedState,a.state=h,Bi(t,s,a,r);var p=t.memoizedState;o!==d||h!==p||Ir.current||Oi?("function"===typeof m&&(no(t,n,m,s),p=t.memoizedState),(c=Oi||ro(t,n,c,s,h,p,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(s,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(s,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=p),a.props=s,a.state=p,a.context=l,s=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),s=!1)}return To(e,t,n,s,i,r)}function To(e,t,n,s,r,i){Co(e,t);var a=0!==(128&t.flags);if(!s&&!a)return r&&Lr(t,n,!1),qo(e,t,i);s=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:s.render();return t.flags|=1,null!==e&&a?(t.child=bi(t,e.child,null,i),t.child=bi(t,null,o,i)):bo(e,t,o,i),t.memoizedState=s.state,r&&Lr(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),Yi(e,t.containerInfo)}function Eo(e,t,n,s,r){return mi(),pi(r),t.flags|=256,bo(e,t,n,s),t.child}var Ao,Po,Mo,Do,Oo={dehydrated:null,treeContext:null,retryLane:0};function Ro(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lo(e,t,n){var s,r=t.pendingProps,a=Zi.current,o=!1,l=0!==(128&t.flags);if((s=l)||(s=(null===e||null!==e.memoizedState)&&0!==(2&a)),s?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Sr(Zi,1&a),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Rc(l,r,0,null),e=Oc(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ro(n),t.memoizedState=Oo,e):$o(t,l));if(null!==(a=e.memoizedState)&&null!==(s=a.dehydrated))return function(e,t,n,s,r,a,o){if(n)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,s=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=s.fallback,r=t.mode,s=Rc({mode:"visible",children:s.children},r,0,null),(a=Oc(a,r,o,null)).flags|=2,s.return=t,a.return=t,s.sibling=a,t.child=s,0!==(1&t.mode)&&bi(t,e.child,null,o),t.child.memoizedState=Ro(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===r.data){if(s=r.nextSibling&&r.nextSibling.dataset)var l=s.dgst;return s=l,Fo(e,t,o,s=co(a=Error(i(419)),s,void 0))}if(l=0!==(o&e.childLanes),xo||l){if(null!==(s=Il)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(s.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Di(e,r),nc(s,e,r,-1))}return fc(),Fo(e,t,o,s=co(Error(i(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=_c.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,si=cr(r.nextSibling),ni=t,ri=!0,ii=null,null!==e&&(Gr[Qr++]=Kr,Gr[Qr++]=Xr,Gr[Qr++]=Yr,Kr=e.id,Xr=e.overflow,Yr=t),t=$o(t,s.children),t.flags|=4096,t)}(e,t,l,r,s,a,n);if(o){o=r.fallback,l=t.mode,s=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Mc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==s?o=Mc(s,o):(o=Oc(o,l,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Ro(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Oo,r}return e=(o=e.child).sibling,r=Mc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function $o(e,t){return(t=Rc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,n,s){return null!==s&&pi(s),bi(t,e.child,null,n),(e=$o(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),Ti(e.return,t,n)}function Vo(e,t,n,s,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function Bo(e,t,n){var s=t.pendingProps,r=s.revealOrder,i=s.tail;if(bo(e,t,s.children,n),0!==(2&(s=Zi.current)))s=1&s|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,n,t);else if(19===e.tag)Uo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(Sr(Zi,s),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vo(t,!1,r,n,i);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vo(t,!0,n,null,i);break;case"together":Vo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Rl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Ho(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=14680064&r.subtreeFlags,s|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function Go(e,t,n){var s=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(t),null;case 1:case 17:return Pr(t.type)&&Mr(),Ho(t),null;case 3:return s=t.stateNode,Ki(),Cr(Ir),Cr(Tr),na(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==e&&null!==e.child||(di(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ac(ii),ii=null))),Po(e,t),Ho(t),null;case 5:Ji(t);var r=Qi(Gi.current);if(n=t.type,null!==e&&null!=t.stateNode)Mo(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(null===t.stateNode)throw Error(i(166));return Ho(t),null}if(e=Qi(Wi.current),di(t)){s=t.stateNode,n=t.type;var a=t.memoizedProps;switch(s[hr]=t,s[mr]=a,e=0!==(1&t.mode),n){case"dialog":Fs("cancel",s),Fs("close",s);break;case"iframe":case"object":case"embed":Fs("load",s);break;case"video":case"audio":for(r=0;r<Os.length;r++)Fs(Os[r],s);break;case"source":Fs("error",s);break;case"img":case"image":case"link":Fs("error",s),Fs("load",s);break;case"details":Fs("toggle",s);break;case"input":K(s,a),Fs("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!a.multiple},Fs("invalid",s);break;case"textarea":re(s,a),Fs("invalid",s)}for(var l in ye(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?s.textContent!==c&&(!0!==a.suppressHydrationWarning&&Js(s.textContent,c,e),r=["children",c]):"number"===typeof c&&s.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Js(s.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fs("scroll",s)}switch(n){case"input":H(s),Z(s,a,!0);break;case"textarea":H(s),ae(s);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(s.onclick=Zs)}s=r,t.updateQueue=s,null!==s&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof s.is?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),"select"===n&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[hr]=t,e[mr]=s,Ao(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(n,s),n){case"dialog":Fs("cancel",e),Fs("close",e),r=s;break;case"iframe":case"object":case"embed":Fs("load",e),r=s;break;case"video":case"audio":for(r=0;r<Os.length;r++)Fs(Os[r],e);r=s;break;case"source":Fs("error",e),r=s;break;case"img":case"image":case"link":Fs("error",e),Fs("load",e),r=s;break;case"details":Fs("toggle",e),r=s;break;case"input":K(e,s),r=Y(e,s),Fs("invalid",e);break;case"option":default:r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=L({},s,{value:void 0}),Fs("invalid",e);break;case"textarea":re(e,s),r=se(e,s),Fs("invalid",e)}for(a in ye(n,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Fs("scroll",e):null!=u&&x(e,a,u,l))}switch(n){case"input":H(e),Z(e,s,!1);break;case"textarea":H(e),ae(e);break;case"option":null!=s.value&&e.setAttribute("value",""+q(s.value));break;case"select":e.multiple=!!s.multiple,null!=(a=s.value)?ne(e,!!s.multiple,a,!1):null!=s.defaultValue&&ne(e,!!s.multiple,s.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zs)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ho(t),null;case 6:if(e&&null!=t.stateNode)Do(e,t,e.memoizedProps,s);else{if("string"!==typeof s&&null===t.stateNode)throw Error(i(166));if(n=Qi(Gi.current),Qi(Wi.current),di(t)){if(s=t.stateNode,n=t.memoizedProps,s[hr]=t,(a=s.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Js(s.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Js(s.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(s=(9===n.nodeType?n:n.ownerDocument).createTextNode(s))[hr]=t,t.stateNode=s}return Ho(t),null;case 13:if(Cr(Zi),s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ri&&null!==si&&0!==(1&t.mode)&&0===(128&t.flags))hi(),mi(),t.flags|=98560,a=!1;else if(a=di(t),null!==s&&null!==s.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[hr]=t}else mi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ho(t),a=!1}else null!==ii&&(ac(ii),ii=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((s=null!==s)!==(null!==e&&null!==e.memoizedState)&&s&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zi.current)?0===Dl&&(Dl=3):fc())),null!==t.updateQueue&&(t.flags|=4),Ho(t),null);case 4:return Ki(),Po(e,t),null===e&&Bs(t.stateNode.containerInfo),Ho(t),null;case 10:return _i(t.type._context),Ho(t),null;case 19:if(Cr(Zi),null===(a=t.memoizedState))return Ho(t),null;if(s=0!==(128&t.flags),null===(l=a.rendering))if(s)Wo(a,!1);else{if(0!==Dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Wo(a,!1),null!==(s=l.updateQueue)&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;null!==n;)e=s,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Sr(Zi,1&Zi.current|2),t.child}e=e.sibling}null!==a.tail&&Xe()>Bl&&(t.flags|=128,s=!0,Wo(a,!1),t.lanes=4194304)}else{if(!s)if(null!==(e=ea(l))){if(t.flags|=128,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!ri)return Ho(t),null}else 2*Xe()-a.renderingStartTime>Bl&&1073741824!==n&&(t.flags|=128,s=!0,Wo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Xe(),t.sibling=null,n=Zi.current,Sr(Zi,s?1&n|2:1&n),t):(Ho(t),null);case 22:case 23:return dc(),s=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==s&&(t.flags|=8192),s&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Ho(t),6&t.subtreeFlags&&(t.flags|=8192)):Ho(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Qo(e,t){switch(ti(t),t.tag){case 1:return Pr(t.type)&&Mr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ki(),Cr(Ir),Cr(Tr),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ji(t),null;case 13:if(Cr(Zi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));mi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Cr(Zi),null;case 4:return Ki(),null;case 10:return _i(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ao=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Mo=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Qi(Wi.current);var i,a=null;switch(n){case"input":r=Y(e,r),s=Y(e,s),a=[];break;case"select":r=L({},r,{value:void 0}),s=L({},s,{value:void 0}),a=[];break;case"textarea":r=se(e,r),s=se(e,s),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof s.onClick&&(e.onclick=Zs)}for(u in ye(n,s),n=null,r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in s){var c=s[u];if(l=null!=r?r[u]:void 0,s.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fs("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Do=function(e,t,n,s){n!==s&&(t.flags|=4)};var Yo=!1,Ko=!1,Xo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(s){jc(e,t,s)}else n.current=null}function el(e,t,n){try{n()}catch(s){jc(e,t,s)}}var tl=!1;function nl(e,t,n){var s=t.updateQueue;if(null!==(s=null!==s?s.lastEffect:null)){var r=s=s.next;do{if((r.tag&e)===e){var i=r.destroy;r.destroy=void 0,void 0!==i&&el(t,n,i)}r=r.next}while(r!==s)}}function sl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[mr],delete t[fr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zs));else if(4!==s&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)ml(e,t,n),n=n.sibling}function ml(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(rt,n)}catch(o){}switch(n.tag){case 5:Ko||Zo(n,t);case 6:var s=ul,r=dl;ul=null,hl(e,t,n),dl=r,null!==(ul=s)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Bt(e)):lr(ul,n.stateNode));break;case 4:s=ul,r=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=s,dl=r;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(s=n.updateQueue)&&null!==(s=s.lastEffect))){r=s=s.next;do{var i=r,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&el(n,t,a),r=r.next}while(r!==s)}hl(e,t,n);break;case 1:if(!Ko&&(Zo(n,t),"function"===typeof(s=n.stateNode).componentWillUnmount))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(o){jc(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Ko=(s=Ko)||null!==n.memoizedState,hl(e,t,n),Ko=s):hl(e,t,n);break;default:hl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xo),t.forEach(function(t){var s=Tc.bind(null,e,t);n.has(t)||(n.add(t),t.then(s,s))})}}function fl(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var r=n[s];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(i(160));ml(a,o,r),ul=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){jc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),vl(e),4&s){try{nl(3,e,e.return),sl(3,e)}catch(g){jc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){jc(e,e.return,g)}}break;case 1:fl(t,e),vl(e),512&s&&null!==n&&Zo(n,n.return);break;case 5:if(fl(t,e),vl(e),512&s&&null!==n&&Zo(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){jc(e,e.return,g)}}if(4&s&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&X(r,a),xe(l,o);var u=xe(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):x(r,d,h,u)}switch(l){case"input":J(r,a);break;case"textarea":ie(r,a);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(r,!!a.multiple,p,!1):m!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[mr]=a}catch(g){jc(e,e.return,g)}}break;case 6:if(fl(t,e),vl(e),4&s){if(null===e.stateNode)throw Error(i(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){jc(e,e.return,g)}}break;case 3:if(fl(t,e),vl(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(g){jc(e,e.return,g)}break;case 4:default:fl(t,e),vl(e);break;case 13:fl(t,e),vl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vl=Xe())),4&s&&pl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ko=(u=Ko)||d,fl(t,e),Ko=u):fl(t,e),vl(e),8192&s){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Jo=e,d=e.child;null!==d;){for(h=Jo=d;null!==Jo;){switch(p=(m=Jo).child,m.tag){case 0:case 11:case 14:case 15:nl(4,m,m.return);break;case 1:Zo(m,m.return);var f=m.stateNode;if("function"===typeof f.componentWillUnmount){s=m,n=m.return;try{t=s,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){jc(s,n,g)}}break;case 5:Zo(m,m.return);break;case 22:if(null!==m.memoizedState){wl(h);continue}}null!==p?(p.return=m,Jo=p):wl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",o))}catch(g){jc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){jc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fl(t,e),vl(e),4&s&&pl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var s=n;break e}n=n.return}throw Error(i(160))}switch(s.tag){case 5:var r=s.stateNode;32&s.flags&&(he(r,""),s.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=s.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(i(161))}}catch(o){jc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Jo=e,xl(e,t,n)}function xl(e,t,n){for(var s=0!==(1&e.mode);null!==Jo;){var r=Jo,i=r.child;if(22===r.tag&&s){var a=null!==r.memoizedState||Yo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Yo;var c=Ko;if(Yo=a,(Ko=l)&&!c)for(Jo=r;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?kl(r):null!==l?(l.return=a,Jo=l):kl(r);for(;null!==i;)Jo=i,xl(i,t,n),i=i.sibling;Jo=r,Yo=o,Ko=c}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==i?(i.return=r,Jo=i):bl(e)}}function bl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||sl(5,t);break;case 1:var s=t.stateNode;if(4&t.flags&&!Ko)if(null===n)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&zi(t,a,s);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}zi(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Bt(h)}}}break;default:throw Error(i(163))}Ko||512&t.flags&&rl(t)}catch(m){jc(t,t.return,m)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function wl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Jo=n;break}Jo=t.return}}function kl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{sl(4,t)}catch(l){jc(t,n,l)}break;case 1:var s=t.stateNode;if("function"===typeof s.componentDidMount){var r=t.return;try{s.componentDidMount()}catch(l){jc(t,r,l)}}var i=t.return;try{rl(t)}catch(l){jc(t,i,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){jc(t,a,l)}}}catch(l){jc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Nl,jl=Math.ceil,Cl=b.ReactCurrentDispatcher,Sl=b.ReactCurrentOwner,_l=b.ReactCurrentBatchConfig,Tl=0,Il=null,El=null,Al=0,Pl=0,Ml=jr(0),Dl=0,Ol=null,Rl=0,Ll=0,$l=0,Fl=null,Ul=null,Vl=0,Bl=1/0,zl=null,ql=!1,Wl=null,Hl=null,Gl=!1,Ql=null,Yl=0,Kl=0,Xl=null,Jl=-1,Zl=0;function ec(){return 0!==(6&Tl)?Xe():-1!==Jl?Jl:Jl=Xe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Tl)&&0!==Al?Al&-Al:null!==fi.transition?(0===Zl&&(Zl=ft()),Zl):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function nc(e,t,n,s){if(50<Kl)throw Kl=0,Xl=null,Error(i(185));vt(e,n,s),0!==(2&Tl)&&e===Il||(e===Il&&(0===(2&Tl)&&(Ll|=n),4===Dl&&oc(e,Al)),sc(e,s),1===n&&0===Tl&&0===(1&t.mode)&&(Bl=Xe()+500,Fr&&Br()))}function sc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&s)||(r[a]=mt(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var s=ht(e,e===Il?Al:0);if(0===s)null!==n&&Qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(null!=n&&Qe(n),1===t)0===e.tag?function(e){Fr=!0,Vr(e)}(lc.bind(null,e)):Vr(lc.bind(null,e)),ar(function(){0===(6&Tl)&&Br()}),n=null;else{switch(bt(s)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=st}n=Ic(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Jl=-1,Zl=0,0!==(6&Tl))throw Error(i(327));var n=e.callbackNode;if(kc()&&e.callbackNode!==n)return null;var s=ht(e,e===Il?Al:0);if(0===s)return null;if(0!==(30&s)||0!==(s&e.expiredLanes)||t)t=gc(e,s);else{t=s;var r=Tl;Tl|=2;var a=pc();for(Il===e&&Al===t||(zl=null,Bl=Xe()+500,hc(e,t));;)try{yc();break}catch(l){mc(e,l)}Si(),Cl.current=a,Tl=r,null!==El?t=0:(Il=null,Al=0,t=Dl)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(s=r,t=ic(e,r))),1===t)throw n=Ol,hc(e,0),oc(e,s),sc(e,Xe()),n;if(6===t)oc(e,s);else{if(r=e.current.alternate,0===(30&s)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!os(i(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,s))&&(0!==(a=pt(e))&&(s=a,t=ic(e,a))),1===t))throw n=Ol,hc(e,0),oc(e,s),sc(e,Xe()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(i(345));case 2:case 5:wc(e,Ul,zl);break;case 3:if(oc(e,s),(130023424&s)===s&&10<(t=Vl+500-Xe())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&s)!==s){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=sr(wc.bind(null,e,Ul,zl),t);break}wc(e,Ul,zl);break;case 4:if(oc(e,s),(4194240&s)===s)break;for(t=e.eventTimes,r=-1;0<s;){var o=31-at(s);a=1<<o,(o=t[o])>r&&(r=o),s&=~a}if(s=r,10<(s=(120>(s=Xe()-s)?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*jl(s/1960))-s)){e.timeoutHandle=sr(wc.bind(null,e,Ul,zl),s);break}wc(e,Ul,zl);break;default:throw Error(i(329))}}}return sc(e,Xe()),e.callbackNode===n?rc.bind(null,e):null}function ic(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){for(t&=~$l,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),s=1<<n;e[n]=-1,t&=~s}}function lc(e){if(0!==(6&Tl))throw Error(i(327));kc();var t=ht(e,0);if(0===(1&t))return sc(e,Xe()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var s=pt(e);0!==s&&(t=s,n=ic(e,s))}if(1===n)throw n=Ol,hc(e,0),oc(e,t),sc(e,Xe()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,zl),sc(e,Xe()),null}function cc(e,t){var n=Tl;Tl|=1;try{return e(t)}finally{0===(Tl=n)&&(Bl=Xe()+500,Fr&&Br())}}function uc(e){null!==Ql&&0===Ql.tag&&0===(6&Tl)&&kc();var t=Tl;Tl|=1;var n=_l.transition,s=xt;try{if(_l.transition=null,xt=1,e)return e()}finally{xt=s,_l.transition=n,0===(6&(Tl=t))&&Br()}}function dc(){Pl=Ml.current,Cr(Ml)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==El)for(n=El.return;null!==n;){var s=n;switch(ti(s),s.tag){case 1:null!==(s=s.type.childContextTypes)&&void 0!==s&&Mr();break;case 3:Ki(),Cr(Ir),Cr(Tr),na();break;case 5:Ji(s);break;case 4:Ki();break;case 13:case 19:Cr(Zi);break;case 10:_i(s.type._context);break;case 22:case 23:dc()}n=n.return}if(Il=e,El=e=Mc(e.current,null),Al=Pl=t,Dl=0,Ol=null,$l=Ll=Rl=0,Ul=Fl=null,null!==Ai){for(t=0;t<Ai.length;t++)if(null!==(s=(n=Ai[t]).interleaved)){n.interleaved=null;var r=s.next,i=n.pending;if(null!==i){var a=i.next;i.next=r,s.next=a}n.pending=s}Ai=null}return e}function mc(e,t){for(;;){var n=El;try{if(Si(),sa.current=Xa,ca){for(var s=aa.memoizedState;null!==s;){var r=s.queue;null!==r&&(r.pending=null),s=s.next}ca=!1}if(ia=0,la=oa=aa=null,ua=!1,da=0,Sl.current=null,null===n||null===n.return){Dl=1,Ol=t,El=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Al,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var m=d.alternate;m?(d.updateQueue=m.updateQueue,d.memoizedState=m.memoizedState,d.lanes=m.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,vo(p,o,l,0,t),1&p.mode&&fo(a,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){fo(a,u,t),fc();break e}c=Error(i(426))}else if(ri&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),pi(lo(c,l));break e}}a=c=lo(c,l),4!==Dl&&(Dl=2),null===Fl?Fl=[a]:Fl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vi(a,mo(0,c,t));break e;case 1:l=c;var y=a.type,x=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Hl||!Hl.has(x)))){a.flags|=65536,t&=-t,a.lanes|=t,Vi(a,po(a,l,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(b){t=b,El===n&&null!==n&&(El=n=n.return);continue}break}}function pc(){var e=Cl.current;return Cl.current=Xa,null===e?Xa:e}function fc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Il||0===(268435455&Rl)&&0===(268435455&Ll)||oc(Il,Al)}function gc(e,t){var n=Tl;Tl|=2;var s=pc();for(Il===e&&Al===t||(zl=null,hc(e,t));;)try{vc();break}catch(r){mc(e,r)}if(Si(),Tl=n,Cl.current=s,null!==El)throw Error(i(261));return Il=null,Al=0,Dl}function vc(){for(;null!==El;)xc(El)}function yc(){for(;null!==El&&!Ye();)xc(El)}function xc(e){var t=Nl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?bc(e):El=t,Sl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Go(n,t,Pl)))return void(El=n)}else{if(null!==(n=Qo(n,t)))return n.flags&=32767,void(El=n);if(null===e)return Dl=6,void(El=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(El=t);El=t=e}while(null!==t);0===Dl&&(Dl=5)}function wc(e,t,n){var s=xt,r=_l.transition;try{_l.transition=null,xt=1,function(e,t,n,s){do{kc()}while(null!==Ql);if(0!==(6&Tl))throw Error(i(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),i=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~i}}(e,a),e===Il&&(El=Il=null,Al=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gl||(Gl=!0,Ic(tt,function(){return kc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=_l.transition,_l.transition=null;var o=xt;xt=1;var l=Tl;Tl|=4,Sl.current=null,function(e,t){if(er=qt,ms(e=hs())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var r=s.anchorOffset,a=s.focusNode;s=s.focusOffset;try{n.nodeType,a.nodeType}catch(w){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,m=null;t:for(;;){for(var p;h!==n||0!==r&&3!==h.nodeType||(l=o+r),h!==a||0!==s&&3!==h.nodeType||(c=o+s),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===n&&++u===r&&(l=o),m===a&&++d===s&&(c=o),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},qt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(i(163))}}catch(w){jc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}f=tl,tl=!1}(e,n),gl(n,e),ps(tr),qt=!!er,tr=er=null,e.current=n,yl(n,e,r),Ke(),Tl=l,xt=o,_l.transition=a}else e.current=n;if(Gl&&(Gl=!1,Ql=e,Yl=r),a=e.pendingLanes,0===a&&(Hl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),sc(e,Xe()),null!==t)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(ql)throw ql=!1,e=Wl,Wl=null,e;0!==(1&Yl)&&0!==e.tag&&kc(),a=e.pendingLanes,0!==(1&a)?e===Xl?Kl++:(Kl=0,Xl=e):Kl=0,Br()}(e,t,n,s)}finally{_l.transition=r,xt=s}return null}function kc(){if(null!==Ql){var e=bt(Yl),t=_l.transition,n=xt;try{if(_l.transition=null,xt=16>e?16:e,null===Ql)var s=!1;else{if(e=Ql,Ql=null,Yl=0,0!==(6&Tl))throw Error(i(331));var r=Tl;for(Tl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Jo=u;null!==Jo;){var d=Jo;switch(d.tag){case 0:case 11:case 15:nl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Jo=h;else for(;null!==Jo;){var m=(d=Jo).sibling,p=d.return;if(il(d),d===u){Jo=null;break}if(null!==m){m.return=p,Jo=m;break}Jo=p}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var x=e.current;for(Jo=x;null!==Jo;){var b=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,Jo=b;else e:for(o=x;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:sl(9,l)}}catch(k){jc(l,l.return,k)}if(l===o){Jo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Jo=w;break e}Jo=l.return}}if(Tl=r,Br(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(rt,e)}catch(k){}s=!0}return s}finally{xt=n,_l.transition=t}}return!1}function Nc(e,t,n){e=Fi(e,t=mo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),sc(e,t))}function jc(e,t,n){if(3===e.tag)Nc(e,e,n);else for(;null!==t;){if(3===t.tag){Nc(t,e,n);break}if(1===t.tag){var s=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof s.componentDidCatch&&(null===Hl||!Hl.has(s))){t=Fi(t,e=po(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),sc(t,e));break}}t=t.return}}function Cc(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Al&n)===n&&(4===Dl||3===Dl&&(130023424&Al)===Al&&500>Xe()-Vl?hc(e,0):$l|=n),sc(e,t)}function Sc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Di(e,t))&&(vt(e,t,n),sc(e,n))}function _c(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Sc(e,n)}function Tc(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(i(314))}null!==s&&s.delete(t),Sc(e,n)}function Ic(e,t){return Ge(e,t)}function Ec(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ac(e,t,n,s){return new Ec(e,t,n,s)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Ac(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dc(e,t,n,s,r,a){var o=2;if(s=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case N:return Oc(n.children,r,a,t);case j:o=8,r|=8;break;case C:return(e=Ac(12,n,t,2|r)).elementType=C,e.lanes=a,e;case I:return(e=Ac(13,n,t,r)).elementType=I,e.lanes=a,e;case E:return(e=Ac(19,n,t,r)).elementType=E,e.lanes=a,e;case M:return Rc(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:o=10;break e;case _:o=9;break e;case T:o=11;break e;case A:o=14;break e;case P:o=16,s=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Ac(o,n,t,r)).elementType=e,t.type=s,t.lanes=a,t}function Oc(e,t,n,s){return(e=Ac(7,e,s,t)).lanes=n,e}function Rc(e,t,n,s){return(e=Ac(22,e,s,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Lc(e,t,n){return(e=Ac(6,e,null,t)).lanes=n,e}function $c(e,t,n){return(t=Ac(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,s,r,i,a,o,l){return e=new Fc(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Ac(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Vc(e){if(!e)return _r;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Pr(n))return Or(e,n,t)}return t}function Bc(e,t,n,s,r,i,a,o,l){return(e=Uc(n,s,!0,e,0,i,0,o,l)).context=Vc(null),n=e.current,(i=$i(s=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,Fi(n,i,r),e.current.lanes=r,vt(e,r,s),sc(e,s),e}function zc(e,t,n,s){var r=t.current,i=ec(),a=tc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=$i(i,a)).payload={element:e},null!==(s=void 0===s?null:s)&&(t.callback=s),null!==(e=Fi(r,t,a))&&(nc(e,r,a,i),Ui(e,r,a)),a}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Nl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)xo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),mi();break;case 5:Xi(t);break;case 1:Pr(t.type)&&Rr(t);break;case 4:Yi(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;Sr(ki,s._currentValue),s._currentValue=r;break;case 13:if(null!==(s=t.memoizedState))return null!==s.dehydrated?(Sr(Zi,1&Zi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Lo(e,t,n):(Sr(Zi,1&Zi.current),null!==(e=qo(e,t,n))?e.sibling:null);Sr(Zi,1&Zi.current);break;case 19:if(s=0!==(n&t.childLanes),0!==(128&e.flags)){if(s)return Bo(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Sr(Zi,Zi.current),s)break;return null;case 22:case 23:return t.lanes=0,jo(e,t,n)}return qo(e,t,n)}(e,t,n);xo=0!==(131072&e.flags)}else xo=!1,ri&&0!==(1048576&t.flags)&&Zr(t,Hr,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;zo(e,t),e=t.pendingProps;var r=Ar(t,Tr.current);Ii(t,n),r=fa(null,t,s,e,r,n);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pr(s)?(a=!0,Rr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ri(t),r.updater=so,t.stateNode=r,r._reactInternals=t,oo(t,s,e,n),t=To(null,t,s,!0,a,n)):(t.tag=0,ri&&a&&ei(t),bo(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(zo(e,t),e=t.pendingProps,s=(r=s._init)(s._payload),t.type=s,r=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===A)return 14}return 2}(s),e=to(s,e),r){case 0:t=So(null,t,s,e,n);break e;case 1:t=_o(null,t,s,e,n);break e;case 11:t=wo(null,t,s,e,n);break e;case 14:t=ko(null,t,s,to(s.type,e),n);break e}throw Error(i(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,So(e,t,s,r=t.elementType===s?r:to(s,r),n);case 1:return s=t.type,r=t.pendingProps,_o(e,t,s,r=t.elementType===s?r:to(s,r),n);case 3:e:{if(Io(t),null===e)throw Error(i(387));s=t.pendingProps,r=(a=t.memoizedState).element,Li(e,t),Bi(t,s,null,n);var o=t.memoizedState;if(s=o.element,a.isDehydrated){if(a={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Eo(e,t,s,n,r=lo(Error(i(423)),t));break e}if(s!==r){t=Eo(e,t,s,n,r=lo(Error(i(424)),t));break e}for(si=cr(t.stateNode.containerInfo.firstChild),ni=t,ri=!0,ii=null,n=wi(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(mi(),s===r){t=qo(e,t,n);break e}bo(e,t,s,n)}t=t.child}return t;case 5:return Xi(t),null===e&&ci(t),s=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,nr(s,r)?o=null:null!==a&&nr(s,a)&&(t.flags|=32),Co(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Lo(e,t,n);case 4:return Yi(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=bi(t,null,s,n):bo(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,wo(e,t,s,r=t.elementType===s?r:to(s,r),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Sr(ki,s._currentValue),s._currentValue=o,null!==a)if(os(a.value,o)){if(a.children===r.children&&!Ir.current){t=qo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===s){if(1===a.tag){(c=$i(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ti(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ti(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,Ii(t,n),s=s(r=Ei(r)),t.flags|=1,bo(e,t,s,n),t.child;case 14:return r=to(s=t.type,t.pendingProps),ko(e,t,s,r=to(s.type,r),n);case 15:return No(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:to(s,r),zo(e,t),t.tag=1,Pr(s)?(e=!0,Rr(t)):e=!1,Ii(t,n),io(t,s,r),oo(t,s,r,n),To(null,t,s,!0,e,n);case 19:return Bo(e,t,n);case 22:return jo(e,t,n)}throw Error(i(156,t.tag))};var Gc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,n,s,r){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof r){var o=r;r=function(){var e=qc(a);o.call(e)}}zc(t,a,e,r)}else a=function(e,t,n,s,r){if(r){if("function"===typeof s){var i=s;s=function(){var e=qc(a);i.call(e)}}var a=Bc(t,s,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[pr]=a.current,Bs(8===e.nodeType?e.parentNode:e),uc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof s){var o=s;s=function(){var e=qc(l);o.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[pr]=l.current,Bs(8===e.nodeType?e.parentNode:e),uc(function(){zc(t,l,n,s)}),l}(n,t,e,r,s);return qc(a)}Yc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));zc(e,t,null,null)},Yc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){zc(null,e,null,null)}),t[pr]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=jt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Lt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),sc(t,Xe()),0===(6&Tl)&&(Bl=Xe()+500,Br()))}break;case 13:uc(function(){var t=Di(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Hc(e,1)}},kt=function(e){if(13===e.tag){var t=Di(e,134217728);if(null!==t)nc(t,e,134217728,ec());Hc(e,134217728)}},Nt=function(e){if(13===e.tag){var t=tc(e),n=Di(e,t);if(null!==n)nc(n,e,t,ec());Hc(e,t)}},jt=function(){return xt},Ct=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},ke=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=wr(s);if(!r)throw Error(i(90));G(s),J(s,r)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[xr,br,wr,Se,_e,cc]},tu={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var su=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!su.isDisabled&&su.supportsFiber)try{rt=su.inject(nu),it=su}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(i(200));return function(e,t,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==s?null:""+s,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(i(299));var n=!1,s="",r=Gc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,s,r),e[pr]=t.current,Bs(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(i(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(i(405));var s=null!=n&&n.hydratedSources||null,r=!1,a="",o=Gc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Bc(t,null,e,1,null!=n?n:null,r,0,a,o),e[pr]=t.current,Bs(e),s)for(e=0;e<s.length;e++)r=(r=(n=s[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(i(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(i(40));return!!e._reactRootContainer&&(uc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[pr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Xc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return Zc(e,t,n,!1,s)},t.version="18.3.1-next-f1338f8080-20240426"},2801:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/equites.e6038606d2cce93219ea.png"},2809:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/manticore.e0843798f3c5d2cc7185.png"},2815:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/Scarab.f2948695f4e40034ad9d.png"},2985:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/odysseus.1d1033f4d1d7a365b575.png"},2998:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/library_of_alexandria.ef7d9b683ae89a6b9359.png"},3053:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/ballistics.81aa640dfa673b2bea8d.png"},3207:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/academy.e9ab6d79578655671e82.png"},3388:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/login.00a22d898a064422c2e3.png"},3407:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/anubis.689184d621bf72dfff19.png"},3448:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/population.1b5638e85d7333c286f6.png"},3524:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/rapid_mobilization.0fa137d41177982ca427.png"},3542:(e,t,n)=>{var s={"./Scarab.png":2815,"./Serpopard.png":9407,"./Sphinx.png":403,"./archers.png":3925,"./athenian_archer.png":643,"./athenian_cavalry.png":4366,"./athenian_hoplite.png":1985,"./athenian_swordsman.png":9310,"./athenian_trireme.png":6714,"./cavalry.png":9751,"./centaur.png":9307,"./corinthian_archer.png":9894,"./corinthian_cavalry.png":6509,"./corinthian_hoplite.png":882,"./corinthian_marine.png":2537,"./corinthian_trireme.png":6909,"./equites.png":2801,"./fast_transport_ship.png":2052,"./griffin.png":7872,"./harpy.png":3757,"./hospite.png":6891,"./legionary.png":2201,"./manticore.png":2809,"./medusa.png":1290,"./minotaur.png":9394,"./mummy.png":9476,"./pegasus.png":6377,"./phoenix.png":6424,"./praetorian_guard.png":6794,"./roman_archer.png":198,"./roman_quinquereme.png":8160,"./slinger.png":5083,"./spartan_archer.png":9132,"./spartan_cavalry.png":5999,"./spartan_hoplite.png":6516,"./spartan_hoplite_elite.png":1476,"./spartan_trireme.png":7555,"./swordman.png":7912,"./transport_ship.png":6981,"./trireme.png":2459};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=3542},3641:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/city_wall.6e155d5f612caa7484bd.png"},3718:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/cave.f337ff4c845c9ff9c185.png"},3757:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/harpy.f30e6cb8955c016ee5fd.png"},3824:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/osiris.db38b08da543d08c416e.png"},3922:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/ruins.02d6da978b0aeb81cc4d.png"},3925:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/archers.e0e384fc61b159e767a2.png"},3938:(e,t,n)=>{var s={"./alliance_wonders.jpg":8611,"./colossus.png":174,"./great_lighthouse.png":611,"./hanging_gardens.png":7042,"./library_of_alexandria.png":2998,"./merchant_guild.png":8941,"./oracle.png":119,"./special_building_plot.png":9867};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=3938},4004:(e,t,n)=>{var s={"./battle_points.png":8559,"./city_layout.png":5297,"./city_modal.png":640,"./god-town.png":7200,"./helmet.png":2532,"./login.png":3388,"./logout.png":2601,"./movement.png":5708,"./placeholder_profile.png":8258,"./ruins.png":3922,"./spells.png":1538,"./trade.png":481,"./villages.png":232,"./water.png":9406,"./world_selection.png":7712,"./world_selection_screen.png":7433};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=4004},4143:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/senate.34ced978c0b1988e5744.png"},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var b=x.prototype=new y;b.constructor=x,f(b,v.prototype),b.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,N={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,s){var r,i={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)k.call(t,r)&&!j.hasOwnProperty(r)&&(i[r]=t[r]);var l=arguments.length-2;if(1===l)i.children=s;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===i[r]&&(i[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:o,props:i,_owner:N.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var _=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,r,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case s:l=!0}}if(l)return a=a(l=e),e=""===i?"."+T(l,0):i,w(a)?(r="",null!=e&&(r=e.replace(_,"$&/")+"/"),I(a,t,r,"",function(e){return e})):null!=a&&(S(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(_,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var u=i+T(o=e[c],c);l+=I(o,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,r,u=i+T(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function E(e,t,n){if(null==e)return e;var s=[],r=0;return I(e,s,"","",function(e){return t.call(n,e,r++)}),s}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},M={transition:null},D={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:M,ReactCurrentOwner:N};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:E,forEach:function(e,t,n){E(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return E(e,function(){t++}),t},toArray:function(e){return E(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=x,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=O,t.cloneElement=function(e,t,s){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=f({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=N.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)k.call(t,c)&&!j.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=s;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:i,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},4366:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athenian_cavalry.020d009b1fbf28c1f4a3.png"},4391:(e,t,n)=>{"use strict";var s=n(7950);t.createRoot=s.createRoot,t.hydrateRoot=s.hydrateRoot},4731:(e,t,n)=>{var s={"./achilles.png":6569,"./odysseus.png":2985};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=4731},4828:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/barracks.a0c9216cef06834b0cd1.png"},4858:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/temple.d21543ec5eaa5b048b3d.png"},5041:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/farm.aee352708fee5a48b0fc.png"},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5083:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/slinger.099462d3f32b016e5263.png"},5156:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/warcry.03ff0ba1f4cf72f5e5c0.png"},5297:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/city_layout.95146de3456e4ae3ba0c.png"},5316:(e,t,n)=>{var s={"./anubis.png":3407,"./athena.png":402,"./hera.png":8373,"./horus.png":6408,"./juno.png":2561,"./jupiter.png":7440,"./minerva.png":9933,"./osiris.png":3824,"./zeus.png":292};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=5316},5387:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/silver_mines.9066a9c0237f4dfd520c.png"},5459:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/stone_quarry.339822c54ca5c3a60859.png"},5708:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/movement.c2675ba5aeda1413f36f.png"},5982:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/wood.922c4c93c417eb15849c.png"},5999:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spartan_cavalry.b4e6b729f79d8c515508.png"},6377:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/pegasus.12306d167753baad1385.png"},6408:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/horus.fea5b4fa1b25bf0c9400.png"},6424:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/phoenix.5107f9505b67e46d1ad1.png"},6509:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/corinthian_cavalry.110517f5cbfef1628073.png"},6516:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spartan_hoplite.bef7b46e20a89c194f1b.png"},6569:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/achilles.995c3e2bdbae101ca1aa.png"},6714:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athenian_trireme.abae5137a3e71d93d293.png"},6779:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/phalanx.ae8fe03d5e561b8151b7.png"},6794:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/praetorian_guard.2ffe47ea77872f2fea23.png"},6864:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/architecture.b53619d976fea75bd7fb.png"},6891:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/hospite.5eafd06f27a0eb5226ce.png"},6909:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/corinthian_trireme.570c0f882b5b3c048b2d.png"},6975:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/master_spy.ec2a4a097183c182666f.png"},6981:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/transport_ship.a9f58974e8aa6733a77f.png"},7042:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/hanging_gardens.3bca705c8be3a0050d0d.png"},7200:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/god-town.98baf2c02fd86f474ba4.png"},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,r=e[s];if(!(0<i(r,t)))break e;e[s]=t,e[n]=r,n=s}}function s(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,r=e.length,a=r>>>1;s<a;){var o=2*(s+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<r&&0>i(u,l)?(e[s]=u,e[c]=n,s=c):(e[s]=l,e[o]=n,s=o);else{if(!(c<r&&0>i(u,n)))break e;e[s]=u,e[c]=n,s=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,m=3,p=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=s(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=s(u)}}function w(e){if(g=!1,b(e),!f)if(null!==s(c))f=!0,M(k);else{var t=s(u);null!==t&&D(w,t.startTime-e)}}function k(e,n){f=!1,g&&(g=!1,y(S),S=-1),p=!0;var i=m;try{for(b(n),h=s(c);null!==h&&(!(h.expirationTime>n)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,m=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===s(c)&&r(c),b(n)}else r(c);h=s(c)}if(null!==h)var l=!0;else{var d=s(u);null!==d&&D(w,d.startTime-n),l=!1}return l}finally{h=null,m=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var N,j=!1,C=null,S=-1,_=5,T=-1;function I(){return!(t.unstable_now()-T<_)}function E(){if(null!==C){var e=t.unstable_now();T=e;var n=!0;try{n=C(!0,e)}finally{n?N():(j=!1,C=null)}}else j=!1}if("function"===typeof x)N=function(){x(E)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,P=A.port2;A.port1.onmessage=E,N=function(){P.postMessage(null)}}else N=function(){v(E,0)};function M(e){C=e,j||(j=!0,N())}function D(e,n){S=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,M(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return s(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},t.unstable_scheduleCallback=function(e,r,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,n(u,e),null===s(c)&&e===s(u)&&(g?(y(S),S=-1):g=!0,D(w,i-a))):(e.sortIndex=o,n(c,e),f||p||(f=!0,M(k))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}},7433:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/world_selection_screen.b8c39702411c0fd51f71.png"},7440:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/jupiter.8ef1ec6e96ec2e05455d.png"},7527:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/lumber_mill.3b2cd9dcc2656698a1a4.png"},7555:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spartan_trireme.59faf647fe18ddf640a3.png"},7635:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/hospital.096128ff8eaeed9a7045.png"},7712:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/world_selection.685bb2a064920ca42c5c.png"},7872:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/griffin.844f9b637aabfa327743.png"},7912:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/swordman.76d285eb6ef7ea613eb1.png"},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8160:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/roman_quinquereme.65779fd3c941a9dce578.png"},8258:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/placeholder_profile.cde71e2edf3afc75c859.png"},8373:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/hera.b8b131b4386720b66914.png"},8456:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/heroes_altar.766e0f9ebfcce275ea77.png"},8559:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/battle_points.4072dfc65d5123cabcac.png"},8562:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/divine_temple.68af444a1c59d4c4f870.png"},8611:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/alliance_wonders.437341ef80b41fcd117a.jpg"},8781:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/market.7193c6c0da6c9113eb89.png"},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8941:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/merchant_guild.49c1d810f2b6b209da04.png"},9088:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/shipwright.454231673d79f28defb9.png"},9132:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/spartan_archer.ca4da2e3d50ff0507991.png"},9283:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/shipyard.cd7f5369d25c4aec689d.png"},9307:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/centaur.1a51c22e4555cd2ddf4f.png"},9310:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/athenian_swordsman.1bd7dc21f41a6c1e04ee.png"},9394:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/minotaur.ec7abfad41417e1aaa70.png"},9406:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/water.d127ef0eccc18197cb25.png"},9407:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/Serpopard.b8a5258db256c51b4e2c.png"},9476:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/mummy.e6e816ef6a43d5ad82a4.png"},9751:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/cavalry.cef2ef03c5b5de4c9f16.png"},9867:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/special_building_plot.3bca705c8be3a0050d0d.png"},9894:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/corinthian_archer.f80f2bd6918d0547e478.png"},9933:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/minerva.b7db6f80b08a5d44489b.png"}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",(()=>{"use strict";var e=n(5043),t=n(4391);const s=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&s+1<e.length&&56320===(64512&e.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++s)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,a=i?e[r+1]:0,o=r+2<e.length,l=o?e[r+2]:0,c=t>>2,u=(3&t)<<4|a>>4;let d=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(d=64)),s.push(n[c],n[u],n[d],n[h])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const r=e[n++];if(r<128)t[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[n++];t[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],a=e[n++];t[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],a=r<e.length?n[e.charAt(r)]:0;++r;const o=r<e.length?n[e.charAt(r)]:64;++r;const l=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==a||null==o||null==l)throw new i;const c=t<<2|a>>4;if(s.push(c),64!==o){const e=a<<4&240|o>>2;if(s.push(e),64!==l){const e=o<<6&192|l;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=s(e);return r.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return r.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const l=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return l()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyDRxwgTDH0yHyRFQovzJOMtmr4vXvh5X30",REACT_APP_FIREBASE_APP_ID:"1:309664339373:web:cc902bc404cb7cfae3bd24",REACT_APP_FIREBASE_AUTH_DOMAIN:"grepollike.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-RLTQQ51W02",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"309664339373",REACT_APP_FIREBASE_PROJECT_ID:"grepollike",REACT_APP_FIREBASE_STORAGE_BUCKET:"grepollike.appspot.com"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},d=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]},h=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},m=e=>{var t;return null===(t=c())||void 0===t?void 0:t[`_${e}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function f(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function g(){return!function(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(s){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function v(){try{return"object"===typeof indexedDB}catch(e){return!1}}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,x.prototype.create)}}class x{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(b,(e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`})}(s,t):"Error",i=`${this.serviceName}: ${r} (${n}).`;return new y(n,i,t)}}const b=/\{\$([^}]+)}/g;function w(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const r of n){if(!s.includes(r))return!1;const n=e[r],i=t[r];if(k(n)&&k(i)){if(!w(n,i))return!1}else if(n!==i)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function k(e){return null!==e&&"object"===typeof e}function N(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function j(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function C(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class S{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");s=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=_),void 0===s.error&&(s.error=_),void 0===s.complete&&(s.complete=_);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}}),this.observers.push(s),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function _(){}function T(e){return e&&e._delegate?e._delegate:e}class I{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const E="[DEFAULT]";class A{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new p;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),s=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(s)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:E})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:s});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&i.resolve(s)}return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(s){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===E?void 0:r),options:n}),this.instances.set(t,s),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(i){}var r;return s||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;return this.component?this.component.multipleInstances?e:E:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class P{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new A(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const M=[];var D;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(D||(D={}));const O={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},R=D.INFO,L={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},$=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),s=L[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];console[s](`[${n}]  ${e.name}:`,...i)};class F{constructor(e){this.name=e,this._logLevel=R,this._logHandler=$,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?O[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...t),this._logHandler(this,D.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...t),this._logHandler(this,D.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,D.INFO,...t),this._logHandler(this,D.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,D.WARN,...t),this._logHandler(this,D.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,D.ERROR,...t),this._logHandler(this,D.ERROR,...t)}}let U,V;const B=new WeakMap,z=new WeakMap,q=new WeakMap,W=new WeakMap,H=new WeakMap;let G={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return z.get(e);if("objectStoreNames"===t)return e.objectStoreNames||q.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return K(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Q(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(V||(V=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return e.apply(X(this),n),K(B.get(this))}:function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return K(e.apply(X(this),n))}:function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];const i=e.call(X(this),t,...s);return q.set(i,t.sort?t.sort():[t]),K(i)}}function Y(e){return"function"===typeof e?Q(e):(e instanceof IDBTransaction&&function(e){if(z.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)});z.set(e,t)}(e),t=e,(U||(U=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,G):e);var t}function K(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(K(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&B.set(t,e)}).catch(()=>{}),H.set(t,e),t}(e);if(W.has(e))return W.get(e);const t=Y(e);return t!==e&&(W.set(e,t),H.set(t,e)),t}const X=e=>H.get(e);const J=["get","getKey","getAll","getAllKeys","count"],Z=["put","add","delete","clear"],ee=new Map;function te(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(ee.get(t))return ee.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=Z.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!J.includes(n))return;const i=async function(e){const t=this.transaction(e,r?"readwrite":"readonly");let i=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return s&&(i=i.index(o.shift())),(await Promise.all([i[n](...o),r&&t.done]))[0]};return ee.set(t,i),i}G=(e=>({...e,get:(t,n,s)=>te(t,n)||e.get(t,n,s),has:(t,n)=>!!te(t,n)||e.has(t,n)}))(G);class ne{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const se="@firebase/app",re="0.10.13",ie=new F("@firebase/app"),ae="@firebase/app-compat",oe="@firebase/analytics-compat",le="@firebase/analytics",ce="@firebase/app-check-compat",ue="@firebase/app-check",de="@firebase/auth",he="@firebase/auth-compat",me="@firebase/database",pe="@firebase/data-connect",fe="@firebase/database-compat",ge="@firebase/functions",ve="@firebase/functions-compat",ye="@firebase/installations",xe="@firebase/installations-compat",be="@firebase/messaging",we="@firebase/messaging-compat",ke="@firebase/performance",Ne="@firebase/performance-compat",je="@firebase/remote-config",Ce="@firebase/remote-config-compat",Se="@firebase/storage",_e="@firebase/storage-compat",Te="@firebase/firestore",Ie="@firebase/vertexai-preview",Ee="@firebase/firestore-compat",Ae="firebase",Pe="[DEFAULT]",Me={[se]:"fire-core",[ae]:"fire-core-compat",[le]:"fire-analytics",[oe]:"fire-analytics-compat",[ue]:"fire-app-check",[ce]:"fire-app-check-compat",[de]:"fire-auth",[he]:"fire-auth-compat",[me]:"fire-rtdb",[pe]:"fire-data-connect",[fe]:"fire-rtdb-compat",[ge]:"fire-fn",[ve]:"fire-fn-compat",[ye]:"fire-iid",[xe]:"fire-iid-compat",[be]:"fire-fcm",[we]:"fire-fcm-compat",[ke]:"fire-perf",[Ne]:"fire-perf-compat",[je]:"fire-rc",[Ce]:"fire-rc-compat",[Se]:"fire-gcs",[_e]:"fire-gcs-compat",[Te]:"fire-fst",[Ee]:"fire-fst-compat",[Ie]:"fire-vertex","fire-js":"fire-js",[Ae]:"fire-js-all"},De=new Map,Oe=new Map,Re=new Map;function Le(e,t){try{e.container.addComponent(t)}catch(n){ie.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function $e(e){const t=e.name;if(Re.has(t))return ie.debug(`There were multiple attempts to register component ${t}.`),!1;Re.set(t,e);for(const n of De.values())Le(n,e);for(const n of Oe.values())Le(n,e);return!0}function Fe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ue(e){return void 0!==e.settings}const Ve=new x("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Be{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new I("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ve.create("app-deleted",{appName:this._name})}}const ze="10.14.1";function qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const s=Object.assign({name:Pe,automaticDataCollectionEnabled:!1},t),r=s.name;if("string"!==typeof r||!r)throw Ve.create("bad-app-name",{appName:String(r)});if(n||(n=h()),!n)throw Ve.create("no-options");const i=De.get(r);if(i){if(w(n,i.options)&&w(s,i.config))return i;throw Ve.create("duplicate-app",{appName:r})}const a=new P(r);for(const l of Re.values())a.addComponent(l);const o=new Be(n,s,a);return De.set(r,o),o}function We(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe;const t=De.get(e);if(!t&&e===Pe&&h())return qe();if(!t)throw Ve.create("no-app",{appName:e});return t}function He(e,t,n){var s;let r=null!==(s=Me[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);const i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${r}" with version "${t}":`];return i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ie.warn(e.join(" "))}$e(new I(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Ge="firebase-heartbeat-store";let Qe=null;function Ye(){return Qe||(Qe=function(e,t){let{blocked:n,upgrade:s,blocking:r,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=K(a);return s&&a.addEventListener("upgradeneeded",e=>{s(K(a.result),e.oldVersion,e.newVersion,K(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ge)}catch(n){console.warn(n)}}}).catch(e=>{throw Ve.create("idb-open",{originalErrorMessage:e.message})})),Qe}async function Ke(e,t){try{const n=(await Ye()).transaction(Ge,"readwrite"),s=n.objectStore(Ge);await s.put(t,Xe(e)),await n.done}catch(n){if(n instanceof y)ie.warn(n.message);else{const e=Ve.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});ie.warn(e.message)}}}function Xe(e){return`${e.name}!${e.options.appId}`}class Je{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new et(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ze();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(e=>e.date===s))return;return this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(n){ie.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ze(),{heartbeatsToSend:n,unsentEntries:s}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let s=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tt(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),r=a(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return ie.warn(t),""}}}function Ze(){return(new Date).toISOString().substring(0,10)}class et{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!v()&&new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ye()).transaction(Ge),n=await t.objectStore(Ge).get(Xe(e));return await t.done,n}catch(t){if(t instanceof y)ie.warn(t.message);else{const e=Ve.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});ie.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function tt(e){return a(JSON.stringify({version:2,heartbeats:e})).length}var nt;nt="",$e(new I("platform-logger",e=>new ne(e),"PRIVATE")),$e(new I("heartbeat",e=>new Je(e),"PRIVATE")),He(se,re,nt),He(se,re,"esm2017"),He("fire-js","");function st(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function rt(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const it=rt,at=new x("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ot=new F("@firebase/auth");function lt(e){if(ot.logLevel<=D.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];ot.error(`Auth (${ze}): ${e}`,...n)}}function ct(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];throw mt(e,...n)}function ut(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return mt(e,...n)}function dt(e,t,n){const s=Object.assign(Object.assign({},it()),{[t]:n});return new x("auth","Firebase",s).create(t,{appName:e.name})}function ht(e){return dt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if("string"!==typeof e){const t=n[0],s=[...n.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(t,...s)}return at.create(e,...n)}function pt(e,t){if(!e){for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];throw mt(t,...s)}}function ft(e){const t="INTERNAL ASSERTION FAILED: "+e;throw lt(t),new Error(t)}function gt(e,t){e||ft(t)}function vt(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function yt(){return"http:"===xt()||"https:"===xt()}function xt(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function bt(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(yt()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class wt{constructor(e,t){this.shortDelay=e,this.longDelay=t,gt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return bt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function kt(e,t){gt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Nt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const jt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ct=new wt(3e4,6e4);function St(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function _t(e,t,n,s){return Tt(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let r={},i={};s&&("GET"===t?i=s:r={body:JSON.stringify(s)});const a=N(Object.assign({key:e.config.apiKey},i)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},r);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),Nt.fetch()(Et(e,e.config.apiHost,n,a),l)})}async function Tt(e,t,n){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},jt),t);try{const t=new Pt(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw Mt(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Mt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Mt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Mt(e,"user-disabled",i);const o=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw dt(e,o,a);ct(e,o)}}catch(r){if(r instanceof y)throw r;ct(e,"network-request-failed",{message:String(r)})}}async function It(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await _t(e,t,n,s,r);return"mfaPendingCredential"in i&&ct(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Et(e,t,n,s){const r=`${t}${n}?${s}`;return e.config.emulator?kt(e.config,r):`${e.config.apiScheme}://${r}`}function At(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Pt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ut(this.auth,"network-request-failed")),Ct.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Mt(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=ut(e,t,s);return r.customData._tokenResponse=n,r}function Dt(e){return void 0!==e&&void 0!==e.enterprise}class Ot{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return At(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Rt(e,t){return _t(e,"GET","/v2/recaptchaConfig",St(e,t))}async function Lt(e,t){return _t(e,"POST","/v1/accounts:lookup",t)}function $t(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Ft(e){return 1e3*Number(e)}function Ut(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return lt("JWT malformed, contained fewer than 3 sections"),null;try{const e=o(n);return e?JSON.parse(e):(lt("Failed to decode base64 JWT payload"),null)}catch(r){return lt("Caught error parsing JWT payload as JSON",null===r||void 0===r?void 0:r.toString()),null}}function Vt(e){const t=Ut(e);return pt(t,"internal-error"),pt("undefined"!==typeof t.exp,"internal-error"),pt("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Bt(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof y&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class zt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===e||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class qt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$t(this.lastLoginAt),this.creationTime=$t(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Wt(e){var t;const n=e.auth,s=await e.getIdToken(),r=await Bt(e,Lt(n,{idToken:s}));pt(null===r||void 0===r?void 0:r.users.length,n,"internal-error");const i=r.users[0];e._notifyReloadListener(i);const a=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?Ht(i.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const u=e.isAnonymous,d=!(e.email&&i.passwordHash)&&!(null===o||void 0===o?void 0:o.length),h=!!u&&d,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new qt(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,m)}function Ht(e){return e.map(e=>{var{providerId:t}=e,n=st(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Gt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pt(e.idToken,"internal-error"),pt("undefined"!==typeof e.idToken,"internal-error"),pt("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Vt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){pt(0!==e.length,"internal-error");const t=Vt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(pt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:r}=await async function(e,t){const n=await Tt(e,{},async()=>{const n=N({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=e.config,i=Et(e,s,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Nt.fetch()(i,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:r}=t,i=new Gt;return n&&(pt("string"===typeof n,"internal-error",{appName:e}),i.refreshToken=n),s&&(pt("string"===typeof s,"internal-error",{appName:e}),i.accessToken=s),r&&(pt("number"===typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Gt,this.toJSON())}_performRefresh(){return ft("not implemented")}}function Qt(e,t){pt("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Yt{constructor(e){var{uid:t,auth:n,stsTokenManager:s}=e,r=st(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new qt(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Bt(this,this.stsTokenManager.getToken(this.auth,e));return pt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=T(e),s=await n.getIdToken(t),r=Ut(s);pt(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i="object"===typeof r.firebase?r.firebase:void 0,a=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:$t(Ft(r.auth_time)),issuedAtTime:$t(Ft(r.iat)),expirationTime:$t(Ft(r.exp)),signInProvider:a||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=T(e);await Wt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(pt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Yt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Wt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ue(this.auth.app))return Promise.reject(ht(this.auth));const e=await this.getIdToken();return await Bt(this,async function(e,t){return _t(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,s,r,i,a,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(s=t.email)&&void 0!==s?s:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,m=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(a=t.tenantId)&&void 0!==a?a:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,v=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:x,isAnonymous:b,providerData:w,stsTokenManager:k}=t;pt(y&&k,e,"internal-error");const N=Gt.fromJSON(this.name,k);pt("string"===typeof y,e,"internal-error"),Qt(u,e.name),Qt(d,e.name),pt("boolean"===typeof x,e,"internal-error"),pt("boolean"===typeof b,e,"internal-error"),Qt(h,e.name),Qt(m,e.name),Qt(p,e.name),Qt(f,e.name),Qt(g,e.name),Qt(v,e.name);const j=new Yt({uid:y,auth:e,email:d,emailVerified:x,displayName:u,isAnonymous:b,photoURL:m,phoneNumber:h,tenantId:p,stsTokenManager:N,createdAt:g,lastLoginAt:v});return w&&Array.isArray(w)&&(j.providerData=w.map(e=>Object.assign({},e))),f&&(j._redirectEventId=f),j}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=new Gt;s.updateFromServerResponse(t);const r=new Yt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await Wt(r),r}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];pt(void 0!==s.localId,"internal-error");const r=void 0!==s.providerUserInfo?Ht(s.providerUserInfo):[],i=!(s.email&&s.passwordHash)&&!(null===r||void 0===r?void 0:r.length),a=new Gt;a.updateFromIdToken(n);const o=new Yt({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new qt(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(null===r||void 0===r?void 0:r.length)};return Object.assign(o,l),o}}const Kt=new Map;function Xt(e){gt(e instanceof Function,"Expected a class definition");let t=Kt.get(e);return t?(gt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Kt.set(e,t),t)}class Jt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Jt.type="NONE";const Zt=Jt;function en(e,t,n){return`firebase:${e}:${t}:${n}`}class tn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:r}=this.auth;this.fullUserKey=en(this.userKey,s.apiKey,r),this.fullPersistenceKey=en("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new tn(Xt(Zt),e,n);const s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=s[0]||Xt(Zt);const i=en(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(i);if(t){const n=Yt._fromJSON(e,t);c!==r&&(a=n),r=c;break}}catch(l){}const o=s.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&o.length?(r=o[0],a&&await r._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(i)}catch(l){}})),new tn(r,e,n)):new tn(r,e,n)}}function nn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(on(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(sn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(cn(t))return"Blackberry";if(un(t))return"Webos";if(rn(t))return"Safari";if((t.includes("chrome/")||an(t))&&!t.includes("edge/"))return"Chrome";if(ln(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function sn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/firefox\//i.test(e)}function rn(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:f()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function an(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/crios\//i.test(e)}function on(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/iemobile/i.test(e)}function ln(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/android/i.test(e)}function cn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/blackberry/i.test(e)}function un(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/webos/i.test(e)}function dn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function hn(){return function(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function mn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f();return dn(e)||ln(e)||un(e)||cn(e)||/windows phone/i.test(e)||on(e)}function pn(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=nn(f());break;case"Worker":t=`${nn(f())}-${e}`;break;default:t=e}const s=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${ze}/${s}`}class fn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,s)=>{try{n(e(t))}catch(r){s(r)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class gn{constructor(e){var t,n,s,r;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(s=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==s?s:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,s,r,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(s=o.containsLowercaseLetter)||void 0===s||s),o.isValid&&(o.isValid=null===(r=o.containsUppercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsNumericCharacter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class vn{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xn(this),this.idTokenSubscription=new xn(this),this.beforeStateQueue=new fn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=at,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Xt(t)),this._initializationPromise=this.queue(async()=>{var n,s;if(!this._deleted&&(this.persistenceManager=await tn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(r){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Lt(this,{idToken:e}),n=await Yt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ue(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null===s||void 0===s?void 0:s._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==i||!(null===a||void 0===a?void 0:a.user)||(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return pt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Wt(e)}catch(t){if("auth/network-request-failed"!==(null===t||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ue(this.app))return Promise.reject(ht(this));const t=e?T(e):null;return t&&pt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&pt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ue(this.app)?Promise.reject(ht(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ue(this.app)?Promise.reject(ht(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return _t(e,"GET","/v2/passwordPolicy",St(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new gn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new x("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return _t(e,"POST","/v2/accounts:revokeToken",St(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Xt(e)||this._popupRedirectResolver;pt(t,this,"argument-error"),this.redirectPersistenceManager=await tn.create(this,[Xt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const r="function"===typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(pt(a,this,"internal-error"),a.then(()=>{i||r(this.currentUser)}),"function"===typeof t){const r=e.addObserver(t,n,s);return()=>{i=!0,r()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(ot.logLevel<=D.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];ot.warn(`Auth (${ze}): ${e}`,...n)}}(`Error while retrieving App Check token: ${t.error}`),null===t||void 0===t?void 0:t.token}}function yn(e){return T(e)}class xn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new S(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return pt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let bn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wn(e){return bn.loadJS(e)}function kn(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Nn{constructor(e){this.type="recaptcha-enterprise",this.auth=yn(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,s){const r=window.grecaptcha;Dt(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,s)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Rt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(void 0!==s.recaptchaKey){const n=new Ot(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(r=>{if(!t&&Dt(window.grecaptcha))n(r,e,s);else{if("undefined"===typeof window)return void s(new Error("RecaptchaVerifier is only supported in browser"));let t=bn.recaptchaEnterpriseScript;0!==t.length&&(t+=r),wn(t).then(()=>{n(r,e,s)}).catch(e=>{s(e)})}}).catch(e=>{s(e)})})}}async function jn(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=new Nn(e);let i;try{i=await r.verify(n)}catch(o){i=await r.verify(n,!0)}const a=Object.assign({},t);return s?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Cn(e,t,n,s){var r;if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await jn(e,t,n,"getOobCode"===n);return s(e,r)}return s(e,t).catch(async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await jn(e,t,n,"getOobCode"===n);return s(e,r)}return Promise.reject(r)})}function Sn(e,t,n){const s=yn(e);pt(s._canInitEmulator,s,"emulator-config-failed"),pt(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const r=!!(null===n||void 0===n?void 0:n.disableWarnings),i=_n(t),{host:a,port:o}=function(e){const t=_n(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const e=r[1];return{host:e,port:Tn(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:Tn(t)}}}(t),l=null===o?"":`:${o}`;s.config.emulator={url:`${i}//${a}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function _n(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Tn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class In{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ft("not implemented")}_getIdTokenResponse(e){return ft("not implemented")}_linkToIdToken(e,t){return ft("not implemented")}_getReauthenticationResolver(e){return ft("not implemented")}}async function En(e,t){return _t(e,"POST","/v1/accounts:signUp",t)}async function An(e,t){return It(e,"POST","/v1/accounts:signInWithPassword",St(e,t))}class Pn extends In{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Pn(e,t,"password")}static _fromEmailAndCode(e,t){return new Pn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Cn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",An);case"emailLink":return async function(e,t){return It(e,"POST","/v1/accounts:signInWithEmailLink",St(e,t))}(e,{email:this._email,oobCode:this._password});default:ct(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Cn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",En);case"emailLink":return async function(e,t){return It(e,"POST","/v1/accounts:signInWithEmailLink",St(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ct(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Mn(e,t){return It(e,"POST","/v1/accounts:signInWithIdp",St(e,t))}class Dn extends In{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Dn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ct("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,r=st(t,["providerId","signInMethod"]);if(!n||!s)return null;const i=new Dn(n,s);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return Mn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Mn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Mn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=N(t)}return e}}const On={USER_NOT_FOUND:"user-not-found"};class Rn extends In{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Rn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Rn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return It(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await It(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,t));if(n.temporaryProof)throw Mt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return It(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),On)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:r}=e;return n||t||s||r?new Rn({verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:r}):null}}class Ln{constructor(e){var t,n,s,r,i,a;const o=j(C(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(s=o.mode)&&void 0!==s?s:null);pt(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(r=o.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(i=o.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=j(C(e)).link,n=t?j(C(t)).deep_link_id:null,s=j(C(e)).deep_link_id;return(s?j(C(s)).link:null)||s||n||t||e}(e);try{return new Ln(t)}catch(n){return null}}}class $n{constructor(){this.providerId=$n.PROVIDER_ID}static credential(e,t){return Pn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ln.parseLink(t);return pt(n,"argument-error"),Pn._fromEmailAndCode(e,n.code,n.tenantId)}}$n.PROVIDER_ID="password",$n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",$n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Fn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Un extends Fn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Vn extends Un{constructor(){super("facebook.com")}static credential(e){return Dn._fromParams({providerId:Vn.PROVIDER_ID,signInMethod:Vn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vn.credentialFromTaggedObject(e)}static credentialFromError(e){return Vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Vn.credential(t.oauthAccessToken)}catch(n){return null}}}Vn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vn.PROVIDER_ID="facebook.com";class Bn extends Un{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Dn._fromParams({providerId:Bn.PROVIDER_ID,signInMethod:Bn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bn.credentialFromTaggedObject(e)}static credentialFromError(e){return Bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:s}=t;if(!n&&!s)return null;try{return Bn.credential(n,s)}catch(r){return null}}}Bn.GOOGLE_SIGN_IN_METHOD="google.com",Bn.PROVIDER_ID="google.com";class zn extends Un{constructor(){super("github.com")}static credential(e){return Dn._fromParams({providerId:zn.PROVIDER_ID,signInMethod:zn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zn.credentialFromTaggedObject(e)}static credentialFromError(e){return zn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return zn.credential(t.oauthAccessToken)}catch(n){return null}}}zn.GITHUB_SIGN_IN_METHOD="github.com",zn.PROVIDER_ID="github.com";class qn extends Un{constructor(){super("twitter.com")}static credential(e,t){return Dn._fromParams({providerId:qn.PROVIDER_ID,signInMethod:qn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qn.credentialFromTaggedObject(e)}static credentialFromError(e){return qn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=t;if(!n||!s)return null;try{return qn.credential(n,s)}catch(r){return null}}}async function Wn(e,t){return It(e,"POST","/v1/accounts:signUp",St(e,t))}qn.TWITTER_SIGN_IN_METHOD="twitter.com",qn.PROVIDER_ID="twitter.com";class Hn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=await Yt._fromIdTokenResponse(e,n,s),i=Gn(n);return new Hn({user:r,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=Gn(n);return new Hn({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function Gn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Qn extends y{constructor(e,t,n,s){var r;super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,Qn.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new Qn(e,t,n,s)}}function Yn(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Qn._fromErrorAndOperation(e,n,t,s);throw n})}async function Kn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=await Bt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Hn._forOperation(e,"link",s)}async function Xn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:s}=e;if(Ue(s.app))return Promise.reject(ht(s));const r="reauthenticate";try{const i=await Bt(e,Yn(s,r,t,e),n);pt(i.idToken,s,"internal-error");const a=Ut(i.idToken);pt(a,s,"internal-error");const{sub:o}=a;return pt(e.uid===o,s,"user-mismatch"),Hn._forOperation(e,r,i)}catch(i){throw"auth/user-not-found"===(null===i||void 0===i?void 0:i.code)&&ct(s,"user-mismatch"),i}}async function Jn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ue(e.app))return Promise.reject(ht(e));const s="signIn",r=await Yn(e,s,t),i=await Hn._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(i.user),i}async function Zn(e,t){return Jn(yn(e),t)}async function es(e){const t=yn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function ts(e){return T(e).signOut()}new WeakMap;const ns="__sak";class ss{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ns,"1"),this.storage.removeItem(ns),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rs extends ss{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=mn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);hn()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rs.type="LOCAL";const is=rs;class as extends ss{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}as.type="SESSION";const os=as;class ls{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new ls(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:r}=t.data,i=this.handlersMap[s];if(!(null===i||void 0===i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const a=Array.from(i).map(async e=>e(t.origin,r)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function cs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let s=0;s<t;s++)n+=Math.floor(10*Math.random());return e+n}ls.receivers=[];class us{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const s="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,i;return new Promise((a,o)=>{const l=cs("",20);s.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),r=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(c),clearTimeout(r),o(new Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ds(){return window}function hs(){return"undefined"!==typeof ds().WorkerGlobalScope&&"function"===typeof ds().importScripts}const ms="firebaseLocalStorageDb",ps="firebaseLocalStorage",fs="fbase_key";class gs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vs(e,t){return e.transaction([ps],t?"readwrite":"readonly").objectStore(ps)}function ys(){const e=indexedDB.open(ms,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ps,{keyPath:fs})}catch(s){n(s)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ps)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ms);return new gs(e).toPromise()}(),t(await ys()))})})}async function xs(e,t,n){const s=vs(e,!0).put({[fs]:t,value:n});return new gs(s).toPromise()}function bs(e,t){const n=vs(e,!0).delete(t);return new gs(n).toPromise()}class ws{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ys()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hs()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ls._getInstance(hs()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new us(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ys();return await xs(e,ns,"1"),await bs(e,ns),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>xs(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=vs(e,!1).get(t),s=await new gs(n).toPromise();return void 0===s?null:s.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>bs(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=vs(e,!1).getAll();return new gs(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:r}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ws.type="LOCAL";const ks=ws;kn("rcb"),new wt(3e4,6e4);const Ns="recaptcha";async function js(e,t,n){var s;const r=await n.verify();try{let i;if(pt("string"===typeof r,e,"argument-error"),pt(n.type===Ns,e,"argument-error"),i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){pt("enroll"===t.type,e,"internal-error");const n=await function(e,t){return _t(e,"POST","/v2/accounts/mfaEnrollment:start",St(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{pt("signin"===t.type,e,"internal-error");const n=(null===(s=i.multiFactorHint)||void 0===s?void 0:s.uid)||i.multiFactorUid;pt(n,e,"missing-multi-factor-info");const a=await function(e,t){return _t(e,"POST","/v2/accounts/mfaSignIn:start",St(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return _t(e,"POST","/v1/accounts:sendVerificationCode",St(e,t))}(e,{phoneNumber:i.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}class Cs{constructor(e){this.providerId=Cs.PROVIDER_ID,this.auth=yn(e)}verifyPhoneNumber(e,t){return js(this.auth,e,T(t))}static credential(e,t){return Rn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Cs.credentialFromTaggedObject(t)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:s}=t;return n&&s?Rn._fromTokenResponse(n,s):null}}function Ss(e,t){return t?Xt(t):(pt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Cs.PROVIDER_ID="phone",Cs.PHONE_SIGN_IN_METHOD="phone";class _s extends In{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Mn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Mn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Mn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ts(e){return Jn(e.auth,new _s(e),e.bypassAuthState)}function Is(e){const{auth:t,user:n}=e;return pt(n,t,"internal-error"),Xn(n,new _s(e),e.bypassAuthState)}async function Es(e){const{auth:t,user:n}=e;return pt(n,t,"internal-error"),Kn(n,new _s(e),e.bypassAuthState)}class As{constructor(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:r,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ts;case"linkViaPopup":case"linkViaRedirect":return Es;case"reauthViaPopup":case"reauthViaRedirect":return Is;default:ct(this.auth,"internal-error")}}resolve(e){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ps=new wt(2e3,1e4);class Ms extends As{constructor(e,t,n,s,r){super(e,t,s,r),this.provider=n,this.authWindow=null,this.pollId=null,Ms.currentPopupAction&&Ms.currentPopupAction.cancel(),Ms.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pt(e,this.auth,"internal-error"),e}async onExecution(){gt(1===this.filter.length,"Popup operations only handle one event");const e=cs();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ut(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ut(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ms.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ut(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ps.get())};e()}}Ms.currentPopupAction=null;const Ds=new Map;class Os extends As{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Ds.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=$s(t),s=Ls(e);if(!await s._isAvailable())return!1;const r="true"===await s._get(n);return await s._remove(n),r}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ds.set(this.auth._key(),e)}return this.bypassAuthState||Ds.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Rs(e,t){Ds.set(e._key(),t)}function Ls(e){return Xt(e._redirectPersistence)}function $s(e){return en("pendingRedirect",e.config.apiKey,e.name)}async function Fs(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ue(e.app))return Promise.reject(ht(e));const s=yn(e),r=Ss(s,t),i=new Os(s,r,n),a=await i.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class Us{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Bs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Bs(e)){const s=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ut(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Vs(e))}saveEventToCache(e){this.cachedEventUids.add(Vs(e)),this.lastProcessedEventTime=Date.now()}}function Vs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Bs(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===(null===n||void 0===n?void 0:n.code)}const zs=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qs=/^https?/;async function Ws(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return _t(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const s of t)try{if(Hs(s))return}catch(n){}ct(e,"unauthorized-domain")}function Hs(e){const t=vt(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===s}if(!qs.test(n))return!1;if(zs.test(e))return s===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const Gs=new wt(3e4,6e4);function Qs(){const e=ds().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ys(e){return new Promise((t,n)=>{var s,r,i;function a(){Qs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Qs(),n(ut(e,"network-request-failed"))},timeout:Gs.get()})}if(null===(r=null===(s=ds().gapi)||void 0===s?void 0:s.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=ds().gapi)||void 0===i?void 0:i.load)){const t=kn("iframefcb");return ds()[t]=()=>{gapi.load?a():n(ut(e,"network-request-failed"))},wn(`${bn.gapiScript}?onload=${t}`).catch(e=>n(e))}a()}}).catch(e=>{throw Ks=null,e})}let Ks=null;const Xs=new wt(5e3,15e3),Js={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Zs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function er(e){const t=e.config;pt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?kt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:ze},r=Zs.get(e.config.apiHost);r&&(s.eid=r);const i=e._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${N(s).slice(1)}`}async function tr(e){const t=await function(e){return Ks=Ks||Ys(e),Ks}(e),n=ds().gapi;return pt(n,e,"internal-error"),t.open({where:document.body,url:er(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Js,dontclear:!0},t=>new Promise(async(n,s)=>{await t.restyle({setHideOnLeave:!1});const r=ut(e,"network-request-failed"),i=ds().setTimeout(()=>{s(r)},Xs.get());function a(){ds().clearTimeout(i),n(t)}t.ping(a).then(a,()=>{s(r)})}))}const nr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class sr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function rr(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let o="";const l=Object.assign(Object.assign({},nr),{width:s.toString(),height:r.toString(),top:i,left:a}),c=f().toLowerCase();n&&(o=an(c)?"_blank":n),sn(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,s]=t;return`${e}${n}=${s},`},"");if(function(){var e;return dn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:f())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",o),new sr(null);const d=window.open(t||"",o,u);pt(d,e,"popup-blocked");try{d.focus()}catch(h){}return new sr(d)}const ir="__/auth/handler",ar="emulator/auth/handler",or=encodeURIComponent("fac");async function lr(e,t,n,s,r,i){pt(e.config.authDomain,e,"auth-domain-config-required"),pt(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:ze,eventId:r};if(t instanceof Fn){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))a[e]=t}if(t instanceof Un){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const l=await e._getAppCheckToken(),c=l?`#${or}=${encodeURIComponent(l)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${ir}`;return kt(t,ar)}(e)}?${N(o).slice(1)}${c}`}const cr="webStorageSupport";const ur=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=os,this._completeRedirectFn=Fs,this._overrideRedirectResult=Rs}async _openPopup(e,t,n,s){var r;gt(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return rr(e,await lr(e,t,n,vt(),s),cs())}async _openRedirect(e,t,n,s){await this._originValidation(e);return function(e){ds().location.href=e}(await lr(e,t,n,vt(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(gt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await tr(e),n=new Us(e);return t.register("authEvent",t=>{pt(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(cr,{type:cr},n=>{var s;const r=null===(s=null===n||void 0===n?void 0:n[0])||void 0===s?void 0:s[cr];void 0!==r&&t(!!r),ct(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ws(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return mn()||rn()||dn()}};var dr="@firebase/auth",hr="1.7.9";class mr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const pr=m("authIdTokenMaxAge")||300;let fr=null;var gr;bn={loadJS:e=>new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=ut("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},gr="Browser",$e(new I("auth",(e,t)=>{let{options:n}=t;const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=s.options;pt(a&&!a.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:a,authDomain:o,clientPlatform:gr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pn(gr)},c=new vn(s,r,i,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Xt);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),$e(new I("auth-internal",e=>(e=>new mr(e))(yn(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),He(dr,hr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(gr)),He(dr,hr,"esm2017");var vr,yr,xr="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},br={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var s=Array(16);if("string"===typeof t)for(var r=0;16>r;++r)s[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var i=e.g[3],a=t+(i^n&(r^i))+s[0]+3614090360&4294967295;a=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=n+(a<<7&4294967295|a>>>25))+((a=i+(r^t&(n^r))+s[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^i&(t^n))+s[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(i^t))+s[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(r^i))+s[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(n^r))+s[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^i&(t^n))+s[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(i^t))+s[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(r^i))+s[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(n^r))+s[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^i&(t^n))+s[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(i^t))+s[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(r^i))+s[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(n^r))+s[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^i&(t^n))+s[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(i^t))+s[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^i&(n^r))+s[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^r&(t^n))+s[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(i^t))+s[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(r^i))+s[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(n^r))+s[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^r&(t^n))+s[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(i^t))+s[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(r^i))+s[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(n^r))+s[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^r&(t^n))+s[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(i^t))+s[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(r^i))+s[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(n^r))+s[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^r&(t^n))+s[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(i^t))+s[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(r^i))+s[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^r^i)+s[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^r)+s[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^n)+s[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^i^t)+s[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^i)+s[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^r)+s[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^n)+s[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^i^t)+s[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^i)+s[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^r)+s[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^n)+s[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^i^t)+s[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^i)+s[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^r)+s[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^n)+s[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^i^t)+s[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^(n|~i))+s[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~r))+s[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~n))+s[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(r|~t))+s[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(n|~i))+s[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~r))+s[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~n))+s[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(r|~t))+s[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(n|~i))+s[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~r))+s[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~n))+s[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(r|~t))+s[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((i=(t=n+((a=t+(r^(n|~i))+s[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~r))+s[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((r=i+((a=r+(t^(i|~n))+s[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+i&4294967295}function s(e,t){this.h=t;for(var n=[],s=!0,r=e.length-1;0<=r;r--){var i=0|e[r];s&&i==t||(n[r]=i,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var s=t-this.blockSize,r=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=s;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var s=0;32>s;s+=8)e[n++]=this.g[t]>>>s&255;return e};var r={};function i(e){return-128<=e&&128>e?function(e,t){var n=r;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return h(a(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new s(t,0)}var o=i(0),l=i(1),c=i(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(l)}function m(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new f(o,o);if(d(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,s=t;0>=s.l(e);)n=v(n),s=v(s);var r=y(n,1),i=y(s,1);for(s=y(s,2),n=y(n,2);!u(s);){var c=i.add(s);0>=c.l(e)&&(r=r.add(n),i=c),s=y(s,1),n=y(n,1)}return t=m(e,r.j(t)),new f(r,t)}for(r=o;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),c=(i=a(n)).j(t);d(c)||0<c.l(e);)c=(i=a(n-=s)).j(t);u(i)&&(i=l),r=r.add(i),e=m(e,c)}return new f(r,e)}function v(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(d(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var s=this.i(n);e+=(0<=s?s:4294967296+s)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,s="";;){var r=g(n,t).g,i=((0<(n=m(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=r))return i+s;for(;6>i.length;)i="0"+i;s=i+s}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=m(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return o;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(0>this.l(c)&&0>e.l(c))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var l=this.i(r)>>>16,m=65535&this.i(r),f=e.i(i)>>>16,g=65535&e.i(i);n[2*r+2*i]+=m*g,p(n,2*r+2*i),n[2*r+2*i+1]+=l*g,p(n,2*r+2*i+1),n[2*r+2*i+1]+=m*f,p(n,2*r+2*i+1),n[2*r+2*i+2]+=l*f,p(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,yr=br.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=a,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=a(Math.pow(n,8)),r=o,i=0;i<t.length;i+=8){var l=Math.min(8,t.length-i),c=parseInt(t.substring(i,i+l),n);8>l?(l=a(Math.pow(n,l)),r=r.j(l).add(a(c))):r=(r=r.j(s)).add(a(c))}return r},vr=br.Integer=s}).apply("undefined"!==typeof xr?xr:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var wr,kr,Nr,jr,Cr,Sr,_r,Tr,Ir="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Er={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ir&&Ir];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,s){if(s)e:{var r=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in r))break e;r=r[a]}(s=s(i=r[e=e[e.length-1]]))!=i&&null!=s&&t(r,e,{configurable:!0,writable:!0,value:s})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,s=!1,r={next:function(){if(!s&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return s=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,function(e,t){return t})}});var s=s||{},r=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function m(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(i(t)){const n=e.length||0,s=t.length||0;e.length=n+s;for(let r=0;r<s;r++)e[n+r]=t[r]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=r.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var v=-1!=f().indexOf("Gecko")&&!(-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge"))&&!(-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE"))&&-1==f().indexOf("Edge");function y(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function x(e){const t={};for(const n in e)t[n]=e[n];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(e,t){let n,s;for(let r=1;r<arguments.length;r++){for(n in s=arguments[r],s)e[n]=s[n];for(let t=0;t<b.length;t++)n=b[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function k(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function N(e){r.setTimeout(()=>{throw e},0)}function j(){var e=I;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new S,e=>e.reset());class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let _,T=!1,I=new class{constructor(){this.h=this.g=null}add(e,t){const n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},E=()=>{const e=r.Promise.resolve(void 0);_=()=>{e.then(A)}};var A=()=>{for(var e;e=j();){try{e.h.call(e.g)}catch(n){N(n)}var t=C;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}T=!1};function P(){this.s=this.s,this.C=this.C}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(n){}return e}();function O(e,t){if(M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(v){e:{try{g(t.nodeName);var r=!0;break e}catch(i){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:R[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&O.aa.h.call(this)}}d(O,M);var R={2:"touch",3:"pen",4:"mouse"};O.prototype.h=function(){O.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),$=0;function F(e,t,n,s,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=r,this.key=++$,this.da=this.fa=!1}function U(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e){this.src=e,this.g={},this.h=0}function B(e,t){var n=t.type;if(n in e.g){var s,r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(U(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,s){for(var r=0;r<e.length;++r){var i=e[r];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==s)return r}return-1}V.prototype.add=function(e,t,n,s,r){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var a=z(e,t,s,r);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new F(t,this.src,i,!!s,r)).fa=n,e.push(t)),t};var q="closure_lm_"+(1e6*Math.random()|0),W={};function H(e,t,n,s,r){if(s&&s.once)return Q(e,t,n,s,r);if(Array.isArray(t)){for(var i=0;i<t.length;i++)H(e,t[i],n,s,r);return null}return n=te(n),e&&e[L]?e.K(t,n,a(s)?!!s.capture:!!s,r):G(e,t,n,!1,s,r)}function G(e,t,n,s,r,i){if(!t)throw Error("Invalid event type");var o=a(r)?!!r.capture:!!r,l=Z(e);if(l||(e[q]=l=new V(e)),(n=l.add(t,n,s,o,i)).proxy)return n;if(s=function(){function e(n){return t.call(e.src,e.listener,n)}const t=J;return e}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)D||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),s,r);else if(e.attachEvent)e.attachEvent(X(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}function Q(e,t,n,s,r){if(Array.isArray(t)){for(var i=0;i<t.length;i++)Q(e,t[i],n,s,r);return null}return n=te(n),e&&e[L]?e.L(t,n,a(s)?!!s.capture:!!s,r):G(e,t,n,!0,s,r)}function Y(e,t,n,s,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)Y(e,t[i],n,s,r);else s=a(s)?!!s.capture:!!s,n=te(n),e&&e[L]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=z(i=e.g[t],n,s,r))&&(U(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,s,r)),(n=-1<e?t[e]:null)&&K(n))}function K(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])B(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(X(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=Z(t))?(B(n,e),0==n.h&&(n.src=null,t[q]=null)):U(e)}}}function X(e){return e in W?W[e]:W[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new O(t,this);var n=e.listener,s=e.ha||e.src;e.fa&&K(e),e=n.call(s,t)}return e}function Z(e){return(e=e[q])instanceof V?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){P.call(this),this.i=new V(this),this.M=this,this.F=null}function se(e,t){var n,s=e.F;if(s)for(n=[];s;s=s.F)n.push(s);if(e=e.M,s=t.type||t,"string"===typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var r=t;w(t=new M(s,e),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var a=t.g=n[i];r=re(a,s,!0,t)&&r}if(r=re(a=t.g=e,s,!0,t)&&r,r=re(a,s,!1,t)&&r,n)for(i=0;i<n.length;i++)r=re(a=t.g=n[i],s,!1,t)&&r}function re(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var a=t[i];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&B(e.i,a),r=!1!==o.call(l,s)&&r}}return r&&!s.defaultPrevented}function ie(e,t,n){if("function"===typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:r.setTimeout(e,t||0)}function ae(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,ae(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(ne,P),ne.prototype[L]=!0,ne.prototype.removeEventListener=function(e,t,n,s){Y(this,e,t,n,s)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)U(n[s]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},ne.prototype.L=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};class oe extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){P.call(this),this.h=e,this.g={}}d(le,P);var ce=[];function ue(e){y(e.g,function(e,t){this.g.hasOwnProperty(t)&&K(e)},e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),ue(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=r.JSON.stringify,he=r.JSON.parse,me=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function pe(){}function fe(e){return e.h||(e.h=e.i())}function ge(){}pe.prototype.h=null;var ve={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ye(){M.call(this,"d")}function xe(){M.call(this,"c")}d(ye,M),d(xe,M);var be={},we=null;function ke(){return we=we||new ne}function Ne(e){M.call(this,be.La,e)}function je(e){const t=ke();se(t,new Ne(t))}function Ce(e,t){M.call(this,be.STAT_EVENT,e),this.stat=t}function Se(e){const t=ke();se(t,new Ce(t,e))}function _e(e,t){M.call(this,be.Ma,e),this.size=t}function Te(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function Ie(){this.g=!0}function Ee(e,t,n,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var s=n[e];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<r.length;a++)r[a]=""}}}return de(n)}catch(o){return t}}(e,n)+(s?" "+s:"")})}be.La="serverreachability",d(Ne,M),be.STAT_EVENT="statevent",d(Ce,M),be.Ma="timingevent",d(_e,M),Ie.prototype.xa=function(){this.g=!1},Ie.prototype.info=function(){};var Ae,Pe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Me={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Oe(e,t,n,s){this.j=e,this.i=t,this.l=n,this.R=s||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}d(De,pe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Ae=new De;var Le={},$e={};function Fe(e,t,n){e.L=1,e.v=dt(at(t)),e.m=n,e.P=!0,Ue(e,null)}function Ue(e,t){e.F=Date.now(),ze(e),e.A=at(e.v);var n=e.A,s=e.R;Array.isArray(s)||(s=[String(s)]),Ct(n.i,"t",s),e.C=0,n=e.j.J,e.h=new Re,e.g=mn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new oe(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,s=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(ce[0]=r.toString()),r=ce);for(var i=0;i<r.length;i++){var a=H(n,r[i],s||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?x(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),je(),function(e,t,n,s,r,i){e.info(function(){if(e.g)if(i)for(var a="",o=i.split("&"),l=0;l<o.length;l++){var c=o[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");a=2<=d.length&&"type"==d[1]?a+(u+"=")+c+"&":a+(u+"=redacted&")}}else a=null;else a=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Be(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?$e:(n=Number(t.substring(n,s)),isNaN(n)?Le:(s+=1)+n>t.length?$e:(t=t.slice(s,s+n),e.C=s+n,t))}function ze(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Te(c(e.ba,e),t)}function We(e){e.B&&(r.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||ln(e.j,e)}function Ge(e){We(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Qe(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var s=n.Da.g.parse(t)}catch(u){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;on(n),Kt(n)}sn(n),Se(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=Te(c(n.Za,n),6e3));if(1>=Je(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else un(n,11)}else if((e.K||n.g==e)&&on(n),!p(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let c=r[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const r=c[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"===typeof u&&0<u&&(s=1.5*u,n.L=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(et(i,i.h),i.h=null))}if(s.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.ya=e,ut(s.I,s.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((s=n).qa=hn(s,s.J?s.ia:null,s.W),a.K){tt(s.h,a);var o=a,l=s.L;l&&(o.I=l),o.B&&(We(o),ze(o)),s.g=a}else nn(s);0<n.i.length&&Jt(n)}else"stop"!=c[0]&&"close"!=c[0]||un(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?un(n,7):Yt(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}je()}catch(u){}}Oe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Wt(e)?t.j():this.Y(e)},Oe.prototype.Y=function(e){try{if(e==this.g)e:{const h=Wt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=h||7==t||je(),We(this);var n=this.g.Z();this.X=n;t:if(Ve(this)){var s=Ht(this.g);e="";var i=s.length,a=4==Wt(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ge(this),He(this);var o="";break t}this.h.i=new r.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(s[t],{stream:!(a&&t==i-1)});s.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,s,r,i,a){e.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Se(12),Ge(this),He(this);break e}Ee(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qe(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Be(this,o),e==$e){4==h&&(this.s=4,Se(14),n=!1),Ee(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,Se(15),Ee(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Ee(this.i,this.l,e,null),Qe(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,Se(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),rn(d),d.M=!0,Se(11))}}else Ee(this.i,this.l,o,"[Invalid Chunked Response]"),Ge(this),He(this)}else Ee(this.i,this.l,o,null),Qe(this,o);4==h&&Ge(this),this.o&&!this.J&&(4==h?ln(this.j,this):(this.o=!1,ze(this)))}else(function(e){const t={};e=(e.g&&2<=Wt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(p(e[s]))continue;var n=k(e[s]);const r=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Se(12)):(this.s=0,Se(13)),Ge(this),He(this)}}}catch(Ar){}},Oe.prototype.cancel=function(){this.J=!0,Ge(this)},Oe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(je(),Se(17)),Ge(this),this.s=2,He(this)):qe(this,this.S-e)};var Ye=class{constructor(e,t){this.g=e,this.map=t}};function Ke(e){this.l=e||10,r.PerformanceNavigationTiming?e=0<(e=r.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Je(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function st(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(i(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const s in e)t[n++]=s;return t}}}(e),s=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(i(e)){for(var t=[],n=e.length,s=0;s<n;s++)t.push(e[s]);return t}for(s in t=[],n=0,e)t[n++]=e[s];return t}(e),r=s.length,a=0;a<r;a++)t.call(void 0,s[a],n&&n[a],e)}Ke.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var rt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,ot(this,e.j),this.o=e.o,this.g=e.g,lt(this,e.s),this.l=e.l;var t=e.i,n=new wt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ct(this,n),this.m=e.m}else e&&(t=String(e).match(rt))?(this.h=!1,ot(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),lt(this,t[4]),this.l=ht(t[5]||"",!0),ct(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new wt(null,this.h))}function at(e){return new it(e)}function ot(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ct(e,t,n){t instanceof wt?(e.i=t,function(e,t){t&&!e.j&&(kt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Nt(this,t),Ct(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=mt(t,xt)),e.i=new wt(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function dt(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function mt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(mt(t,gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(mt(t,gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(mt(n,"/"==n.charAt(0)?yt:vt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",mt(n,bt)),e.join("")};var ft,gt=/[#\/\?@]/g,vt=/[#\?:]/g,yt=/[#\?]/g,xt=/[#\?@]/g,bt=/#/g;function wt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function kt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var s=e[n].indexOf("="),r=null;if(0<=s){var i=e[n].substring(0,s);r=e[n].substring(s+1)}else i=e[n];t(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Nt(e,t){kt(e),t=St(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function jt(e,t){return kt(e),t=St(e,t),e.g.has(t)}function Ct(e,t,n){Nt(e,t),0<n.length&&(e.i=null,e.g.set(St(e,t),h(n)),e.h+=n.length)}function St(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function _t(e,t,n,s,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),s(n)}catch(i){}}function Tt(){this.g=new me}function It(e,t,n){const s=n||"";try{st(e,function(e,n){let r=e;a(e)&&(r=de(e)),t.push(s+n+"="+encodeURIComponent(r))})}catch(r){throw t.push(s+"type="+encodeURIComponent("_badmap")),r}}function Et(e){this.l=e.Ub||null,this.j=e.eb||!1}function At(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Pt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ot(e){let t="";return y(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Rt(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Ot(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Lt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=wt.prototype).add=function(e,t){kt(this),this.i=null,e=St(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){kt(this),this.g.forEach(function(n,s){n.forEach(function(n){e.call(t,n,s,this)},this)},this)},e.na=function(){kt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let s=0;s<t.length;s++){const r=e[s];for(let e=0;e<r.length;e++)n.push(t[s])}return n},e.V=function(e){kt(this);let t=[];if("string"===typeof e)jt(this,e)&&(t=t.concat(this.g.get(St(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return kt(this),this.i=null,jt(this,e=St(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var s=t[n];const i=encodeURIComponent(String(s)),a=this.V(s);for(s=0;s<a.length;s++){var r=i;""!==a[s]&&(r+="="+encodeURIComponent(String(a[s]))),e.push(r)}}return this.i=e.join("&")},d(Et,pe),Et.prototype.g=function(){return new At(this.l,this.j)},Et.prototype.i=(ft={},function(){return ft}),d(At,ne),(e=At.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||r).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mt(this):Dt(this),3==this.readyState&&Pt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},e.Qa=function(e){this.g&&(this.response=e,Mt(this))},e.ga=function(){this.g&&Mt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(At.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Lt,ne);var $t=/^https?$/i,Ft=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Vt(e),zt(e)}function Vt(e){e.A||(e.A=!0,se(e,"complete"),se(e,"error"))}function Bt(e){if(e.h&&"undefined"!=typeof s&&(!e.v[1]||4!=Wt(e)||2!=e.Z()))if(e.u&&4==Wt(e))ie(e.Ea,0,e);else if(se(e,"readystatechange"),4==Wt(e)){e.h=!1;try{const s=e.Z();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===s){var a=String(e.D).match(rt)[1]||null;!a&&r.self&&r.self.location&&(a=r.self.location.protocol.slice(0,-1)),i=!$t.test(a?a.toLowerCase():"")}n=i}if(n)se(e,"complete"),se(e,"success");else{e.m=6;try{var o=2<Wt(e)?e.g.statusText:""}catch(l){o=""}e.l=o+" ["+e.Z()+"]",Vt(e)}}finally{zt(e)}}}function zt(e,t){if(e.g){qt(e);const s=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||se(e,"ready");try{s.onreadystatechange=r}catch(n){}}}function qt(e){e.I&&(r.clearTimeout(e.I),e.I=null)}function Wt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Dr){return null}}function Gt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Qt(e){this.Aa=0,this.i=[],this.j=new Ie,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ke(e&&e.concurrentRequestLimit),this.Da=new Tt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Yt(e){if(Xt(e),3==e.G){var t=e.U++,n=at(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),en(e,n),(t=new Oe(e,e.j,t)).L=2,t.v=dt(at(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.v.toString(),"")}catch(s){}!n&&r.Image&&((new Image).src=t.v,n=!0),n||(t.g=mn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ze(t)}dn(e)}function Kt(e){e.g&&(rn(e),e.g.cancel(),e.g=null)}function Xt(e){Kt(e),e.u&&(r.clearTimeout(e.u),e.u=null),on(e),e.h.cancel(),e.s&&("number"===typeof e.s&&r.clearTimeout(e.s),e.s=null)}function Jt(e){if(!Xe(e.h)&&!e.s){e.s=!0;var t=e.Ga;_||E(),T||(_(),T=!0),I.add(t,e),e.B=0}}function Zt(e,t){var n;n=t?t.l:e.U++;const s=at(e.I);ut(s,"SID",e.K),ut(s,"RID",n),ut(s,"AID",e.T),en(e,s),e.m&&e.o&&Rt(s,e.m,e.o),n=new Oe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Fe(n,s,t)}function en(e,t){e.H&&y(e.H,function(e,n){ut(t,n,e)}),e.l&&st({},function(e,n){ut(t,n,e)})}function tn(e,t,n){n=Math.min(e.i.length,n);var s=e.l?c(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let a=0;a<n;a++){let n=r[a].g;const o=r[a].map;if(n-=t,0>n)t=Math.max(0,r[a].g-100),i=!1;else try{It(o,e,"req"+n+"_")}catch(Ar){s&&s(o)}}if(i){s=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,s}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;_||E(),T||(_(),T=!0),I.add(t,e),e.v=0}}function sn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Te(c(e.Fa,e),cn(e,e.v)),e.v++,!0)}function rn(e){null!=e.A&&(r.clearTimeout(e.A),e.A=null)}function an(e){e.g=new Oe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=at(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&Rt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(at(t)),n.m=null,n.P=!0,Ue(n,e)}function on(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){on(e),rn(e),e.g=null;var s=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),s=1}if(0!=e.G)if(t.o)if(1==s){n=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;se(s=ke(),new _e(s,n)),Jt(e)}else nn(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==s&&function(e,t){return!(Je(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Te(c(e.Ga,e,t),cn(e,e.B)),e.B++,!0))}(e,t)||2==s&&sn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),r){case 1:un(e,5);break;case 4:un(e,10);break;case 3:un(e,6);break;default:un(e,2)}}function cn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function un(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),s=e.Xa;const t=!s;s=new it(s||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||ot(s,"https"),dt(s),t?function(e,t){const n=new Ie;if(r.Image){const s=new Image;s.onload=u(_t,n,"TestLoadImage: loaded",!0,t,s),s.onerror=u(_t,n,"TestLoadImage: error",!1,t,s),s.onabort=u(_t,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=u(_t,n,"TestLoadImage: timeout",!1,t,s),r.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new Ie;const n=new AbortController,s=setTimeout(()=>{n.abort(),_t(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(s),e.ok?_t(0,0,!0,t):_t(0,0,!1,t)}).catch(()=>{clearTimeout(s),_t(0,0,!1,t)})}(s.toString(),n)}else Se(2);e.G=0,e.l&&e.l.sa(t),dn(e),Xt(e)}function dn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(m(e.ka,t),m(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function hn(e,t,n){var s=n instanceof it?at(n):new it(n);if(""!=s.g)t&&(s.g=t+"."+s.g),lt(s,s.s);else{var i=r.location;s=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new it(null);s&&ot(a,s),t&&(a.g=t),i&&lt(a,i),n&&(a.l=n),s=a}return n=e.D,t=e.ya,n&&t&&ut(s,n,t),ut(s,"VER",e.la),en(e,s),s}function mn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Lt(new Et({eb:n})):new Lt(e.pa)).Ha(e.J),t}function pn(){}function fn(){}function gn(e,t){ne.call(this),this.g=new Qt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new xn(this)}function vn(e){ye.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yn(){xe.call(this),this.status=1}function xn(e){this.g=e}(e=Lt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ae.g(),this.v=this.o?fe(this.o):fe(Ae),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Ut(this,a)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var i in s)n.set(i,s[i]);else{if("function"!==typeof s.keys||"function"!==typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=r.FormData&&e instanceof r.FormData,!(0<=Array.prototype.indexOf.call(Ft,t,void 0))||s||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of n)this.g.setRequestHeader(r,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qt(this),this.u=!0,this.g.send(e),this.u=!1}catch(a){Ut(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,se(this,"complete"),se(this,"abort"),zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zt(this,!0)),Lt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Bt(this):this.bb())},e.bb=function(){Bt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Wt(this)?this.g.status:-1}catch(ft){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(ft){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Qt.prototype).la=8,e.G=1,e.connect=function(e,t,n,s){Se(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.I=hn(this,null,this.W),Jt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new Oe(this,this.j,e);let i=this.o;if(this.S&&(i?(i=x(i),w(i,this.S)):i=this.S),null!==this.m||this.O||(r.H=i,i=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"===typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(t+=s)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,r,t),ut(n=at(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),en(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Ot(i)))+"&"+t:this.m&&Rt(n,this.m,i)),et(this.h,r),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),r.T=!0,Fe(r,n,null)):Fe(r,n,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Xe(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,an(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Te(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Se(10),Kt(this),an(this))},e.Za=function(){null!=this.C&&(this.C=null,Kt(this),sn(this),Se(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Se(2)):(this.j.info("Failed to ping google.com"),Se(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},fn.prototype.g=function(e,t){return new gn(e,t)},d(gn,ne),gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){Yt(this.g)},gn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new Ye(t.Ya++,e)),3==t.G&&Jt(t)},gn.prototype.N=function(){this.g.l=null,delete this.j,Yt(this.g),delete this.g,gn.aa.N.call(this)},d(vn,ye),d(yn,xe),d(xn,pn),xn.prototype.ua=function(){se(this.g,"a")},xn.prototype.ta=function(e){se(this.g,new vn(e))},xn.prototype.sa=function(e){se(this.g,new yn)},xn.prototype.ra=function(){se(this.g,"b")},fn.prototype.createWebChannel=fn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,Tr=Er.createWebChannelTransport=function(){return new fn},_r=Er.getStatEventTarget=function(){return ke()},Sr=Er.Event=be,Cr=Er.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,jr=Er.ErrorCode=Pe,Me.COMPLETE="complete",Nr=Er.EventType=Me,ge.EventType=ve,ve.OPEN="a",ve.CLOSE="b",ve.ERROR="c",ve.MESSAGE="d",ne.prototype.listen=ne.prototype.K,kr=Er.WebChannel=ge,Er.FetchXmlHttpFactory=Et,Lt.prototype.listenOnce=Lt.prototype.L,Lt.prototype.getLastError=Lt.prototype.Ka,Lt.prototype.getLastErrorCode=Lt.prototype.Ba,Lt.prototype.getStatus=Lt.prototype.Z,Lt.prototype.getResponseJson=Lt.prototype.Oa,Lt.prototype.getResponseText=Lt.prototype.oa,Lt.prototype.send=Lt.prototype.ea,Lt.prototype.setWithCredentials=Lt.prototype.Ha,wr=Er.XhrIo=Lt}).apply("undefined"!==typeof Ir?Ir:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const Ar="@firebase/firestore";class Pr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pr.UNAUTHENTICATED=new Pr(null),Pr.GOOGLE_CREDENTIALS=new Pr("google-credentials-uid"),Pr.FIRST_PARTY=new Pr("first-party-uid"),Pr.MOCK_USER=new Pr("mock-user");let Mr="10.14.0";const Dr=new F("@firebase/firestore");function Or(){return Dr.logLevel}function Rr(e){if(Dr.logLevel<=D.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const r=n.map(Fr);Dr.debug(`Firestore (${Mr}): ${e}`,...r)}}function Lr(e){if(Dr.logLevel<=D.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const r=n.map(Fr);Dr.error(`Firestore (${Mr}): ${e}`,...r)}}function $r(e){if(Dr.logLevel<=D.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const r=n.map(Fr);Dr.warn(`Firestore (${Mr}): ${e}`,...r)}}function Fr(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Ur(){const e=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state");throw Lr(e),new Error(e)}function Vr(e,t){e||Ur()}function Br(e,t){return e}const zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qr extends y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Hr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Gr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pr.UNAUTHENTICATED))}shutdown(){}}class Qr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yr{constructor(e){this.t=e,this.currentUser=Pr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Vr(void 0===this.o);let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Wr;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Wr,e.enqueueRetryable(()=>s(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},a=e=>{Rr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(Rr("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Wr)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Rr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Vr("string"==typeof t.accessToken),new Hr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Vr(null===e||"string"==typeof e),new Pr(e)}}class Kr{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Pr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Xr{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Kr(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Pr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Jr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zr{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Vr(void 0===this.o);const n=e=>{null!=e.error&&Rr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Rr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const s=e=>{Rr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?s(e):Rr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Vr("string"==typeof e.token),this.R=e.token,new Jr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ei(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let s=0;s<e;s++)n[s]=Math.floor(256*Math.random());return n}class ti{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=ei(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<t&&(n+=e.charAt(s[r]%62))}return n}}function ni(e,t){return e<t?-1:e>t?1:0}function si(e,t,n){return e.length===t.length&&e.every((e,s)=>n(e,t[s]))}class ri{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ri.fromMillis(Date.now())}static fromDate(e){return ri.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ri(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ni(this.nanoseconds,e.nanoseconds):ni(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ii{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ii(e)}static min(){return new ii(new ri(0,0))}static max(){return new ii(new ri(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ai{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ur(),void 0===n?n=e.length-t:n>e.length-t&&Ur(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ai.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ai?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.get(s),r=t.get(s);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oi extends ai{construct(e,t,n){return new oi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const r of n){if(r.indexOf("//")>=0)throw new qr(zr.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(e=>e.length>0))}return new oi(e)}static emptyPath(){return new oi([])}}const li=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ci extends ai{construct(e,t,n){return new ci(e,t,n)}static isValidIdentifier(e){return li.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ci.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ci(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const r=()=>{if(0===n.length)throw new qr(zr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new qr(zr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new qr(zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(i=!i,s++):"."!==t||i?(n+=t,s++):(r(),s++)}if(r(),i)throw new qr(zr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ci(t)}static emptyPath(){return new ci([])}}class ui{constructor(e){this.path=e}static fromPath(e){return new ui(oi.fromString(e))}static fromName(e){return new ui(oi.fromString(e).popFirst(5))}static empty(){return new ui(oi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ui(new oi(e.slice()))}}class di{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}di.UNKNOWN_ID=-1;function hi(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,r=ii.fromTimestamp(1e9===s?new ri(n+1,0):new ri(n,s));return new pi(r,ui.empty(),t)}function mi(e){return new pi(e.readTime,e.key,-1)}class pi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new pi(ii.min(),ui.empty(),-1)}static max(){return new pi(ii.max(),ui.empty(),-1)}}function fi(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ui.comparator(e.documentKey,t.documentKey),0!==n?n:ni(e.largestBatchId,t.largestBatchId))}const gi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function yi(e){if(e.code!==zr.FAILED_PRECONDITION||e.message!==gi)throw e;Rr("LocalStore","Unexpectedly lost primary lease")}class xi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ur(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new xi((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof xi?t:xi.resolve(t)}catch(e){return xi.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):xi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):xi.reject(t)}static resolve(e){return new xi((t,n)=>{t(e)})}static reject(e){return new xi((t,n)=>{n(e)})}static waitFor(e){return new xi((t,n)=>{let s=0,r=0,i=!1;e.forEach(e=>{++s,e.next(()=>{++r,i&&r===s&&t()},e=>n(e))}),i=!0,r===s&&t()})}static or(e){let t=xi.resolve(!1);for(const n of e)t=t.next(e=>e?xi.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,s)=>{n.push(t.call(this,e,s))}),this.waitFor(n)}static mapArray(e,t){return new xi((n,s)=>{const r=e.length,i=new Array(r);let a=0;for(let o=0;o<r;o++){const l=o;t(e[l]).next(e=>{i[l]=e,++a,a===r&&n(i)},e=>s(e))}})}static doWhile(e,t){return new xi((n,s)=>{const r=()=>{!0===e()?t().next(()=>{r()},s):n()};r()})}}function bi(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function wi(e){return"IndexedDbTransactionError"===e.name}class ki{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Ni(e){return null==e}function ji(e){return 0===e&&1/e==-1/0}function Ci(e){return"number"==typeof e&&Number.isInteger(e)&&!ji(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}ki.oe=-1;const Si=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],_i=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ti=_i,Ii=[...Ti,"indexConfiguration","indexState","indexEntries"];function Ei(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ai(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Pi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Mi{constructor(e,t){this.comparator=e,this.root=t||Oi.EMPTY}insert(e,t){return new Mi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Oi.BLACK,null,null))}remove(e){return new Mi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Di(this.root,e,this.comparator,!1)}getReverseIterator(){return new Di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Di(this.root,e,this.comparator,!0)}}class Di{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Oi{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:Oi.RED,this.left=null!=s?s:Oi.EMPTY,this.right=null!=r?r:Oi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new Oi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Oi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Oi.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Oi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Oi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ur();if(this.right.isRed())throw Ur();const e=this.left.check();if(e!==this.right.check())throw Ur();return e+(this.isRed()?0:1)}}Oi.EMPTY=null,Oi.RED=!0,Oi.BLACK=!1,Oi.EMPTY=new class{constructor(){this.size=0}get key(){throw Ur()}get value(){throw Ur()}get color(){throw Ur()}get left(){throw Ur()}get right(){throw Ur()}copy(e,t,n,s,r){return this}insert(e,t,n){return new Oi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ri{constructor(e){this.comparator=e,this.data=new Mi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Li(this.data.getIterator())}getIteratorFrom(e){return new Li(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ri))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ri(this.comparator);return t.data=e,t}}class Li{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class $i{constructor(e){this.fields=e,e.sort(ci.comparator)}static empty(){return new $i([])}unionWith(e){let t=new Ri(ci.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new $i(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return si(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Fi extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ui{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Fi("Invalid base64 string: "+e):e}}(e);return new Ui(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ui(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ni(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ui.EMPTY_BYTE_STRING=new Ui("");const Vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bi(e){if(Vr(!!e),"string"==typeof e){let t=0;const n=Vi.exec(e);if(Vr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:zi(e.seconds),nanos:zi(e.nanos)}}function zi(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function qi(e){return"string"==typeof e?Ui.fromBase64String(e):Ui.fromUint8Array(e)}function Wi(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Hi(e){const t=e.mapValue.fields.__previous_value__;return Wi(t)?Hi(t):t}function Gi(e){const t=Bi(e.mapValue.fields.__local_write_time__.timestampValue);return new ri(t.seconds,t.nanos)}class Qi{constructor(e,t,n,s,r,i,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class Yi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Yi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Yi&&e.projectId===this.projectId&&e.database===this.database}}const Ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Xi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Wi(e)?4:ma(e)?9007199254740991:da(e)?10:11:Ur()}function Ji(e,t){if(e===t)return!0;const n=Xi(e);if(n!==Xi(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Gi(e).isEqual(Gi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Bi(e.timestampValue),s=Bi(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return qi(e.bytesValue).isEqual(qi(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return zi(e.geoPointValue.latitude)===zi(t.geoPointValue.latitude)&&zi(e.geoPointValue.longitude)===zi(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return zi(e.integerValue)===zi(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=zi(e.doubleValue),s=zi(t.doubleValue);return n===s?ji(n)===ji(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return si(e.arrayValue.values||[],t.arrayValue.values||[],Ji);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Ei(n)!==Ei(s))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===s[r]||!Ji(n[r],s[r])))return!1;return!0}(e,t);default:return Ur()}}function Zi(e,t){return void 0!==(e.values||[]).find(e=>Ji(e,t))}function ea(e,t){if(e===t)return 0;const n=Xi(e),s=Xi(t);if(n!==s)return ni(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return ni(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=zi(e.integerValue||e.doubleValue),s=zi(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return ta(e.timestampValue,t.timestampValue);case 4:return ta(Gi(e),Gi(t));case 5:return ni(e.stringValue,t.stringValue);case 6:return function(e,t){const n=qi(e),s=qi(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let r=0;r<n.length&&r<s.length;r++){const e=ni(n[r],s[r]);if(0!==e)return e}return ni(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ni(zi(e.latitude),zi(t.latitude));return 0!==n?n:ni(zi(e.longitude),zi(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return na(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,s,r,i;const a=e.fields||{},o=t.fields||{},l=null===(n=a.value)||void 0===n?void 0:n.arrayValue,c=null===(s=o.value)||void 0===s?void 0:s.arrayValue,u=ni((null===(r=null==l?void 0:l.values)||void 0===r?void 0:r.length)||0,(null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0);return 0!==u?u:na(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Ki.mapValue&&t===Ki.mapValue)return 0;if(e===Ki.mapValue)return 1;if(t===Ki.mapValue)return-1;const n=e.fields||{},s=Object.keys(n),r=t.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let a=0;a<s.length&&a<i.length;++a){const e=ni(s[a],i[a]);if(0!==e)return e;const t=ea(n[s[a]],r[i[a]]);if(0!==t)return t}return ni(s.length,i.length)}(e.mapValue,t.mapValue);default:throw Ur()}}function ta(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ni(e,t);const n=Bi(e),s=Bi(t),r=ni(n.seconds,s.seconds);return 0!==r?r:ni(n.nanos,s.nanos)}function na(e,t){const n=e.values||[],s=t.values||[];for(let r=0;r<n.length&&r<s.length;++r){const e=ea(n[r],s[r]);if(e)return e}return ni(n.length,s.length)}function sa(e){return ra(e)}function ra(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Bi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return qi(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ui.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=ra(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const r of t)s?s=!1:n+=",",n+=`${r}:${ra(e.fields[r])}`;return n+"}"}(e.mapValue):Ur()}function ia(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function aa(e){return!!e&&"integerValue"in e}function oa(e){return!!e&&"arrayValue"in e}function la(e){return!!e&&"nullValue"in e}function ca(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ua(e){return!!e&&"mapValue"in e}function da(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ha(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ai(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ha(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ha(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ma(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class pa{constructor(e){this.value=e}static empty(){return new pa({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ua(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ha(t)}setAll(e){let t=ci.emptyPath(),n={},s=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=r.popLast()}e?n[r.lastSegment()]=ha(e):s.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){const t=this.field(e.popLast());ua(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ji(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ua(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Ai(t,(t,n)=>e[t]=n);for(const s of n)delete e[s]}clone(){return new pa(ha(this.value))}}function fa(e){const t=[];return Ai(e.fields,(e,n)=>{const s=new ci([e]);if(ua(n)){const e=fa(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)}),new $i(t)}class ga{constructor(e,t,n,s,r,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=a}static newInvalidDocument(e){return new ga(e,0,ii.min(),ii.min(),ii.min(),pa.empty(),0)}static newFoundDocument(e,t,n,s){return new ga(e,1,t,ii.min(),n,s,0)}static newNoDocument(e,t){return new ga(e,2,t,ii.min(),ii.min(),pa.empty(),0)}static newUnknownDocument(e,t){return new ga(e,3,t,ii.min(),ii.min(),pa.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ii.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pa.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ii.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ga&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ga(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class va{constructor(e,t){this.position=e,this.inclusive=t}}function ya(e,t,n){let s=0;for(let r=0;r<e.position.length;r++){const i=t[r],a=e.position[r];if(s=i.field.isKeyField()?ui.comparator(ui.fromName(a.referenceValue),n.key):ea(a,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function xa(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ji(e.position[n],t.position[n]))return!1;return!0}class ba{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function wa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ka{}class Na extends ka{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Aa(e,t,n):"array-contains"===t?new Oa(e,n):"in"===t?new Ra(e,n):"not-in"===t?new La(e,n):"array-contains-any"===t?new $a(e,n):new Na(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Pa(e,n):new Ma(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ea(t,this.value)):null!==t&&Xi(this.value)===Xi(t)&&this.matchesComparison(ea(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ur()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ja extends ka{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ja(e,t)}matches(e){return Ca(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ca(e){return"and"===e.op}function Sa(e){return _a(e)&&Ca(e)}function _a(e){for(const t of e.filters)if(t instanceof ja)return!1;return!0}function Ta(e){if(e instanceof Na)return e.field.canonicalString()+e.op.toString()+sa(e.value);if(Sa(e))return e.filters.map(e=>Ta(e)).join(",");{const t=e.filters.map(e=>Ta(e)).join(",");return`${e.op}(${t})`}}function Ia(e,t){return e instanceof Na?function(e,t){return t instanceof Na&&e.op===t.op&&e.field.isEqual(t.field)&&Ji(e.value,t.value)}(e,t):e instanceof ja?function(e,t){return t instanceof ja&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,s)=>e&&Ia(n,t.filters[s]),!0)}(e,t):void Ur()}function Ea(e){return e instanceof Na?function(e){return`${e.field.canonicalString()} ${e.op} ${sa(e.value)}`}(e):e instanceof ja?function(e){return e.op.toString()+" {"+e.getFilters().map(Ea).join(" ,")+"}"}(e):"Filter"}class Aa extends Na{constructor(e,t,n){super(e,t,n),this.key=ui.fromName(n.referenceValue)}matches(e){const t=ui.comparator(e.key,this.key);return this.matchesComparison(t)}}class Pa extends Na{constructor(e,t){super(e,"in",t),this.keys=Da("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ma extends Na{constructor(e,t){super(e,"not-in",t),this.keys=Da("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Da(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ui.fromName(e.referenceValue))}class Oa extends Na{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return oa(t)&&Zi(t.arrayValue,this.value)}}class Ra extends Na{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Zi(this.value.arrayValue,t)}}class La extends Na{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Zi(this.value.arrayValue,t)}}class $a extends Na{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!oa(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Zi(this.value.arrayValue,e))}}class Fa{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=a,this.ue=null}}function Ua(e){return new Fa(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Va(e){const t=Br(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Ta(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ni(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>sa(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>sa(e)).join(",")),t.ue=e}return t.ue}function Ba(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!wa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ia(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!xa(e.startAt,t.startAt)&&xa(e.endAt,t.endAt)}function za(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class qa{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Wa(e,t,n,s,r,i,a,o){return new qa(e,t,n,s,r,i,a,o)}function Ha(e){return new qa(e)}function Ga(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Qa(e){return null!==e.collectionGroup}function Ya(e){const t=Br(e);if(null===t.ce){t.ce=[];const e=new Set;for(const r of t.explicitOrderBy)t.ce.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",s=function(e){let t=new Ri(ci.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);s.forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new ba(s,n))}),e.has(ci.keyField().canonicalString())||t.ce.push(new ba(ci.keyField(),n))}return t.ce}function Ka(e){const t=Br(e);return t.le||(t.le=Xa(t,Ya(e))),t.le}function Xa(e,t){if("F"===e.limitType)return Ua(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ba(e.field,t)});const n=e.endAt?new va(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new va(e.startAt.position,e.startAt.inclusive):null;return Ua(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}function Ja(e,t){const n=e.filters.concat([t]);return new qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Za(e,t,n){return new qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function eo(e,t){return Ba(Ka(e),Ka(t))&&e.limitType===t.limitType}function to(e){return`${Va(Ka(e))}|lt:${e.limitType}`}function no(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Ea(e)).join(", ")}]`),Ni(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sa(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sa(e)).join(",")),`Target(${t})`}(Ka(e))}; limitType=${e.limitType})`}function so(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ui.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ya(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=ya(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,Ya(e),t))&&!(e.endAt&&!function(e,t,n){const s=ya(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,Ya(e),t))}(e,t)}function ro(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function io(e){return(t,n)=>{let s=!1;for(const r of Ya(e)){const e=ao(r,t,n);if(0!==e)return e;s=s||r.field.isKeyField()}return 0}}function ao(e,t,n){const s=e.field.isKeyField()?ui.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),r=n.data.field(e);return null!==s&&null!==r?ea(s,r):Ur()}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return Ur()}}class oo{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,r]of n)if(this.equalsFn(s,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ai(this.inner,(t,n)=>{for(const[s,r]of n)e(s,r)})}isEmpty(){return Pi(this.inner)}size(){return this.innerSize}}const lo=new Mi(ui.comparator);function co(){return lo}const uo=new Mi(ui.comparator);function ho(){let e=uo;for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const r of n)e=e.insert(r.key,r);return e}function mo(e){let t=uo;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function po(){return go()}function fo(){return go()}function go(){return new oo(e=>e.toString(),(e,t)=>e.isEqual(t))}const vo=new Mi(ui.comparator),yo=new Ri(ui.comparator);function xo(){let e=yo;for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const r of n)e=e.add(r);return e}const bo=new Ri(ni);function wo(){return bo}function ko(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ji(t)?"-0":t}}function No(e){return{integerValue:""+e}}function jo(e,t){return Ci(t)?No(t):ko(e,t)}class Co{constructor(){this._=void 0}}function So(e,t,n){return e instanceof Io?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Wi(t)&&(t=Hi(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Eo?Ao(e,t):e instanceof Po?Mo(e,t):function(e,t){const n=To(e,t),s=Oo(n)+Oo(e.Pe);return aa(n)&&aa(e.Pe)?No(s):ko(e.serializer,s)}(e,t)}function _o(e,t,n){return e instanceof Eo?Ao(e,t):e instanceof Po?Mo(e,t):n}function To(e,t){return e instanceof Do?function(e){return aa(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Io extends Co{}class Eo extends Co{constructor(e){super(),this.elements=e}}function Ao(e,t){const n=Ro(t);for(const s of e.elements)n.some(e=>Ji(e,s))||n.push(s);return{arrayValue:{values:n}}}class Po extends Co{constructor(e){super(),this.elements=e}}function Mo(e,t){let n=Ro(t);for(const s of e.elements)n=n.filter(e=>!Ji(e,s));return{arrayValue:{values:n}}}class Do extends Co{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Oo(e){return zi(e.integerValue||e.doubleValue)}function Ro(e){return oa(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Lo{constructor(e,t){this.field=e,this.transform=t}}class $o{constructor(e,t){this.version=e,this.transformResults=t}}class Fo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Fo}static exists(e){return new Fo(void 0,e)}static updateTime(e){return new Fo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Uo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Vo{}function Bo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Jo(e.key,Fo.none()):new Go(e.key,e.data,Fo.none());{const n=e.data,s=pa.empty();let r=new Ri(ci.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),r=r.add(e)}return new Qo(e.key,s,new $i(r.toArray()),Fo.none())}}function zo(e,t,n){e instanceof Go?function(e,t,n){const s=e.value.clone(),r=Ko(e.fieldTransforms,t,n.transformResults);s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Qo?function(e,t,n){if(!Uo(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Ko(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Yo(e)),r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function qo(e,t,n,s){return e instanceof Go?function(e,t,n,s){if(!Uo(e.precondition,t))return n;const r=e.value.clone(),i=Xo(e.fieldTransforms,s,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,s):e instanceof Qo?function(e,t,n,s){if(!Uo(e.precondition,t))return n;const r=Xo(e.fieldTransforms,s,t),i=t.data;return i.setAll(Yo(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,s):function(e,t,n){return Uo(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Wo(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),r=To(s.transform,e||null);null!=r&&(null===n&&(n=pa.empty()),n.set(s.field,r))}return n||null}function Ho(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&si(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Eo&&t instanceof Eo||e instanceof Po&&t instanceof Po?si(e.elements,t.elements,Ji):e instanceof Do&&t instanceof Do?Ji(e.Pe,t.Pe):e instanceof Io&&t instanceof Io}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Go extends Vo{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Qo extends Vo{constructor(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Yo(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}}),t}function Ko(e,t,n){const s=new Map;Vr(e.length===n.length);for(let r=0;r<n.length;r++){const i=e[r],a=i.transform,o=t.data.field(i.field);s.set(i.field,_o(a,o,n[r]))}return s}function Xo(e,t,n){const s=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);s.set(r.field,So(e,i,t))}return s}class Jo extends Vo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Zo extends Vo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class el{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const t=this.mutations[s];t.key.isEqual(e.key)&&zo(t,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=qo(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=qo(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=fo();return this.mutations.forEach(s=>{const r=e.get(s.key),i=r.overlayedDocument;let a=this.applyToLocalView(i,r.mutatedFields);a=t.has(s.key)?null:a;const o=Bo(i,a);null!==o&&n.set(s.key,o),i.isValidDocument()||i.convertToNoDocument(ii.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),xo())}isEqual(e){return this.batchId===e.batchId&&si(this.mutations,e.mutations,(e,t)=>Ho(e,t))&&si(this.baseMutations,e.baseMutations,(e,t)=>Ho(e,t))}}class tl{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Vr(e.mutations.length===n.length);let s=vo;const r=e.mutations;for(let i=0;i<r.length;i++)s=s.insert(r[i].key,n[i].version);return new tl(e,t,n,s)}}class nl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class sl{constructor(e,t){this.count=e,this.unchangedNames=t}}var rl,il;function al(e){switch(e){default:return Ur();case zr.CANCELLED:case zr.UNKNOWN:case zr.DEADLINE_EXCEEDED:case zr.RESOURCE_EXHAUSTED:case zr.INTERNAL:case zr.UNAVAILABLE:case zr.UNAUTHENTICATED:return!1;case zr.INVALID_ARGUMENT:case zr.NOT_FOUND:case zr.ALREADY_EXISTS:case zr.PERMISSION_DENIED:case zr.FAILED_PRECONDITION:case zr.ABORTED:case zr.OUT_OF_RANGE:case zr.UNIMPLEMENTED:case zr.DATA_LOSS:return!0}}function ol(e){if(void 0===e)return Lr("GRPC error has no .code"),zr.UNKNOWN;switch(e){case rl.OK:return zr.OK;case rl.CANCELLED:return zr.CANCELLED;case rl.UNKNOWN:return zr.UNKNOWN;case rl.DEADLINE_EXCEEDED:return zr.DEADLINE_EXCEEDED;case rl.RESOURCE_EXHAUSTED:return zr.RESOURCE_EXHAUSTED;case rl.INTERNAL:return zr.INTERNAL;case rl.UNAVAILABLE:return zr.UNAVAILABLE;case rl.UNAUTHENTICATED:return zr.UNAUTHENTICATED;case rl.INVALID_ARGUMENT:return zr.INVALID_ARGUMENT;case rl.NOT_FOUND:return zr.NOT_FOUND;case rl.ALREADY_EXISTS:return zr.ALREADY_EXISTS;case rl.PERMISSION_DENIED:return zr.PERMISSION_DENIED;case rl.FAILED_PRECONDITION:return zr.FAILED_PRECONDITION;case rl.ABORTED:return zr.ABORTED;case rl.OUT_OF_RANGE:return zr.OUT_OF_RANGE;case rl.UNIMPLEMENTED:return zr.UNIMPLEMENTED;case rl.DATA_LOSS:return zr.DATA_LOSS;default:return Ur()}}(il=rl||(rl={}))[il.OK=0]="OK",il[il.CANCELLED=1]="CANCELLED",il[il.UNKNOWN=2]="UNKNOWN",il[il.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",il[il.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",il[il.NOT_FOUND=5]="NOT_FOUND",il[il.ALREADY_EXISTS=6]="ALREADY_EXISTS",il[il.PERMISSION_DENIED=7]="PERMISSION_DENIED",il[il.UNAUTHENTICATED=16]="UNAUTHENTICATED",il[il.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",il[il.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",il[il.ABORTED=10]="ABORTED",il[il.OUT_OF_RANGE=11]="OUT_OF_RANGE",il[il.UNIMPLEMENTED=12]="UNIMPLEMENTED",il[il.INTERNAL=13]="INTERNAL",il[il.UNAVAILABLE=14]="UNAVAILABLE",il[il.DATA_LOSS=15]="DATA_LOSS";let ll=null;function cl(){return new TextEncoder}const ul=new vr([4294967295,4294967295],0);function dl(e){const t=cl().encode(e),n=new yr;return n.update(t),new Uint8Array(n.digest())}function hl(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new vr([n,s],0),new vr([r,i],0)]}class ml{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new pl(`Invalid padding: ${t}`);if(n<0)throw new pl(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new pl(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new pl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=vr.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(vr.fromNumber(n)));return 1===s.compare(ul)&&(s=new vr([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=dl(e),[n,s]=hl(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(n,s,r);if(!this.de(e))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new ml(r,s,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.Ie)return;const t=dl(e),[n,s]=hl(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(n,s,r);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class pl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fl{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,gl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new fl(ii.min(),s,new Mi(ni),co(),xo())}}class gl{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new gl(n,t,xo(),xo(),xo())}}class vl{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class yl{constructor(e,t){this.targetId=e,this.me=t}}class xl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ui.EMPTY_BYTE_STRING,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class bl{constructor(){this.fe=0,this.ge=Nl(),this.pe=Ui.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=xo(),t=xo(),n=xo();return this.ge.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:Ur()}}),new gl(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Nl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Vr(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class wl{constructor(e){this.Le=e,this.Be=new Map,this.ke=co(),this.qe=kl(),this.Qe=new Mi(ni)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Ur()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const r=s.target;if(za(r))if(0===n){const e=new ui(r.path);this.Ue(t,e,ga.newNoDocument(e,ii.min()))}else Vr(1===n);else{const s=this.Ye(t);if(s!==n){const n=this.Ze(e),r=n?this.Xe(n,e,s):1;if(0!==r){this.je(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==ll||ll.et(function(e,t,n,s,r){var i,a,o,l,c,u;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===r,hashCount:null!==(i=null==h?void 0:h.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(l=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(u=null===(c=null==h?void 0:h.bits)||void 0===c?void 0:c.padding)&&void 0!==u?u:0,mightContain:e=>{var t;return null!==(t=null==s?void 0:s.mightContain(e))&&void 0!==t&&t}}),d}(s,e.me,this.Le.tt(),n,r))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t;let i,a;try{i=qi(n).toUint8Array()}catch(e){if(e instanceof Fi)return $r("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new ml(i,s,r)}catch(e){return $r(e instanceof pl?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(n=>{const r=this.Le.tt(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.Ue(t,n,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((n,s)=>{const r=this.Je(s);if(r){if(n.current&&za(r.target)){const t=new ui(r.target.path);null!==this.ke.get(t)||this.it(s,t)||this.Ue(s,t,ga.newNoDocument(t,e))}n.be&&(t.set(s,n.ve()),n.Ce())}});let n=xo();this.qe.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const s=new fl(e,t,this.Qe,this.ke,n);return this.ke=co(),this.qe=kl(),this.Qe=new Mi(ni),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new bl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ri(ni),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Rr("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new bl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function kl(){return new Mi(ui.comparator)}function Nl(){return new Mi(ui.comparator)}const jl={asc:"ASCENDING",desc:"DESCENDING"},Cl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sl={and:"AND",or:"OR"};class _l{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Tl(e,t){return e.useProto3Json||Ni(t)?t:{value:t}}function Il(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function El(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Al(e,t){return Il(e,t.toTimestamp())}function Pl(e){return Vr(!!e),ii.fromTimestamp(function(e){const t=Bi(e);return new ri(t.seconds,t.nanos)}(e))}function Ml(e,t){return Dl(e,t).canonicalString()}function Dl(e,t){const n=function(e){return new oi(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ol(e){const t=oi.fromString(e);return Vr(tc(t)),t}function Rl(e,t){return Ml(e.databaseId,t.path)}function Ll(e,t){const n=Ol(t);if(n.get(1)!==e.databaseId.projectId)throw new qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ui(Vl(n))}function $l(e,t){return Ml(e.databaseId,t)}function Fl(e){const t=Ol(e);return 4===t.length?oi.emptyPath():Vl(t)}function Ul(e){return new oi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Vl(e){return Vr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Bl(e,t,n){return{name:Rl(e,t),fields:n.value.mapValue.fields}}function zl(e,t){let n;if(t instanceof Go)n={update:Bl(e,t.key,t.value)};else if(t instanceof Jo)n={delete:Rl(e,t.key)};else if(t instanceof Qo)n={update:Bl(e,t.key,t.data),updateMask:ec(t.fieldMask)};else{if(!(t instanceof Zo))return Ur();n={verify:Rl(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Io)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Eo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Po)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Do)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw Ur()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Al(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ur()}(e,t.precondition)),n}function ql(e,t){return{documents:[$l(e,t.path)]}}function Wl(e,t){const n={structuredQuery:{}},s=t.path;let r;null!==t.collectionGroup?(r=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=$l(e,r);const i=function(e){if(0!==e.length)return Zl(ja.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Xl(e.field),direction:Ql(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=Tl(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:r}}function Hl(e){let t=Fl(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Vr(1===s);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=Gl(e);return t instanceof ja&&Sa(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new ba(Jl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,Ni(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new va(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new va(n,t)}(n.endAt)),Wa(t,r,a,i,o,"F",l,c)}function Gl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Jl(e.unaryFilter.field);return Na.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Jl(e.unaryFilter.field);return Na.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Jl(e.unaryFilter.field);return Na.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Jl(e.unaryFilter.field);return Na.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Ur()}}(e):void 0!==e.fieldFilter?function(e){return Na.create(Jl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ur()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ja.create(e.compositeFilter.filters.map(e=>Gl(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ur()}}(e.compositeFilter.op))}(e):Ur()}function Ql(e){return jl[e]}function Yl(e){return Cl[e]}function Kl(e){return Sl[e]}function Xl(e){return{fieldPath:e.canonicalString()}}function Jl(e){return ci.fromServerFormat(e.fieldPath)}function Zl(e){return e instanceof Na?function(e){if("=="===e.op){if(ca(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NAN"}};if(la(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ca(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NOT_NAN"}};if(la(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xl(e.field),op:Yl(e.op),value:e.value}}}(e):e instanceof ja?function(e){const t=e.getFilters().map(e=>Zl(e));return 1===t.length?t[0]:{compositeFilter:{op:Kl(e.op),filters:t}}}(e):Ur()}function ec(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function tc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class nc{constructor(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ii.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ii.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ui.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new nc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class sc{constructor(e){this.ct=e}}function rc(e){const t=Hl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Za(t,t.limit,"L"):t}class ic{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(zi(e.integerValue));else if("doubleValue"in e){const n=zi(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ji(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Bi(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(qi(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?ma(e)?this.dt(t,Number.MAX_SAFE_INTEGER):da(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ur()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const r=e.fields||{};this.dt(t,53);const i="value",a=(null===(s=null===(n=r[i].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(t,15),t.At(zi(a)),this.Vt(i,t),this.Tt(r[i],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),ui.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ic.vt=new ic;class ac{constructor(){this.un=new oc}addToCollectionParentIndex(e,t){return this.un.add(t),xi.resolve()}getCollectionParents(e,t){return xi.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return xi.resolve()}deleteFieldIndex(e,t){return xi.resolve()}deleteAllFieldIndexes(e){return xi.resolve()}createTargetIndexes(e,t){return xi.resolve()}getDocumentsMatchingTarget(e,t){return xi.resolve(null)}getIndexType(e,t){return xi.resolve(0)}getFieldIndexes(e,t){return xi.resolve([])}getNextCollectionGroupToUpdate(e){return xi.resolve(null)}getMinOffset(e,t){return xi.resolve(pi.min())}getMinOffsetFromCollectionGroup(e,t){return xi.resolve(pi.min())}updateCollectionGroup(e,t,n){return xi.resolve()}updateIndexEntries(e,t){return xi.resolve()}}class oc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Ri(oi.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Ri(oi.comparator)).toArray()}}new Uint8Array(0);class lc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new lc(e,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}lc.DEFAULT_COLLECTION_PERCENTILE=10,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lc.DEFAULT=new lc(41943040,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lc.DISABLED=new lc(-1,0,0);class cc{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new cc(0)}static kn(){return new cc(-1)}}class uc{constructor(){this.changes=new oo(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ga.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?xi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class dc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class hc{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&qo(n.mutation,e,$i.empty(),ri.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,xo()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xo();const s=po();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(e=>{let t=ho();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=po();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,xo()))}populateOverlays(e,t,n){const s=[];return n.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,s){let r=co();const i=go(),a=go();return t.forEach((e,t)=>{const a=n.get(t.key);s.has(t.key)&&(void 0===a||a.mutation instanceof Qo)?r=r.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),qo(a.mutation,t,a.mutation.getFieldMask(),ri.now())):i.set(t.key,$i.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new dc(t,null!==(n=i.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=go();let s=new Mi((e,t)=>e-t),r=xo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=n.get(e)||$i.empty();a=r.applyToLocalView(i,a),n.set(e,a);const o=(s.get(r.batchId)||xo()).add(e);s=s.insert(r.batchId,o)})}).next(()=>{const i=[],a=s.getReverseIterator();for(;a.hasNext();){const s=a.getNext(),o=s.key,l=s.value,c=fo();l.forEach(e=>{if(!r.has(e)){const s=Bo(t.get(e),n.get(e));null!==s&&c.set(e,s),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return xi.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,s){return function(e){return ui.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Qa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):xi.resolve(po());let a=-1,o=r;return i.next(t=>xi.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?xi.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,xo())).next(e=>({batchId:a,changes:mo(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ui(t)).next(e=>{let t=ho();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const r=t.collectionGroup;let i=ho();return this.indexManager.getCollectionParents(e,r).next(a=>xi.forEach(a,a=>{const o=function(e,t){return new qa(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n,s).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(e=>{r.forEach((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,ga.newInvalidDocument(s)))});let n=ho();return e.forEach((e,s)=>{const i=r.get(e);void 0!==i&&qo(i.mutation,s,$i.empty(),ri.now()),so(t,s)&&(n=n.insert(e,s))}),n})}}class mc{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return xi.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Pl(e.createTime)}}(t)),xi.resolve()}getNamedQuery(e,t){return xi.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:rc(e.bundledQuery),readTime:Pl(e.readTime)}}(t)),xi.resolve()}}class pc{constructor(){this.overlays=new Mi(ui.comparator),this.Ir=new Map}getOverlay(e,t){return xi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=po();return xi.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,s)=>{this.ht(e,t,s)}),xi.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),xi.resolve()}getOverlaysForCollection(e,t,n){const s=po(),r=t.length+1,i=new ui(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&s.set(e.getKey(),e)}return xi.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Mi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=po(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=po(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=s)););return xi.resolve(a)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new nl(t,n));let r=this.Ir.get(t);void 0===r&&(r=xo(),this.Ir.set(t,r)),this.Ir.set(t,r.add(n.key))}}class fc{constructor(){this.sessionToken=Ui.EMPTY_BYTE_STRING}getSessionToken(e){return xi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,xi.resolve()}}class gc{constructor(){this.Tr=new Ri(vc.Er),this.dr=new Ri(vc.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new vc(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new vc(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new ui(new oi([])),n=new vc(t,e),s=new vc(t,e+1),r=[];return this.dr.forEachInRange([n,s],e=>{this.Vr(e),r.push(e.key)}),r}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ui(new oi([])),n=new vc(t,e),s=new vc(t,e+1);let r=xo();return this.dr.forEachInRange([n,s],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new vc(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class vc{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ui.comparator(e.key,t.key)||ni(e.wr,t.wr)}static Ar(e,t){return ni(e.wr,t.wr)||ui.comparator(e.key,t.key)}}class yc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ri(vc.Er)}checkEmpty(e){return xi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const r=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new el(r,t,n,s);this.mutationQueue.push(i);for(const a of s)this.br=this.br.add(new vc(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return xi.resolve(i)}lookupMutationBatch(e,t){return xi.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.vr(n),r=s<0?0:s;return xi.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return xi.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return xi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new vc(t,0),s=new vc(t,Number.POSITIVE_INFINITY),r=[];return this.br.forEachInRange([n,s],e=>{const t=this.Dr(e.wr);r.push(t)}),xi.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ri(ni);return t.forEach(e=>{const t=new vc(e,0),s=new vc(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,s],e=>{n=n.add(e.wr)})}),xi.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let r=n;ui.isDocumentKey(r)||(r=r.child(""));const i=new vc(new ui(r),0);let a=new Ri(ni);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(a=a.add(e.wr)),!0)},i),xi.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Vr(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return xi.forEach(t.mutations,s=>{const r=new vc(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new vc(t,0),s=this.br.firstAfterOrEqual(n);return xi.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,xi.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xc{constructor(e){this.Mr=e,this.docs=new Mi(ui.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),r=s?s.size:0,i=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return xi.resolve(n?n.document.mutableCopy():ga.newInvalidDocument(t))}getEntries(e,t){let n=co();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ga.newInvalidDocument(e))}),xi.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=co();const i=t.path,a=new ui(i.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||fi(mi(a),n)<=0||(s.has(a.key)||so(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return xi.resolve(r)}getAllFromCollectionGroup(e,t,n,s){Ur()}Or(e,t){return xi.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new bc(this)}getSize(e){return xi.resolve(this.size)}}class bc extends uc{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),xi.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class wc{constructor(e){this.persistence=e,this.Nr=new oo(e=>Va(e),Ba),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.Lr=0,this.Br=new gc,this.targetCount=0,this.kr=cc.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),xi.resolve()}getLastRemoteSnapshotVersion(e){return xi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return xi.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),xi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),xi.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new cc(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,xi.resolve()}updateTargetData(e,t){return this.Kn(t),xi.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,xi.resolve()}removeTargets(e,t,n){let s=0;const r=[];return this.Nr.forEach((i,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(i),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),xi.waitFor(r).next(()=>s)}getTargetCount(e){return xi.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return xi.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),xi.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(t=>{r.push(s.markPotentiallyOrphaned(e,t))}),xi.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),xi.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return xi.resolve(n)}containsKey(e,t){return xi.resolve(this.Br.containsKey(t))}}class kc{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ki(0),this.Kr=!1,this.Kr=!0,this.$r=new fc,this.referenceDelegate=e(this),this.Ur=new wc(this),this.indexManager=new ac,this.remoteDocumentCache=function(e){return new xc(e)}(e=>this.referenceDelegate.Wr(e)),this.serializer=new sc(t),this.Gr=new mc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new yc(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Rr("MemoryPersistence","Starting transaction:",e);const s=new Nc(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(e=>this.referenceDelegate.jr(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Hr(e,t){return xi.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Nc extends vi{constructor(e){super(),this.currentSequenceNumber=e}}class jc{constructor(e){this.persistence=e,this.Jr=new gc,this.Yr=null}static Zr(e){return new jc(e)}get Xr(){if(this.Yr)return this.Yr;throw Ur()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),xi.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),xi.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),xi.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xi.forEach(this.Xr,n=>{const s=ui.fromPath(n);return this.ei(e,s).next(e=>{e||t.removeEntry(s,ii.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return xi.or([()=>xi.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Cc{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=xo(),s=xo();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Cc(e,t.fromCache,n,s)}}class Sc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class _c{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=g()?8:bi(f())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const r={result:null};return this.Yi(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Zi(e,t,s,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new Sc;return this.Xi(e,t,n).next(s=>{if(r.result=s,this.zi)return this.es(e,t,n,s.size)})}).next(()=>r.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(Or()<=D.DEBUG&&Rr("QueryEngine","SDK will not create cache indexes for query:",no(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),xi.resolve()):(Or()<=D.DEBUG&&Rr("QueryEngine","Query:",no(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(Or()<=D.DEBUG&&Rr("QueryEngine","The SDK decides to create cache indexes for query:",no(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ka(t))):xi.resolve())}Yi(e,t){if(Ga(t))return xi.resolve(null);let n=Ka(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Za(t,null,"F"),n=Ka(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const r=xo(...s);return this.Ji.getDocuments(e,r).next(s=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.ts(t,s);return this.ns(t,i,r,n.readTime)?this.Yi(e,Za(t,null,"F")):this.rs(e,i,t,n)}))})))}Zi(e,t,n,s){return Ga(t)||s.isEqual(ii.min())?xi.resolve(null):this.Ji.getDocuments(e,n).next(r=>{const i=this.ts(t,r);return this.ns(t,i,n,s)?xi.resolve(null):(Or()<=D.DEBUG&&Rr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),no(t)),this.rs(e,i,t,hi(s,-1)).next(e=>e))})}ts(e,t){let n=new Ri(io(e));return t.forEach((t,s)=>{so(e,s)&&(n=n.add(s))}),n}ns(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Xi(e,t,n){return Or()<=D.DEBUG&&Rr("QueryEngine","Using full collection scan to execute query:",no(t)),this.Ji.getDocumentsMatchingQuery(e,t,pi.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Tc{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Mi(ni),this._s=new oo(e=>Va(e),Ba),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hc(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Ic(e,t,n,s){return new Tc(e,t,n,s)}async function Ec(e,t){const n=Br(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next(r=>(s=r,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let a=xo();for(const e of s){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({hs:e,removedBatchIds:r,addedBatchIds:i}))})})}function Ac(e){const t=Br(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function Pc(e,t,n){let s=xo(),r=xo();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=co();return n.forEach((n,i)=>{const a=e.get(n);i.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(ii.min())?(t.removeEntry(n,i.readTime),s=s.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),s=s.insert(n,i)):Rr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",i.version)}),{Ps:s,Is:r}})}function Mc(e,t){const n=Br(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Dc(e,t){const n=Br(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let s;return n.Ur.getTargetData(e,t).next(r=>r?(s=r,xi.resolve(s)):n.Ur.allocateTargetId(e).next(r=>(s=new nc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,s).next(()=>s))))}).then(e=>{const s=n.os.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e})}async function Oc(e,t,n){const s=Br(e),r=s.os.get(t),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,e=>s.persistence.referenceDelegate.removeTarget(e,r))}catch(e){if(!wi(e))throw e;Rr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}s.os=s.os.remove(t),s._s.delete(r.target)}function Rc(e,t,n){const s=Br(e);let r=ii.min(),i=xo();return s.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const s=Br(e),r=s._s.get(n);return void 0!==r?xi.resolve(s.os.get(r)):s.Ur.getTargetData(t,n)}(s,e,Ka(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>s.ss.getDocumentsMatchingQuery(e,t,n?r:ii.min(),n?i:xo())).next(e=>(Lc(s,ro(t),e),{documents:e,Ts:i})))}function Lc(e,t,n){let s=e.us.get(t)||ii.min();n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.us.set(t,s)}class $c{constructor(){this.activeTargetIds=wo()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fc{constructor(){this.so=new $c,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new $c,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Uc{_o(e){}shutdown(){}}class Vc{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Rr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Rr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bc=null;function zc(){return null===Bc?Bc=268435456+Math.round(2147483648*Math.random()):Bc++,"0x"+Bc.toString(16)}const qc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wc{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Hc="WebChannelConnection";class Gc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${s}`}get Fo(){return!1}Mo(e,t,n,s,r){const i=zc(),a=this.xo(e,t.toUriEncodedString());Rr("RestConnection",`Sending RPC '${e}' ${i}:`,a,n);const o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,s,r),this.No(e,a,o,n).then(t=>(Rr("RestConnection",`Received RPC '${e}' ${i}: `,t),t),t=>{throw $r("RestConnection",`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",n),t})}Lo(e,t,n,s,r,i){return this.Mo(e,t,n,s,r)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=qc[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const r=zc();return new Promise((i,a)=>{const o=new wr;o.setWithCredentials(!0),o.listenOnce(Nr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case jr.NO_ERROR:const t=o.getResponseJson();Rr(Hc,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),i(t);break;case jr.TIMEOUT:Rr(Hc,`RPC '${e}' ${r} timed out`),a(new qr(zr.DEADLINE_EXCEEDED,"Request time out"));break;case jr.HTTP_ERROR:const n=o.getStatus();if(Rr(Hc,`RPC '${e}' ${r} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(zr).indexOf(t)>=0?t:zr.UNKNOWN}(t.status);a(new qr(e,t.message))}else a(new qr(zr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new qr(zr.UNAVAILABLE,"Connection failed."));break;default:Ur()}}finally{Rr(Hc,`RPC '${e}' ${r} completed.`)}});const l=JSON.stringify(s);Rr(Hc,`RPC '${e}' ${r} sending request:`,s),o.send(t,"POST",l,n,15)})}Bo(e,t,n){const s=zc(),r=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Tr(),a=_r(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=r.join("");Rr(Hc,`Creating RPC '${e}' stream ${s}: ${c}`,o);const u=i.createWebChannel(c,o);let d=!1,h=!1;const m=new Wc({Io:t=>{h?Rr(Hc,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(d||(Rr(Hc,`Opening RPC '${e}' stream ${s} transport.`),u.open(),d=!0),Rr(Hc,`RPC '${e}' stream ${s} sending:`,t),u.send(t))},To:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,kr.EventType.OPEN,()=>{h||(Rr(Hc,`RPC '${e}' stream ${s} transport opened.`),m.yo())}),p(u,kr.EventType.CLOSE,()=>{h||(h=!0,Rr(Hc,`RPC '${e}' stream ${s} transport closed`),m.So())}),p(u,kr.EventType.ERROR,t=>{h||(h=!0,$r(Hc,`RPC '${e}' stream ${s} transport errored:`,t),m.So(new qr(zr.UNAVAILABLE,"The operation could not be completed")))}),p(u,kr.EventType.MESSAGE,t=>{var n;if(!h){const r=t.data[0];Vr(!!r);const i=r,a=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(a){Rr(Hc,`RPC '${e}' stream ${s} received error:`,a);const t=a.status;let n=function(e){const t=rl[e];if(void 0!==t)return ol(t)}(t),r=a.message;void 0===n&&(n=zr.INTERNAL,r="Unknown error status: "+t+" with message "+a.message),h=!0,m.So(new qr(n,r)),u.close()}else Rr(Hc,`RPC '${e}' stream ${s} received:`,r),m.bo(r)}}),p(a,Sr.STAT_EVENT,t=>{t.stat===Cr.PROXY?Rr(Hc,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===Cr.NOPROXY&&Rr(Hc,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{m.wo()},0),m}}function Qc(){return"undefined"!=typeof document?document:null}function Yc(e){return new _l(e,!0)}class Kc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&Rr("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Xc{constructor(e,t,n,s,r,i,a,o){this.ui=e,this.Ho=n,this.Jo=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Kc(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===zr.RESOURCE_EXHAUSTED?(Lr(t.toString()),Lr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===zr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,s]=e;this.Yo===t&&this.P_(n,s)},t=>{e(()=>{const e=new qr(zr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Rr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Rr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Jc extends Xc{constructor(e,t,n,s,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ur()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Vr(void 0===t||"string"==typeof t),Ui.fromBase64String(t||"")):(Vr(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Ui.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?zr.UNKNOWN:ol(e.code);return new qr(t,e.message||"")}(a);n=new xl(s,r,i,o||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ll(e,s.document.name),i=Pl(s.document.updateTime),a=s.document.createTime?Pl(s.document.createTime):ii.min(),o=new pa({mapValue:{fields:s.document.fields}}),l=ga.newFoundDocument(r,i,a,o),c=s.targetIds||[],u=s.removedTargetIds||[];n=new vl(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=Ll(e,s.document),i=s.readTime?Pl(s.readTime):ii.min(),a=ga.newNoDocument(r,i),o=s.removedTargetIds||[];n=new vl([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=Ll(e,s.document),i=s.removedTargetIds||[];n=new vl([],i,r,null)}else{if(!("filter"in t))return Ur();{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:r}=e,i=new sl(s,r),a=e.targetId;n=new yl(a,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ii.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ii.min():t.readTime?Pl(t.readTime):ii.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Ul(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=za(s)?{documents:ql(e,s)}:{query:Wl(e,s)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=El(e,t.resumeToken);const s=Tl(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(ii.min())>0){n.readTime=Il(e,t.snapshotVersion.toTimestamp());const s=Tl(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ur()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Ul(this.serializer),t.removeTarget=e,this.a_(t)}}class Zc extends Xc{constructor(e,t,n,s,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Vr(!!e.streamToken),this.lastStreamToken=e.streamToken,Vr(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){Vr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(Vr(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Pl(e.updateTime):Pl(t);return n.isEqual(ii.min())&&(n=Pl(t)),new $o(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Pl(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Ul(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>zl(this.serializer,e))};this.a_(t)}}class eu extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new qr(zr.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[i,a]=r;return this.connection.Mo(e,Dl(t,n),s,i,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new qr(zr.UNKNOWN,e.toString())})}Lo(e,t,n,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[a,o]=i;return this.connection.Lo(e,Dl(t,n),s,a,o,r)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new qr(zr.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class tu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Lr(t),this.D_=!1):Rr("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class nu{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=r,this.k_._o(e=>{n.enqueueAndForget(async()=>{du(this)&&(Rr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Br(e);t.L_.add(4),await ru(t),t.q_.set("Unknown"),t.L_.delete(4),await su(t)}(this))})}),this.q_=new tu(n,s)}}async function su(e){if(du(e))for(const t of e.B_)await t(!0)}async function ru(e){for(const t of e.B_)await t(!1)}function iu(e,t){const n=Br(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),uu(n)?cu(n):Eu(n).r_()&&ou(n,t))}function au(e,t){const n=Br(e),s=Eu(n);n.N_.delete(t),s.r_()&&lu(n,t),0===n.N_.size&&(s.r_()?s.o_():du(n)&&n.q_.set("Unknown"))}function ou(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ii.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Eu(e).A_(t)}function lu(e,t){e.Q_.xe(t),Eu(e).R_(t)}function cu(e){e.Q_=new wl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Eu(e).start(),e.q_.v_()}function uu(e){return du(e)&&!Eu(e).n_()&&e.N_.size>0}function du(e){return 0===Br(e).L_.size}function hu(e){e.Q_=void 0}async function mu(e){e.q_.set("Online")}async function pu(e){e.N_.forEach((t,n)=>{ou(e,t)})}async function fu(e,t){hu(e),uu(e)?(e.q_.M_(t),cu(e)):e.q_.set("Unknown")}async function gu(e,t,n){if(e.q_.set("Online"),t instanceof xl&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.N_.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.N_.delete(s),e.Q_.removeTarget(s))}(e,t)}catch(n){Rr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await vu(e,n)}else if(t instanceof vl?e.Q_.Ke(t):t instanceof yl?e.Q_.He(t):e.Q_.We(t),!n.isEqual(ii.min()))try{const t=await Ac(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.N_.get(s);r&&e.N_.set(s,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const s=e.N_.get(t);if(!s)return;e.N_.set(t,s.withResumeToken(Ui.EMPTY_BYTE_STRING,s.snapshotVersion)),lu(e,t);const r=new nc(s.target,t,n,s.sequenceNumber);ou(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Rr("RemoteStore","Failed to raise snapshot:",t),await vu(e,t)}}async function vu(e,t,n){if(!wi(t))throw t;e.L_.add(1),await ru(e),e.q_.set("Offline"),n||(n=()=>Ac(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Rr("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await su(e)})}function yu(e,t){return t().catch(n=>vu(e,n,t))}async function xu(e){const t=Br(e),n=Au(t);let s=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;bu(t);)try{const e=await Mc(t.localStore,s);if(null===e){0===t.O_.length&&n.o_();break}s=e.batchId,wu(t,e)}catch(e){await vu(t,e)}ku(t)&&Nu(t)}function bu(e){return du(e)&&e.O_.length<10}function wu(e,t){e.O_.push(t);const n=Au(e);n.r_()&&n.V_&&n.m_(t.mutations)}function ku(e){return du(e)&&!Au(e).n_()&&e.O_.length>0}function Nu(e){Au(e).start()}async function ju(e){Au(e).p_()}async function Cu(e){const t=Au(e);for(const n of e.O_)t.m_(n.mutations)}async function Su(e,t,n){const s=e.O_.shift(),r=tl.from(s,t,n);await yu(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await xu(e)}async function _u(e,t){t&&Au(e).V_&&await async function(e,t){if(function(e){return al(e)&&e!==zr.ABORTED}(t.code)){const n=e.O_.shift();Au(e).s_(),await yu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await xu(e)}}(e,t),ku(e)&&Nu(e)}async function Tu(e,t){const n=Br(e);n.asyncQueue.verifyOperationInProgress(),Rr("RemoteStore","RemoteStore received new credentials");const s=du(n);n.L_.add(3),await ru(n),s&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await su(n)}async function Iu(e,t){const n=Br(e);t?(n.L_.delete(2),await su(n)):t||(n.L_.add(2),await ru(n),n.q_.set("Unknown"))}function Eu(e){return e.K_||(e.K_=function(e,t,n){const s=Br(e);return s.w_(),new Jc(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Eo:mu.bind(null,e),Ro:pu.bind(null,e),mo:fu.bind(null,e),d_:gu.bind(null,e)}),e.B_.push(async t=>{t?(e.K_.s_(),uu(e)?cu(e):e.q_.set("Unknown")):(await e.K_.stop(),hu(e))})),e.K_}function Au(e){return e.U_||(e.U_=function(e,t,n){const s=Br(e);return s.w_(),new Zc(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ju.bind(null,e),mo:_u.bind(null,e),f_:Cu.bind(null,e),g_:Su.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await xu(e)):(await e.U_.stop(),e.O_.length>0&&(Rr("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))})),e.U_}class Pu{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new Wr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){const i=Date.now()+n,a=new Pu(e,t,i,s,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qr(zr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mu(e,t){if(Lr("AsyncQueue",`${t}: ${e}`),wi(e))return new qr(zr.UNAVAILABLE,`${t}: ${e}`);throw e}class Du{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ui.comparator(t.key,n.key):(e,t)=>ui.comparator(e.key,t.key),this.keyedMap=ho(),this.sortedSet=new Mi(this.comparator)}static emptySet(e){return new Du(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Du))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Du;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ou{constructor(){this.W_=new Mi(ui.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ur():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Ru{constructor(e,t,n,s,r,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,s,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Ru(e,t,Du.emptySet(t),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&eo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class Lu{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class $u{constructor(){this.queries=Fu(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=Br(e),s=n.queries;n.queries=Fu(),s.forEach((e,n)=>{for(const s of n.j_)s.onError(t)})}(this,new qr(zr.ABORTED,"Firestore shutting down"))}}function Fu(){return new oo(e=>to(e),eo)}async function Uu(e,t){const n=Br(e);let s=3;const r=t.query;let i=n.queries.get(r);i?!i.H_()&&t.J_()&&(s=2):(i=new Lu,s=t.J_()?0:1);try{switch(s){case 0:i.z_=await n.onListen(r,!0);break;case 1:i.z_=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(e){const n=Mu(e,`Initialization of query '${no(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.j_.push(t),t.Z_(n.onlineState),i.z_&&t.X_(i.z_)&&qu(n)}async function Vu(e,t){const n=Br(e),s=t.query;let r=3;const i=n.queries.get(s);if(i){const e=i.j_.indexOf(t);e>=0&&(i.j_.splice(e,1),0===i.j_.length?r=t.J_()?0:1:!i.H_()&&t.J_()&&(r=2))}switch(r){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function Bu(e,t){const n=Br(e);let s=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(r)&&(s=!0);t.z_=r}}s&&qu(n)}function zu(e,t,n){const s=Br(e),r=s.queries.get(t);if(r)for(const i of r.j_)i.onError(n);s.queries.delete(t)}function qu(e){e.Y_.forEach(e=>{e.next()})}var Wu,Hu;(Hu=Wu||(Wu={})).ea="default",Hu.Cache="cache";class Gu{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Ru(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=Ru.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Wu.Cache}}class Qu{constructor(e){this.key=e}}class Yu{constructor(e){this.key=e}}class Ku{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=xo(),this.mutatedKeys=xo(),this.Aa=io(e),this.Ra=new Du(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Ou,s=t?t.Ra:this.Ra;let r=t?t.mutatedKeys:this.mutatedKeys,i=s,a=!1;const o="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,l="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{const c=s.get(e),u=so(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let m=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),m=!0):this.ga(c,u)||(n.track({type:2,doc:u}),m=!0,(o&&this.Aa(u,o)>0||l&&this.Aa(u,l)<0)&&(a=!0)):!c&&u?(n.track({type:0,doc:u}),m=!0):c&&!u&&(n.track({type:1,doc:c}),m=!0,(o||l)&&(a=!0)),m&&(u?(i=i.add(u),r=h?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ra:i,fa:n,ns:a,mutatedKeys:r}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const r=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const i=e.fa.G_();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ur()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(n),s=null!=s&&s;const a=t&&!s?this.ya():[],o=0===this.da.size&&this.current&&!s?1:0,l=o!==this.Ea;return this.Ea=o,0!==i.length||l?{snapshot:new Ru(this.query,e.Ra,r,i,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ou,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=xo(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});const t=[];return e.forEach(e=>{this.da.has(e)||t.push(new Yu(e))}),this.da.forEach(n=>{e.has(n)||t.push(new Qu(n))}),t}ba(e){this.Ta=e.Ts,this.da=xo();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ru.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Xu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ju{constructor(e){this.key=e,this.va=!1}}class Zu{constructor(e,t,n,s,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Ca={},this.Fa=new oo(e=>to(e),eo),this.Ma=new Map,this.xa=new Set,this.Oa=new Mi(ui.comparator),this.Na=new Map,this.La=new gc,this.Ba={},this.ka=new Map,this.qa=cc.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function ed(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=wd(e);let r;const i=s.Fa.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Da()):r=await nd(s,t,n,!0),r}async function td(e,t){const n=wd(e);await nd(n,t,!0,!1)}async function nd(e,t,n,s){const r=await Dc(e.localStore,Ka(t)),i=r.targetId,a=e.sharedClientState.addLocalQueryTarget(i,n);let o;return s&&(o=await sd(e,t,i,"current"===a,r.resumeToken)),e.isPrimaryClient&&n&&iu(e.remoteStore,r),o}async function sd(e,t,n,s,r){e.Ka=(t,n,s)=>async function(e,t,n,s){let r=t.view.ma(n);r.ns&&(r=await Rc(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ma(n,r)}));const i=s&&s.targetChanges.get(t.targetId),a=s&&null!=s.targetMismatches.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,i,a);return fd(e,t.targetId,o.wa),o.snapshot}(e,t,n,s);const i=await Rc(e.localStore,t,!0),a=new Ku(t,i.Ts),o=a.ma(i.documents),l=gl.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,r),c=a.applyChanges(o,e.isPrimaryClient,l);fd(e,n,c.wa);const u=new Xu(t,n,a);return e.Fa.set(t,u),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),c.snapshot}async function rd(e,t,n){const s=Br(e),r=s.Fa.get(t),i=s.Ma.get(r.targetId);if(i.length>1)return s.Ma.set(r.targetId,i.filter(e=>!eo(e,t))),void s.Fa.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Oc(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),n&&au(s.remoteStore,r.targetId),md(s,r.targetId)}).catch(yi)):(md(s,r.targetId),await Oc(s.localStore,r.targetId,!0))}async function id(e,t){const n=Br(e),s=n.Fa.get(t),r=n.Ma.get(s.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),au(n.remoteStore,s.targetId))}async function ad(e,t){const n=Br(e);try{const e=await function(e,t){const n=Br(e),s=t.snapshotVersion;let r=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.cs.newChangeBuffer({trackRemovals:!0});r=n.os;const a=[];t.targetChanges.forEach((i,o)=>{const l=r.get(o);if(!l)return;a.push(n.Ur.removeMatchingKeys(e,i.removedDocuments,o).next(()=>n.Ur.addMatchingKeys(e,i.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Ui.EMPTY_BYTE_STRING,ii.min()).withLastLimboFreeSnapshotVersion(ii.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,s)),r=r.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,i)&&a.push(n.Ur.updateTargetData(e,c))});let o=co(),l=xo();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))}),a.push(Pc(e,i,t.documentUpdates).next(e=>{o=e.Ps,l=e.Is})),!s.isEqual(ii.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next(t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,s));a.push(t)}return xi.waitFor(a).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.os=r,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const s=n.Na.get(t);s&&(Vr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?s.va=!0:e.modifiedDocuments.size>0?Vr(s.va):e.removedDocuments.size>0&&(Vr(s.va),s.va=!1))}),await yd(n,e,t)}catch(e){await yi(e)}}function od(e,t,n){const s=Br(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.Fa.forEach((n,s)=>{const r=s.view.Z_(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=Br(e);n.onlineState=t;let s=!1;n.queries.forEach((e,n)=>{for(const r of n.j_)r.Z_(t)&&(s=!0)}),s&&qu(n)}(s.eventManager,t),e.length&&s.Ca.d_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function ld(e,t,n){const s=Br(e);s.sharedClientState.updateQueryState(t,"rejected",n);const r=s.Na.get(t),i=r&&r.key;if(i){let e=new Mi(ui.comparator);e=e.insert(i,ga.newNoDocument(i,ii.min()));const n=xo().add(i),r=new fl(ii.min(),new Map,new Mi(ni),e,n);await ad(s,r),s.Oa=s.Oa.remove(i),s.Na.delete(t),vd(s)}else await Oc(s.localStore,t,!1).then(()=>md(s,t,n)).catch(yi)}async function cd(e,t){const n=Br(e),s=t.batch.batchId;try{const e=await function(e,t){const n=Br(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const s=t.batch.keys(),r=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const r=n.batch,i=r.keys();let a=xi.resolve();return i.forEach(e=>{a=a.next(()=>s.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);Vr(null!==i),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=xo();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,s))})}(n.localStore,t);hd(n,s,null),dd(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await yd(n,e)}catch(e){await yi(e)}}async function ud(e,t,n){const s=Br(e);try{const e=await function(e,t){const n=Br(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(Vr(null!==t),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s)).next(()=>n.localDocuments.getDocuments(e,s))})}(s.localStore,t);hd(s,t,n),dd(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await yd(s,e)}catch(n){await yi(n)}}function dd(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function hd(e,t,n){const s=Br(e);let r=s.Ba[s.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),s.Ba[s.currentUser.toKey()]=r}}function md(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Ma.get(t))e.Fa.delete(s),n&&e.Ca.$a(s,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||pd(e,t)})}function pd(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(au(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),vd(e))}function fd(e,t,n){for(const s of n)s instanceof Qu?(e.La.addReference(s.key,t),gd(e,s)):s instanceof Yu?(Rr("SyncEngine","Document no longer in limbo: "+s.key),e.La.removeReference(s.key,t),e.La.containsKey(s.key)||pd(e,s.key)):Ur()}function gd(e,t){const n=t.key,s=n.path.canonicalString();e.Oa.get(n)||e.xa.has(s)||(Rr("SyncEngine","New document in limbo: "+n),e.xa.add(s),vd(e))}function vd(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new ui(oi.fromString(t)),s=e.qa.next();e.Na.set(s,new Ju(n)),e.Oa=e.Oa.insert(n,s),iu(e.remoteStore,new nc(Ka(Ha(n.path)),s,"TargetPurposeLimboResolution",ki.oe))}}async function yd(e,t,n){const s=Br(e),r=[],i=[],a=[];s.Fa.isEmpty()||(s.Fa.forEach((e,o)=>{a.push(s.Ka(o,t,n).then(e=>{var t;if((e||n)&&s.isPrimaryClient){const r=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;s.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(e){r.push(e);const t=Cc.Wi(o.targetId,e);i.push(t)}}))}),await Promise.all(a),s.Ca.d_(r),await async function(e,t){const n=Br(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>xi.forEach(t,t=>xi.forEach(t.$i,s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s)).next(()=>xi.forEach(t.Ui,s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))}catch(e){if(!wi(e))throw e;Rr("LocalStore","Failed to update sequence numbers: "+e)}for(const s of t){const e=s.targetId;if(!s.fromCache){const t=n.os.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.os=n.os.insert(e,r)}}}(s.localStore,i))}async function xd(e,t){const n=Br(e);if(!n.currentUser.isEqual(t)){Rr("SyncEngine","User change. New user:",t.toKey());const e=await Ec(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach(e=>{e.forEach(e=>{e.reject(new qr(zr.CANCELLED,t))})}),e.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await yd(n,e.hs)}}function bd(e,t){const n=Br(e),s=n.Na.get(t);if(s&&s.va)return xo().add(s.key);{let e=xo();const s=n.Ma.get(t);if(!s)return e;for(const t of s){const s=n.Fa.get(t);e=e.unionWith(s.view.Va)}return e}}function wd(e){const t=Br(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ad.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=bd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ld.bind(null,t),t.Ca.d_=Bu.bind(null,t.eventManager),t.Ca.$a=zu.bind(null,t.eventManager),t}function kd(e){const t=Br(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=cd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ud.bind(null,t),t}class Nd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Ic(this.persistence,new _c,e.initialUser,this.serializer)}Ga(e){return new kc(jc.Zr,this.serializer)}Wa(e){return new Fc}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nd.provider={build:()=>new Nd};class jd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>od(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=xd.bind(null,this.syncEngine),await Iu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new $u}createDatastore(e){const t=Yc(e.databaseInfo.databaseId),n=function(e){return new Gc(e)}(e.databaseInfo);return function(e,t,n,s){return new eu(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,s,r){return new nu(e,t,n,s,r)}(this.localStore,this.datastore,e.asyncQueue,e=>od(this.syncEngine,e,0),Vc.D()?new Vc:new Uc)}createSyncEngine(e,t){return function(e,t,n,s,r,i,a){const o=new Zu(e,t,n,s,r,i);return a&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Br(e);Rr("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await ru(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}jd.provider={build:()=>new jd};class Cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Lr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Sd{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new qr(zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=Br(e),s={documents:t.map(e=>Rl(n.serializer,e))},r=await n.Lo("BatchGetDocuments",n.serializer.databaseId,oi.emptyPath(),s,t.length),i=new Map;r.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){Vr(!!t.found),t.found.name,t.found.updateTime;const n=Ll(e,t.found.name),s=Pl(t.found.updateTime),r=t.found.createTime?Pl(t.found.createTime):ii.min(),i=new pa({mapValue:{fields:t.found.fields}});return ga.newFoundDocument(n,s,r,i)}(e,t):"missing"in t?function(e,t){Vr(!!t.missing),Vr(!!t.readTime);const n=Ll(e,t.missing),s=Pl(t.readTime);return ga.newNoDocument(n,s)}(e,t):Ur()}(n.serializer,e);i.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=i.get(e.toString());Vr(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Jo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=ui.fromPath(t);this.mutations.push(new Zo(n,this.precondition(n)))}),await async function(e,t){const n=Br(e),s={writes:t.map(e=>zl(n.serializer,e))};await n.Mo("Commit",n.serializer.databaseId,oi.emptyPath(),s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ur();t=ii.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new qr(zr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ii.min())?Fo.exists(!1):Fo.updateTime(t):Fo.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ii.min()))throw new qr(zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Fo.updateTime(t)}return Fo.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class _d{constructor(e,t,n,s,r){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=s,this.deferred=r,this._u=n.maxAttempts,this.t_=new Kc(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new Sd(this.datastore),t=this.cu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.lu(e)}))}).catch(e=>{this.lu(e)})})}cu(e){try{const t=this.updateFunction(e);return!Ni(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!al(t)}return!1}}class Td{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Pr.UNAUTHENTICATED,this.clientId=ti.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{Rr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Rr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Mu(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Id(e,t){e.asyncQueue.verifyOperationInProgress(),Rr("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await Ec(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Ed(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Ad(e);Rr("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Tu(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Tu(t.remoteStore,n)),e._onlineComponents=t}async function Ad(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Rr("FirestoreClient","Using user provided OfflineComponentProvider");try{await Id(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===zr.FAILED_PRECONDITION||e.code===zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;$r("Error using user provided cache. Falling back to memory cache: "+n),await Id(e,new Nd)}}else Rr("FirestoreClient","Using default OfflineComponentProvider"),await Id(e,new Nd);return e._offlineComponents}async function Pd(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Rr("FirestoreClient","Using user provided OnlineComponentProvider"),await Ed(e,e._uninitializedComponentsProvider._online)):(Rr("FirestoreClient","Using default OnlineComponentProvider"),await Ed(e,new jd))),e._onlineComponents}function Md(e){return Pd(e).then(e=>e.syncEngine)}function Dd(e){return Pd(e).then(e=>e.datastore)}async function Od(e){const t=await Pd(e),n=t.eventManager;return n.onListen=ed.bind(null,t.syncEngine),n.onUnlisten=rd.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=td.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=id.bind(null,t.syncEngine),n}function Rd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new Wr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,r){const i=new Cd({next:o=>{i.Za(),t.enqueueAndForget(()=>Vu(e,a));const l=o.docs.has(n);!l&&o.fromCache?r.reject(new qr(zr.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&s&&"server"===s.source?r.reject(new qr(zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(o)},error:e=>r.reject(e)}),a=new Gu(Ha(n.path),i,{includeMetadataChanges:!0,_a:!0});return Uu(e,a)}(await Od(e),e.asyncQueue,t,n,s)),s.promise}function Ld(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new Wr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,r){const i=new Cd({next:n=>{i.Za(),t.enqueueAndForget(()=>Vu(e,a)),n.fromCache&&"server"===s.source?r.reject(new qr(zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),a=new Gu(n,i,{includeMetadataChanges:!0,_a:!0});return Uu(e,a)}(await Od(e),e.asyncQueue,t,n,s)),s.promise}function $d(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Fd=new Map;function Ud(e,t,n){if(!n)throw new qr(zr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Vd(e){if(!ui.isDocumentKey(e))throw new qr(zr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Bd(e){if(ui.isDocumentKey(e))throw new qr(zr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function zd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ur()}function qd(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new qr(zr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=zd(e);throw new qr(zr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Wd(e,t){if(t<=0)throw new qr(zr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Hd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new qr(zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new qr(zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new qr(zr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$d(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new qr(zr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new qr(zr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new qr(zr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gd{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hd({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new qr(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new qr(zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Gr;switch(e.type){case"firstParty":return new Xr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new qr(zr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Fd.get(e);t&&(Rr("ComponentProvider","Removing Datastore"),Fd.delete(e),t.terminate())}(this),Promise.resolve()}}function Qd(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var r;const i=(e=qd(e,Gd))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&$r("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=Pr.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(i)),""].join(".")}(s.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new qr(zr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Pr(i)}e._authCredentials=new Qr(new Hr(t,n))}}class Yd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Yd(this.firestore,e,this._query)}}class Kd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Kd(this.firestore,e,this._key)}}class Xd extends Yd{constructor(e,t,n){super(e,t,Ha(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Kd(this.firestore,null,new ui(e))}withConverter(e){return new Xd(this.firestore,e,this._path)}}function Jd(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];if(e=T(e),Ud("collection","path",t),e instanceof Gd){const n=oi.fromString(t,...s);return Bd(n),new Xd(e,null,n)}{if(!(e instanceof Kd||e instanceof Xd))throw new qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(oi.fromString(t,...s));return Bd(n),new Xd(e.firestore,null,n)}}function Zd(e,t){if(e=qd(e,Gd),Ud("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new qr(zr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Yd(e,null,function(e){return new qa(oi.emptyPath(),e)}(t))}function eh(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];if(e=T(e),1===arguments.length&&(t=ti.newId()),Ud("doc","path",t),e instanceof Gd){const n=oi.fromString(t,...s);return Vd(n),new Kd(e,null,new ui(n))}{if(!(e instanceof Kd||e instanceof Xd))throw new qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(oi.fromString(t,...s));return Vd(n),new Kd(e.firestore,e instanceof Xd?e.converter:null,new ui(n))}}class th{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Kc(this,"async_queue_retry"),this.Vu=()=>{const e=Qc();e&&Rr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=Qc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Qc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Wr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!wi(e))throw e;Rr("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Lr("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Pu.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(s),s}fu(){this.Eu&&Ur()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function nh(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const s of t)if(s in n&&"function"==typeof n[s])return!0;return!1}(e,["next","error","complete"])}class sh extends Gd{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new th,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new th(e),this._firestoreClient=void 0,await e}}}function rh(e){if(e._terminated)throw new qr(zr.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||ih(e),e._firestoreClient}function ih(e){var t,n,s;const r=e._freezeSettings(),i=function(e,t,n,s){return new Qi(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,$d(s.experimentalLongPollingOptions),s.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._componentsProvider||(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=r.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new Td(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class ah{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ah(Ui.fromBase64String(e))}catch(e){throw new qr(zr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ah(Ui.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class oh{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let s=0;s<t.length;++s)if(0===t[s].length)throw new qr(zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ci(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lh{constructor(e){this._methodName=e}}class ch{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new qr(zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new qr(zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ni(this._lat,e._lat)||ni(this._long,e._long)}}class uh{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const dh=/^__.*__$/;class hh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Qo(e,this.data,this.fieldMask,t,this.fieldTransforms):new Go(e,this.data,t,this.fieldTransforms)}}class mh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Qo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ph(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ur()}}class fh{constructor(e,t,n,s,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new fh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Dh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(ph(this.Cu)&&dh.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class gh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Yc(e)}Qu(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new fh({Cu:e,methodName:t,qu:n,path:ci.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vh(e){const t=e._freezeSettings(),n=Yc(e._databaseId);return new gh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function yh(e,t,n,s,r){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Qu(i.merge||i.mergeFields?2:0,t,n,r);Eh("Data must be an object, but it was:",a,s);const o=Th(s,a);let l,c;if(i.merge)l=new $i(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const s of i.mergeFields){const r=Ah(t,s,n);if(!a.contains(r))throw new qr(zr.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Oh(e,r)||e.push(r)}l=new $i(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new hh(new pa(o),l,c)}class xh extends lh{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xh}}function bh(e,t,n){return new fh({Cu:3,qu:t.settings.qu,methodName:e._methodName,xu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class wh extends lh{_toFieldTransform(e){return new Lo(e.path,new Io)}isEqual(e){return e instanceof wh}}class kh extends lh{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=bh(this,e,!0),n=this.Ku.map(e=>_h(e,t)),s=new Eo(n);return new Lo(e.path,s)}isEqual(e){return e instanceof kh&&w(this.Ku,e.Ku)}}class Nh extends lh{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=bh(this,e,!0),n=this.Ku.map(e=>_h(e,t)),s=new Po(n);return new Lo(e.path,s)}isEqual(e){return e instanceof Nh&&w(this.Ku,e.Ku)}}function jh(e,t,n,s){const r=e.Qu(1,t,n);Eh("Data must be an object, but it was:",r,s);const i=[],a=pa.empty();Ai(s,(e,s)=>{const o=Mh(t,e,n);s=T(s);const l=r.Nu(o);if(s instanceof xh)i.push(o);else{const e=_h(s,l);null!=e&&(i.push(o),a.set(o,e))}});const o=new $i(i);return new mh(a,o,r.fieldTransforms)}function Ch(e,t,n,s,r,i){const a=e.Qu(1,t,n),o=[Ah(t,s,n)],l=[r];if(i.length%2!=0)throw new qr(zr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<i.length;h+=2)o.push(Ah(t,i[h])),l.push(i[h+1]);const c=[],u=pa.empty();for(let h=o.length-1;h>=0;--h)if(!Oh(c,o[h])){const e=o[h];let t=l[h];t=T(t);const n=a.Nu(e);if(t instanceof xh)c.push(e);else{const s=_h(t,n);null!=s&&(c.push(e),u.set(e,s))}}const d=new $i(c);return new mh(u,d,a.fieldTransforms)}function Sh(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return _h(n,e.Qu(s?4:3,t))}function _h(e,t){if(Ih(e=T(e)))return Eh("Unsupported field value:",t,e),Th(e,t);if(e instanceof lh)return function(e,t){if(!ph(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const r of e){let e=_h(r,t.Lu(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=T(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return jo(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ri.fromDate(e);return{timestampValue:Il(t.serializer,n)}}if(e instanceof ri){const n=new ri(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Il(t.serializer,n)}}if(e instanceof ch)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ah)return{bytesValue:El(t.serializer,e._byteString)};if(e instanceof Kd){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Bu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ml(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uh)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return ko(t.serializer,e)})}}}}}}(e,t);throw t.Bu(`Unsupported field value: ${zd(e)}`)}(e,t)}function Th(e,t){const n={};return Pi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ai(e,(e,s)=>{const r=_h(s,t.Mu(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function Ih(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ri||e instanceof ch||e instanceof ah||e instanceof Kd||e instanceof lh||e instanceof uh)}function Eh(e,t,n){if(!Ih(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=zd(n);throw"an object"===s?t.Bu(e+" a custom object"):t.Bu(e+" "+s)}}function Ah(e,t,n){if((t=T(t))instanceof oh)return t._internalPath;if("string"==typeof t)return Mh(e,t);throw Dh("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ph=new RegExp("[~\\*/\\[\\]]");function Mh(e,t,n){if(t.search(Ph)>=0)throw Dh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new oh(...t.split("."))._internalPath}catch(s){throw Dh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Dh(e,t,n,s,r){const i=s&&!s.isEmpty(),a=void 0!==r;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${s}`),a&&(l+=` in document ${r}`),l+=")"),new qr(zr.INVALID_ARGUMENT,o+e+l)}function Oh(e,t){return e.some(e=>e.isEqual(t))}class Rh{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Kd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Lh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($h("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Lh extends Rh{data(){return super.data()}}function $h(e,t){return"string"==typeof t?Mh(e,t):t instanceof oh?t._internalPath:t._delegate._internalPath}function Fh(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new qr(zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uh{}class Vh extends Uh{}function Bh(e,t){let n=[];for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];t instanceof Uh&&n.push(t),n=n.concat(r),function(e){const t=e.filter(e=>e instanceof Wh).length,n=e.filter(e=>e instanceof zh).length;if(t>1||t>0&&n>0)throw new qr(zr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class zh extends Vh{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new zh(e,t,n)}_apply(e){const t=this._parse(e);return Jh(e._query,t),new Yd(e.firestore,e.converter,Ja(e._query,t))}_parse(e){const t=vh(e.firestore),n=function(e,t,n,s,r,i,a){let o;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new qr(zr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Xh(a,i);const t=[];for(const n of a)t.push(Kh(s,e,n));o={arrayValue:{values:t}}}else o=Kh(s,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Xh(a,i),o=Sh(n,t,a,"in"===i||"not-in"===i);return Na.create(r,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function qh(e,t,n){const s=t,r=$h("where",e);return zh._create(r,s,n)}class Wh extends Uh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wh(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ja.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const r of s)Jh(n,r),n=Ja(n,r)}(e._query,t),new Yd(e.firestore,e.converter,Ja(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Hh extends Vh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Hh(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ba(t,n)}(e._query,this._field,this._direction);return new Yd(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new qa(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Gh(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=$h("orderBy",e);return Hh._create(n,t)}class Qh extends Vh{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Qh(e,t,n)}_apply(e){return new Yd(e.firestore,e.converter,Za(e._query,this._limit,this._limitType))}}function Yh(e){return Wd("limit",e),Qh._create("limit",e,"F")}function Kh(e,t,n){if("string"==typeof(n=T(n))){if(""===n)throw new qr(zr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qa(t)&&-1!==n.indexOf("/"))throw new qr(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(oi.fromString(n));if(!ui.isDocumentKey(s))throw new qr(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ia(e,new ui(s))}if(n instanceof Kd)return ia(e,n._key);throw new qr(zr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${zd(n)}.`)}function Xh(e,t){if(!Array.isArray(e)||0===e.length)throw new qr(zr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Jh(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new qr(zr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new qr(zr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Zh{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Xi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return zi(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ur()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Ai(e,(e,s)=>{n[e]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,s;const r=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map(e=>zi(e.doubleValue));return new uh(r)}convertGeoPoint(e){return new ch(zi(e.latitude),zi(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Hi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Gi(e));default:return null}}convertTimestamp(e){const t=Bi(e);return new ri(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=oi.fromString(e);Vr(tc(n));const s=new Yi(n.get(1),n.get(3)),r=new ui(n.popFirst(5));return s.isEqual(t)||Lr(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function em(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class tm extends Zh{constructor(e){super(),this.firestore=e}convertBytes(e){return new ah(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Kd(this.firestore,null,t)}}class nm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sm extends Rh{constructor(e,t,n,s,r,i){super(e,t,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new rm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field($h("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class rm extends sm{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class im{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new nm(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new rm(this._firestore,this._userDataWriter,n.key,n,new nm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new qr(zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const s=new rm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new nm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const s=new rm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new nm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:am(t.type),doc:s,oldIndex:r,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function am(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ur()}}function om(e){e=qd(e,Kd);const t=qd(e.firestore,sh);return Rd(rh(t),e._key).then(n=>gm(t,e,n))}class lm extends Zh{constructor(e){super(),this.firestore=e}convertBytes(e){return new ah(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Kd(this.firestore,null,t)}}function cm(e){e=qd(e,Yd);const t=qd(e.firestore,sh),n=rh(t),s=new lm(t);return Fh(e._query),Ld(n,e._query).then(n=>new im(t,s,e,n))}function um(e,t,n){e=qd(e,Kd);const s=qd(e.firestore,sh),r=em(e.converter,t,n);return fm(s,[yh(vh(s),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Fo.none())])}function dm(e,t,n){e=qd(e,Kd);const s=qd(e.firestore,sh),r=vh(s);let i;for(var a=arguments.length,o=new Array(a>3?a-3:0),l=3;l<a;l++)o[l-3]=arguments[l];return i="string"==typeof(t=T(t))||t instanceof oh?Ch(r,"updateDoc",e._key,t,n,o):jh(r,"updateDoc",e._key,t),fm(s,[i.toMutation(e._key,Fo.exists(!0))])}function hm(e){return fm(qd(e.firestore,sh),[new Jo(e._key,Fo.none())])}function mm(e,t){const n=qd(e.firestore,sh),s=eh(e),r=em(e.converter,t);return fm(n,[yh(vh(e.firestore),"addDoc",s._key,r,null!==e.converter,{}).toMutation(s._key,Fo.exists(!1))]).then(()=>s)}function pm(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];var r,i,a;e=T(e);let o={includeMetadataChanges:!1,source:"default"},l=0;"object"!=typeof n[l]||nh(n[l])||(o=n[l],l++);const c={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(nh(n[l])){const e=n[l];n[l]=null===(r=e.next)||void 0===r?void 0:r.bind(e),n[l+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),n[l+2]=null===(a=e.complete)||void 0===a?void 0:a.bind(e)}let u,d,h;if(e instanceof Kd)d=qd(e.firestore,sh),h=Ha(e._key.path),u={next:t=>{n[l]&&n[l](gm(d,e,t))},error:n[l+1],complete:n[l+2]};else{const t=qd(e,Yd);d=qd(t.firestore,sh),h=t._query;const s=new lm(d);u={next:e=>{n[l]&&n[l](new im(d,s,t,e))},error:n[l+1],complete:n[l+2]},Fh(e._query)}return function(e,t,n,s){const r=new Cd(s),i=new Gu(t,r,n);return e.asyncQueue.enqueueAndForget(async()=>Uu(await Od(e),i)),()=>{r.Za(),e.asyncQueue.enqueueAndForget(async()=>Vu(await Od(e),i))}}(rh(d),h,c,u)}function fm(e,t){return function(e,t){const n=new Wr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const s=kd(e);try{const e=await function(e,t){const n=Br(e),s=ri.now(),r=t.reduce((e,t)=>e.add(t.key),xo());let i,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=co(),l=xo();return n.cs.getEntries(e,r).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(r=>{i=r;const a=[];for(const e of t){const t=Wo(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new Qo(e.key,t,fa(t.value.mapValue),Fo.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{a=t;const s=t.applyToLocalDocumentSet(i,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:a.batchId,changes:mo(i)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Ba[e.currentUser.toKey()];s||(s=new Mi(ni)),s=s.insert(t,n),e.Ba[e.currentUser.toKey()]=s}(s,e.batchId,n),await yd(s,e.changes),await xu(s.remoteStore)}catch(e){const t=Mu(e,"Failed to persist write");n.reject(t)}}(await Md(e),t,n)),n.promise}(rh(e),t)}function gm(e,t,n){const s=n.docs.get(t._key),r=new lm(e);return new sm(e,r,t._key,s,new nm(n.hasPendingWrites,n.fromCache),t.converter)}const vm={maxAttempts:5};class ym{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=vh(e)}set(e,t,n){this._verifyNotCommitted();const s=xm(e,this._firestore),r=em(s.converter,t,n),i=yh(this._dataReader,"WriteBatch.set",s._key,r,null!==s.converter,n);return this._mutations.push(i.toMutation(s._key,Fo.none())),this}update(e,t,n){this._verifyNotCommitted();const s=xm(e,this._firestore);let r;for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return r="string"==typeof(t=T(t))||t instanceof oh?Ch(this._dataReader,"WriteBatch.update",s._key,t,n,a):jh(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(r.toMutation(s._key,Fo.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=xm(e,this._firestore);return this._mutations=this._mutations.concat(new Jo(t._key,Fo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new qr(zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function xm(e,t){if((e=T(e)).firestore!==t)throw new qr(zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class bm extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=vh(e)}get(e){const t=xm(e,this._firestore),n=new tm(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return Ur();const s=e[0];if(s.isFoundDocument())return new Rh(this._firestore,n,s.key,s,t.converter);if(s.isNoDocument())return new Rh(this._firestore,n,t._key,null,t.converter);throw Ur()})}set(e,t,n){const s=xm(e,this._firestore),r=em(s.converter,t,n),i=yh(this._dataReader,"Transaction.set",s._key,r,null!==s.converter,n);return this._transaction.set(s._key,i),this}update(e,t,n){const s=xm(e,this._firestore);let r;for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return r="string"==typeof(t=T(t))||t instanceof oh?Ch(this._dataReader,"Transaction.update",s._key,t,n,a):jh(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,r),this}delete(e){const t=xm(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=xm(e,this._firestore),n=new lm(this._firestore);return super.get(e).then(e=>new sm(this._firestore,n,t._key,e._document,new nm(!1,!1),t.converter))}}function wm(e,t,n){e=qd(e,sh);const s=Object.assign(Object.assign({},vm),n);return function(e){if(e.maxAttempts<1)throw new qr(zr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(e,t,n){const s=new Wr;return e.asyncQueue.enqueueAndForget(async()=>{const r=await Dd(e);new _d(e.asyncQueue,r,n,t,s).au()}),s.promise}(rh(e),n=>t(new bm(e,n)),s)}function km(){return new wh("serverTimestamp")}function Nm(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new kh("arrayUnion",t)}function jm(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Nh("arrayRemove",t)}function Cm(e){return rh(e=qd(e,sh)),new ym(e,t=>fm(e,t))}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Mr=e}(ze),$e(new I("firestore",(e,n)=>{let{instanceIdentifier:s,options:r}=n;const i=e.getProvider("app").getImmediate(),a=new sh(new Yr(e.getProvider("auth-internal")),new Zr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new qr(zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yi(e.options.projectId,t)}(i,s),i);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),He(Ar,"4.7.3",e),He(Ar,"4.7.3","esm2017")}();He("firebase","10.14.1","app");const Sm="functions";class _m{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Tm="us-central1";class Im{constructor(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Tm,i=arguments.length>5?arguments[5]:void 0;this.app=e,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new _m(t,n,s),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(r);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=Tm}catch(a){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){return`${this.emulatorOrigin}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const Em="@firebase/functions",Am="0.11.8";function Pm(e,t,n){!function(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}(T(e),t,n)}!function(e,t){$e(new I(Sm,(t,n)=>{let{instanceIdentifier:s}=n;const r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),a=t.getProvider("messaging-internal"),o=t.getProvider("app-check-internal");return new Im(r,i,a,o,s,e)},"PUBLIC").setMultipleInstances(!0)),He(Em,Am,t),He(Em,Am,"esm2017")}(fetch.bind(self));const Mm=qe({apiKey:"AIzaSyDRxwgTDH0yHyRFQovzJOMtmr4vXvh5X30",authDomain:"grepollike.firebaseapp.com",projectId:"grepollike",storageBucket:"grepollike.appspot.com",messagingSenderId:"309664339373",appId:"1:309664339373:web:cc902bc404cb7cfae3bd24",measurementId:"G-RLTQQ51W02"}),Dm=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We();const t=Fe(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Fe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(w(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;ct(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ur,persistence:[ks,is,os]}),s=m("authTokenSyncURL");if(s&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>pr)return;const s=null===t||void 0===t?void 0:t.token;fr!==s&&(fr=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});!function(e,t,n){T(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,s){T(e).onIdTokenChanged(t,n,s)}(n,e=>t(e))}}var r;const i=u("auth");return i&&Sn(n,`http://${i}`),n}(Mm),Om=function(e,t){const n="string"==typeof e?e:t||"(default)",s=Fe("object"==typeof e?e:We(),"firestore").getImmediate({identifier:n});if(!s._initialized){const e=d("firestore");e&&Qd(s,...e)}return s}(Mm),Rm=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tm;const n=Fe(T(e),Sm).getImmediate({identifier:t}),s=d("functions");return s&&Pm(n,...s),n}(Mm);"undefined"!==typeof window&&("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||"::1"===window.location.hostname)&&(Sn(Dm,"http://127.0.0.1:9099"),Qd(Om,"127.0.0.1",8090),Pm(Rm,"127.0.0.1",5001));var Lm=n(579);const $m=(0,e.createContext)(),Fm=()=>(0,e.useContext)($m),Um=t=>{let{children:n}=t;const[s,r]=(0,e.useState)(null),[i,a]=(0,e.useState)(null),[o,l]=(0,e.useState)(!0);(0,e.useEffect)(()=>{let e=()=>{};const t=function(e,t,n,s){return T(e).onAuthStateChanged(t,n,s)}(Dm,t=>{if(r(t),e(),t){const n=eh(Om,"users",t.uid);dm(n,{lastLogin:km()}).catch(e=>{"not-found"!==e.code&&console.error("Failed to update last login time:",e)}),l(!0),e=pm(n,e=>{e.exists()?a(e.data()):a(null),l(!1)},e=>{console.error("Error fetching user profile:",e),a(null),l(!1)})}else a(null),l(!1)});return()=>{t(),e()}},[]);const c={currentUser:s,userProfile:i,loading:o,updateUserProfile:async e=>{if(s){const t=eh(Om,"users",s.uid);await dm(t,e)}}};return(0,Lm.jsx)($m.Provider,{value:c,children:!o&&n})},Vm=(0,e.createContext)(),Bm=Vm,zm=JSON.parse('{"senate":{"name":"Senate","description":"Manage your city and view building levels.","baseCost":{"wood":200,"stone":250,"silver":150,"population":10,"time":120},"image":"senate.png","maxLevel":10,"points":20},"timber_camp":{"name":"Timber Camp","description":"Generates wood for your empire.","baseCost":{"wood":60,"stone":80,"silver":20,"population":5,"time":60},"image":"lumber_mill.png","maxLevel":25,"points":5,"requirements":{"senate":1}},"quarry":{"name":"Quarry","description":"Mines stone for construction.","baseCost":{"wood":80,"stone":60,"silver":20,"population":5,"time":60},"image":"stone_quarry.png","maxLevel":25,"points":5,"requirements":{"senate":1}},"silver_mine":{"name":"Silver Mine","description":"Mints silver coins.","baseCost":{"wood":100,"stone":100,"silver":50,"population":8,"time":90},"image":"silver_mines.png","maxLevel":25,"points":5,"requirements":{"senate":1}},"farm":{"name":"Farm","description":"Increases your city\'s population capacity.","baseCost":{"wood":100,"stone":50,"silver":30,"population":0,"time":70},"image":"farm.png","maxLevel":30,"points":4,"requirements":{"senate":1}},"warehouse":{"name":"Warehouse","description":"Stores your precious resources.","baseCost":{"wood":150,"stone":200,"silver":0,"population":0,"time":80},"image":"warehouse.png","maxLevel":20,"points":8,"requirements":{"senate":1}},"barracks":{"name":"Barracks","description":"Train land units to attack and defend.","baseCost":{"wood":120,"stone":100,"silver":80,"population":10,"time":150},"image":"barracks.png","maxLevel":15,"points":12,"requirements":{"senate":3}},"shipyard":{"name":"Shipyard","description":"Build ships for naval warfare.","baseCost":{"wood":150,"stone":100,"silver":100,"population":10,"time":180},"image":"shipyard.png","maxLevel":15,"points":12,"requirements":{"senate":4,"timber_camp":5}},"academy":{"name":"Academy","description":"Research new technologies and units.","baseCost":{"wood":220,"stone":220,"silver":180,"population":15,"time":240},"image":"academy.png","maxLevel":10,"points":15,"requirements":{"senate":5,"warehouse":2}},"city_wall":{"name":"City Wall","description":"Increases the defense of your city.","baseCost":{"wood":50,"stone":250,"silver":100,"population":5,"time":100},"image":"city_wall.png","maxLevel":20,"points":10,"requirements":{"senate":2}},"cave":{"name":"Cave","description":"Train spies and store silver safely from raids.","baseCost":{"wood":100,"stone":100,"silver":20,"population":5,"time":120},"image":"cave.png","maxLevel":10,"points":8,"requirements":{"senate":3}},"market":{"name":"Market","description":"Trade resources with other players.","baseCost":{"wood":180,"stone":180,"silver":180,"population":10,"time":200},"image":"market.png","maxLevel":10,"points":8,"requirements":{"warehouse":3}},"temple":{"name":"Temple","description":"Worship the gods to gain their favor.","baseCost":{"wood":250,"stone":250,"silver":250,"population":10,"time":300},"image":"temple.png","maxLevel":10,"points":15,"requirements":{"academy":2}},"divine_temple":{"name":"Divine Temple","description":"A sacred place to train mythical units blessed by your worshipped god.","baseCost":{"wood":500,"stone":500,"silver":500,"population":20,"time":1800},"image":"divine_temple.png","maxLevel":5,"points":25,"requirements":{"temple":5}},"hospital":{"name":"Hospital","description":"Heal your wounded troops after battle.","baseCost":{"wood":200,"stone":150,"silver":100,"population":8,"time":180},"image":"hospital.png","maxLevel":10,"points":10,"requirements":{"barracks":3}},"special_building_plot":{"name":"Wonders","description":"Construct a legendary building that provides a unique, city-wide bonus.","image":"special_building_plot.png","constructible":false,"points":500},"heroes_altar":{"name":"Heroes\' Altar","description":"Recruit legendary heroes and activate their powerful skills.","baseCost":{"wood":1000,"stone":1000,"silver":1000,"population":10,"time":3600},"image":"heroes_altar.png","maxLevel":1,"points":100,"requirements":{"senate":8,"temple":3}},"prison":{"name":"Prison","description":"Holds captured enemy heroes. Heroes escape if the city is successfully conquered. Higher levels allow holding more heroes.","baseCost":{"wood":800,"stone":1200,"silver":1000,"population":15,"time":2500},"image":"prison.png","maxLevel":25,"points":30,"requirements":{"city_wall":5}}}'),qm=JSON.parse('{"swordsman":{"name":"Swordsman","description":"A basic melee unit, effective in close combat.","cost":{"wood":50,"stone":30,"silver":20,"population":1,"time":30},"heal_cost":{"wood":15,"stone":10,"silver":6},"heal_time":10,"attack":10,"defense":15,"speed":5,"type":"land","counters":["archer"],"image":"swordman.png"},"archer":{"name":"Archer","description":"A ranged unit that can attack from a distance.","cost":{"wood":30,"stone":40,"silver":35,"population":1,"time":45},"heal_cost":{"wood":9,"stone":12,"silver":10},"heal_time":15,"attack":12,"defense":8,"speed":6,"type":"land","counters":["swordsman"],"image":"archers.png"},"hoplite":{"name":"Hoplite","description":"Heavily armored infantry, strong defensive unit.","cost":{"wood":70,"stone":60,"silver":40,"population":2,"time":60},"heal_cost":{"wood":21,"stone":18,"silver":12},"heal_time":20,"attack":15,"defense":25,"speed":4,"type":"land","counters":["cavalry"],"image":"hospite.png"},"cavalry":{"name":"Cavalry","description":"Fast and powerful mounted units, good for flanking.","cost":{"wood":80,"stone":50,"silver":70,"population":3,"time":90},"heal_cost":{"wood":24,"stone":15,"silver":21},"heal_time":30,"attack":20,"defense":18,"speed":10,"type":"land","counters":["archer","slinger"],"image":"cavalry.png"},"swordsman_athenian":{"name":"Athenian Swordsman","description":"A versatile melee unit from Athens, balanced in attack and defense.","cost":{"wood":50,"stone":30,"silver":20,"population":1,"time":30},"heal_cost":{"wood":15,"stone":10,"silver":6},"heal_time":10,"attack":10,"defense":15,"speed":5,"type":"land","nation":"Athenian","image":"athenian_swordsman.png"},"archer_athenian":{"name":"Athenian Archer","description":"A skilled archer from Athens, known for precision.","cost":{"wood":30,"stone":40,"silver":35,"population":1,"time":45},"heal_cost":{"wood":9,"stone":12,"silver":10},"heal_time":15,"attack":12,"defense":8,"speed":6,"type":"land","nation":"Athenian","image":"athenian_archer.png"},"hoplite_athenian":{"name":"Athenian Hoplite","description":"The backbone of the Athenian army, well-armored and reliable.","cost":{"wood":70,"stone":60,"silver":40,"population":2,"time":60},"heal_cost":{"wood":21,"stone":18,"silver":12},"heal_time":20,"attack":15,"defense":25,"speed":4,"type":"land","nation":"Athenian","image":"athenian_hoplite.png"},"cavalry_athenian":{"name":"Athenian Cavalry","description":"Noble horsemen of Athens, effective for flanking maneuvers.","cost":{"wood":80,"stone":50,"silver":70,"population":3,"time":90},"heal_cost":{"wood":24,"stone":15,"silver":21},"heal_time":30,"attack":20,"defense":18,"speed":10,"type":"land","nation":"Athenian","image":"athenian_cavalry.png"},"trireme_athenian":{"name":"Athenian Trireme","description":"A powerful and versatile warship from the Athenian navy.","cost":{"wood":300,"stone":150,"silver":200,"population":8,"time":300},"attack":25,"defense":30,"speed":8,"type":"naval","nation":"Athenian","image":"athenian_trireme.png"},"swordsman_spartan":{"name":"Spartan Hoplite","description":"A disciplined and heavily armored warrior from Sparta, excelling in defense.","cost":{"wood":60,"stone":40,"silver":25,"population":1,"time":35},"heal_cost":{"wood":18,"stone":12,"silver":7},"heal_time":12,"attack":8,"defense":20,"speed":4,"type":"land","nation":"Spartan","image":"spartan_hoplite.png"},"archer_spartan":{"name":"Spartan Helot Archer","description":"A lightly armored but disciplined archer serving the Spartan army.","cost":{"wood":35,"stone":45,"silver":30,"population":1,"time":50},"heal_cost":{"wood":10,"stone":13,"silver":9},"heal_time":17,"attack":10,"defense":10,"speed":5,"type":"land","nation":"Spartan","image":"spartan_archer.png"},"hoplite_spartan":{"name":"Royal Spartan Guard","description":"The elite of the Spartan phalanx, nearly unbreakable in defense.","cost":{"wood":80,"stone":70,"silver":50,"population":2,"time":70},"heal_cost":{"wood":24,"stone":21,"silver":15},"heal_time":23,"attack":16,"defense":30,"speed":3,"type":"land","nation":"Spartan","image":"spartan_hoplite_elite.png"},"cavalry_spartan":{"name":"Spartan Rider","description":"A heavy cavalry unit focused on breaking enemy lines.","cost":{"wood":90,"stone":60,"silver":80,"population":3,"time":100},"heal_cost":{"wood":27,"stone":18,"silver":24},"heal_time":33,"attack":22,"defense":22,"speed":9,"type":"land","nation":"Spartan","image":"spartan_cavalry.png"},"trireme_spartan":{"name":"Spartan Diekplous","description":"A sturdy warship designed for ramming and boarding actions.","cost":{"wood":320,"stone":180,"silver":200,"population":8,"time":320},"attack":28,"defense":35,"speed":7,"type":"naval","nation":"Spartan","image":"spartan_trireme.png"},"swordsman_corinthian":{"name":"Corinthian Marine","description":"A swift and aggressive fighter from Corinth, trained for rapid assaults.","cost":{"wood":45,"stone":25,"silver":30,"population":1,"time":28},"heal_cost":{"wood":13,"stone":7,"silver":9},"heal_time":9,"attack":12,"defense":12,"speed":6,"type":"land","nation":"Corinthian","image":"corinthian_marine.png"},"archer_corinthian":{"name":"Corinthian Skirmisher","description":"A fast-moving archer that excels at harassing enemy forces.","cost":{"wood":28,"stone":38,"silver":40,"population":1,"time":42},"heal_cost":{"wood":8,"stone":11,"silver":12},"heal_time":14,"attack":13,"defense":7,"speed":7,"type":"land","nation":"Corinthian","image":"corinthian_archer.png"},"hoplite_corinthian":{"name":"Corinthian Phalanx","description":"A well-equipped hoplite, more mobile than its counterparts.","cost":{"wood":65,"stone":55,"silver":45,"population":2,"time":55},"heal_cost":{"wood":19,"stone":16,"silver":13},"heal_time":18,"attack":16,"defense":22,"speed":5,"type":"land","nation":"Corinthian","image":"corinthian_hoplite.png"},"cavalry_corinthian":{"name":"Corinthian Hippeus","description":"Light and swift cavalry, perfect for raiding and quick strikes.","cost":{"wood":75,"stone":45,"silver":75,"population":3,"time":85},"heal_cost":{"wood":22,"stone":13,"silver":22},"heal_time":28,"attack":21,"defense":16,"speed":12,"type":"land","nation":"Corinthian","image":"corinthian_cavalry.png"},"trireme_corinthian":{"name":"Corinthian Bireme","description":"A fast and maneuverable warship, ideal for controlling the seas.","cost":{"wood":280,"stone":140,"silver":220,"population":8,"time":280},"attack":26,"defense":28,"speed":10,"type":"naval","nation":"Corinthian","image":"corinthian_trireme.png"},"swordsman_roman":{"name":"Legionary","description":"A disciplined soldier of the Roman legions, balanced and effective.","cost":{"wood":50,"stone":30,"silver":20,"population":1,"time":30},"heal_cost":{"wood":15,"stone":10,"silver":6},"heal_time":10,"attack":10,"defense":15,"speed":5,"type":"land","nation":"Julian","image":"legionary.png"},"archer_roman":{"name":"Roman Archer","description":"A disciplined archer providing ranged support for the legions.","cost":{"wood":30,"stone":40,"silver":35,"population":1,"time":45},"heal_cost":{"wood":9,"stone":12,"silver":10},"heal_time":15,"attack":12,"defense":8,"speed":6,"type":"land","nation":"Julian","image":"roman_archer.png"},"hoplite_roman":{"name":"Praetorian Guard","description":"An elite unit of the Roman Army, formidable in both attack and defense.","cost":{"wood":70,"stone":60,"silver":40,"population":2,"time":60},"heal_cost":{"wood":21,"stone":18,"silver":12},"heal_time":20,"attack":18,"defense":26,"speed":4,"type":"land","nation":"Julian","image":"praetorian_guard.png"},"cavalry_roman":{"name":"Equites","description":"Roman cavalry, effective at charging and disrupting enemy formations.","cost":{"wood":80,"stone":50,"silver":70,"population":3,"time":90},"heal_cost":{"wood":24,"stone":15,"silver":21},"heal_time":30,"attack":20,"defense":18,"speed":10,"type":"land","nation":"Julian","image":"equites.png"},"trireme_roman":{"name":"Roman Quinquereme","description":"A large and powerful Roman warship, built for dominating naval battles.","cost":{"wood":300,"stone":150,"silver":200,"population":8,"time":300},"attack":30,"defense":32,"speed":8,"type":"naval","nation":"Julian","image":"roman_quinquereme.png"},"slinger":{"name":"Slinger","description":"Light ranged unit, good against unarmored foes.","cost":{"wood":25,"stone":20,"silver":15,"population":1,"time":25},"heal_cost":{"wood":8,"stone":6,"silver":5},"heal_time":8,"attack":8,"defense":10,"speed":7,"type":"land","image":"slinger.png"},"transport_ship":{"name":"Transport Ship","description":"Standard transport for land units across seas. Slower but higher capacity.","cost":{"wood":200,"stone":100,"silver":150,"population":5,"time":180},"attack":0,"defense":20,"speed":10,"type":"naval","capacity":16,"image":"transport_ship.png"},"fast_transport_ship":{"name":"Fast Transport Ship","description":"Faster transport for land units, but with less capacity.","cost":{"wood":250,"stone":120,"silver":180,"population":6,"time":240},"attack":0,"defense":15,"speed":15,"type":"naval","capacity":10,"image":"fast_transport_ship.png"},"minotaur":{"name":"Minotaur","description":"A fearsome beast with the body of a man and the head of a bull.","cost":{"wood":300,"stone":250,"silver":400,"population":10,"time":600,"favor":50},"heal_cost":{"wood":90,"stone":75,"silver":120},"heal_time":200,"attack":50,"defense":40,"speed":4,"type":"land","mythical":true,"god":"Zeus","image":"minotaur.png"},"manticore":{"name":"Manticore","description":"A terrifying creature with the body of a lion, a human head, and a tail of venomous spines.","cost":{"wood":450,"stone":150,"silver":350,"population":12,"time":750,"favor":65},"heal_cost":{"wood":135,"stone":45,"silver":105},"heal_time":250,"attack":60,"defense":30,"speed":7,"type":"land","flying":true,"mythical":true,"god":"Zeus","image":"manticore.png"},"harpy":{"name":"Harpy","description":"A winged spirit of sharp claws and sharper temper.","cost":{"wood":150,"stone":300,"silver":200,"population":8,"time":450,"favor":40},"heal_cost":{"wood":45,"stone":90,"silver":60},"heal_time":150,"attack":35,"defense":25,"speed":14,"type":"land","flying":true,"mythical":true,"god":"Hera","image":"harpy.png"},"medusa":{"name":"Medusa","description":"A creature whose gaze can turn warriors to stone.","cost":{"wood":200,"stone":400,"silver":350,"population":12,"time":700,"favor":60},"heal_cost":{"wood":60,"stone":120,"silver":105},"heal_time":230,"attack":40,"defense":60,"speed":3,"type":"land","mythical":true,"god":"Hera","image":"medusa.png"},"centaur":{"name":"Centaur","description":"A skilled archer with the body of a horse, swift and deadly.","cost":{"wood":250,"stone":150,"silver":300,"population":9,"time":500,"favor":45},"heal_cost":{"wood":75,"stone":45,"silver":90},"heal_time":170,"attack":45,"defense":30,"speed":9,"type":"land","mythical":true,"god":"Athena","image":"centaur.png"},"pegasus":{"name":"Pegasus","description":"A divine winged stallion, the fastest scout in the land.","cost":{"wood":100,"stone":100,"silver":500,"population":15,"time":800,"favor":70},"heal_cost":{"wood":30,"stone":30,"silver":150},"heal_time":270,"attack":10,"defense":50,"speed":25,"type":"land","flying":true,"mythical":true,"god":"Athena","image":"pegasus.png"},"sphinx":{"name":"Sphinx","description":"A mythical creature with the head of a human, the body of a lion, and the wings of a falcon.","cost":{"wood":350,"stone":200,"silver":300,"population":11,"time":650,"favor":55},"heal_cost":{"wood":105,"stone":60,"silver":90},"heal_time":220,"attack":55,"defense":45,"speed":16,"type":"land","flying":true,"mythical":true,"god":"Anubis","image":"sphinx.png"},"scarab":{"name":"Scarab","description":"A large, heavily armored beetle that moves slowly but is incredibly resilient.","cost":{"wood":100,"stone":500,"silver":150,"population":7,"time":400,"favor":35},"heal_cost":{"wood":30,"stone":150,"silver":45},"heal_time":130,"attack":20,"defense":70,"speed":2,"type":"land","mythical":true,"god":"Anubis","image":"scarab.png"},"griffin":{"name":"Griffin","description":"A legendary creature with the body, tail, and back legs of a lion; the head and wings of an eagle.","cost":{"wood":400,"stone":200,"silver":250,"population":13,"time":720,"favor":62},"heal_cost":{"wood":120,"stone":60,"silver":75},"heal_time":240,"attack":65,"defense":35,"speed":18,"type":"land","flying":true,"mythical":true,"god":"Horus","image":"griffin.png"},"phoenix":{"name":"Phoenix","description":"A long-lived bird that cyclically regenerates or is otherwise born again.","cost":{"wood":100,"stone":100,"silver":600,"population":18,"time":900,"favor":80},"heal_cost":{"wood":30,"stone":30,"silver":180},"heal_time":300,"attack":30,"defense":60,"speed":22,"type":"land","flying":true,"mythical":true,"god":"Horus","image":"phoenix.png"},"mummy":{"name":"Mummy","description":"An undead creature wrapped in bandages, cursed to serve its master.","cost":{"wood":50,"stone":350,"silver":250,"population":6,"time":350,"favor":30},"heal_cost":{"wood":15,"stone":105,"silver":75},"heal_time":120,"attack":25,"defense":55,"speed":3,"type":"land","mythical":true,"god":"Osiris","image":"mummy.png"},"serpopard":{"name":"Serpopard","description":"A mythical animal with the body of a leopard and the long neck of a serpent.","cost":{"wood":300,"stone":150,"silver":400,"population":10,"time":620,"favor":58},"heal_cost":{"wood":90,"stone":45,"silver":120},"heal_time":210,"attack":58,"defense":42,"speed":8,"type":"land","mythical":true,"god":"Osiris","image":"serpopard.png"}}'),Wm=JSON.parse('{"logistics":{"name":"Logistics","description":"Increases the speed of your land units by 10%.","cost":{"wood":1000,"stone":1200,"silver":800,"time":1800,"points":5},"requirements":{"academy":1},"effect":{"type":"unit_speed_land","value":1.1}},"architecture":{"name":"Architecture","description":"Reduces the construction time of buildings by 10%.","cost":{"wood":1500,"stone":2000,"silver":1000,"time":3600,"points":8},"requirements":{"academy":2},"effect":{"type":"build_time","value":0.9}},"ballistics":{"name":"Ballistics","description":"Increases the attack power of archers and slingers by 10%.","cost":{"wood":2000,"stone":1500,"silver":2500,"time":5400,"points":12},"requirements":{"academy":3,"research":"logistics"},"effect":{"type":"unit_attack_ranged","value":1.1}},"shipwright":{"name":"Shipwright","description":"Increases the speed of your naval units by 10%.","cost":{"wood":2500,"stone":1800,"silver":2200,"time":7200,"points":15},"requirements":{"academy":4},"effect":{"type":"unit_speed_naval","value":1.1}},"phalanx":{"name":"Phalanx","description":"Increases the defensive strength of hoplites by 15%.","cost":{"wood":3000,"stone":4000,"silver":3500,"time":10800,"points":20},"requirements":{"academy":5,"research":"architecture"},"effect":{"type":"unit_defense_hoplite","value":1.15}}}'),Hm=JSON.parse('{"achilles":{"name":"Achilles","description":"A legendary warrior whose skill in battle is unmatched. He inspires troops to fight with greater ferocity.","image":"achilles.png","cost":{"silver":5000,"favor":100},"maxLevel":10,"xpPerLevel":[100,250,500,1000,2000,4000,8000,16000,32000],"levelUpCost":{"silver":1000,"favor":20},"passive":{"name":"Warrior\'s Presence","description":"Increases land unit attack by 5% (+1% per level) in this city.","effect":{"type":"city_buff","subtype":"land_attack","baseValue":0.05,"valuePerLevel":0.01}},"skills":[{"name":"Warcry","type":"battle","description":"Boosts the attack of all land units by 10% (+2% per level) for the next battle.","cost":{"favor":{"base":50,"perLevel":5}},"cooldown":3600,"icon":"warcry.png","effect":{"type":"troop_buff","subtype":"attack","baseValue":0.1,"valuePerLevel":0.02,"unit_type":"land"}},{"name":"Rapid Mobilization","type":"city","description":"Reduces recruitment time in the Barracks by 15% (+1% per level) for 1 hour.","cost":{"favor":{"base":30,"perLevel":3}},"cooldown":7200,"icon":"rapid_mobilization.png","effect":{"type":"city_buff","subtype":"recruitment_speed","baseValue":0.15,"valuePerLevel":0.01,"duration":3600}}]},"odysseus":{"name":"Odysseus","description":"A cunning strategist known for his intellect and trickery. He excels at espionage and naval tactics.","image":"odysseus.png","cost":{"silver":4500,"favor":120},"maxLevel":10,"xpPerLevel":[100,250,500,1000,2000,4000,8000,16000,32000],"levelUpCost":{"silver":900,"favor":25},"passive":{"name":"Cunning Mind","description":"Increases silver production by 10% (+1.5% per level) in this city.","effect":{"type":"city_buff","subtype":"silver_production","baseValue":0.1,"valuePerLevel":0.015}},"skills":[{"name":"Naval Superiority","type":"battle","description":"Boosts the speed of all naval units by 15% (+1% per level) for the next battle.","cost":{"favor":{"base":40,"perLevel":4}},"cooldown":3600,"icon":"naval_superiority.png","effect":{"type":"troop_buff","subtype":"speed","baseValue":0.15,"valuePerLevel":0.01,"unit_type":"naval"}},{"name":"Master Spy","type":"city","description":"Increases the effectiveness of spies by 20% (+2% per level) for 2 hours.","cost":{"favor":{"base":60,"perLevel":6}},"cooldown":7200,"icon":"master_spy.png","effect":{"type":"city_buff","subtype":"spy_effectiveness","baseValue":0.2,"valuePerLevel":0.02,"duration":7200}}]}}');var Gm,Qm=new Uint8Array(16);function Ym(){if(!Gm&&!(Gm="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Gm(Qm)}const Km=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const Xm=function(e){return"string"===typeof e&&Km.test(e)};for(var Jm=[],Zm=0;Zm<256;++Zm)Jm.push((Zm+256).toString(16).substr(1));const ep=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Jm[e[t+0]]+Jm[e[t+1]]+Jm[e[t+2]]+Jm[e[t+3]]+"-"+Jm[e[t+4]]+Jm[e[t+5]]+"-"+Jm[e[t+6]]+Jm[e[t+7]]+"-"+Jm[e[t+8]]+Jm[e[t+9]]+"-"+Jm[e[t+10]]+Jm[e[t+11]]+Jm[e[t+12]]+Jm[e[t+13]]+Jm[e[t+14]]+Jm[e[t+15]]).toLowerCase();if(!Xm(n))throw TypeError("Stringified UUID is invalid");return n};const tp=function(e,t,n){var s=(e=e||{}).random||(e.rng||Ym)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=s[r];return t}return ep(s)},np=(0,e.createContext)(),sp=()=>(0,e.useContext)(np),rp=np,ip=JSON.parse('{"great_forum":{"name":"Great Forum","description":"A magnificent forum that fosters intellectual debate and civic engagement, significantly increasing the research speed of all alliance members.","bonus":{"type":"research_boost","value":0.2},"image":"great_forum.png"},"grand_arsenal":{"name":"Grand Arsenal","description":"An enormous armory that provides the best weapons and armor, boosting the attack and defense of all alliance members\' units.","bonus":{"type":"unit_boost","value":0.15},"image":"grand_arsenal.png"},"the_great_market":{"name":"The Great Market","description":"A bustling hub of commerce that makes trade more efficient, increasing the market capacity and speed for all alliance members.","bonus":{"type":"trade_efficiency","value":0.25},"image":"the_great_market.png"},"shrine_of_the_ancestors":{"name":"Shrine of the Ancestors","description":"A sacred shrine that inspires great loyalty, boosting city happiness and population growth across all alliance members\' cities.","bonus":{"type":"morale_boost","value":0.1},"image":"shrine_of_the_ancestors.png"},"fortress_of_the_gods":{"name":"Fortress of the Gods","description":"An impenetrable citadel that provides powerful defensive bonuses to all cities on the island held by the alliance.","bonus":{"type":"fortification_boost","value":0.2},"image":"fortress_of_the_gods.png"}}'),ap=(e,t)=>{if(!e)return 0;let n=0;if(e.buildings)for(const s in e.buildings){const t=e.buildings[s],r=zm[s];if(r&&r.points){const e=t.level;n+=r.points*(e*(e+1)/2)}}if(e.units)for(const s in e.units){const t=qm[s];t&&(n+=e.units[s]*(t.cost.population||1))}return e.research&&(n+=50*Object.keys(e.research).length),null!==t&&void 0!==t&&t.allianceWonder&&(n+=500),Math.floor(n)},op=e=>{if(!e||e<1)return 0;const t=500+200*(e-1);return Math.min(2500,t)},lp=(t,n,s,r)=>{const{currentUser:i}=Fm(),{activeCityId:a,addNotification:o}=up(),{playerAlliance:l}=sp(),[c,u]=(0,e.useState)(null),d=(0,e.useRef)(c);(0,e.useEffect)(()=>{d.current=c},[c]);const h=(0,e.useCallback)(e=>{if(!e||!e.senate)return{base:0,penalty:0,total:0};const t=10*e.senate.level;let n=0;["timber_camp","quarry","silver_mine"].forEach(t=>{e[t]&&e[t].workers&&(n+=Number(e[t].workers||0))});const s=5*n;return{base:t,penalty:s,total:Math.max(0,Math.min(100,t-s))}},[]),m=(0,e.useCallback)(e=>{var t;if(!e||!e.senate)return 0;let n=h(e).total;return"shrine_of_the_ancestors"===(null===l||void 0===l||null===(t=l.allianceWonder)||void 0===t?void 0:t.id)&&(n+=100*ip.shrine_of_the_ancestors.bonus.value),Math.min(100,n)},[h,l]),p=(0,e.useCallback)(e=>!e||e<1?0:Math.min(6,1+Math.floor(e/5)),[]),f=(0,e.useCallback)(e=>{var t,n,s,r,i,o;if(!e)return{wood:0,stone:0,silver:0};const l=m(e),u=l>70?1.1:l<40?.9:1,d={wood:Math.floor(30*Math.pow(1.2,((null===(t=e.timber_camp)||void 0===t?void 0:t.level)||1)-1)),stone:Math.floor(30*Math.pow(1.2,((null===(n=e.quarry)||void 0===n?void 0:n.level)||1)-1)),silver:Math.floor(15*Math.pow(1.15,((null===(s=e.silver_mine)||void 0===s?void 0:s.level)||1)-1))};if(null!==(r=e.timber_camp)&&void 0!==r&&r.workers){const t=Number(e.timber_camp.workers)||0;d.wood*=1+.1*t}if(null!==(i=e.quarry)&&void 0!==i&&i.workers){const t=Number(e.quarry.workers)||0;d.stone*=1+.1*t}if(null!==(o=e.silver_mine)&&void 0!==o&&o.workers){const t=Number(e.silver_mine.workers)||0;d.silver*=1+.1*t}if(null!==c&&void 0!==c&&c.heroes)for(const h in c.heroes)if(c.heroes[h].cityId===a){const e=Hm[h];"silver_production"===e.passive.effect.subtype&&(d.silver*=1+e.passive.effect.value)}return d.wood=Math.floor(d.wood*u),d.stone=Math.floor(d.stone*u),d.silver=Math.floor(d.silver*u),d},[m,c,a]),g=(0,e.useCallback)(e=>e?Math.floor(1500*Math.pow(1.4,e-1)):0,[]),v=(0,e.useCallback)(e=>{var t;if(!e)return 0;let n=Math.floor(200*Math.pow(1.25,e-1));return"shrine_of_the_ancestors"===(null===l||void 0===l||null===(t=l.allianceWonder)||void 0===t?void 0:t.id)&&(n*=1+ip.shrine_of_the_ancestors.bonus.value),n},[l]),y=(0,e.useCallback)(e=>e?1e3*e:0,[]),x=(0,e.useCallback)((e,t)=>{const s=zm[e];if(!s||t<1)return{wood:0,stone:0,silver:0,population:0,time:0};const r=s.baseCost;let i=Math.floor(r.population*Math.pow(1.1,t-1));1===t&&["senate","farm","warehouse","timber_camp","quarry","silver_mine","cave","hospital"].includes(e)&&(i=0);const a=Math.floor(r.time*Math.pow(1.25,t-1));return{wood:Math.floor(r.wood*Math.pow(1.6,t-1)),stone:Math.floor(r.stone*Math.pow(1.6,t-1)),silver:Math.floor(r.silver*Math.pow(1.8,t-1)),population:i,time:n?1:a}},[n]),b=(0,e.useCallback)(e=>{var t;const n=Wm[e];if(!n)return null;let r=n.cost.time;return"great_forum"===(null===l||void 0===l||null===(t=l.allianceWonder)||void 0===t?void 0:t.id)&&(r*=1-ip.great_forum.bonus.value),{wood:n.cost.wood,stone:n.cost.stone,silver:n.cost.silver,time:s?1:r}},[s,l]),w=(0,e.useCallback)(e=>{if(!e)return 0;const{buildings:t,units:n,specialBuilding:s,barracksQueue:r,shipyardQueue:i,divineTempleQueue:a}=e;let o=0;if(t)for(const c in t){const e=t[c];for(let t=["senate","farm","warehouse","timber_camp","quarry","silver_mine","cave","hospital"].includes(c)?1:0;t<=e.level;t++)t>0&&(o+=x(c,t).population);e.workers&&(o+=20*e.workers)}if(n)for(const c in n){var l;o+=((null===(l=qm[c])||void 0===l?void 0:l.cost.population)||0)*n[c]}s&&(o+=60);return[r||[],i||[],a||[]].forEach(e=>{e.forEach(e=>{const t=qm[e.unitId];t&&(o+=(t.cost.population||0)*e.amount)})}),o},[x]),k=(0,e.useCallback)(e=>ap(e,l),[l]),N=(0,e.useCallback)(async e=>{if(i&&t&&a&&e)try{var n,s;const r=eh(Om,`users/${i.uid}/games`,t,"cities",a),o=g(null===(n=e.buildings)||void 0===n||null===(s=n.warehouse)||void 0===s?void 0:s.level),l={wood:Math.min(o,e.resources.wood||0),stone:Math.min(o,e.resources.stone||0),silver:Math.min(o,e.resources.silver||0)},c={...e,resources:{...e.resources,...l},lastUpdated:Date.now()};await um(r,c,{merge:!0})}catch(r){console.error("Failed to save game state:",r)}},[i,t,a,g]);return(0,e.useEffect)(()=>{if(!i||!t||!a)return void u(null);const e=pm(eh(Om,`users/${i.uid}/games`,t,"cities",a),e=>{if(e.exists()){const t=e.data();t.buildings||(t.buildings={});for(const e in zm)t.buildings[e]||(t.buildings[e]={level:0});t.units||(t.units={}),t.wounded||(t.wounded={}),t.worship||(t.worship={}),t.cave||(t.cave={silver:0}),t.research||(t.research={}),t.buildQueue||(t.buildQueue=[]),t.barracksQueue||(t.barracksQueue=[]),t.shipyardQueue||(t.shipyardQueue=[]),t.divineTempleQueue||(t.divineTempleQueue=[]),t.healQueue||(t.healQueue=[]);const n=e=>(e||[]).map(e=>{var t;return{id:e.id||tp(),...e,endTime:null!==(t=e.endTime)&&void 0!==t&&t.toDate?e.endTime.toDate():e.endTime}});t.buildQueue=n(t.buildQueue),t.barracksQueue=n(t.barracksQueue),t.shipyardQueue=n(t.shipyardQueue),t.divineTempleQueue=n(t.divineTempleQueue),t.researchQueue=n(t.researchQueue),t.healQueue=n(t.healQueue),u(t)}else u(null)});return()=>e()},[i,t,a]),(0,e.useEffect)(()=>{if(!a)return;const e=setInterval(()=>{u(e=>{var t,n,s,r;if(!e)return e;const i=Date.now(),a=(i-((null!==(t=e.lastUpdated)&&void 0!==t&&t.toDate?e.lastUpdated.toDate().getTime():e.lastUpdated)||i))/1e3;if(a<0)return e;const o=JSON.parse(JSON.stringify(e)),l=f(o.buildings),c=g(null===(n=o.buildings)||void 0===n||null===(s=n.warehouse)||void 0===s?void 0:s.level);o.resources.wood=Math.min(c,(e.resources.wood||0)+l.wood/3600*a),o.resources.stone=Math.min(c,(e.resources.stone||0)+l.stone/3600*a),o.resources.silver=Math.min(c,(e.resources.silver||0)+l.silver/3600*a);const u=(null===(r=o.buildings.temple)||void 0===r?void 0:r.level)||0;if(o.god&&u>0){const t=u/3600,n=100+20*u;o.worship[o.god]=Math.min(n,(e.worship[o.god]||0)+t*a)}return o.lastUpdated=i,o})},1e3);return()=>clearInterval(e)},[a,f,g]),(0,e.useEffect)(()=>{const e=setInterval(async()=>{try{var e,n,s,r,l,c;const u=d.current;if(!i||!t||!a)return;if((null===u||void 0===u||null===(e=u.buildQueue)||void 0===e||!e.length)&&(null===u||void 0===u||null===(n=u.barracksQueue)||void 0===n||!n.length)&&(null===u||void 0===u||null===(s=u.shipyardQueue)||void 0===s||!s.length)&&(null===u||void 0===u||null===(r=u.divineTempleQueue)||void 0===r||!r.length)&&(null===u||void 0===u||null===(l=u.researchQueue)||void 0===l||!l.length)&&(null===u||void 0===u||null===(c=u.healQueue)||void 0===c||!c.length))return;const h=Date.now();let m={},p=!1;const f=(e,t)=>{var n;if(null===(n=u[e])||void 0===n||!n.length)return;const s=[],r=[];u[e].forEach(e=>{try{var t,n;const i=(null===(t=e.endTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||(e.endTime instanceof Date?e.endTime:new Date(e.endTime));if(isNaN(i.getTime()))return void console.error("Invalid endTime",e);h>=i.getTime()?r.push(e):s.push(e)}catch(i){console.error("Error processing queue item:",i)}}),r.length>0&&(m[e]=s,t(r,m),p=!0,r.forEach(t=>{let n="";const s=u.cityName;switch(e){case"buildQueue":const e=zm[t.buildingId];n="demolish"===t.type?`Demolition of ${e.name} is complete in ${s}.`:`Your ${e.name} (Level ${t.level}) is complete in ${s}.`;break;case"barracksQueue":case"shipyardQueue":case"divineTempleQueue":const r=qm[t.unitId];n=`Training of ${t.amount}x ${r.name} is complete in ${s}.`;break;case"researchQueue":n=`Research for ${Wm[t.researchId].name} is complete in ${s}.`;break;case"healQueue":const i=qm[t.unitId];n=`Healing of ${t.amount}x ${i.name} is complete in ${s}.`}n&&o&&o(n)}))};if(f("buildQueue",(e,t)=>{t.buildings=t.buildings||{...u.buildings},e.forEach(e=>{if("demolish"===e.type){if(t.buildings[e.buildingId]&&(t.buildings[e.buildingId].level=e.level),"academy"===e.buildingId){const n=e.level;t.research=t.research||{...u.research},Object.keys(t.research).forEach(e=>{const s=t.research[e];if(!0===s||s&&s.completed){const s=Wm[e];s&&s.requirements.academy>n&&(t.research[e]={completed:!0,active:!1})}})}}else if(e.isSpecial)t.specialBuilding=e.buildingId;else if(t.buildings[e.buildingId]||(t.buildings[e.buildingId]={level:0}),t.buildings[e.buildingId].level=e.level,"academy"===e.buildingId){const n=e.level;t.research=t.research||{...u.research},Object.keys(t.research).forEach(e=>{const s=t.research[e],r=!0===s||s&&s.completed,i=!0===s||s&&s.active;if(r&&!i){const s=Wm[e];s&&s.requirements.academy<=n&&(t.research[e]={completed:!0,active:!0})}})}})}),f("barracksQueue",(e,t)=>{t.units=t.units||{...u.units},e.forEach(e=>{t.units[e.unitId]=(t.units[e.unitId]||0)+e.amount})}),f("shipyardQueue",(e,t)=>{t.units=t.units||{...u.units},e.forEach(e=>{t.units[e.unitId]=(t.units[e.unitId]||0)+e.amount})}),f("divineTempleQueue",(e,t)=>{t.units=t.units||{...u.units},e.forEach(e=>{t.units[e.unitId]=(t.units[e.unitId]||0)+e.amount})}),f("researchQueue",(e,t)=>{t.research=t.research||{...u.research},e.forEach(e=>{t.research[e.researchId]={completed:!0,active:!0}})}),f("healQueue",(e,t)=>{t.units=t.units||{...u.units},e.forEach(e=>{t.units[e.unitId]=(t.units[e.unitId]||0)+e.amount})}),p){const e=eh(Om,`users/${i.uid}/games`,t,"cities",a);await um(e,{...m,lastUpdated:km()},{merge:!0})}}catch(u){console.error("Error in queue processing:",u)}},1e3);return()=>clearInterval(e)},[i,t,a,x,o]),(0,e.useEffect)(()=>{const e=setInterval(async()=>{if(d.current)try{await N(d.current)}catch(e){console.error("Auto-save failed:",e)}},3e4);return()=>clearInterval(e)},[N]),{cityGameState:c,setCityGameState:u,getUpgradeCost:x,getFarmCapacity:v,getWarehouseCapacity:g,getHospitalCapacity:y,getProductionRates:f,calculateUsedPopulation:w,saveGameState:N,getResearchCost:b,calculateTotalPoints:k,calculateHappiness:m,getHappinessDetails:h,getMaxWorkerSlots:p,getMarketCapacity:op}},cp=(0,e.createContext)(),up=()=>(0,e.useContext)(cp),dp=t=>{let{children:n,worldId:s}=t;const{currentUser:r}=Fm(),{addNotification:i}=(0,e.useContext)(Vm),[a,o]=(0,e.useState)(null),[l,c]=(0,e.useState)({}),[u,d]=(0,e.useState)(null),[h,m]=(0,e.useState)(null),[p,f]=(0,e.useState)(!1),[g,v]=(0,e.useState)(!0),[y,x]=(0,e.useState)({}),[b,w]=(0,e.useState)({}),[k,N]=(0,e.useState)({}),[j,C]=(0,e.useState)({animations:!0,confirmActions:!0,showGrid:!0,showVisuals:!0,hideReturningReports:!1,hideCompletedQuestsIcon:!1,workerPresets:{timber_camp:0,quarry:0,silver_mine:0}}),[S,_]=(0,e.useState)(()=>"true"===localStorage.getItem("isInstantBuild")),[T,I]=(0,e.useState)(()=>"true"===localStorage.getItem("isInstantResearch")),[E,A]=(0,e.useState)(()=>"true"===localStorage.getItem("isInstantUnits"));(0,e.useEffect)(()=>{if(!r||!s)return void v(!1);v(!0);const e=pm(eh(Om,"worlds",s),e=>{m(e.exists()?{id:e.id,...e.data()}:null)}),t=pm(eh(Om,`users/${r.uid}/games`,s),e=>{if(e.exists()){const t=e.data();o(t)}else o(null)}),n=pm(Jd(Om,`users/${r.uid}/games`,s,"cities"),e=>{const t={};let n=null;e.forEach(e=>{n||(n=e.id),t[e.id]={id:e.id,...e.data()}}),c(t);const s=!e.empty;f(s),d(e=>!s||e&&t[e]?s?e:null:n),v(!1)}),i=pm(Jd(Om,`users/${r.uid}/games`,s,"conqueredVillages"),e=>{const t={};e.docs.forEach(e=>{t[e.id]={id:e.id,...e.data()}}),x(t)}),a=pm(Jd(Om,`users/${r.uid}/games`,s,"conqueredRuins"),e=>{const t={};e.docs.forEach(e=>{t[e.id]={id:e.id,...e.data()}}),w(t)});return()=>{e(),t(),n(),i(),a()}},[r,s]),(0,e.useEffect)(()=>{if(!r||!s||!l)return void(l&&0!==Object.keys(l).length||N({}));(async()=>{let e=null;if(null!==a&&void 0!==a&&a.alliance){const t=eh(Om,"worlds",s,"alliances",a.alliance),n=await om(t);n.exists()&&(e={id:n.id,...n.data()})}let t=0;const n={};for(const s in l){const r=l[s],i=ap(r,e);t+=i,r.slotId&&(n[r.slotId]=i)}N(n);const i=Object.keys(l).length;if((null===a||void 0===a?void 0:a.totalPoints)!==t||(null===a||void 0===a?void 0:a.cityCount)!==i){const e=eh(Om,`users/${r.uid}/games`,s);try{(await om(e)).exists()&&await dm(e,{totalPoints:t,cityCount:i})}catch(o){console.error("Error updating total points and city count:",o)}}})()},[l,r,s,a]);const P=l[u]||null,M=P,D=P,O=(0,e.useCallback)(e=>e&&l?Object.values(l).filter(t=>t.islandId===e).length:0,[l]),R=(0,e.useCallback)(async(e,t)=>{if(!r||!s||!e||!t.trim())throw new Error("Invalid parameters for renaming city.");const n=l[e];if(!n)throw new Error("City not found.");const i=eh(Om,`users/${r.uid}/games`,s,"cities",e),a=eh(Om,"worlds",s,"citySlots",n.slotId),o=Cm(Om);o.update(i,{cityName:t.trim()}),o.update(a,{cityName:t.trim()}),await o.commit()},[r,s,l]),L={worldId:s,worldState:h,playerGameData:a,playerCities:l,activeCityId:u,setActiveCityId:d,activeCity:P,playerHasCities:p,loading:g,conqueredVillages:y,conqueredRuins:b,gameSettings:j,setGameSettings:C,countCitiesOnIsland:O,renameCity:R,addNotification:i,playerCityPoints:k,gameState:M,playerCity:D,setGameState:e=>{u&&c(t=>({...t,[u]:e}))}};return(0,Lm.jsx)(cp.Provider,{value:{...L,isInstantBuild:S,setIsInstantBuild:e=>{_(e),localStorage.setItem("isInstantBuild",e.toString())},isInstantResearch:T,setIsInstantResearch:e=>{I(e),localStorage.setItem("isInstantResearch",e.toString())},isInstantUnits:E,setIsInstantUnits:e=>{A(e),localStorage.setItem("isInstantUnits",e.toString())}},children:n})},hp=async(e,t,n,s)=>{const r="system",i="System",a=[r,e].sort(),o=Bh(Jd(Om,"worlds",s,"conversations"),qh("participants","==",a)),l=await cm(o);let c;l.empty?(c=eh(Jd(Om,"worlds",s,"conversations")),await um(c,{participants:a,participantUsernames:{[r]:i,[e]:t},lastMessage:{text:n.substring(0,30)+"...",senderId:r,timestamp:km()},readBy:[]})):c=l.docs[0].ref,await mm(Jd(c,"messages"),{text:n,senderId:r,senderUsername:i,isSystem:!0,timestamp:km()}),await dm(c,{lastMessage:{text:n.substring(0,30)+"...",senderId:r,timestamp:km()},readBy:[]})},mp=JSON.parse('{"master_of_arms":{"name":"Master of Arms","description":"Increases the attack power of all alliance members\' troops.","maxLevel":10,"baseCost":{"wood":100000,"stone":100000,"silver":50000},"costMultiplier":1.5,"effect":{"type":"attack_boost","value":0.01}},"fortification_experts":{"name":"Fortification Experts","description":"Increases the defensive power of all alliance members\' troops.","maxLevel":10,"baseCost":{"wood":100000,"stone":150000,"silver":25000},"costMultiplier":1.5,"effect":{"type":"defense_boost","value":0.01}},"logistics_specialists":{"name":"Logistics Specialists","description":"Increases the travel speed of all alliance members\' troops.","maxLevel":5,"baseCost":{"wood":120000,"stone":80000,"silver":80000},"costMultiplier":1.8,"effect":{"type":"speed_boost","value":0.02}},"expanded_charter":{"name":"Expanded Charter","description":"Increases the maximum number of members in the alliance.","maxLevel":5,"baseCost":{"wood":250000,"stone":250000,"silver":100000},"costMultiplier":2,"effect":{"type":"max_members","value":5}},"reinforced_vaults":{"name":"Reinforced Vaults","description":"Increases the capacity of the alliance bank.","maxLevel":10,"baseCost":{"wood":150000,"stone":200000,"silver":150000},"costMultiplier":1.6,"effect":{"type":"bank_capacity","value":50000}}}'),pp={},fp=()=>{for(const e in pp)delete pp[e]},gp=e=>{let{message:t,onConfirm:n,onCancel:s}=e;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600 text-white",children:[(0,Lm.jsx)("p",{className:"mb-6 text-lg",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-danger",children:"Confirm"})]})]})})},vp=()=>{var t,n,s,r;const{playerAlliance:i,kickAllianceMember:a,banAllianceMember:o,updateAllianceMemberRank:l}=sp(),{worldId:c,worldState:u}=up(),{currentUser:d}=Fm(),[h,m]=(0,e.useState)({}),[p,f]=(0,e.useState)(!0),[g,v]=(0,e.useState)({key:"username",direction:"ascending"}),[y,x]=(0,e.useState)(null),[b,w]=(0,e.useState)(""),[k,N]=(0,e.useState)(null),[j,C]=(0,e.useState)(null),S=(0,e.useRef)(null),_=(0,e.useMemo)(()=>{if(!i||!d)return null;const e=i.members.find(e=>e.uid===d.uid);return e?i.ranks.find(t=>t.id===e.rank):null},[i,d]),T=null===_||void 0===_||null===(t=_.permissions)||void 0===t?void 0:t.kickMembers,I=null===_||void 0===_||null===(n=_.permissions)||void 0===n?void 0:n.banMembers,E=null===_||void 0===_||null===(s=_.permissions)||void 0===s?void 0:s.viewMemberActivity,A=null===_||void 0===_||null===(r=_.permissions)||void 0===r?void 0:r.manageRanks;(0,e.useEffect)(()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&C(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const P=(0,e.useMemo)(()=>{var e,t;if(!i)return 0;const n=(null===(e=i.research)||void 0===e||null===(t=e.expanded_charter)||void 0===t?void 0:t.level)||0;return 20+mp.expanded_charter.effect.value*n},[i]);(0,e.useEffect)(()=>{const e=Date.now(),t=null===i||void 0===i?void 0:i.id;t&&pp[t]&&e-pp[t].timestamp<12e4?(m(pp[t].data),f(!1)):t?(async()=>{if(!i||0===i.members.length||!u)return void f(!1);f(!0);const e=i.members.map(e=>e.uid),t=new Map,n=new Map,s=Bh(Zd(Om,"games"),qh("worldName","==",u.name));if((await cm(s)).forEach(t=>{const s=t.ref.parent.parent.id;e.includes(s)&&n.set(s,t.data())}),E&&e.length>0){const n=Bh(Jd(Om,"users"),qh("__name__","in",e));(await cm(n)).forEach(e=>{t.set(e.id,e.data())})}const r=i.members.map(async e=>{var s,r;const i=n.get(e.uid)||{totalPoints:0,cityCount:0,lastSeen:null},a=t.get(e.uid)||{};return{uid:e.uid,points:i.totalPoints||0,cityCount:i.cityCount||0,lastSeen:(null===(s=i.lastSeen)||void 0===s?void 0:s.toDate())||null,lastLogin:(null===(r=a.lastLogin)||void 0===r?void 0:r.toDate())||null}}),a=await Promise.all(r),o=new Map(a.map(e=>[e.uid,e]));m(Object.fromEntries(o)),pp[i.id]={data:Object.fromEntries(o),timestamp:Date.now()},f(!1)})():f(!1)},[i,c,E,u]);const M=(0,e.useMemo)(()=>i?i.members.map(e=>({...e,...h[e.uid]||{points:0,cityCount:0,lastSeen:null,lastLogin:null}})):[],[i,h]),D=(0,e.useMemo)(()=>{let e=[...M];return null!==g.key&&e.sort((e,t)=>{let n=e[g.key],s=t[g.key];if("rank"===g.key&&(n=i.ranks.findIndex(t=>t.id===e.rank),s=i.ranks.findIndex(e=>e.id===t.rank)),"status"===g.key){const r=e.lastSeen&&new Date-e.lastSeen<3e5,i=t.lastSeen&&new Date-t.lastSeen<3e5;if(r&&!i)return-1;if(!r&&i)return 1;n=t.lastSeen||t.lastLogin||0,s=e.lastSeen||e.lastLogin||0}return n<s?"ascending"===g.direction?-1:1:n>s?"ascending"===g.direction?1:-1:0}),e},[M,g,i.ranks]),O=e=>{let t="ascending";g.key===e&&"ascending"===g.direction&&(t="descending"),v({key:e,direction:t})},R=e=>g.key===e?"ascending"===g.direction?" \u25b2":" \u25bc":"",L=(e,t)=>{const n=new Date;if(e&&n-e<3e5)return(0,Lm.jsx)("span",{className:"text-green-500 font-bold",children:"Online"});const s=e||t;if(!s||!(s instanceof Date))return(0,Lm.jsx)("span",{className:"text-gray-500",children:"Offline"});const r=Math.round((n-s)/1e3),i=Math.round(r/60),a=Math.round(i/60),o=Math.round(a/24);return i<60?`${i}m ago`:a<24?`${a}h ago`:1===o?"Yesterday":o<7?`${o}d ago`:s.toLocaleDateString()};return p?(0,Lm.jsx)("div",{children:"Loading member data..."}):(0,Lm.jsxs)("div",{children:[y&&(0,Lm.jsx)(gp,{message:y.message,onConfirm:y.onConfirm,onCancel:()=>x(null)}),(0,Lm.jsxs)("h3",{className:"text-xl font-bold mb-2",children:["Members (",i.members.length," / ",P,")"]}),b&&(0,Lm.jsx)("p",{className:"text-center text-yellow-400 mb-2",children:b}),(0,Lm.jsxs)("table",{className:"w-full text-left",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{className:"bg-gray-300 text-gray-900",children:[(0,Lm.jsxs)("th",{className:"p-2 cursor-pointer",onClick:()=>O("username"),children:["Player",R("username")]}),(0,Lm.jsxs)("th",{className:"p-2 cursor-pointer",onClick:()=>O("rank"),children:["Rank",R("rank")]}),(0,Lm.jsxs)("th",{className:"p-2 cursor-pointer text-right",onClick:()=>O("points"),children:["Points",R("points")]}),(0,Lm.jsxs)("th",{className:"p-2 cursor-pointer text-right",onClick:()=>O("cityCount"),children:["Cities",R("cityCount")]}),E&&(0,Lm.jsxs)("th",{className:"p-2 cursor-pointer text-right",onClick:()=>O("status"),children:["Status",R("status")]}),(T||I)&&(0,Lm.jsx)("th",{className:"p-2 text-right",children:"Actions"})]})}),(0,Lm.jsx)("tbody",{children:D.map(e=>(0,Lm.jsxs)("tr",{className:"border-b border-gray-300 text-gray-900",children:[(0,Lm.jsx)("td",{className:"p-2",children:e.username}),(0,Lm.jsx)("td",{className:"p-2",children:A&&e.uid!==i.leader.uid?k===e.uid?(0,Lm.jsx)("select",{value:e.rank,onChange:t=>{(async(e,t)=>{try{await l(e,t),w("Member rank updated successfully!"),setTimeout(()=>w(""),3e3)}catch(n){w("Failed to update rank. Please try again."),console.error("Error updating member rank:",n)}})(e.uid,t.target.value),N(null)},onBlur:()=>N(null),autoFocus:!0,className:"bg-white text-gray-900 p-1 rounded text-sm border border-amber-300",children:i.ranks.map(e=>(0,Lm.jsx)("option",{value:e.id,children:e.name},e.id))}):(0,Lm.jsx)("button",{onClick:()=>N(e.uid),className:"text-sm text-amber-800 hover:underline cursor-pointer bg-transparent border-none p-0",children:e.rank}):e.rank}),(0,Lm.jsx)("td",{className:"p-2 text-right",children:e.points.toLocaleString()}),(0,Lm.jsx)("td",{className:"p-2 text-right",children:e.cityCount}),E&&(0,Lm.jsx)("td",{className:"p-2 text-right",children:L(e.lastSeen,e.lastLogin)}),(T||I)&&(0,Lm.jsxs)("td",{className:"p-2 text-right relative",children:[e.uid!==d.uid&&e.uid!==i.leader.uid&&(0,Lm.jsx)("button",{onClick:()=>C(j===e.uid?null:e.uid),className:"btn btn-primary text-xs px-2 py-1",children:"Manage"}),j===e.uid&&(0,Lm.jsxs)("div",{ref:S,className:"absolute right-0 mt-2 w-32 bg-white rounded-md shadow-lg z-10 border border-gray-200",children:[T&&(0,Lm.jsx)("button",{onClick:()=>(e=>{C(null),x({message:`Are you sure you want to kick ${e.username} from the alliance?`,onConfirm:async()=>{try{await a(e.uid),w(`${e.username} has been kicked.`)}catch(t){w(`Error: ${t.message}`)}finally{x(null)}}})})(e),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Kick"}),I&&(0,Lm.jsx)("button",{onClick:()=>(e=>{C(null),x({message:`Are you sure you want to ban ${e.username}? This will kick them and prevent them from rejoining.`,onConfirm:async()=>{try{await o(e.uid),w(`${e.username} has been banned.`)}catch(t){w(`Error: ${t.message}`)}finally{x(null)}}})})(e),className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50",children:"Ban"})]})]})]},e.uid))})]})]})},yp=e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s}=up();return{createAlliance:async(e,r)=>{if(!t||!s||!n)return;const i=Jd(Om,`users/${t.uid}/games`,s,"cities"),a=(await cm(i)).docs.map(e=>e.data().slotId);if(0===a.length)throw new Error("You must have a city to create an alliance.");const o=r.toUpperCase(),l=eh(Om,"worlds",s,"alliances",o),c=eh(Om,`users/${t.uid}/games`,s),u=Jd(Om,"worlds",s,"alliances",o,"events");try{await wm(Om,async i=>{if((await i.get(l)).exists())throw new Error("An alliance with this tag already exists.");const d=await i.get(c);if(!d.exists())throw new Error("Player game data not found.");if(d.data().alliance)throw new Error("You are already in an alliance.");const h={name:e,tag:o,leader:{uid:t.uid,username:n.username},members:[{uid:t.uid,username:n.username,rank:"Leader"}],research:{},bank:{wood:0,stone:0,silver:0,capacity:1e5},diplomacy:{allies:[],enemies:[],requests:[]},settings:{status:"open",description:`A new alliance, '${e}', has been formed!`,privateDescription:""},ranks:[{id:"Leader",name:"Leader",permissions:{manageRanks:!0,manageSettings:!0,manageDiplomacy:!0,inviteMembers:!0,kickMembers:!0,banMembers:!0,recommendResearch:!0,viewSecretForums:!0,manageBank:!0,withdrawFromBank:!0,proposeTreaties:!0,viewMemberActivity:!0}},{id:"Member",name:"Member",permissions:{manageRanks:!1,manageSettings:!1,manageDiplomacy:!1,inviteMembers:!1,kickMembers:!1,banMembers:!1,recommendResearch:!1,viewSecretForums:!1,manageBank:!1,withdrawFromBank:!1,proposeTreaties:!1,viewMemberActivity:!1}}],banned:[],applications:[]};i.set(l,h),i.update(c,{alliance:o});for(const t of a){const n=eh(Om,"worlds",s,"citySlots",t);i.update(n,{alliance:o,allianceName:e})}i.set(eh(u),{type:"alliance_created",text:`The alliance '${e}' [${r.toUpperCase()}] was founded by ${n.username}.`,timestamp:km()})})}catch(d){throw console.error("Error creating alliance: ",d),d}},updateAllianceSettings:async r=>{var i;if(!e)return;const a=e.members.find(e=>e.uid===t.uid),o=e.ranks.find(e=>e.id===(null===a||void 0===a?void 0:a.rank));if(null===o||void 0===o||null===(i=o.permissions)||void 0===i||!i.manageSettings)return;const l=eh(Om,"worlds",s,"alliances",e.id);await dm(l,{settings:r});const c=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(c,{type:"settings_updated",text:`${n.username} updated the alliance settings.`,timestamp:km()})},applyToAlliance:async r=>{if(!t||!s||!n)throw new Error("User or world not identified.");if(e)throw new Error("You are already in an alliance.");const i=eh(Om,"worlds",s,"alliances",r),a=await om(i);if(!a.exists())throw new Error("Alliance not found.");{var o,l;const e=a.data();if(null!==(o=e.banned)&&void 0!==o&&o.some(e=>e.uid===t.uid))throw new Error("You are banned from this alliance.");const c=null===(l=e.applications)||void 0===l?void 0:l.find(e=>e.userId===t.uid);if(c)throw new Error("You have already applied to this alliance.");await dm(i,{applications:Nm({userId:t.uid,username:n.username,timestamp:new Date})});const u=e.leader.uid,d=e.leader.username,h=`You have a new application for [alliance id=${r}]${e.name}[/alliance] from [player id=${t.uid}]${n.username}[/player].`;await hp(u,d,h,s)}},leaveAlliance:async()=>{if(!e)throw new Error("You are not in an alliance.");if(e.leader.uid===t.uid&&e.members.length>1)throw new Error("Leaders must pass leadership before leaving.");const r=Jd(Om,`users/${t.uid}/games`,s,"cities"),i=(await cm(r)).docs.map(e=>e.data().slotId),a=eh(Om,"worlds",s,"alliances",e.id),o=eh(Om,`users/${t.uid}/games`,s),l=Jd(Om,"worlds",s,"alliances",e.id,"events");await wm(Om,async r=>{if(1===e.members.length)r.delete(a);else{const n=e.members.find(e=>e.uid===t.uid);n&&r.update(a,{members:jm(n)})}r.update(o,{alliance:null});for(const e of i){const t=eh(Om,"worlds",s,"citySlots",e);r.update(t,{alliance:null,allianceName:null})}r.set(eh(l),{type:"member_left",text:`${n.username} has left the alliance.`,timestamp:km()})}),fp()},disbandAlliance:async()=>{if(!e||e.leader.uid!==t.uid)throw new Error("You are not the leader of this alliance.");const n=eh(Om,"worlds",s,"alliances",e.id),r=Cm(Om);for(const t of e.members){const e=eh(Om,`users/${t.uid}/games`,s);r.update(e,{alliance:null});const n=Jd(Om,`users/${t.uid}/games`,s,"cities");(await cm(n)).forEach(e=>{const t=e.data();if(t.slotId){const e=eh(Om,"worlds",s,"citySlots",t.slotId);r.update(e,{alliance:null,allianceName:null})}})}r.delete(n),await r.commit()},joinOpenAlliance:async r=>{if(!t||!s||!n)throw new Error("User or world not identified.");if(e)throw new Error("You are already in an alliance.");const i=Jd(Om,`users/${t.uid}/games`,s,"cities"),a=(await cm(i)).docs.map(e=>e.data().slotId),o=eh(Om,"worlds",s,"alliances",r),l=eh(Om,`users/${t.uid}/games`,s),c=Jd(Om,"worlds",s,"alliances",r,"events");await wm(Om,async e=>{var i;const u=await e.get(o);if(!u.exists())throw new Error("Alliance not found.");const d=u.data();if(null!==(i=d.banned)&&void 0!==i&&i.some(e=>e.uid===t.uid))throw new Error("You are banned from this alliance.");if("open"!==d.settings.status)throw new Error("This alliance is not open for joining.");const h=(e=>{var t,n;const s=(null===(t=e.research)||void 0===t||null===(n=t.expanded_charter)||void 0===n?void 0:n.level)||0;return 20+mp.expanded_charter.effect.value*s})(d);if(d.members.length>=h)throw new Error("This alliance is full.");e.update(o,{members:Nm({uid:t.uid,username:n.username,rank:"Member"})}),e.update(l,{alliance:r});for(const t of a){const n=eh(Om,"worlds",s,"citySlots",t);e.update(n,{alliance:r,allianceName:d.name})}e.set(eh(c),{type:"member_joined",text:`${n.username} has joined the alliance.`,timestamp:km()})}),fp()}}},xp=e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s,activeCityId:r}=up();return{donateToBank:async i=>{if(!e)throw new Error("You are not in an alliance.");if(Object.values(i).every(e=>0===e))throw new Error("Donation amount cannot be zero.");const a=eh(Om,`users/${t.uid}/games`,s,"cities",r),o=eh(Om,"worlds",s,"alliances",e.id),l=eh(Jd(o,"bank_logs")),c=eh(Jd(o,"events")),u=eh(Om,`users/${t.uid}/games`,s,"bankActivity","activity");await wm(Om,async e=>{const t=await e.get(a),s=await e.get(o),r=await e.get(u);if(!t.exists()||!s.exists())throw new Error("City or Alliance data not found.");const d=t.data(),h=s.data(),m=(e=>{var t,n;if(!e)return 0;const s=(null===(t=e.research)||void 0===t||null===(n=t.reinforced_vaults)||void 0===n?void 0:n.level)||0;return 1e5+mp.reinforced_vaults.effect.value*s})(h),p=r.exists()?r.data():{lastDonation:0,dailyDonationTotal:0,lastDonationDate:new Date(0).toISOString().split("T")[0]},f=new Date,g=f.toISOString().split("T")[0];if(f.getTime()-(p.lastDonation||0)<3e5){const e=Math.ceil((3e5-(f.getTime()-p.lastDonation))/1e3);throw new Error(`You must wait ${e} seconds between donations.`)}let v=p.dailyDonationTotal||0;p.lastDonationDate!==g&&(v=0);const y=Object.values(i).reduce((e,t)=>e+t,0);if(v+y>5e4)throw new Error(`You have reached your daily donation limit of 50,000. You have ${5e4-v} left to donate today.`);const x={...d.resources},b={...h.bank||{wood:0,stone:0,silver:0}};for(const n in i){if((x[n]||0)<i[n])throw new Error(`Not enough ${n}.`);if((b[n]||0)+i[n]>m)throw new Error(`Bank is full for ${n}. Capacity: ${m.toLocaleString()}`);x[n]-=i[n],b[n]=(b[n]||0)+i[n]}e.update(a,{resources:x}),e.update(o,{bank:b}),e.set(u,{lastDonation:f.getTime(),dailyDonationTotal:v+y,lastDonationDate:g},{merge:!0}),e.set(l,{type:"donation",user:n.username,resources:i,timestamp:km()});const w=Object.entries(i).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;return`${n.toLocaleString()} ${t}`}).join(", ");e.set(c,{type:"bank_donation",text:`${n.username} donated ${w} to the bank.`,timestamp:km()})})},distributeFromBank:async(t,r)=>{if(!e)throw new Error("You are not in an alliance.");if(Object.values(r).every(e=>0===e))throw new Error("Distribution amount cannot be zero.");const i=eh(Om,"worlds",s,"alliances",e.id),a=eh(Jd(i,"bank_logs")),o=eh(Jd(i,"events")),l=Bh(Jd(Om,`users/${t}/games`,s,"cities"),Yh(1)),c=await cm(l);if(c.empty)throw new Error("Target member has no cities in this world.");const u=c.docs[0].ref;await wm(Om,async e=>{var s;const l=await e.get(i),c=await e.get(u);if(!l.exists()||!c.exists())throw new Error("Alliance or target city data not found.");const d=l.data(),h=c.data(),m={...d.bank||{wood:0,stone:0,silver:0}},p={...h.resources};for(const t in r){if((m[t]||0)<r[t])throw new Error(`Not enough ${t} in the bank.`);m[t]-=r[t],p[t]=(p[t]||0)+r[t]}e.update(i,{bank:m}),e.update(u,{resources:p});const f=(null===(s=d.members.find(e=>e.uid===t))||void 0===s?void 0:s.username)||"Unknown";e.set(a,{type:"distribution",from:n.username,to:f,resources:r,timestamp:km()});const g=Object.entries(r).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;return`${n.toLocaleString()} ${t}`}).join(", ");e.set(o,{type:"bank_distribution",text:`${n.username} distributed ${g} to ${f}.`,timestamp:km()})})},withdrawFromBank:async i=>{if(!e)throw new Error("You are not in an alliance.");if(Object.values(i).every(e=>0===e))throw new Error("Withdrawal amount cannot be zero.");const a=eh(Om,`users/${t.uid}/games`,s,"cities",r),o=eh(Om,"worlds",s,"alliances",e.id),l=eh(Jd(o,"bank_logs"));await wm(Om,async e=>{const t=await e.get(a),s=await e.get(o);if(!t.exists()||!s.exists())throw new Error("City or Alliance data not found.");const r=t.data(),c=s.data(),u={...r.resources},d={...c.bank};for(const n in i){if(d[n]<i[n])throw new Error(`Not enough ${n} in the bank.`);d[n]-=i[n],u[n]=(u[n]||0)+i[n]}e.update(a,{resources:u}),e.update(o,{bank:d}),e.set(l,{type:"withdrawal",user:n.username,resources:i,timestamp:km()})})}}},bp=e=>{var t,n;const s=(null===(t=e.research)||void 0===t||null===(n=t.expanded_charter)||void 0===n?void 0:n.level)||0;return 20+mp.expanded_charter.effect.value*s},wp=e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s,gameState:r}=up();return{startWonder:async(i,a,o)=>{if(!e)throw new Error("You are not in an alliance.");if(e.leader.uid!==t.uid)throw new Error("Only the leader can start a wonder.");if(e.allianceWonder)throw new Error("Your alliance is already building a wonder.");const l=eh(Om,"worlds",s,"alliances",e.id),c=eh(Om,`users/${t.uid}/games`,s,"cities",r.id),u=eh(Jd(l,"events")),d={wood:5e4,stone:5e4,silver:25e3};await wm(Om,async e=>{const t=await e.get(c);if(!t.exists())throw new Error("Your city data was not found.");const s=t.data();for(const n in d)if((s.resources[n]||0)<d[n])throw new Error(`You do not have enough ${n} to start the wonder.`);const r={...s.resources};for(const n in d)r[n]-=d[n];e.update(c,{resources:r}),e.update(l,{allianceWonder:{id:i,level:0,islandId:a,x:o.x,y:o.y},wonderProgress:{[i]:{wood:0,stone:0,silver:0}}});const h=`${n.username} has started construction of the ${ip[i].name}.`;e.set(u,{type:"wonder_start",text:h,timestamp:km()})})},donateToWonder:async(i,a)=>{if(!e)throw new Error("You are not in an alliance.");const o=eh(Om,"worlds",s,"alliances",e.id),l=eh(Om,`users/${t.uid}/games`,s,"cities",r.id),c=eh(Jd(o,"events"));await wm(Om,async e=>{var t;const s=await e.get(l),r=await e.get(o);if(!s.exists()||!r.exists())throw new Error("City or Alliance data not found.");const u=s.data(),d=r.data(),h=d.allianceWonder;if(!h||h.id!==i)throw new Error("Cannot donate to this wonder, as it is not the active wonder.");const m={...u.resources},p={...(null===(t=d.wonderProgress)||void 0===t?void 0:t[i])||{wood:0,stone:0,silver:0}};for(const n in a){if((m[n]||0)<a[n])throw new Error(`Not enough ${n} in your city.`);m[n]-=a[n],p[n]+=a[n]}e.update(l,{resources:m}),e.update(o,{[`wonderProgress.${i}`]:p});const f=Object.entries(a).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;return`${n.toLocaleString()} ${t}`}).join(", ");f&&e.set(c,{type:"wonder_donation",text:`${n.username} donated ${f} to the wonder.`,timestamp:km()})})},claimWonderLevel:async n=>{if(!e)throw new Error("You are not in an alliance.");if(e.leader.uid!==t.uid)throw new Error("Only the leader can claim wonder levels.");const r=eh(Om,"worlds",s,"alliances",e.id);await wm(Om,async e=>{const t=await e.get(r);if(!t.exists())throw new Error("Alliance data not found.");const s=t.data(),i=s.allianceWonder,a=s.wonderProgress[n]||{wood:0,stone:0,silver:0},o=i.level+1,l=(e=>{const t=Math.pow(1.5,e);return{wood:Math.floor(1e5*t),stone:Math.floor(1e5*t),silver:Math.floor(5e4*t)}})(o-1);if(a.wood<l.wood||a.stone<l.stone||a.silver<l.silver)throw new Error("Not enough resources have been donated to claim this level.");const c={wood:a.wood-l.wood,stone:a.stone-l.stone,silver:a.silver-l.silver};e.update(r,{allianceWonder:{...i,level:o},[`wonderProgress.${n}`]:c})})},demolishWonder:async()=>{if(!e)throw new Error("You are not in an alliance.");if(e.leader.uid!==t.uid)throw new Error("Only the leader can demolish the wonder.");const n=eh(Om,"worlds",s,"alliances",e.id);await wm(Om,async e=>{if(!(await e.get(n)).exists())throw new Error("Alliance data not found.");e.update(n,{allianceWonder:null,wonderProgress:{}})})}}},kp=t=>{let{children:n}=t;const{worldId:s,playerGameData:r}=up(),[i,a]=(0,e.useState)(null);(0,e.useEffect)(()=>{if(!s||!r||!r.alliance)return void a(null);const e=pm(eh(Om,"worlds",s,"alliances",r.alliance),e=>{e.exists()?a({id:e.id,...e.data()}):a(null)});return()=>e()},[s,r]);const o=yp(i),l=xp(i),c=(e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s}=up();return{sendAllyRequest:async r=>{var i,a,o,l,c;if(!e)throw new Error("You are not in an alliance.");const u=e.members.find(e=>e.uid===t.uid),d=e.ranks.find(e=>e.id===(null===u||void 0===u?void 0:u.rank));if(null===d||void 0===d||null===(i=d.permissions)||void 0===i||!i.manageDiplomacy)throw new Error("You don't have permission to do this.");const h=Bh(Jd(Om,"worlds",s,"alliances"),qh("tag","==",r.toUpperCase())),m=await cm(h);if(m.empty)throw new Error("Alliance with that tag not found.");const p=m.docs[0],f=p.data(),g=p.id;if(e.id===g)throw new Error("You cannot send an ally request to your own alliance.");if(null!==(a=e.diplomacy)&&void 0!==a&&null!==(o=a.allies)&&void 0!==o&&o.some(e=>e.id===g))throw new Error("You are already allied with this alliance.");if(null!==(l=e.diplomacy)&&void 0!==l&&null!==(c=l.enemies)&&void 0!==c&&c.some(e=>e.id===g))throw new Error("You cannot send an ally request to an enemy. Remove them from your enemies first.");const v=eh(Om,"worlds",s,"alliances",g);await dm(v,{"diplomacy.requests":Nm({id:e.id,name:e.name,tag:e.tag})});const y=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(y,{type:"diplomacy",text:`${n.username} sent an ally request to [${r}].`,timestamp:km()});const x=f.leader.uid,b=f.leader.username,w=`Your alliance has received an ally request from [alliance id=${e.id}]${e.name}[/alliance]. You can accept or reject it in your alliance's diplomacy tab.`;await hp(x,b,w,s)},declareEnemy:async r=>{var i,a,o,l,c;if(!e)throw new Error("You are not in an alliance.");const u=e.members.find(e=>e.uid===t.uid),d=e.ranks.find(e=>e.id===(null===u||void 0===u?void 0:u.rank));if(null===d||void 0===d||null===(i=d.permissions)||void 0===i||!i.manageDiplomacy)throw new Error("You don't have permission to do this.");if(null!==(a=e.diplomacy)&&void 0!==a&&null!==(o=a.allies)&&void 0!==o&&o.some(e=>e.id===r))throw new Error("You cannot declare an ally as an enemy.");if(null!==(l=e.diplomacy)&&void 0!==l&&null!==(c=l.enemies)&&void 0!==c&&c.some(e=>e.id===r))throw new Error("This alliance is already an enemy.");const h=eh(Om,"worlds",s,"alliances",e.id),m=await om(eh(Om,"worlds",s,"alliances",r));if(!m.exists())throw new Error("Target alliance not found.");const p=m.data();await dm(h,{"diplomacy.enemies":Nm({id:r,name:p.name,tag:p.tag})});const f=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(f,{type:"diplomacy",text:`${n.username} declared [${r}] as an enemy.`,timestamp:km()})},handleDiplomacyResponse:async(r,i)=>{var a;if(!e)throw new Error("You are not in an alliance.");const o=e.members.find(e=>e.uid===t.uid),l=e.ranks.find(e=>e.id===(null===o||void 0===o?void 0:o.rank));if(null===l||void 0===l||null===(a=l.permissions)||void 0===a||!a.manageDiplomacy)throw new Error("You don't have permission to do this.");const c=eh(Om,"worlds",s,"alliances",e.id),u=eh(Om,"worlds",s,"alliances",r),d=Jd(Om,"worlds",s,"alliances",e.id,"events"),h=Jd(Om,"worlds",s,"alliances",r,"events");await wm(Om,async t=>{var s;const a=await t.get(c),o=await t.get(u);if(!a.exists())throw new Error("Your alliance data not found.");if(!o.exists())throw new Error("Target alliance not found.");const l=a.data(),m=o.data(),p={id:r,name:m.name,tag:m.tag},f={id:e.id,name:l.name,tag:l.tag},g=l.diplomacy||{allies:[],enemies:[],requests:[]},v=m.diplomacy||{allies:[],enemies:[],requests:[]};switch(i){case"accept":if(null!==(s=g.enemies)&&void 0!==s&&s.some(e=>e.id===r))throw new Error("You cannot ally with an enemy. Remove them from your enemies list first.");t.update(c,{"diplomacy.requests":jm(p),"diplomacy.allies":Nm(p)}),t.update(u,{"diplomacy.allies":Nm(f)}),mm(d,{type:"diplomacy",text:`${n.username} accepted the ally request from [${p.tag}].`,timestamp:km()}),mm(h,{type:"diplomacy",text:`[${f.tag}] has accepted your ally request.`,timestamp:km()});break;case"reject":t.update(c,{"diplomacy.requests":jm(p)}),mm(d,{type:"diplomacy",text:`${n.username} rejected the ally request from [${p.tag}].`,timestamp:km()});break;case"removeAlly":const i=g.allies.find(e=>e.id===r),a=v.allies.find(t=>t.id===e.id);i&&t.update(c,{"diplomacy.allies":jm(i)}),a&&t.update(u,{"diplomacy.allies":jm(a)}),mm(d,{type:"diplomacy",text:`${n.username} terminated the alliance with [${p.tag}].`,timestamp:km()}),mm(h,{type:"diplomacy",text:`The alliance with [${f.tag}] has been terminated.`,timestamp:km()});break;case"removeEnemy":const o=g.enemies.find(e=>e.id===r);o&&t.update(c,{"diplomacy.enemies":jm(o)}),mm(d,{type:"diplomacy",text:`${n.username} removed [${p.tag}] from the enemies list.`,timestamp:km()});break;default:throw new Error("Invalid diplomacy action.")}})},proposeTreaty:async(r,i)=>{var a;if(!e)throw new Error("You are not in an alliance.");const o=e.members.find(e=>e.uid===t.uid),l=e.ranks.find(e=>e.id===(null===o||void 0===o?void 0:o.rank));if(null===l||void 0===l||null===(a=l.permissions)||void 0===a||!a.proposeTreaties)throw new Error("You don't have permission to do this.");const c=Bh(Jd(Om,"worlds",s,"alliances"),qh("tag","==",r.toUpperCase())),u=await cm(c);if(u.empty)throw new Error("Alliance with that tag not found.");const d={id:u.docs[0].id,...u.docs[0].data()},h=d.leader.uid,m=d.leader.username,p=`Alliance ${e.name} [${e.tag}] has proposed a treaty to you.\n\nDetails:\n${i.message}\n\n[action=view_treaty,treatyId=TEMP]View Treaty[/action]`;await hp(h,m,p,s);const f=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(f,{type:"treaty_proposed",text:`${n.username} proposed a treaty to [${r}].`,timestamp:km()})}}})(i),u=(e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s}=up();return{sendAllianceInvitation:async r=>{var i;if(!e)throw new Error("You do not have permission to send invitations.");const a=e.members.find(e=>e.uid===t.uid),o=e.ranks.find(e=>e.id===(null===a||void 0===a?void 0:a.rank));if(null===o||void 0===o||null===(i=o.permissions)||void 0===i||!i.inviteMembers)throw new Error("You do not have permission to send invitations.");if(!r)throw new Error("Target user ID is not specified.");try{const t=await om(eh(Om,"users",r));if(!t.exists())throw new Error("Target user not found.");const i=t.data().username,a=Jd(Om,"worlds",s,"alliances",e.id,"invitations");await mm(a,{invitedUserId:r,invitedUsername:i,sentAt:km(),sentBy:n.username});const o=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(o,{type:"invitation_sent",text:`${n.username} invited ${i} to the alliance.`,timestamp:km()});const l=`You have been invited to join the alliance "${e.name}".\n\n[action=accept_invite,allianceId=${e.id}]Accept Invitation[/action]\n[action=decline_invite,allianceId=${e.id}]Decline Invitation[/action]`;await hp(r,i,l,s)}catch(l){throw console.error("Error sending invitation:",l),l}},revokeAllianceInvitation:async r=>{var i;if(!e)return;const a=e.members.find(e=>e.uid===t.uid),o=e.ranks.find(e=>e.id===(null===a||void 0===a?void 0:a.rank));if(null===o||void 0===o||null===(i=o.permissions)||void 0===i||!i.inviteMembers)return;const l=Bh(Jd(eh(Om,"worlds",s,"alliances",e.id),"invitations"),qh("invitedUserId","==",r));try{const t=await cm(l);if(!t.empty){const r=t.docs[0],i=r.data().invitedUsername||"a player",a=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(a,{type:"invitation_revoked",text:`${n.username} has revoked the invitation for ${i}.`,timestamp:km()}),await hm(r.ref)}}catch(c){throw console.error("Error revoking invitation:",c),c}},acceptAllianceInvitation:async e=>{if(!t||!s)return;const r=Jd(Om,`users/${t.uid}/games`,s,"cities"),i=(await cm(r)).docs.map(e=>e.data().slotId),a=eh(Om,"worlds",s,"alliances",e),o=eh(Om,`users/${t.uid}/games`,s),l=Bh(Jd(Om,"worlds",s,"alliances",e,"invitations"),qh("invitedUserId","==",t.uid)),c=await cm(l);if(c.empty)throw new Error("Invitation not found. It may have been revoked or already handled.");const u=c.docs[0].ref;try{await wm(Om,async r=>{var l;if(!(await r.get(u)).exists())throw new Error("Invitation was handled by another action.");const c=await r.get(a),d=await r.get(o);if(!c.exists())throw new Error("Alliance no longer exists.");if(!d.exists())throw new Error("Your game data was not found.");const h=c.data();if(null!==(l=h.banned)&&void 0!==l&&l.some(e=>e.uid===t.uid))throw r.delete(u),new Error("You are banned from this alliance.");const m=d.data().alliance;if(m===e)throw new Error("You are already in this alliance.");const p=bp(h);if(h.members.length>=p)throw new Error("This alliance is full.");if(m){const e=eh(Om,"worlds",s,"alliances",m),i=await r.get(e);if(i.exists()){const a=i.data().members.filter(e=>e.uid!==t.uid);r.update(e,{members:a});const o=eh(Jd(Om,"worlds",s,"alliances",m,"events"));r.set(o,{type:"member_left",text:`${n.username} has left the alliance to join ${h.name}.`,timestamp:km()})}}const f=[...h.members,{uid:t.uid,username:n.username,rank:"Member"}];r.update(a,{members:f}),r.update(o,{alliance:e});const g=eh(Jd(Om,"worlds",s,"alliances",e,"events"));r.set(g,{type:"member_joined",text:`${n.username} has joined the alliance.`,timestamp:km()});for(const t of i){const n=eh(Om,"worlds",s,"citySlots",t);r.update(n,{alliance:e,allianceName:h.name})}r.delete(u)}),fp()}catch(d){console.error("Error accepting invitation:",d),alert(`Failed to join alliance: ${d.message}`)}},declineAllianceInvitation:async e=>{if(!t||!s)throw new Error("User or world not identified.");const n=Bh(Jd(Om,"worlds",s,"alliances",e,"invitations"),qh("invitedUserId","==",t.uid)),r=await cm(n);if(r.empty)throw new Error("Invitation not found. It may have been revoked or already handled.");const i=r.docs[0].ref;await hm(i)},handleApplication:async(n,r,i)=>{var a;if(!e)throw new Error("You don't have permission to do this.");const o=e.members.find(e=>e.uid===t.uid),l=e.ranks.find(e=>e.id===(null===o||void 0===o?void 0:o.rank));if(null===l||void 0===l||null===(a=l.permissions)||void 0===a||!a.inviteMembers)throw new Error("You don't have permission to do this.");const c=eh(Om,"worlds",s,"alliances",r),u=eh(Om,`users/${n.userId}/games`,s),d=Jd(Om,`users/${n.userId}/games`,s,"cities"),h=(await cm(d)).docs.map(e=>e.data().slotId);await wm(Om,async e=>{var t;const a=await e.get(c),o=await e.get(u);if(!a.exists())throw new Error("Alliance data not found.");const l=a.data(),d=null===(t=l.applications)||void 0===t?void 0:t.find(e=>e.userId===n.userId);if(d&&(e.update(c,{applications:jm(d)}),"accept"===i)){var m;if(null!==(m=l.banned)&&void 0!==m&&m.some(e=>e.uid===n.userId))throw new Error("This player is banned from your alliance.");if(!o.exists())throw new Error("Applicant's game data not found.");if(o.data().alliance)throw new Error("This player has already joined another alliance.");const t=bp(l);if(l.members.length>=t)throw new Error("This alliance is full and cannot accept new members.");e.update(c,{members:Nm({uid:n.userId,username:n.username,rank:"Member"})}),e.update(u,{alliance:r});for(const n of h){const t=eh(Om,"worlds",s,"citySlots",n);e.update(t,{alliance:r,allianceName:l.name})}}}),"accept"===i&&fp()},kickAllianceMember:async r=>{if(!e)throw new Error("You are not in an alliance.");const i=e.members.find(e=>e.uid===r);if(!i)throw new Error("Member not found.");if(r===t.uid)throw new Error("You cannot kick yourself.");if(r===e.leader.uid)throw new Error("You cannot kick the leader.");const a=eh(Om,"worlds",s,"alliances",e.id),o=eh(Om,`users/${r}/games`,s),l=Jd(Om,`users/${r}/games`,s,"cities"),c=(await cm(l)).docs.map(e=>e.data().slotId);await wm(Om,async e=>{e.update(a,{members:jm(i)}),e.update(o,{alliance:null});for(const t of c){const n=eh(Om,"worlds",s,"citySlots",t);e.update(n,{alliance:null,allianceName:null})}});const u=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(u,{type:"member_kicked",text:`${n.username} has kicked ${i.username} from the alliance.`,timestamp:km()});const d=`You have been kicked from the alliance "${e.name}" by ${n.username}.`;await hp(r,i.username,d,s),fp()},banAllianceMember:async r=>{if(!e)throw new Error("You are not in an alliance.");const i=e.members.find(e=>e.uid===r);if(!i)throw new Error("Member not found.");if(r===t.uid)throw new Error("You cannot ban yourself.");if(r===e.leader.uid)throw new Error("You cannot ban the leader.");const a=eh(Om,"worlds",s,"alliances",e.id),o=eh(Om,`users/${r}/games`,s),l=Jd(Om,`users/${r}/games`,s,"cities"),c=(await cm(l)).docs.map(e=>e.data().slotId);await wm(Om,async e=>{e.update(a,{members:jm(i),banned:Nm({uid:i.uid,username:i.username})}),e.update(o,{alliance:null});for(const t of c){const n=eh(Om,"worlds",s,"citySlots",t);e.update(n,{alliance:null,allianceName:null})}});const u=Jd(Om,"worlds",s,"alliances",e.id,"events");await mm(u,{type:"member_banned",text:`${n.username} has banned ${i.username} from the alliance.`,timestamp:km()});const d=`You have been banned from the alliance "${e.name}" by ${n.username}.`;await hp(r,i.username,d,s),fp()},createAllianceRank:async n=>{if(!e||e.leader.uid!==t.uid)return;const r=eh(Om,"worlds",s,"alliances",e.id),i=[...e.ranks,n];await dm(r,{ranks:i})},updateAllianceMemberRank:async(n,r)=>{if(!e||e.leader.uid!==t.uid)return;const i=eh(Om,"worlds",s,"alliances",e.id),a=e.members.map(e=>e.uid===n?{...e,rank:r}:e);await dm(i,{members:a})},updateRanksOrder:async n=>{if(!e||e.leader.uid!==t.uid)throw new Error("You don't have permission to do this.");const r=eh(Om,"worlds",s,"alliances",e.id);await dm(r,{ranks:n})},updateAllianceRank:async(n,r)=>{if(!e||e.leader.uid!==t.uid)throw new Error("You don't have permission to do this.");const i=eh(Om,"worlds",s,"alliances",e.id),a=e.ranks.map(e=>e.id===n?{...e,...r,id:r.name,name:r.name}:e),o=e.members.map(e=>e.rank===n?{...e,rank:r.name}:e);await dm(i,{ranks:a,members:o})},deleteAllianceRank:async n=>{if(!e||e.leader.uid!==t.uid)throw new Error("You don't have permission to do this.");const r=eh(Om,"worlds",s,"alliances",e.id);if(e.members.some(e=>e.rank===n))throw new Error("Cannot delete rank as it is still assigned to members.");const i=e.ranks.filter(e=>e.id!==n);await dm(r,{ranks:i})}}})(i),d=(e=>{const{currentUser:t,userProfile:n}=Fm(),{worldId:s,gameState:r}=up();return{donateToAllianceResearch:async(n,i)=>{if(!e)return void alert("You are not in an alliance.");const a=eh(Om,`users/${t.uid}/games`,s,"cities",r.id),o=eh(Om,"worlds",s,"alliances",e.id),l=Jd(o,"events");try{await wm(Om,async e=>{const t=await e.get(a),s=await e.get(o);if(!t.exists()||!s.exists())throw new Error("City or Alliance data not found.");const r=t.data(),c=s.data();for(const n in i)if((r.resources[n]||0)<i[n])throw new Error(`Not enough ${n}.`);const u=mp[n],d=c.research[n]||{level:0,progress:{wood:0,stone:0,silver:0}},h={...r.resources},m={...d.progress};for(const n in i)h[n]-=i[n],m[n]=(m[n]||0)+i[n];e.update(a,{resources:h});const p=Math.floor(u.baseCost.wood*Math.pow(u.costMultiplier,d.level)),f=Math.floor(u.baseCost.stone*Math.pow(u.costMultiplier,d.level)),g=Math.floor(u.baseCost.silver*Math.pow(u.costMultiplier,d.level));if(m.wood>=p&&m.stone>=f&&m.silver>=g){const t=d.level+1,s={wood:m.wood-p,stone:m.stone-f,silver:m.silver-g};e.update(o,{[`research.${n}`]:{level:t,progress:s}}),e.set(eh(l),{type:"research_completed",text:`The alliance has completed ${u.name} Level ${t}!`,timestamp:km()})}else e.update(o,{[`research.${n}.progress`]:m})}),alert("Donation successful!")}catch(c){alert(`Donation failed: ${c.message}`),console.error("Donation error:",c)}},recommendAllianceResearch:async r=>{if(!e||!t||!n)return;const i=e.members.find(e=>e.uid===t.uid);if(!i)throw new Error("You are not a member of this alliance.");const a=e.ranks.find(e=>e.id===i.rank);if(!a||!a.permissions.recommendResearch)throw new Error("You do not have permission to recommend research.");const o=eh(Om,"worlds",s,"alliances",e.id),l=Jd(o,"events");try{await wm(Om,async e=>{var t;e.update(o,{recommendedResearch:r});const s=(null===(t=mp[r])||void 0===t?void 0:t.name)||"a research";e.set(eh(l),{type:"research_recommendation",text:`${n.username} has recommended focusing on ${s}.`,timestamp:km()})})}catch(c){throw console.error("Error recommending research:",c),c}}}})(i),h={playerAlliance:i,...o,...l,...c,...u,...d,...wp(i)};return(0,Lm.jsx)(rp.Provider,{value:h,children:n})};var Np=n(3925);const jp=t=>{let{message:n,onClose:s}=t;const[r,i]=(0,e.useState)(!0),a=(0,e.useCallback)(()=>{i(!1),setTimeout(()=>{s()},400)},[s]);return(0,e.useEffect)(()=>{const e=setTimeout(()=>{a()},5e3);return()=>clearTimeout(e)},[a]),(0,Lm.jsxs)("div",{className:"notification-container "+(r?"show":""),children:[(0,Lm.jsx)("div",{className:"notification-icon-container",children:(0,Lm.jsx)("img",{src:Np,alt:"Notification Icon",className:"notification-icon"})}),(0,Lm.jsx)("div",{className:"notification-content",children:(0,Lm.jsx)("p",{children:n})}),(0,Lm.jsx)("button",{onClick:a,className:"notification-close-btn",children:"\xd7"})]})},Cp=t=>{let{children:n}=t;const[s,r]=(0,e.useState)([]),i=(0,e.useRef)(new Set),a=(0,e.useCallback)(e=>{if(i.current.has(e))return;const t=tp();r(n=>[...n,{id:t,message:e}]),i.current.add(e),setTimeout(()=>{i.current.delete(e)},2e3)},[]),o=(0,e.useCallback)(e=>{r(t=>t.filter(t=>t.id!==e))},[]);return(0,Lm.jsxs)(Bm.Provider,{value:{addNotification:a},children:[n,(0,Lm.jsx)("div",{className:"fixed bottom-5 right-5 z-[100]",children:s.map(e=>(0,Lm.jsx)(jp,{message:e.message,onClose:()=>o(e.id)},e.id))})]})},Sp=e=>{let{message:t,title:n,children:s,onClose:r}=e;return t||n||s?(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",onClick:r,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600",onClick:e=>e.stopPropagation(),children:[n&&(0,Lm.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center text-yellow-400",children:n}),t&&(0,Lm.jsx)("p",{className:"mb-4 text-lg text-gray-300",children:t}),s," ",(0,Lm.jsx)("button",{onClick:r,className:"btn btn-primary px-6 py-2 mt-4",children:"Close"})]})}):null},_p=e=>(0,Lm.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,Lm.jsx)("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),(0,Lm.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}),Tp=e=>(0,Lm.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,Lm.jsx)("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),(0,Lm.jsx)("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),(0,Lm.jsx)("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),(0,Lm.jsx)("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}),Ip=()=>{const[t,n]=(0,e.useState)(!1),[s,r]=(0,e.useState)(!1),[i,a]=(0,e.useState)(""),[o,l]=(0,e.useState)(""),[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)(""),[f,g]=(0,e.useState)(""),[v,y]=(0,e.useState)(""),x=()=>r(!s);return(0,Lm.jsxs)("div",{className:"w-full min-h-screen flex items-center justify-center p-4 perspective auth-screen-container",children:[(0,Lm.jsx)(Sp,{message:i,onClose:()=>a("")}),(0,Lm.jsxs)("div",{className:"auth-card "+(t?"flipped":""),children:[(0,Lm.jsx)("div",{className:"auth-card-face auth-card-front",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md",children:[(0,Lm.jsx)("h1",{className:"font-title text-4xl text-center text-gray-300 mb-8",children:"Age of Nasos"}),(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-center text-white mb-6",children:"Login"}),(0,Lm.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),a("");try{await function(e,t,n){return Ue(e.app)?Promise.reject(ht(e)):Zn(T(e),$n.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&es(e),t})}(Dm,o,c)}catch(t){a("Failed to login. Please check your email and password."),console.error(t)}},children:[(0,Lm.jsxs)("div",{className:"mb-4",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Email"}),(0,Lm.jsx)("input",{type:"email",value:o,onChange:e=>l(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Lm.jsxs)("div",{className:"mb-6 relative",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Password"}),(0,Lm.jsx)("input",{type:s?"text":"password",value:c,onChange:e=>u(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,Lm.jsx)("button",{type:"button",onClick:x,className:"absolute right-3 top-10 text-gray-400 hover:text-white",children:s?(0,Lm.jsx)(Tp,{}):(0,Lm.jsx)(_p,{})})]}),(0,Lm.jsx)("button",{type:"submit",className:"w-full btn btn-primary font-bold py-3 rounded-lg",children:"Enter the Realm"})]}),(0,Lm.jsxs)("p",{className:"text-center text-gray-400 mt-6",children:["Don't have an account? ",(0,Lm.jsx)("button",{onClick:()=>n(!0),className:"text-blue-400 hover:underline",children:"Register here"})]})]})}),(0,Lm.jsx)("div",{className:"auth-card-face auth-card-back",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md",children:[(0,Lm.jsx)("h1",{className:"font-title text-4xl text-center text-gray-300 mb-8",children:"Age of Nasos"}),(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-center text-white mb-6",children:"Register"}),(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d&&m&&f&&v?f!==v?(a("Passwords do not match."),0):f.length<6?(a("Password must be at least 6 characters long."),0):!(d.length<3)||(a("Username must be at least 3 characters long."),0):(a("All fields are required."),0)){a("");try{const e=await async function(e,t,n){if(Ue(e.app))return Promise.reject(ht(e));const s=yn(e),r=Cn(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Wn),i=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&es(e),t}),a=await Hn._fromIdTokenResponse(s,"signIn",i);return await s._updateCurrentUser(a.user),a}(Dm,m,f),t=e.user;await um(eh(Om,"users",t.uid),{username:d,email:t.email,is_admin:!1})}catch(t){"auth/email-already-in-use"===t.code?a("An account with this email already exists."):a(t.message),console.error(t)}}},children:[(0,Lm.jsxs)("div",{className:"mb-4",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Username"}),(0,Lm.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Lm.jsxs)("div",{className:"mb-4",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Email"}),(0,Lm.jsx)("input",{type:"email",value:m,onChange:e=>p(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Lm.jsxs)("div",{className:"mb-4 relative",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Password"}),(0,Lm.jsx)("input",{type:s?"text":"password",value:f,onChange:e=>g(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,Lm.jsx)("button",{type:"button",onClick:x,className:"absolute right-3 top-10 text-gray-400 hover:text-white",children:s?(0,Lm.jsx)(Tp,{}):(0,Lm.jsx)(_p,{})})]}),(0,Lm.jsxs)("div",{className:"mb-6",children:[(0,Lm.jsx)("label",{className:"block text-gray-400 mb-2",children:"Confirm Password"}),(0,Lm.jsx)("input",{type:s?"text":"password",value:v,onChange:e=>y(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Lm.jsx)("button",{type:"submit",className:"w-full btn btn-primary font-bold py-3 rounded-lg",children:"Forge Your Empire"})]}),(0,Lm.jsxs)("p",{className:"text-center text-gray-400 mt-6",children:["Already have an account? ",(0,Lm.jsx)("button",{onClick:()=>n(!1),className:"text-blue-400 hover:underline",children:"Login here"})]})]})})]})]})},Ep=t=>{let{onCheat:n,onClose:s,InstantBuildActive:r}=t;const[i,a]=(0,e.useState)({wood:0,stone:0,silver:0}),[o,l]=(0,e.useState)({unit:"swordsman",amount:0}),[c,u]=(0,e.useState)(0),{isInstantBuild:d,setIsInstantBuild:h,isInstantResearch:m,setIsInstantResearch:p,isInstantUnits:f,setIsInstantUnits:g}=up(),[v,y]=(0,e.useState)(""),[x,b]=(0,e.useState)(0),[w,k]=(0,e.useState)(0);return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border-2 border-gray-600",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl text-white mb-4",children:"Admin Cheats"}),(0,Lm.jsxs)("div",{className:"space-y-4",children:[Object.keys(i).map(e=>(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{className:"text-white capitalize",children:e}),(0,Lm.jsx)("input",{type:"number",value:i[e],onChange:t=>a(n=>({...n,[e]:parseInt(t.target.value,10)||0})),className:"bg-gray-700 text-white rounded p-2 w-32"})]},e)),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{className:"text-white capitalize",children:"Add Troops"}),(0,Lm.jsx)("select",{value:o.unit,onChange:e=>l(t=>({...t,unit:e.target.value})),className:"bg-gray-700 text-white rounded p-2 w-32",children:Object.keys(qm).map(e=>(0,Lm.jsx)("option",{value:e,children:qm[e].name},e))}),(0,Lm.jsx)("input",{type:"number",value:o.amount,onChange:e=>l(t=>({...t,amount:parseInt(e.target.value,10)||0})),className:"bg-gray-700 text-white rounded p-2 w-24"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{className:"text-white capitalize",children:"Set Warehouse Level"}),(0,Lm.jsx)("input",{type:"number",min:"1",value:c,onChange:e=>u(parseInt(e.target.value,10)||0),className:"bg-gray-700 text-white rounded p-2 w-32"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{className:"text-white capitalize",children:"Set Farm Level"}),(0,Lm.jsx)("input",{type:"number",min:"1",value:w,onChange:e=>k(parseInt(e.target.value,10)||0),className:"bg-gray-700 text-white rounded p-2 w-32"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-600",children:[(0,Lm.jsx)("label",{htmlFor:"unresearch",className:"text-white",children:"Unresearch:"}),(0,Lm.jsxs)("select",{id:"unresearch",value:v,onChange:e=>y(e.target.value),className:"bg-gray-700 text-white rounded p-2 w-40",children:[(0,Lm.jsx)("option",{value:"",children:"Select Research"}),Object.keys(Wm).map(e=>(0,Lm.jsx)("option",{value:e,children:Wm[e].name},e))]})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{htmlFor:"addFavor",className:"text-white",children:"Add Favor:"}),(0,Lm.jsx)("input",{id:"addFavor",type:"number",value:x,onChange:e=>b(parseInt(e.target.value,10)||0),className:"bg-gray-700 text-white rounded p-2 w-32"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-600",children:[(0,Lm.jsx)("label",{htmlFor:"isInstantBuild",className:"text-white capitalize",children:"1-Second Builds"}),(0,Lm.jsx)("input",{id:"isInstantBuild",type:"checkbox",checked:d,onChange:e=>h(e.target.checked),className:"w-6 h-6 rounded"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{htmlFor:"isInstantResearch",className:"text-white capitalize",children:"1-Second Research"}),(0,Lm.jsx)("input",{id:"isInstantResearch",type:"checkbox",checked:m,onChange:e=>p(e.target.checked),className:"w-6 h-6 rounded"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("label",{htmlFor:"isInstantUnits",className:"text-white capitalize",children:"1-Second Units"}),(0,Lm.jsx)("input",{id:"isInstantUnits",type:"checkbox",checked:f,onChange:e=>g(e.target.checked),className:"w-6 h-6 rounded"})]})]}),(0,Lm.jsx)("button",{onClick:()=>{n({},{},0,!1,"",!1,!1,0,!0),s()},className:"btn btn-primary w-full py-2 mt-4 bg-yellow-600 hover:bg-yellow-500",children:"Found Second City"}),(0,Lm.jsx)("button",{onClick:()=>{n(i,o,w,c,d,v,m,f,x,!1),s()},className:"btn btn-primary w-full py-2 mt-2",children:"Apply Cheats"}),(0,Lm.jsx)("button",{onClick:()=>{n({},{},0,!1,"",!1,!1,0,!1,!0),s()},className:"btn btn-secondary w-full py-2 mt-2 bg-blue-600 hover:bg-blue-500",children:"Force Refresh Data"})]})})},Ap={},Pp=n(3542);Pp.keys().forEach(e=>{const t=e.replace("./","");Ap[t]=Pp(e)});const Mp=e=>{e<0&&(e=0);return`${Math.floor(e/3600).toString().padStart(2,"0")}:${Math.floor(e%3600/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`},Dp=t=>{let{item:n,onCancel:s,isFirst:r,isLast:i,onHover:a,onLeave:o}=t;const[l,c]=(0,e.useState)(0),u=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(!r)return;let e;const t=()=>{const t=n.endTime instanceof Date?n.endTime:new Date(n.endTime);if(isNaN(t.getTime()))return void c(0);const s=Math.max(0,(t.getTime()-Date.now())/1e3);c(s),s<=0&&clearInterval(e)};return t(),e=setInterval(t,1e3),()=>clearInterval(e)},[n.endTime,r]);const d=qm[n.unitId];if(!d)return null;const h=Ap[d.image];return(0,Lm.jsxs)("div",{ref:u,className:"relative w-16 h-16 bg-gray-700 border-2 border-gray-600 rounded-md flex-shrink-0",title:`${n.amount}x ${d.name}`,onMouseEnter:()=>a(n,u.current),onMouseLeave:o,children:[(0,Lm.jsx)("img",{src:h,alt:d.name,className:"w-full h-full object-contain p-1"}),(0,Lm.jsx)("span",{className:"absolute bottom-0 right-1 text-white bg-black bg-opacity-75 px-1.5 py-0.5 text-xs font-bold rounded-tl-md rounded-br-md",children:n.amount}),r&&(0,Lm.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-white text-xs text-center py-0.5 font-mono",children:Mp(l)}),i&&(0,Lm.jsx)("button",{onClick:()=>s(n),className:"absolute -top-2 -right-2 w-5 h-5 flex items-center justify-center bg-red-600 text-white rounded-full font-bold text-xs hover:bg-red-500 transition-colors z-10",title:"Cancel",children:"\xd7"})]})},Op=t=>{let{unitQueue:n,onCancel:s,title:r="In Training"}=t;const[i,a]=(0,e.useState)(null),[o,l]=(0,e.useState)({display:"none"}),c=(0,e.useRef)(null),u=(0,e.useRef)(null),d=(e,t)=>{if(clearTimeout(c.current),t&&u.current){const n=u.current.getBoundingClientRect(),s=t.getBoundingClientRect();l({position:"absolute",bottom:`${n.height}px`,left:s.left-n.left+s.width/2+"px",transform:"translateX(-50%)",marginBottom:"8px"}),a(e)}},h=()=>{c.current=setTimeout(()=>{a(null)},200)},m=n&&n.length>0?n[n.length-1].endTime:null;return n&&0!==n.length?(0,Lm.jsxs)("div",{className:"mt-auto pt-4 relative",ref:u,children:[(0,Lm.jsxs)("h4",{className:"text-lg font-semibold text-yellow-400 mb-2",children:[r," (",n.length,"/5)"]}),(0,Lm.jsx)("div",{className:"flex space-x-3 bg-gray-900 p-2 rounded-lg overflow-x-auto h-24 items-center",children:n.map((e,t)=>(0,Lm.jsx)(Dp,{item:e,onCancel:s,isFirst:0===t,isLast:t===n.length-1,onHover:d,onLeave:h},e.id||`${e.unitId}-${t}`))}),(()=>{if(!i)return null;const e=qm[i.unitId],t=m?new Date(m).toLocaleTimeString():"Queued";return(0,Lm.jsxs)("div",{className:"unit-queue-tooltip",style:o,children:[(0,Lm.jsxs)("h3",{className:"unit-tooltip-title",children:[i.amount,"x ",e.name]}),(0,Lm.jsxs)("dl",{className:"unit-tooltip-info",children:[(0,Lm.jsx)("dt",{children:"Time per unit:"}),(0,Lm.jsx)("dd",{children:Mp(e.cost.time)}),(0,Lm.jsx)("dt",{children:"Queue Completion:"}),(0,Lm.jsx)("dd",{children:t})]})]})})()]}):(0,Lm.jsxs)("div",{className:"mt-auto pt-4",children:[(0,Lm.jsxs)("h4",{className:"text-lg font-semibold text-yellow-400 mb-2",children:[r," (0/5)"]}),(0,Lm.jsx)("div",{className:"flex space-x-3 bg-gray-900 p-2 rounded-lg h-24 items-center justify-center",children:(0,Lm.jsx)("p",{className:"text-gray-500",children:"Queue is empty."})})]})},Rp={Athenian:{swordsman:"swordsman_athenian",archer:"archer_athenian",hoplite:"hoplite_athenian",cavalry:"cavalry_athenian",trireme:"trireme_athenian"},Spartan:{swordsman:"swordsman_spartan",archer:"archer_spartan",hoplite:"hoplite_spartan",cavalry:"cavalry_spartan",trireme:"trireme_spartan"},Corinthian:{swordsman:"swordsman_corinthian",archer:"archer_corinthian",hoplite:"hoplite_corinthian",cavalry:"cavalry_corinthian",trireme:"trireme_corinthian"},Julian:{swordsman:"swordsman_roman",archer:"archer_roman",hoplite:"hoplite_roman",cavalry:"cavalry_roman",trireme:"trireme_roman"},Cornelian:{swordsman:"swordsman_roman",archer:"archer_roman",hoplite:"hoplite_roman",cavalry:"cavalry_roman",trireme:"trireme_roman"},Fabian:{swordsman:"swordsman_roman",archer:"archer_roman",hoplite:"hoplite_roman",cavalry:"cavalry_roman",trireme:"trireme_roman"}},Lp=(e,t)=>{var n;let s=e;["Julian","Cornelian","Fabian"].includes(e)&&(s="Julian");const r=t.replace("generic_","");return(null===(n=Rp[s])||void 0===n?void 0:n[r])||r},$p=e=>{const t=Object.keys(qm).filter(t=>{const n=qm[t];return!(!n.nation||"land"!==n.type)&&(["Julian","Cornelian","Fabian"].includes(e)?"Julian"===n.nation:n.nation===e)});return t},Fp=e=>{const t=Object.keys(qm).filter(t=>{const n=qm[t];return!(!n.nation||"naval"!==n.type)&&(["Julian","Cornelian","Fabian"].includes(e)?"Julian"===n.nation:n.nation===e)}),n=Object.keys(qm).filter(e=>{const t=qm[e];return!t.nation&&!t.mythical&&"naval"===t.type});return[...new Set([...t,...n])]},Up={},Vp=n(3542);Vp.keys().forEach(e=>{const t=e.replace("./","");Up[t]=Vp(e)});const Bp=e=>{let{unit:t}=e;return(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-2",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-3",children:"Unit Information"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.attack})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.defense})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udc0e Speed"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.speed})]})]})},zp=t=>{let{resources:n,availablePopulation:s,onTrain:r,onFire:i,onClose:a,cityGameState:o,unitQueue:l,onCancelTrain:c}=t;const[u,d]=(0,e.useState)("train"),h=(0,e.useMemo)(()=>$p(o.playerInfo.nation),[o.playerInfo.nation]),[m,p]=(0,e.useState)(h[0]||null),[f,g]=(0,e.useState)(""),[v,y]=(0,e.useState)({});(0,e.useEffect)(()=>{g("")},[m]);const x=(null===o||void 0===o?void 0:o.units)||{};if(0===h.length)return(0,Lm.jsx)(Sp,{message:"Your nation has no specific land units that can be trained in the Barracks.",onClose:a});const b=m?qm[m]:null,w=(l||[]).filter(e=>{var t,n;return"land"===(null===(t=qm[e.unitId])||void 0===t?void 0:t.type)&&!(null!==(n=qm[e.unitId])&&void 0!==n&&n.mythical)}),k=parseInt(f,10)||0,N={wood:b?b.cost.wood*k:0,stone:b?b.cost.stone*k:0,silver:b?b.cost.silver*k:0,population:b?b.cost.population*k:0},j=n.wood>=N.wood&&n.stone>=N.stone&&n.silver>=N.silver&&s>=N.population;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:a,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"font-title text-3xl text-white",children:"Barracks"}),(0,Lm.jsx)("button",{onClick:a,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"flex border-b border-gray-700 mb-4",children:[(0,Lm.jsx)("button",{onClick:()=>d("train"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("train"===u?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Train"}),(0,Lm.jsx)("button",{onClick:()=>d("fire"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("fire"===u?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Dismiss"})]}),"train"===u&&b&&(0,Lm.jsxs)("div",{className:"flex-grow flex gap-4 overflow-y-auto",children:[(0,Lm.jsx)("div",{className:"w-1/3 flex flex-col gap-2",children:h.map(e=>{const t=qm[e],n=m===e;return(0,Lm.jsxs)("button",{onClick:()=>p(e),className:"flex items-center p-2 rounded border-2 transition-colors w-full "+(n?"bg-gray-600 border-yellow-500":"bg-gray-700 border-gray-600 hover:border-yellow-400"),children:[(0,Lm.jsx)("img",{src:Up[t.image],alt:t.name,className:"w-12 h-12 mr-3 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-left text-white",children:t.name}),(0,Lm.jsxs)("p",{className:"text-sm text-left text-gray-400",children:["In City: ",x[e]||0]})]})]},e)})}),(0,Lm.jsxs)("div",{className:"w-2/3 flex flex-col gap-4",children:[(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Lm.jsx)("h4",{className:"font-title text-2xl text-yellow-400",children:b.name}),(0,Lm.jsx)("p",{className:"text-gray-400 italic mt-1",children:b.description})]}),(0,Lm.jsxs)("div",{className:"flex gap-4",children:[(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-1",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-2",children:"Cost (Total)"}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Wood: ",b.cost.wood," (",N.wood,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Stone: ",b.cost.stone," (",N.stone,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Silver: ",b.cost.silver," (",N.silver,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Population: ",b.cost.population," (",N.population,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Time per unit: ",b.cost.time,"s"]})]}),(0,Lm.jsx)(Bp,{unit:b})]}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg flex items-center justify-between",children:[(0,Lm.jsx)("input",{type:"number",value:f,onChange:e=>{const t=e.target.value;(""===t||parseInt(t)>=0&&!t.includes("."))&&g(t)},className:"bg-gray-800 text-white rounded p-2 w-24",placeholder:"0"}),(0,Lm.jsx)("button",{onClick:()=>{const e=parseInt(f,10)||0;e>0&&r(m,e)},disabled:!j||0===k||(w||[]).length>=5,className:"py-2 px-6 text-lg rounded-lg btn "+(j&&k>0&&(w||[]).length<5?"btn-confirm":"btn-disabled"),children:(w||[]).length>=5?"Queue Full":"Train"})]})]})]}),"fire"===u&&(0,Lm.jsxs)("div",{className:"flex-grow overflow-y-auto pr-2",children:[(0,Lm.jsx)("h4",{className:"text-xl font-semibold text-yellow-400 mb-2",children:"Dismiss Units"}),Object.keys(x).filter(e=>"land"===qm[e].type).length>0?(0,Lm.jsxs)("div",{className:"space-y-3",children:[Object.entries(x).filter(e=>{let[t]=e;return"land"===qm[t].type}).map(e=>{let[t,n]=e;const s=qm[t];return(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg flex items-center justify-between",children:[(0,Lm.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Lm.jsx)("img",{src:Up[s.image],alt:s.name,className:"w-12 h-12 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-white",children:s.name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-400",children:["In City: ",n]})]})]}),(0,Lm.jsx)("input",{type:"number",value:v[t]||"",onChange:e=>((e,t)=>{const n=x[e]||0,s=Math.max(0,Math.min(n,parseInt(t,10)||0));y(t=>({...t,[e]:s}))})(t,e.target.value),className:"bg-gray-800 text-white rounded p-2 w-24 text-center",placeholder:"Amount",max:n,min:"0"})]},t)}),(0,Lm.jsx)("div",{className:"flex justify-end mt-4",children:(0,Lm.jsx)("button",{onClick:()=>{const e=Object.entries(v).filter(e=>{let[,t]=e;return t>0});e.length>0&&("function"===typeof i?(i(Object.fromEntries(e)),y({})):console.error("BarracksMenu Error: onFire prop is not a function. It was not passed from the parent component."))},disabled:0===Object.values(v).reduce((e,t)=>e+t,0),className:"btn btn-danger py-2 px-6",children:"Dismiss Selected"})})]}):(0,Lm.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No land units in the city to dismiss."})]}),(0,Lm.jsx)(Op,{unitQueue:w,onCancel:e=>c(e,"barracks"),title:"Land Unit Queue"})]})})},qp={},Wp=n(3542);Wp.keys().forEach(e=>{const t=e.replace("./","");qp[t]=Wp(e)});const Hp=e=>{let{unit:t}=e;return(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-2",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-3",children:"Unit Information"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.attack})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.defense})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\u26f5 Speed"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.speed})]}),t.capacity>0&&(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udce6 Capacity"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.capacity})]})]})},Gp=t=>{let{resources:n,availablePopulation:s,onTrain:r,onClose:i,cityGameState:a,unitQueue:o,onCancelTrain:l}=t;const c=(0,e.useMemo)(()=>Fp(a.playerInfo.nation),[a.playerInfo.nation]),[u,d]=(0,e.useState)(c[0]||null),[h,m]=(0,e.useState)("");if((0,e.useEffect)(()=>{m("")},[u]),!u)return(0,Lm.jsx)(Sp,{message:"No naval units available to build.",onClose:i});const p=qm[u],f=(null===a||void 0===a?void 0:a.units)||{},g=(o||[]).filter(e=>{var t;return"naval"===(null===(t=qm[e.unitId])||void 0===t?void 0:t.type)}),v=parseInt(h,10)||0,y={wood:p.cost.wood*v,stone:p.cost.stone*v,silver:p.cost.silver*v,population:p.cost.population*v},x=n.wood>=y.wood&&n.stone>=y.stone&&n.silver>=y.silver&&s>=y.population;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:i,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"font-title text-3xl text-white",children:"Shipyard"}),(0,Lm.jsx)("button",{onClick:i,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"flex-grow flex gap-4 overflow-y-auto",children:[(0,Lm.jsx)("div",{className:"w-1/3 flex flex-col gap-2",children:c.map(e=>{const t=qm[e],n=u===e;return(0,Lm.jsxs)("button",{onClick:()=>d(e),className:"flex items-center p-2 rounded border-2 transition-colors w-full "+(n?"bg-gray-600 border-yellow-500":"bg-gray-700 border-gray-600 hover:border-yellow-400"),children:[(0,Lm.jsx)("img",{src:qp[t.image],alt:t.name,className:"w-12 h-12 mr-3 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-left text-white",children:t.name}),(0,Lm.jsxs)("p",{className:"text-sm text-left text-gray-400",children:["In City: ",f[e]||0]})]})]},e)})}),(0,Lm.jsxs)("div",{className:"w-2/3 flex flex-col gap-4",children:[(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Lm.jsx)("h4",{className:"font-title text-2xl text-yellow-400",children:p.name}),(0,Lm.jsx)("p",{className:"text-gray-400 italic mt-1",children:p.description})]}),(0,Lm.jsxs)("div",{className:"flex gap-4",children:[(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-1",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-2",children:"Cost (Total)"}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Wood: ",p.cost.wood," (",y.wood,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Stone: ",p.cost.stone," (",y.stone,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Silver: ",p.cost.silver," (",y.silver,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Population: ",p.cost.population," (",y.population,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Time per unit: ",p.cost.time,"s"]})]}),(0,Lm.jsx)(Hp,{unit:p})]}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg flex items-center justify-between",children:[(0,Lm.jsx)("input",{type:"number",value:h,onChange:e=>{const t=e.target.value;(""===t||parseInt(t)>=0&&!t.includes("."))&&m(t)},className:"bg-gray-800 text-white rounded p-2 w-24",placeholder:"0"}),(0,Lm.jsx)("button",{onClick:()=>{const e=parseInt(h,10)||0;e>0&&r(u,e)},disabled:!x||0===v||(g||[]).length>=5,className:"py-2 px-6 text-lg rounded-lg btn "+(x&&v>0&&(g||[]).length<5?"btn-confirm":"btn-disabled"),children:(g||[]).length>=5?"Queue Full":"Build"})]})]})]}),(0,Lm.jsx)(Op,{unitQueue:g,onCancel:e=>l(e,"shipyard"),title:"Naval Unit Queue"})]})})},Qp=e=>{let{buildingId:t,buildingData:n,onClose:s,getProductionRates:r,getWarehouseCapacity:i,getFarmCapacity:a,onOpenBarracks:o,onOpenShipyard:l,onAddWorker:c,onRemoveWorker:u,availablePopulation:d,getMaxWorkerSlots:h,onOpenMarket:m}=e;const p=zm[t];if(!p)return null;const f=n.level+1,g=["timber_camp","quarry","silver_mine"].includes(t),v=n.workers||0,y=g?h(n.level):0,x=e=>"timber_camp"===e?"wood":"quarry"===e?"stone":"silver_mine"===e?"silver":"";return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border-2 border-gray-600",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"font-title text-3xl text-white",children:p.name}),(0,Lm.jsxs)("p",{className:"text-yellow-300 font-bold text-lg",children:["Level ",n.level]})]}),(0,Lm.jsx)("button",{onClick:s,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsx)("p",{className:"text-gray-400 mt-2 mb-6",children:p.description}),g&&(0,Lm.jsxs)("div",{className:"text-sm space-y-1 mb-6 text-gray-300",children:[(0,Lm.jsx)("p",{className:"font-semibold text-lg",children:"Production (per hour):"}),(0,Lm.jsxs)("p",{children:["Current: ",r({[t]:n})[x(t)].toLocaleString()]}),(0,Lm.jsxs)("p",{children:["Next Level: ",r({[t]:{level:f,workers:v}})[x(t)].toLocaleString()]}),(0,Lm.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(0,Lm.jsxs)("h4",{className:"font-semibold text-lg mb-2",children:["Worker Slots (",v,"/",y,")"]}),(0,Lm.jsxs)("div",{className:"flex items-center space-x-2",children:[Array.from({length:y}).map((e,t)=>(0,Lm.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+(t<v?"bg-green-500":"bg-gray-600")},t)),(0,Lm.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,Lm.jsx)("button",{onClick:()=>{d>=20?c(t):console.warn("Not enough available population. Each worker requires 20 population.")},disabled:v>=y||d<20,className:"w-6 h-6 flex items-center justify-center bg-gray-500 hover:bg-gray-400 rounded-md text-white font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"+"}),(0,Lm.jsx)("button",{onClick:()=>u(t),disabled:v<=0,className:"w-6 h-6 flex items-center justify-center bg-red-600 hover:bg-red-500 rounded-md text-white font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"-"})]})]}),(0,Lm.jsx)("p",{className:"text-xs mt-2 text-gray-400",children:"Each worker costs 20 population, boosts production by 10%, and reduces city happiness by 5."})]})]}),"warehouse"===t&&(0,Lm.jsxs)("div",{className:"text-sm space-y-1 mb-6 text-gray-300",children:[(0,Lm.jsx)("p",{className:"font-semibold text-lg",children:"Capacity:"}),(0,Lm.jsxs)("p",{children:["Current: ",i(n.level).toLocaleString()]}),(0,Lm.jsxs)("p",{children:["Next Level: ",i(f).toLocaleString()]})]}),"farm"===t&&(0,Lm.jsxs)("div",{className:"text-sm space-y-1 mb-6 text-gray-300",children:[(0,Lm.jsx)("p",{className:"font-semibold text-lg",children:"Population Capacity:"}),(0,Lm.jsxs)("p",{children:["Current: ",a(n.level).toLocaleString()]}),(0,Lm.jsxs)("p",{children:["Next Level: ",a(f).toLocaleString()]})]}),"barracks"===t&&(0,Lm.jsx)("button",{onClick:o,className:"btn btn-primary w-full py-2",children:"Train Troops"}),"shipyard"===t&&(0,Lm.jsx)("button",{onClick:l,className:"btn btn-primary w-full py-2",children:"Build Naval Units"}),"market"===t&&(0,Lm.jsx)("button",{onClick:m,className:"btn btn-primary w-full py-2",children:"Open Market"})]})})},Yp=JSON.parse('{"great_lighthouse":{"name":"Great Lighthouse","description":"A beacon of hope for your navy, increasing the speed and attack power of all ships.","bonus":{"type":"naval_boost","value":0.1},"image":"great_lighthouse.png"},"colossus":{"name":"Colossus","description":"A towering statue that inspires your armies, increasing the attack power of all land troops.","bonus":{"type":"land_boost","value":0.1},"image":"colossus.png"},"oracle":{"name":"Oracle","description":"A mystical site that attracts powerful mythical creatures to your cause.","bonus":{"type":"mythic_boost","value":0.1},"image":"oracle.png"},"hanging_gardens":{"name":"Hanging Gardens","description":"Lush gardens that boost population growth and city happiness.","bonus":{"type":"population_boost","value":0.1},"image":"hanging_gardens.png"},"merchant_guild":{"name":"Merchant Guild","description":"Establishes powerful trade routes, increasing the speed and capacity of your trades.","bonus":{"type":"trade_boost","value":0.1},"image":"merchant_guild.png"},"library_of_alexandria":{"name":"Library of Alexandria","description":"A center of knowledge that accelerates your research capabilities.","bonus":{"type":"research_boost","value":0.1},"image":"library_of_alexandria.png"},"alliance_wonders":{"name":"Alliance Wonders","description":"A special building only available to alliances that control an entire island.","image":"alliance_wonders.png"}}'),Kp={};[n(326),n(3938)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");Kp[n]=e(t)})});const Xp=e=>{e<0&&(e=0);return`${Math.floor(e/3600).toString().padStart(2,"0")}:${Math.floor(e%3600/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`},Jp=t=>{let{item:n,isFirst:s,onCancel:r,isLast:i,onHover:a,onLeave:o,hoveredItem:l}=t;const[c,u]=(0,e.useState)(0);(0,e.useEffect)(()=>{if(!s)return;const e=()=>{const e=n.endTime instanceof Date?n.endTime:new Date(n.endTime);if(isNaN(e.getTime()))return void u(0);const t=Math.max(0,e.getTime()-Date.now());u(t/1e3)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[n.endTime,s]);const d=n.isSpecial?Yp[n.buildingId]:zm[n.buildingId];if(!d)return null;const h=Kp[d.image],m="demolish"===n.type,p=m?`Demolish ${d.name} to Lvl ${n.level}`:`${d.name} (Level ${n.level})`,f=m?` Lvl ${n.level}`:`^${n.level}`;return(0,Lm.jsxs)("div",{className:"relative w-16 h-16 bg-gray-700 border-2 rounded-md flex-shrink-0 "+(m?"border-red-500":"border-gray-600"),title:p,onMouseEnter:()=>a(n.id),onMouseLeave:o,children:[(0,Lm.jsx)("img",{src:h,alt:d.name,className:"w-full h-full object-contain p-1"}),(0,Lm.jsx)("span",{className:"absolute top-0 right-0 text-black text-xs font-bold px-1 rounded-bl-md z-10 "+(m?"bg-red-500 text-white":"bg-yellow-500"),children:f}),s&&(0,Lm.jsx)("span",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-red-500 text-xs text-center py-0.5 font-mono",children:Xp(c)}),i&&(0,Lm.jsx)("button",{onClick:r,className:"absolute -top-2 -right-2 w-5 h-5 flex items-center justify-center bg-red-600 text-white rounded-full font-bold text-xs hover:bg-red-500 transition-colors z-10",title:"Cancel Construction",children:"\xd7"}),l===n.id&&(0,Lm.jsxs)("div",{className:"unit-tooltip",style:{top:"50%",left:"100%",transform:"translate(10px, -50%)",zIndex:100,width:"200px",pointerEvents:"none"},children:[(0,Lm.jsx)("div",{className:"tooltip-header",children:(0,Lm.jsx)("h3",{className:"tooltip-title",children:d.name})}),(0,Lm.jsx)("div",{className:"tooltip-body",style:{padding:"0.5rem"},children:(0,Lm.jsx)("p",{className:"tooltip-description",style:{fontSize:"0.75rem"},children:d.description})})]})]})},Zp=t=>{let{buildQueue:n,onCancel:s}=t;const[r,i]=(0,e.useState)(null),a=(0,e.useRef)(null),o=Array(Math.max(0,5-((null===n||void 0===n?void 0:n.length)||0))).fill(null),l=e=>{clearTimeout(a.current),i(e)},c=()=>{a.current=setTimeout(()=>{i(null)},200)};return(0,Lm.jsxs)("div",{className:"bg-gray-900 p-2 rounded-lg mb-4 flex items-center gap-3 border border-gray-700",children:[(0,Lm.jsx)("div",{className:"w-16 h-16 bg-gray-700 rounded-lg flex items-center justify-center text-4xl flex-shrink-0",title:"Construction",children:"\ud83d\udd28"}),(0,Lm.jsxs)("div",{className:"flex-grow flex items-center gap-3",children:[n&&n.map((e,t)=>(0,Lm.jsx)(Jp,{item:e,isFirst:0===t,isLast:t===n.length-1,onCancel:()=>s(e),onHover:l,onLeave:c,hoveredItem:r},e.id||`${e.buildingId}-${t}`)),o.map((e,t)=>(0,Lm.jsx)("div",{className:"w-16 h-16 bg-gray-800 border-2 border-dashed border-gray-600 rounded-md flex items-center justify-center flex-shrink-0",children:(0,Lm.jsx)("img",{src:Kp["temple.png"],alt:"Empty Slot",className:"w-10 h-10 opacity-20"})},`empty-${t}`))]})]})},ef={};[n(326),n(3938)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");ef[n]=e(t)})});const tf=e=>{let{message:t,onConfirm:n,onCancel:s}=e;return(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg text-white",children:[(0,Lm.jsx)("p",{className:"mb-4",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,Lm.jsx)("button",{onClick:s,className:"btn btn-secondary",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-danger",children:"Confirm"})]})]})})},nf=e=>{let{buildings:t,onAddWorker:n,onRemoveWorker:s,getMaxWorkerSlots:r,availablePopulation:i}=e;return(0,Lm.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold font-title text-yellow-300 mb-3 text-center",children:"Worker Management"}),(0,Lm.jsx)("div",{className:"space-y-3",children:["timber_camp","quarry","silver_mine"].map(e=>{const a=t[e];if(!a||0===a.level)return null;const o=a.workers||0,l=r(a.level);return(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg flex justify-between items-center",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-semibold text-white",children:zm[e].name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-400",children:["Workers: ",o," / ",l]})]}),(0,Lm.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Lm.jsx)("button",{onClick:()=>s(e),disabled:o<=0,className:"btn btn-danger w-8 h-8 flex items-center justify-center text-lg",children:"-"}),(0,Lm.jsx)("button",{onClick:()=>n(e),disabled:o>=l||i<20,className:"btn btn-confirm w-8 h-8 flex items-center justify-center text-lg",children:"+"})]})]},e)})}),(0,Lm.jsx)("p",{className:"text-xs mt-2 text-gray-400 text-center",children:"Each worker costs 20 population."})]})},sf=e=>{let{presets:t,selectedPresetId:n,setSelectedPresetId:s,handleApplyPreset:r,setIsSavingPreset:i,handleDeletePreset:a}=e;const o=t.find(e=>e.id===n);return(0,Lm.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold font-title text-yellow-300 mb-3 text-center",children:"Worker Presets"}),(0,Lm.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Lm.jsxs)("select",{value:n,onChange:e=>s(e.target.value),className:"bg-gray-700 text-white p-2 rounded w-full",children:[(0,Lm.jsx)("option",{value:"",children:"Select a Preset"}),t.map(e=>(0,Lm.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,Lm.jsx)("button",{onClick:r,disabled:!n,className:"btn btn-primary text-sm py-2 px-3 flex-shrink-0",children:"Apply"}),(0,Lm.jsx)("button",{onClick:()=>i(!0),disabled:t.length>=3,className:"btn btn-primary text-sm py-2 px-3 flex-shrink-0",title:t.length>=3?"Maximum of 3 presets reached":"Save current layout",children:"Save"}),(0,Lm.jsx)("button",{onClick:a,disabled:!n,className:"btn btn-danger text-sm py-2 px-3 flex-shrink-0",children:"Delete"})]}),o&&(0,Lm.jsxs)("div",{className:"mt-4 p-2 bg-gray-800 rounded-lg max-h-48 overflow-y-auto",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-center mb-2",children:"Preset Workers"}),(0,Lm.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm",children:o.workers&&Object.entries(o.workers).sort((e,t)=>{let[n]=e,[s]=t;return zm[n].name.localeCompare(zm[s].name)}).map(e=>{let[t,n]=e;return(0,Lm.jsxs)("div",{className:"flex justify-between",children:[(0,Lm.jsx)("span",{children:zm[t].name}),(0,Lm.jsx)("span",{className:"font-bold",children:n})]},t)})})]})]})},rf=e=>{let t,{id:n,config:s,level:r,finalQueuedLevel:i,cost:a,canAfford:o,onUpgrade:l,isQueueFull:c,isMaxLevel:u}=e;t=0===r&&0===i?"Build":`Expand to ${i+1}`,u&&(t="Max Level");let d="";return u?d="Max Level":c?d="Queue Full":o||(d="Not enough resources/pop"),(0,Lm.jsxs)("div",{className:"bg-gray-700/80 border-2 border-gray-600 rounded-lg p-2 w-48 text-center flex flex-col items-center relative shadow-lg",children:[(0,Lm.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 w-0.5 h-6 bg-gray-500/50"}),(0,Lm.jsx)("h4",{className:"font-bold text-yellow-400 text-base",children:s.name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300 font-semibold",children:["Level ",r," ",i>r?`(-> ${i})`:""]}),(0,Lm.jsx)("img",{src:ef[s.image],alt:s.name,className:"w-20 h-20 object-contain my-1"}),(0,Lm.jsxs)("div",{className:"text-xs text-gray-400 mb-2",children:[(0,Lm.jsxs)("span",{children:[a.wood,"W"]}),", ",(0,Lm.jsxs)("span",{children:[a.stone,"S"]}),", ",(0,Lm.jsxs)("span",{children:[a.silver,"Ag"]}),", ",(0,Lm.jsxs)("span",{children:[a.population,"P"]})]}),(0,Lm.jsx)("button",{onClick:()=>l(n),disabled:!o||c||u,className:"w-full py-1.5 rounded font-bold text-sm transition-colors "+(!o||c||u?"btn-disabled":"btn-upgrade"),children:d||t})]})},af=e=>{let{cityGameState:t,onOpenSpecialBuildingMenu:n}=e;const s=t.specialBuilding,r=s?Yp[s]:zm.special_building_plot;return(0,Lm.jsxs)("div",{className:"bg-gray-700/80 border-2 border-gray-600 rounded-lg p-2 w-48 text-center flex flex-col items-center relative shadow-lg",children:[(0,Lm.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 w-0.5 h-6 bg-gray-500/50"}),(0,Lm.jsx)("h4",{className:"font-bold text-yellow-400 text-base",children:r.name}),(0,Lm.jsx)("p",{className:"text-sm text-gray-300 font-semibold",children:s?"Constructed":"Empty Plot"}),(0,Lm.jsx)("img",{src:ef[r.image],alt:r.name,className:"w-20 h-20 object-contain my-1"}),(0,Lm.jsx)("p",{className:"text-xs text-gray-400 mb-2 h-8 overflow-hidden",children:r.description}),(0,Lm.jsx)("button",{onClick:n,disabled:!!s,className:"w-full py-1.5 rounded font-bold text-sm transition-colors "+(s?"btn-disabled":"btn-upgrade"),children:s?"Constructed":"Build Wonder"})]})},of=t=>{let{buildings:n,resources:s,onUpgrade:r,onDemolish:i,getUpgradeCost:a,onClose:o,usedPopulation:l,maxPopulation:c,buildQueue:u=[],onCancelBuild:d,setMessage:h,cityGameState:m,onOpenSpecialBuildingMenu:p,onDemolishSpecialBuilding:f,currentUser:g,worldId:v,onAddWorker:y,onRemoveWorker:x,getMaxWorkerSlots:b,availablePopulation:w,onApplyWorkerPreset:k}=t;const[N,j]=(0,e.useState)("upgrade"),[C,S]=(0,e.useState)([]),[_,T]=(0,e.useState)(""),[I,E]=(0,e.useState)(!1),[A,P]=(0,e.useState)(""),[M,D]=(0,e.useState)(null);(0,e.useEffect)(()=>{if(!g||!v)return;const e=pm(Jd(Om,`users/${g.uid}/games/${v}/presets`),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));S(t)});return()=>e()},[g,v]);const O=e=>{var t;let s=(null===(t=n[e])||void 0===t?void 0:t.level)||0;const r=(u||[]).filter(t=>t.buildingId===e&&"demolish"!==t.type),i=(u||[]).filter(t=>t.buildingId===e&&"demolish"===t.type);return r.length>0&&(s=Math.max(...r.map(e=>e.level))),i.length>0&&(s=Math.min(...i.map(e=>e.level))),s};return(0,Lm.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-30",children:[M&&(0,Lm.jsx)(tf,{message:M.message,onConfirm:M.onConfirm,onCancel:()=>D(null)}),I&&(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100]",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,Lm.jsx)("h3",{className:"text-lg font-bold mb-4 text-white",children:"Save Worker Preset"}),(0,Lm.jsx)("input",{type:"text",value:A,onChange:e=>P(e.target.value),placeholder:"Enter preset name...",className:"w-full bg-gray-700 p-2 rounded mb-4 text-white"}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,Lm.jsx)("button",{onClick:()=>E(!1),className:"btn btn-secondary",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:async()=>{if(!A.trim())return void h("Please enter a name for the preset.");const e=A.trim().toLowerCase().replace(/\s+/g,"-"),t=eh(Om,`users/${g.uid}/games/${v}/presets`,e),s=C.find(t=>t.id===e);if(C.length>=3&&!s)return h("You can only have a maximum of 3 presets. Delete one to save a new one."),void E(!1);const r=async()=>{const s={};["timber_camp","quarry","silver_mine"].forEach(e=>{var t;s[e]=(null===(t=n[e])||void 0===t?void 0:t.workers)||0});const r={name:A.trim(),workers:s};await um(t,r),P(""),E(!1),T(e),D(null),h(`Preset '${r.name}' saved successfully!`)};s?D({message:`A preset named "${A.trim()}" already exists. Do you want to overwrite it?`,onConfirm:r}):await r()},className:"btn btn-confirm",children:"Save"})]})]})}),(0,Lm.jsxs)("div",{className:"senate-view-container text-white p-6 rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] flex flex-col",children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-600 pb-3 mb-4",children:[(0,Lm.jsx)("h2",{className:"text-3xl font-bold font-title text-yellow-300",children:"Senate"}),(0,Lm.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-white text-2xl",children:"\xd7"})]}),(0,Lm.jsx)(Zp,{buildQueue:u,onCancel:d}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4 p-3 bg-gray-900 rounded-lg",children:[(0,Lm.jsxs)("p",{className:"text-lg",children:["Population: ",(0,Lm.jsx)("span",{className:"font-bold text-green-400",children:w})," / ",c]}),(0,Lm.jsxs)("div",{className:"flex gap-4",children:[(0,Lm.jsxs)("p",{children:["Wood: ",(0,Lm.jsx)("span",{className:"font-bold text-yellow-300",children:Math.floor(s.wood)})]}),(0,Lm.jsxs)("p",{children:["Stone: ",(0,Lm.jsx)("span",{className:"font-bold text-gray-300",children:Math.floor(s.stone)})]}),(0,Lm.jsxs)("p",{children:["Silver: ",(0,Lm.jsx)("span",{className:"font-bold text-blue-300",children:Math.floor(s.silver)})]})]})]}),(0,Lm.jsxs)("div",{className:"flex border-b border-gray-600 mb-4",children:[(0,Lm.jsx)("button",{onClick:()=>j("upgrade"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("upgrade"===N?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Upgrade"}),(0,Lm.jsx)("button",{onClick:()=>j("demolish"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("demolish"===N?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Demolish"}),(0,Lm.jsx)("button",{onClick:()=>j("management"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("management"===N?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Management"})]}),(0,Lm.jsxs)("div",{className:"overflow-y-auto pr-2",children:["upgrade"===N&&(0,Lm.jsx)("div",{className:"flex flex-col items-center space-y-12 py-6",children:[["senate"],["timber_camp","quarry","silver_mine","farm"],["warehouse","market","barracks","shipyard"],["academy","temple","divine_temple","hospital"],["city_wall","cave","prison","heroes_altar"],["special_building_plot"]].map((e,t)=>(0,Lm.jsxs)("div",{className:"flex justify-center items-start gap-6 relative",children:[e.length>1&&t>0&&(0,Lm.jsx)("div",{className:"absolute -top-9 left-0 right-0 h-0.5 bg-gray-500/50 z-0 w-3/4 mx-auto"}),e.map(e=>{var t;if("special_building_plot"===e)return(0,Lm.jsx)(af,{cityGameState:m,onOpenSpecialBuildingMenu:p},e);const i=zm[e];if(!1===i.constructible&&"senate"!==e)return null;const o=(null===(t=n[e])||void 0===t?void 0:t.level)||0,d=O(e),h=d+1,f=d>=(i.maxLevel||99),g=a(e,h);let v=s.wood>=g.wood&&s.stone>=g.stone&&s.silver>=g.silver;"farm"!==e&&"warehouse"!==e&&(v=v&&c-l>=g.population);const y=(u||[]).length>=5;return(0,Lm.jsx)(rf,{id:e,config:i,level:o,finalQueuedLevel:d,cost:g,canAfford:v,onUpgrade:r,isQueueFull:y,isMaxLevel:f},e)})]},t))}),"demolish"===N&&(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[Object.entries(n).filter(e=>{let[t,n]=e;return n.level>0&&!1!==zm[t].constructible&&"senate"!==t}).map(e=>{let[t,n]=e;const s=zm[t],r=O(t),a=r>0,o=(u||[]).length>=5;let l="Demolish";return r>1&&(l="Demolish to Lvl "+(r-1)),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg flex justify-between items-center",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"text-xl font-semibold text-yellow-400",children:s.name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Level ",n.level]})]}),(0,Lm.jsx)("button",{onClick:()=>i(t),disabled:!a||o,className:"py-2 px-4 rounded font-bold "+(!a||o?"btn-disabled":"btn-danger"),children:o?"Queue Full":a?l:"At Lvl 0"})]},t)}),m.specialBuilding&&(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg flex justify-between items-center",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"text-xl font-semibold text-yellow-400",children:Yp[m.specialBuilding].name}),(0,Lm.jsx)("p",{className:"text-sm text-gray-300",children:"Wonder"})]}),(0,Lm.jsx)("button",{onClick:f,className:"py-2 px-4 rounded font-bold btn-danger",children:"Demolish"})]})]}),"management"===N&&(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[(0,Lm.jsx)(nf,{buildings:n,onAddWorker:y,onRemoveWorker:x,getMaxWorkerSlots:b,availablePopulation:w}),(0,Lm.jsx)(sf,{presets:C,selectedPresetId:_,setSelectedPresetId:T,handleApplyPreset:()=>{const e=C.find(e=>e.id===_);e?k(e):h("Please select a preset to apply.")},setIsSavingPreset:E,handleDeletePreset:async()=>{var e;if(!_)return;const t=null===(e=C.find(e=>e.id===_))||void 0===e?void 0:e.name;D({message:`Are you sure you want to delete the preset "${t}"?`,onConfirm:async()=>{const e=eh(Om,`users/${g.uid}/games/${v}/presets`,_);await hm(e),T(""),D(null),h(`Preset '${t}' deleted.`)}})}})]})]})]})]})},lf=JSON.parse('{"greek":{"Zeus":{"name":"Zeus","description":"King of the Gods, master of lightning and the sky.","powers":[{"name":"Divine Sign","description":"Instantly send 250 silver to a target city.","favorCost":50,"effect":{"type":"add_resources","resource":"silver","amount":250,"target":"both"}},{"name":"Lightning Bolt","description":"Destroy a random enemy building level in a target city.","favorCost":200,"effect":{"type":"damage_building","amount":1,"target":"other"}}],"mythical_units":["Minotaur","Manticore"],"image":"zeus.png"},"Hera":{"name":"Hera","description":"Queen of the Gods, protector of marriage and family.","powers":[{"name":"Wedding","description":"Instantly send 250 wood to a target city.","favorCost":50,"effect":{"type":"add_resources","resource":"wood","amount":250,"target":"both"}},{"name":"Satisfaction","description":"Increase resource production by 10% for 1 hour in a target city.","favorCost":150,"effect":{"type":"resource_boost","multiplier":1.1,"duration":3600,"target":"both"}}],"mythical_units":["Harpy","Medusa"],"image":"hera.png"},"Athena":{"name":"Athena","description":"Goddess of wisdom, courage, and strategic warfare.","powers":[{"name":"City Protection","description":"Your city cannot be attacked for 1 hour.","favorCost":300,"effect":{"type":"protection","duration":3600,"target":"self"}},{"name":"Wisdom","description":"All your troops gain +10% attack for their next battle.","favorCost":180,"effect":{"type":"attack_boost","multiplier":1.1,"target":"self"}}],"mythical_units":["Centaur","Pegasus"],"image":"athena.png"}},"roman":{"Jupiter":{"name":"Jupiter","description":"The Roman equivalent of Zeus, god of the sky and thunder.","powers":[{"name":"Divine Sign","description":"Instantly send 250 silver to a target city.","favorCost":50,"effect":{"type":"add_resources","resource":"silver","amount":250,"target":"both"}},{"name":"Lightning Bolt","description":"Destroy a random enemy building level in a target city.","favorCost":200,"effect":{"type":"damage_building","amount":1,"target":"other"}}],"mythical_units":["Minotaur","Manticore"],"image":"jupiter.png"},"Juno":{"name":"Juno","description":"The Roman equivalent of Hera, protector of the Roman people.","powers":[{"name":"Wedding","description":"Instantly send 250 wood to a target city.","favorCost":50,"effect":{"type":"add_resources","resource":"wood","amount":250,"target":"both"}},{"name":"Satisfaction","description":"Increase resource production by 10% for 1 hour in a target city.","favorCost":150,"effect":{"type":"resource_boost","multiplier":1.1,"duration":3600,"target":"both"}}],"mythical_units":["Harpy","Medusa"],"image":"juno.png"},"Minerva":{"name":"Minerva","description":"The Roman equivalent of Athena, goddess of wisdom and strategic warfare.","powers":[{"name":"City Protection","description":"Your city cannot be attacked for 1 hour.","favorCost":300,"effect":{"type":"protection","duration":3600,"target":"self"}},{"name":"Wisdom","description":"All your troops gain +10% attack for their next battle.","favorCost":180,"effect":{"type":"attack_boost","multiplier":1.1,"target":"self"}}],"mythical_units":["Centaur","Pegasus"],"image":"minerva.png"}},"egyptian":{"Anubis":{"name":"Anubis","description":"God of the dead and the embalming process, protector of tombs.","powers":[{"name":"Plague of Locusts","description":"Reduce a target city\'s resource production by 20% for 1 hour.","favorCost":250,"effect":{"type":"production_debuff","multiplier":0.8,"duration":3600,"target":"other"}},{"name":"Underworld\'s Favor","description":"Revive 10% of your troops lost in the next battle.","favorCost":350,"effect":{"type":"revive_troops","percentage":0.1,"target":"self"}}],"mythical_units":["Sphinx","Scarab"],"image":"anubis.png"},"Horus":{"name":"Horus","description":"God of the sky, kingship, and order.","powers":[{"name":"Favorable Winds","description":"Your naval units travel 20% faster for 1 hour.","favorCost":120,"effect":{"type":"naval_speed_boost","multiplier":1.2,"duration":3600,"target":"self"}},{"name":"Vision of the Sky","description":"Reveal the number of incoming attacks on your city.","favorCost":80,"effect":{"type":"reveal_attacks","target":"self"}}],"mythical_units":["Griffin","Phoenix"],"image":"horus.png"},"Osiris":{"name":"Osiris","description":"God of the afterlife, the underworld, and rebirth.","powers":[{"name":"Resurrection","description":"Instantly revive 5 of your most powerful deceased units.","favorCost":400,"effect":{"type":"revive_specific_troops","amount":5,"target":"self"}},{"name":"Bountiful Harvest","description":"Instantly send 250 wood and 250 stone to a target city.","favorCost":100,"effect":{"type":"add_multiple_resources","resources":{"wood":250,"stone":250},"target":"both"}}],"mythical_units":["Mummy","Serpopard"],"image":"osiris.png"}}}'),cf=n(5316),uf=cf.keys().reduce((e,t)=>(e[t.replace("./","")]=cf(t),e),{}),df=t=>{var n;let{city:s,onWorship:r,onClose:i,favorData:a}=t;const o=s.playerInfo.religion,l=s.god,c=o&&lf[o.toLowerCase()]||{},u=Object.keys(c)[0]||null,[d,h]=(0,e.useState)(l||u),m=d?c[d]:null,p=d&&a[d]||0,f=(null===(n=s.buildings.temple)||void 0===n?void 0:n.level)||0,g=f>0?100+20*f:0,v=g>0?p/g*100:0,y=!d||d===l;let x;return x=l&&d===l?`Currently Worshipping ${l}`:d?`Worship ${d}`:"Select a God",(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:i,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl border-2 border-yellow-600 text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsxs)("h3",{className:"font-title text-3xl",children:["Temple in ",s.name]}),(0,Lm.jsx)("button",{onClick:i,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"flex gap-6",children:[(0,Lm.jsx)("div",{className:"flex flex-col gap-2 p-2 bg-gray-900 border border-gray-700 rounded-lg",children:Object.values(c).map(e=>(0,Lm.jsx)("button",{onClick:()=>h(e.name),className:"w-20 h-20 flex items-center justify-center rounded-lg overflow-hidden transition-all border-2 "+(d===e.name?"bg-gray-700 border-yellow-400":"bg-gray-800 border-gray-600 hover:bg-gray-700"),title:e.name,children:(0,Lm.jsx)("img",{src:uf[e.image],alt:e.name,className:"w-full h-full object-cover"})},e.name))}),(0,Lm.jsx)("div",{className:"flex-1 bg-gray-900 border border-gray-700 rounded-lg p-4",children:m?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,Lm.jsx)("div",{className:"w-32 h-32 p-1 bg-gray-800 rounded-full border-4 border-stone-500 flex-shrink-0 overflow-hidden",children:(0,Lm.jsx)("img",{src:uf[m.image],alt:m.name,className:"w-full h-full object-cover rounded-full"})}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-title text-4xl text-yellow-400",children:m.name}),(0,Lm.jsx)("p",{className:"text-gray-400",children:m.description})]})]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsxs)("h5",{className:"text-lg font-bold mb-2",children:["Favor for ",d]}),(0,Lm.jsx)("div",{className:"bg-gray-700 rounded-full h-6 border border-gray-600",children:(0,Lm.jsx)("div",{className:"bg-blue-500 h-full rounded-full text-center text-white text-sm flex items-center justify-center transition-all duration-500",style:{width:`${v}%`},children:(0,Lm.jsxs)("span",{children:[Math.floor(p)," / ",g]})})}),(0,Lm.jsx)("p",{className:"text-xs text-gray-500 text-center mt-1",children:"Favor increases over time based on this city's Temple level."})]}),(0,Lm.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h5",{className:"text-lg font-bold mb-2 text-yellow-500",children:"Divine Powers"}),(0,Lm.jsx)("ul",{className:"list-disc list-inside text-gray-300",children:m.powers.map(e=>(0,Lm.jsx)("li",{children:e.name},e.name))})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h5",{className:"text-lg font-bold mb-2 text-yellow-500",children:"Mythical Units"}),(0,Lm.jsx)("ul",{className:"list-disc list-inside text-gray-300",children:m.mythical_units.map(e=>(0,Lm.jsx)("li",{children:e},e))})]})]})]}):(0,Lm.jsx)("p",{className:"text-center p-10",children:"Select a god to view their details."})})]}),(0,Lm.jsx)("div",{className:"mt-6",children:(0,Lm.jsx)("button",{onClick:()=>r(d),disabled:y,className:"w-full py-3 btn text-lg "+(y?"btn-disabled":"btn-confirm"),children:x})})]})})},hf=t=>{var n,s;let{cityGameState:r,onClose:i,saveGameState:a,currentUser:o,worldId:l}=t;const[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)("");if(console.log("CaveMenu rendered. cityGameState:",r),!r)return console.log("CaveMenu: cityGameState is null, showing loading modal."),(0,Lm.jsx)(Sp,{message:"Loading city data...",onClose:i});const f=(null===(n=r.buildings.cave)||void 0===n?void 0:n.level)||0,g=f===zm.cave.maxLevel?1/0:1e3*f,v=(null===(s=r.cave)||void 0===s?void 0:s.silver)||0;return(0,Lm.jsx)(Sp,{onClose:i,title:"Cave",children:(0,Lm.jsxs)("div",{className:"p-4 bg-gray-800 text-white rounded-lg shadow-lg",children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center text-yellow-400",children:"Cave"}),(0,Lm.jsxs)("p",{className:"text-center mb-4",children:["Silver in Cave: ",(0,Lm.jsx)("span",{className:"font-semibold text-green-400",children:v.toLocaleString()})," / ",(0,Lm.jsx)("span",{className:"font-semibold text-blue-400",children:g===1/0?"\u221e":g.toLocaleString()})]}),(0,Lm.jsxs)("div",{className:"mb-6",children:[(0,Lm.jsx)("h3",{className:"text-xl font-semibold mb-2 text-yellow-300",children:"Deposit Silver"}),(0,Lm.jsx)("input",{type:"number",value:c,onChange:e=>u(e.target.value),placeholder:"Amount to deposit",className:"w-full p-2 mb-2 rounded bg-gray-700 border border-gray-600 text-white placeholder-gray-400"}),(0,Lm.jsx)("button",{onClick:async()=>{const e=parseInt(c,10);if(isNaN(e)||e<=0)p("Please enter a valid amount to deposit.");else if(r.resources.silver<e)p("Not enough silver in your city to deposit.");else if(v+e>g)p(`Cannot deposit. Cave storage limit is ${g.toLocaleString()}.`);else try{const t={...r};t.resources.silver-=e,t.cave.silver=v+e,await a(t),p(`Successfully deposited ${e} silver.`),u("")}catch(t){console.error("Error depositing silver: ",t),p("Failed to deposit silver. Please try again.")}},className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out shadow-md",children:"Deposit"})]}),(0,Lm.jsxs)("div",{className:"mb-6",children:[(0,Lm.jsx)("h3",{className:"text-xl font-semibold mb-2 text-yellow-300",children:"Withdraw Silver"}),(0,Lm.jsx)("input",{type:"number",value:d,onChange:e=>h(e.target.value),placeholder:"Amount to withdraw",className:"w-full p-2 mb-2 rounded bg-gray-700 border border-gray-600 text-white placeholder-gray-400"}),(0,Lm.jsx)("button",{onClick:async()=>{const e=parseInt(d,10);if(isNaN(e)||e<=0)p("Please enter a valid amount to withdraw.");else if(v<e)p("Not enough silver in the cave to withdraw.");else try{const t={...r};t.resources.silver+=e,t.cave.silver=v-e,await a(t),p(`Successfully withdrew ${e} silver.`),h("")}catch(t){console.error("Error withdrawing silver: ",t),p("Failed to withdraw silver. Please try again.")}},className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out shadow-md",children:"Withdraw"})]}),m&&(0,Lm.jsx)("p",{className:"mt-4 p-2 bg-blue-700 text-white rounded text-center",children:m})]})})},mf={},pf=n(4731);pf.keys().forEach(e=>{const t=e.replace("./","");mf[t]=pf(e)});const ff=t=>{var n;let{cityGameState:s,onClose:r,onHeal:i,onCancelHeal:a,getHospitalCapacity:o,availablePopulation:l}=t;const[c,u]=(0,e.useState)({}),d=s.wounded||{},h=(null===(n=s.buildings.hospital)||void 0===n?void 0:n.level)||0,m=o(h),p=Object.values(d).reduce((e,t)=>e+t,0),f=(0,e.useMemo)(()=>Object.entries(c).reduce((e,t)=>{let[n,s]=t;const r=qm[n];return r&&r.heal_cost&&(e.wood+=(r.heal_cost.wood||0)*s,e.stone+=(r.heal_cost.stone||0)*s,e.silver+=(r.heal_cost.silver||0)*s),e},{wood:0,stone:0,silver:0}),[c]),g=(0,e.useMemo)(()=>Object.entries(c).reduce((e,t)=>{let[n,s]=t;const r=qm[n];return r&&(e+=(r.cost.population||0)*s),e},0),[c]),v=s.resources.wood>=f.wood&&s.resources.stone>=f.stone&&s.resources.silver>=f.silver,y=l>=g;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:r,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsxs)("h3",{className:"font-title text-3xl text-white",children:["Hospital (Level ",h,")"]}),(0,Lm.jsx)("button",{onClick:r,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("p",{className:"text-gray-400 mb-4",children:["Capacity: ",p," / ",m]}),(0,Lm.jsxs)("div",{className:"flex-grow overflow-y-auto pr-2",children:[(0,Lm.jsx)("h4",{className:"text-xl font-semibold text-yellow-400 mb-2",children:"Wounded Units"}),Object.keys(d).length>0?(0,Lm.jsx)("div",{className:"space-y-3",children:Object.entries(d).map(e=>{let[t,n]=e;if(0===n)return null;const s=qm[t];return(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg flex items-center justify-between",children:[(0,Lm.jsxs)("div",{className:"flex items-center gap-4",children:[(0,Lm.jsx)("img",{src:mf[s.image],alt:s.name,className:"w-12 h-12 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-white",children:s.name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-400",children:["Wounded: ",n]})]})]}),(0,Lm.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Lm.jsx)("input",{type:"number",value:c[t]||"",onChange:e=>((e,t)=>{const n=d[e]||0,s=Math.max(0,Math.min(n,parseInt(t,10)||0));u(t=>({...t,[e]:s}))})(t,e.target.value),className:"bg-gray-800 text-white rounded p-2 w-24 text-center",placeholder:"Amount",max:n,min:"0"}),(0,Lm.jsxs)("div",{className:"text-xs text-gray-300",children:[(0,Lm.jsx)("p",{children:"Cost/unit:"}),(0,Lm.jsxs)("p",{children:["W: ",s.heal_cost.wood,", S: ",s.heal_cost.stone,", Ag: ",s.heal_cost.silver]}),(0,Lm.jsxs)("p",{children:["Time/unit: ",s.heal_time,"s"]})]})]})]},t)})}):(0,Lm.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No wounded units."})]}),(0,Lm.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-600",children:(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",children:"Total Cost:"}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Wood: ",f.wood,", Stone: ",f.stone,", Silver: ",f.silver]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Population: ",(0,Lm.jsxs)("span",{className:y?"text-green-400":"text-red-400",children:[g," / ",l]})]})]}),(0,Lm.jsx)("button",{onClick:()=>{const e=Object.entries(c).filter(e=>{let[,t]=e;return t>0});e.length>0&&(i(Object.fromEntries(e)),u({}))},disabled:!v||!y||0===Object.values(c).reduce((e,t)=>e+t,0)||(s.healQueue||[]).length>=5,className:"py-2 px-6 text-lg rounded-lg btn "+(v&&y&&Object.values(c).reduce((e,t)=>e+t,0)>0&&(s.healQueue||[]).length<5?"btn-confirm":"btn-disabled"),children:(s.healQueue||[]).length>=5?"Queue Full":y?"Heal Selected":"Not Enough Pop."})]})}),(0,Lm.jsx)(Op,{unitQueue:s.healQueue||[],onCancel:a,title:"Healing"})]})})};var gf=n(5982),vf=n(1826),yf=n(490);const xf={wood:gf,stone:vf,silver:yf},bf=t=>{let{onClose:n,cityGameState:s,worldId:r,marketCapacity:i}=t;const{currentUser:a,userProfile:o}=Fm(),{activeCityId:l}=up(),[c,u]=(0,e.useState)("marketplace"),[d,h]=(0,e.useState)([]),[m,p]=(0,e.useState)([]),[f,g]=(0,e.useState)(!0),[v,y]=(0,e.useState)(""),[x,b]=(0,e.useState)(!1),[w,k]=(0,e.useState)("wood"),[N,j]=(0,e.useState)(""),[C,S]=(0,e.useState)("stone"),[_,T]=(0,e.useState)("");(0,e.useEffect)(()=>{if(!r)return;g(!0);const e=pm(Bh(Jd(Om,"worlds",r,"trades"),Gh("createdAt","desc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));h(t.filter(e=>e.playerId!==a.uid)),p(t.filter(e=>e.playerId===a.uid)),g(!1)},e=>{console.error("Error fetching trades:",e),y("Could not load market data."),g(!1)});return()=>e()},[r,a.uid]);const I=(e,t)=>f?(0,Lm.jsx)("p",{children:"Loading trades..."}):0===e.length?(0,Lm.jsx)("p",{className:"text-center p-4",children:"No trades found."}):(0,Lm.jsxs)("table",{className:"market-table",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("th",{children:"Player"}),(0,Lm.jsx)("th",{children:"Offering"}),(0,Lm.jsx)("th",{children:"Demanding"}),(0,Lm.jsx)("th",{children:"Action"})]})}),(0,Lm.jsx)("tbody",{children:e.map(e=>{const n=s.resources[e.demand.resource]>=e.demand.amount;return(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("td",{children:e.playerName}),(0,Lm.jsxs)("td",{className:"resource-cell",children:[(0,Lm.jsx)("img",{src:xf[e.offer.resource],alt:e.offer.resource}),e.offer.amount.toLocaleString()]}),(0,Lm.jsxs)("td",{className:"resource-cell",children:[(0,Lm.jsx)("img",{src:xf[e.demand.resource],alt:e.demand.resource}),e.demand.amount.toLocaleString()]}),(0,Lm.jsx)("td",{children:t?(0,Lm.jsx)("button",{onClick:()=>(async e=>{y("");const t=eh(Om,"worlds",r,"trades",e.id),n=eh(Om,`users/${a.uid}/games`,r,"cities",e.originCityId);try{await wm(Om,async s=>{if(!(await s.get(t)).exists())throw new Error("This trade no longer exists.");const r=await s.get(n);if(!r.exists())throw new Error("Your city data could not be found.");const i={...r.data().resources};i[e.offer.resource]=(i[e.offer.resource]||0)+e.offer.amount,s.update(n,{resources:i}),s.delete(t)})}catch(v){console.error("Error canceling trade:",v),y(`Failed to cancel trade: ${v.message}`)}})(e),className:"market-btn cancel-btn",children:"Cancel"}):(0,Lm.jsx)("button",{onClick:()=>(async e=>{if(y(""),s.resources[e.demand.resource]<e.demand.amount)return void y(`You don't have enough ${e.demand.resource} to accept this trade.`);const t=eh(Om,"worlds",r,"trades",e.id),n=eh(Om,`users/${a.uid}/games`,r,"cities",l),i=eh(Om,`users/${e.playerId}/games`,r,"cities",e.originCityId);try{await wm(Om,async s=>{if(!(await s.get(t)).exists())throw new Error("This trade is no longer available.");const r=await s.get(n),a=await s.get(i);if(!r.exists()||!a.exists())throw new Error("Could not find player data for this trade.");const o=r.data().resources,l=a.data().resources;if(o[e.demand.resource]<e.demand.amount)throw new Error(`You do not have enough ${e.demand.resource}.`);const c={...o};c[e.demand.resource]-=e.demand.amount,c[e.offer.resource]=(c[e.offer.resource]||0)+e.offer.amount,s.update(n,{resources:c});const u={...l};u[e.demand.resource]=(u[e.demand.resource]||0)+e.demand.amount,s.update(i,{resources:u}),s.delete(t)})}catch(v){console.error("Error accepting trade:",v),y(`Failed to accept trade: ${v.message}`)}})(e),disabled:!n,className:"market-btn accept-btn",children:n?"Accept":"Too Costly"})})]},e.id)})})]});return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"market-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"market-header",children:[(0,Lm.jsx)("h2",{children:"Marketplace"}),(0,Lm.jsx)("button",{onClick:n,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"market-tabs",children:[(0,Lm.jsx)("button",{onClick:()=>u("marketplace"),className:"marketplace"===c?"active":"",children:"Marketplace"}),(0,Lm.jsx)("button",{onClick:()=>u("my-trades"),className:"my-trades"===c?"active":"",children:"My Trades"}),(0,Lm.jsx)("button",{onClick:()=>u("create"),className:"create"===c?"active":"",children:"Create Trade"})]}),(0,Lm.jsxs)("div",{className:"market-content",children:[v&&(0,Lm.jsx)("p",{className:"error-message",children:v}),"marketplace"===c&&I(d,!1),"my-trades"===c&&I(m,!0),"create"===c&&(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x)return;y("");const t=parseInt(N,10),n=parseInt(_,10);if(w===C)return void y("You cannot trade a resource for itself.");if(!t||!n||t<=0||n<=0)return void y("Please enter valid, positive amounts for the trade.");if(s.resources[w]<t)return void y(`You do not have enough ${w} to make this offer.`);if(t>i)return void y(`You cannot offer more than your market capacity of ${i}.`);b(!0);const c=eh(Om,`users/${a.uid}/games`,r,"cities",l),d=Jd(Om,"worlds",r,"trades");try{await wm(Om,async e=>{const s=await e.get(c);if(!s.exists())throw new Error("City data not found.");const r=s.data().resources;if(r[w]<t)throw new Error(`Not enough ${w}.`);const i={...r,[w]:r[w]-t};e.update(c,{resources:i});const u={playerId:a.uid,playerName:o.username,originCityId:l,offer:{resource:w,amount:t},demand:{resource:C,amount:n},createdAt:km()};e.set(eh(d),u)}),j(""),T(""),u("my-trades"),setTimeout(()=>b(!1),3e3)}catch(v){console.error("Error creating trade:",v),y(`Failed to create trade: ${v.message}`),b(!1)}},className:"create-trade-form",children:[(0,Lm.jsxs)("div",{className:"trade-inputs",children:[(0,Lm.jsxs)("div",{className:"trade-group",children:[(0,Lm.jsx)("label",{children:"You Offer"}),(0,Lm.jsxs)("select",{value:w,onChange:e=>k(e.target.value),children:[(0,Lm.jsx)("option",{value:"wood",children:"Wood"}),(0,Lm.jsx)("option",{value:"stone",children:"Stone"}),(0,Lm.jsx)("option",{value:"silver",children:"Silver"})]}),(0,Lm.jsx)("input",{type:"number",value:N,onChange:e=>j(e.target.value),placeholder:"Amount"}),(0,Lm.jsxs)("p",{children:["Your Wood: ",Math.floor(s.resources.wood)]})]}),(0,Lm.jsxs)("div",{className:"trade-group",children:[(0,Lm.jsx)("label",{children:"You Demand"}),(0,Lm.jsxs)("select",{value:C,onChange:e=>S(e.target.value),children:[(0,Lm.jsx)("option",{value:"wood",children:"Wood"}),(0,Lm.jsx)("option",{value:"stone",children:"Stone"}),(0,Lm.jsx)("option",{value:"silver",children:"Silver"})]}),(0,Lm.jsx)("input",{type:"number",value:_,onChange:e=>T(e.target.value),placeholder:"Amount"}),(0,Lm.jsxs)("p",{children:["Your Stone: ",Math.floor(s.resources.stone)]})]})]}),(0,Lm.jsxs)("p",{className:"capacity-info",children:["Your Silver: ",Math.floor(s.resources.silver)," | Market Capacity: ",i]}),(0,Lm.jsx)("button",{type:"submit",className:"market-btn create-btn",disabled:x,children:x?"Creating...":"Create Offer"})]})]})]})})},wf=e=>{e<0&&(e=0);return`${Math.floor(e/3600).toString().padStart(2,"0")}:${Math.floor(e%3600/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`},kf=t=>{let{item:n,onCancel:s,isFirst:r,isLast:i,onHover:a,onLeave:o}=t;const[l,c]=(0,e.useState)(0),u=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(!r)return;const e=()=>{const e=n.endTime instanceof Date?n.endTime:new Date(n.endTime);if(isNaN(e.getTime()))return void c(0);const t=Math.max(0,e.getTime()-Date.now());c(t/1e3)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[n.endTime,r]);const d=Wm[n.researchId];return d?(0,Lm.jsxs)("div",{ref:u,className:"relative p-2 bg-amber-100/50 rounded flex justify-between items-center",onMouseEnter:()=>a(n,u.current),onMouseLeave:o,children:[(0,Lm.jsx)("span",{className:"font-semibold",children:d.name}),(0,Lm.jsxs)("div",{className:"flex items-center gap-4",children:[r&&(0,Lm.jsx)("span",{className:"font-mono text-gray-800 bg-white/50 px-2 py-1 rounded",children:wf(l)}),i&&(0,Lm.jsx)("button",{onClick:s,className:"text-red-600 hover:text-red-500 font-bold text-xl leading-none px-2 rounded-full",title:"Cancel Research",children:"\xd7"})]})]}):null},Nf=t=>{let{researchQueue:n,onCancel:s}=t;const[r,i]=(0,e.useState)(null),[a,o]=(0,e.useState)({display:"none"}),l=(0,e.useRef)(null),c=(0,e.useRef)(null),u=(e,t)=>{if(clearTimeout(l.current),t&&c.current){const n=t.getBoundingClientRect();o({position:"fixed",bottom:window.innerHeight-n.top+8+"px",left:`${n.left+n.width/2}px`,transform:"translateX(-50%)"}),i(e)}},d=()=>{l.current=setTimeout(()=>{i(null)},200)},h=n&&n.length>0?n[n.length-1].endTime:null;return n&&0!==n.length?(0,Lm.jsxs)("div",{className:"bg-gray-900/80 p-3 mt-auto flex-shrink-0",ref:c,children:[(0,Lm.jsxs)("h4",{className:"text-lg font-semibold text-yellow-400 mb-2",children:["Research Queue (",n.length,"/5)"]}),(0,Lm.jsx)("div",{className:"space-y-2",children:n.map((e,t)=>(0,Lm.jsx)(kf,{item:e,onCancel:()=>s(t),isFirst:0===t,isLast:t===n.length-1,onHover:u,onLeave:d},`${e.researchId}-${t}`))}),(()=>{if(!r)return null;const e=Wm[r.researchId],t=h?new Date(h).toLocaleTimeString():"N/A";return(0,Lm.jsxs)("div",{className:"research-queue-tooltip",style:a,children:[(0,Lm.jsx)("h3",{className:"research-tooltip-title",children:e.name}),(0,Lm.jsx)("p",{className:"text-sm mb-2",children:e.description}),(0,Lm.jsxs)("dl",{className:"research-tooltip-info",children:[(0,Lm.jsx)("dt",{children:"Time:"}),(0,Lm.jsx)("dd",{children:wf(e.cost.time)}),(0,Lm.jsx)("dt",{children:"Queue Completion:"}),(0,Lm.jsx)("dd",{children:t})]})]})})()]}):(0,Lm.jsx)("div",{className:"bg-gray-900/80 p-3 mt-auto flex-shrink-0",children:(0,Lm.jsx)("h4",{className:"text-lg font-semibold text-gray-400 text-center",children:"Research queue is empty."})})},jf={},Cf=n(1442);Cf.keys().forEach(e=>{const t=e.replace("./","").replace(".png","");jf[t]=Cf(e)});const Sf=e=>{var t;let{cityGameState:n,onResearch:s,onClose:r,researchQueue:i,onCancelResearch:a}=e;const{buildings:o,resources:l,research:c={},researchPoints:u=0}=n,d=(null===(t=o.academy)||void 0===t?void 0:t.level)||0;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:r,children:(0,Lm.jsxs)("div",{className:"academy-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"academy-header",children:[(0,Lm.jsxs)("h3",{children:["Academy (Level ",d,")"]}),(0,Lm.jsxs)("p",{children:["Research Points: ",u]}),(0,Lm.jsx)("button",{onClick:r,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"academy-grid",children:Object.entries(Wm).map(e=>{let[t,n]=e;const r=c[t],a=!((o=n.requirements).academy&&d<o.academy)&&!(o.research&&!c[o.research]);var o;const h=(m=n.cost,l.wood>=m.wood&&l.stone>=m.stone&&l.silver>=m.silver&&u>=(m.points||0));var m;const p=(f=t,(i||[]).some(e=>e.researchId===f));var f;const g=(i||[]).length>=5;let v="";a||(v=`Requires: Academy Lvl ${n.requirements.academy||0}`,n.requirements.research&&(v+=` & ${Wm[n.requirements.research].name}`));let y="Research",x=!1;return r?(y="Completed",x=!0):p?(y="In Queue",x=!0):g?(y="Queue Full",x=!0):a?h||(y="No Resources",x=!0):(y="Locked",x=!0),(0,Lm.jsxs)("div",{className:`research-card ${r?"researched":""} ${a?"":"locked"}`,children:[(0,Lm.jsx)("div",{className:"research-icon",style:{backgroundImage:`url(${jf[t]})`},children:(0,Lm.jsxs)("div",{className:"research-tooltip",children:[(0,Lm.jsx)("h5",{className:"tooltip-title",children:n.name}),(0,Lm.jsx)("p",{className:"tooltip-desc",children:n.description}),(0,Lm.jsxs)("div",{className:"tooltip-cost",children:["Cost: ",n.cost.wood,"W, ",n.cost.stone,"S, ",n.cost.silver,"Ag, ",n.cost.points||0,"RP"]}),v&&(0,Lm.jsx)("p",{className:"tooltip-req",children:v})]})}),(0,Lm.jsx)("button",{onClick:()=>s(t),disabled:x,className:"btn research-btn "+(r?"completed":p?"in-queue":"btn-primary"),children:y})]},t)})}),(0,Lm.jsx)(Nf,{researchQueue:i,onCancel:a})]})})},_f={},Tf=n(3542);Tf.keys().forEach(e=>{const t=e.replace("./","");_f[t]=Tf(e)});const If=e=>{let{unit:t}=e;return(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-2",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-3",children:"Unit Information"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.attack})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.defense})]}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,Lm.jsx)("span",{children:"\ud83d\udc0e Speed"}),(0,Lm.jsx)("span",{className:"font-bold",children:t.speed})]})]})},Ef=t=>{var n;let{resources:s,availablePopulation:r,onTrain:i,onClose:a,cityGameState:o,unitQueue:l,onCancelTrain:c}=t;const{gameState:u}=up(),d=null===u||void 0===u?void 0:u.god,h=Object.keys(qm).filter(e=>qm[e].mythical&&qm[e].god===d),[m,p]=(0,e.useState)(h[0]||null),[f,g]=(0,e.useState)("");if((0,e.useEffect)(()=>{g("")},[m]),(0,e.useEffect)(()=>{const e=Object.keys(qm).filter(e=>qm[e].mythical&&qm[e].god===d);p(e[0]||null)},[d]),!d)return(0,Lm.jsx)(Sp,{message:"You must worship a god to train mythical units.",onClose:a});if(!m)return(0,Lm.jsx)(Sp,{message:`There are no mythical units for your worshipped god, ${d}.`,onClose:a});const v=qm[m],y=(null===o||void 0===o?void 0:o.units)||{},x=(l||[]).filter(e=>{var t;return null===(t=qm[e.unitId])||void 0===t?void 0:t.mythical}),b=parseInt(f,10)||0,w={wood:v?v.cost.wood*b:0,stone:v?v.cost.stone*b:0,silver:v?v.cost.silver*b:0,population:v?v.cost.population*b:0,favor:v?v.cost.favor*b:0},k=(null===(n=o.worship)||void 0===n?void 0:n[d])||0,N=s.wood>=w.wood&&s.stone>=w.stone&&s.silver>=w.silver&&r>=w.population&&k>=w.favor;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:a,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"font-title text-3xl text-white",children:"Divine Temple"}),(0,Lm.jsx)("button",{onClick:a,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"flex-grow flex gap-4 overflow-y-auto",children:[(0,Lm.jsx)("div",{className:"w-1/3 flex flex-col gap-2",children:h.map(e=>{const t=qm[e],n=m===e;return(0,Lm.jsxs)("button",{onClick:()=>p(e),className:"flex items-center p-2 rounded border-2 transition-colors w-full "+(n?"bg-gray-600 border-yellow-500":"bg-gray-700 border-gray-600 hover:border-yellow-400"),children:[(0,Lm.jsx)("img",{src:_f[t.image],alt:t.name,className:"w-12 h-12 mr-3 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-left text-white",children:t.name}),(0,Lm.jsxs)("p",{className:"text-sm text-left text-gray-400",children:["In City: ",y[e]||0]})]})]},e)})}),(0,Lm.jsxs)("div",{className:"w-2/3 flex flex-col gap-4",children:[(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Lm.jsx)("h4",{className:"font-title text-2xl text-yellow-400",children:v.name}),(0,Lm.jsx)("p",{className:"text-gray-400 italic mt-1",children:v.description})]}),(0,Lm.jsxs)("div",{className:"flex gap-4",children:[(0,Lm.jsxs)("div",{className:"w-1/2 bg-gray-900 p-4 rounded-lg space-y-1",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg text-yellow-300 mb-2",children:"Cost (Total)"}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Wood: ",v.cost.wood," (",w.wood,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Stone: ",v.cost.stone," (",w.stone,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Silver: ",v.cost.silver," (",w.silver,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Population: ",v.cost.population," (",w.population,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-blue-300",children:["Favor: ",v.cost.favor," (",w.favor,")"]}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-300",children:["Time per unit: ",v.cost.time,"s"]})]}),(0,Lm.jsx)(If,{unit:v})]}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg flex items-center justify-between",children:[(0,Lm.jsx)("input",{type:"number",value:f,onChange:e=>{const t=e.target.value;(""===t||parseInt(t)>=0&&!t.includes("."))&&g(t)},className:"bg-gray-800 text-white rounded p-2 w-24",placeholder:"0"}),(0,Lm.jsx)("button",{onClick:()=>{const e=parseInt(f,10)||0;e>0&&i(m,e)},disabled:!N||0===b||(x||[]).length>=5,className:"py-2 px-6 text-lg rounded-lg btn "+(N&&b>0&&(x||[]).length<5?"btn-confirm":"btn-disabled"),children:(x||[]).length>=5?"Queue Full":"Train"})]})]})]}),(0,Lm.jsx)(Op,{unitQueue:x,onCancel:e=>c(e,"divineTemple"),title:"Mythical Unit Queue"})]})})},Af={},Pf=n(3938);Pf.keys().forEach(e=>{const t=e.replace("./","");Af[t]=Pf(e)});const Mf=e=>{let{onBuild:t,onClose:n,cityGameState:s,availablePopulation:r}=e;const i={wood:15e3,stone:15e3,silver:15e3,population:60},a=s.resources.wood>=i.wood&&s.resources.stone>=i.stone&&s.resources.silver>=i.silver&&r>=i.population;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"special-building-menu-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"special-building-header",children:[(0,Lm.jsx)("h3",{children:"Construct a Wonder"}),(0,Lm.jsx)("button",{onClick:n,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"p-2 text-center bg-amber-200 border-b-2 border-amber-400",children:[(0,Lm.jsxs)("p",{className:"font-bold",children:["Cost: ",i.wood," Wood, ",i.stone," Stone, ",i.silver," Silver, ",i.population," Population"]}),(0,Lm.jsx)("p",{className:"text-sm italic",children:"You may only construct one special building per city."})]}),(0,Lm.jsx)("div",{className:"special-building-grid",children:Object.entries(Yp).map(e=>{let[n,s]=e;return(0,Lm.jsxs)("div",{className:"special-building-card",children:[(0,Lm.jsx)("img",{src:Af[s.image],alt:s.name}),(0,Lm.jsx)("h4",{children:s.name}),(0,Lm.jsx)("p",{children:s.description}),(0,Lm.jsx)("button",{onClick:()=>t(n,i),disabled:!a,className:"special-build-btn",children:"Build"})]},n)})})]})})},Df={},Of=n(3938);Of.keys().forEach(e=>{const t=e.replace("./","");Df[t]=Of(e)});const Rf=e=>{let{buildingId:t,onClose:n,onDemolish:s}=e;const r=Yp[t];return r?(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"special-building-menu-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"special-building-header",children:[(0,Lm.jsx)("h3",{children:r.name}),(0,Lm.jsx)("button",{onClick:n,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"p-4 flex flex-col items-center text-center",children:[(0,Lm.jsx)("img",{src:Df[r.image],alt:r.name,className:"w-32 h-32 object-contain mb-4"}),(0,Lm.jsx)("p",{className:"italic mb-4",children:r.description}),(0,Lm.jsxs)("div",{className:"bg-amber-200 p-3 rounded w-full",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg",children:"Bonus"}),(0,Lm.jsx)("p",{children:r.bonus.description})]}),(0,Lm.jsx)("button",{onClick:s,className:"btn btn-danger mt-6",children:"Demolish"})]})]})}):(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"special-building-menu-container text-center p-8",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("p",{children:"Wonder information not found."}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-primary mt-4",children:"Close"})]})})},Lf={},$f=n(4731);$f.keys().forEach(e=>{const t=e.replace("./","");Lf[t]=$f(e)});const Ff={},Uf=n(2393);Uf.keys().forEach(e=>{const t=e.replace("./","");Ff[t]=Uf(e)});const Vf=t=>{let{cityGameState:n,onRecruitHero:s,onActivateSkill:r,onClose:i,onAssignHero:a,onUnassignHero:o,onLevelUpHero:l,onAddHeroXp:c}=t;const[u,d]=(0,e.useState)(Object.keys(Hm)[0]),{heroes:h={},activeSkills:m={}}=n,{activeCityId:p}=up(),f=Hm[u],g=h[u]||{level:1,xp:0},v=(null===g||void 0===g?void 0:g.cityId)===p,y=(e,t,n)=>{if(!e||!t||"number"!==typeof n)return e||"";const s=100*((e,t)=>e&&"number"===typeof t?(e.baseValue||0)+(t-1)*(e.valuePerLevel||0):0)(t,n),r=100*(t.valuePerLevel||0);let i=e.replace(/(\d+(\.\d+)?%)/,`${s.toFixed(1)}%`);return r>0&&(i+=` (+${r.toFixed(1)}% per level)`),i},x=g.level<f.maxLevel?f.xpPerLevel[g.level-1]:1/0,b=g.xp>=x&&g.level<f.maxLevel;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:i,children:(0,Lm.jsxs)("div",{className:"heroes-altar-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"heroes-altar-header",children:[(0,Lm.jsx)("h3",{children:"Heroes Altar"}),(0,Lm.jsx)("button",{onClick:i,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"heroes-altar-content",children:[(0,Lm.jsx)("div",{className:"heroes-list",children:Object.entries(Hm).map(e=>{let[t,n]=e;return(0,Lm.jsxs)("div",{className:"hero-list-item "+(u===t?"selected":""),onClick:()=>d(t),children:[(0,Lm.jsx)("img",{src:Lf[n.image],alt:n.name,className:"hero-list-avatar"}),(0,Lm.jsx)("span",{children:n.name}),h[t]&&(0,Lm.jsx)("span",{className:"recruited-indicator",children:"\u2714"})]},t)})}),(0,Lm.jsx)("div",{className:"hero-details-panel",children:f?(0,Lm.jsxs)("div",{className:"hero-details-content",children:[(0,Lm.jsxs)("div",{className:"hero-main-info",children:[(0,Lm.jsx)("img",{src:Lf[f.image],alt:f.name,className:"hero-details-avatar"}),(0,Lm.jsxs)("div",{className:"hero-text",children:[(0,Lm.jsxs)("h4",{children:[f.name," ",h[u]&&`(Lvl ${g.level})`]}),(0,Lm.jsx)("p",{children:f.description}),f.passive&&(0,Lm.jsxs)("div",{className:"passive-skill-info",children:[(0,Lm.jsxs)("h5",{children:["Passive: ",f.passive.name]}),(0,Lm.jsx)("p",{children:y(f.passive.description,f.passive.effect,g.level)})]}),h[u]&&(0,Lm.jsxs)("div",{className:"mt-2",children:[(0,Lm.jsx)("div",{className:"w-full bg-gray-600 rounded-full h-4",children:(0,Lm.jsx)("div",{className:"bg-yellow-400 h-4 rounded-full",style:{width:`${Math.min(100,g.xp/(x===1/0?g.xp:x)*100)}%`}})}),(0,Lm.jsxs)("p",{className:"text-xs text-center",children:[g.xp," / ",x===1/0?"Max":x," XP"]}),b&&(0,Lm.jsxs)("button",{className:"recruit-btn mt-1",onClick:()=>l(u),children:["Level Up (",f.levelUpCost.silver," Silver, ",f.levelUpCost.favor," Favor)"]}),(0,Lm.jsx)("button",{className:"text-xs",onClick:()=>c(u,100),children:"+100 XP"})]}),!h[u]&&(0,Lm.jsxs)("button",{className:"recruit-btn",onClick:e=>((e,t)=>{e.stopPropagation(),s(t)})(e,u),children:["Recruit (",f.cost.silver," Silver, ",f.cost.favor," Favor)"]}),h[u]&&!v&&(0,Lm.jsx)("button",{className:"recruit-btn",onClick:e=>((e,t)=>{e.stopPropagation(),a(t)})(e,u),children:"Assign to this City"}),h[u]&&v&&(0,Lm.jsx)("button",{className:"recruit-btn",onClick:e=>((e,t)=>{e.stopPropagation(),o(t)})(e,u),children:"Unassign from City"})]})]}),(0,Lm.jsx)("div",{className:"skills-list",children:f.skills.map(e=>{const t=((e,t)=>{if(!e||!e.cost||!e.cost.favor||"number"!==typeof t)return 0;const n=e.cost.favor;return(n.base||0)+(t-1)*(n.perLevel||0)})(e,g.level),n=m[e.name],s=n&&Date.now()<n.expires,i=s?Math.ceil((n.expires-Date.now())/1e3):0;return(0,Lm.jsxs)("div",{className:"skill-card",children:[(0,Lm.jsx)("img",{src:Ff[e.icon],alt:e.name,className:"skill-icon"}),(0,Lm.jsxs)("div",{className:"skill-info",children:[(0,Lm.jsxs)("h5",{children:[e.name," ",(0,Lm.jsxs)("span",{className:"skill-type",children:["(",e.type,")"]})]}),(0,Lm.jsx)("p",{children:y(e.description,e.effect,g.level)})]}),h[u]&&(0,Lm.jsx)("button",{className:"activate-skill-btn",onClick:t=>((e,t,n)=>{e.stopPropagation(),r(t,n)})(t,u,e),disabled:s,children:s?`Cooldown: ${i}s`:`Activate (${t} Favor)`})]},e.name)})})]}):(0,Lm.jsx)("p",{children:"Select a hero to see details."})})]})]})})},Bf=t=>{let{arrivalTime:n}=t;const[s,r]=(0,e.useState)("");return(0,e.useEffect)(()=>{const e=(t=n)?"function"===typeof t.toDate?t.toDate():t.seconds&&"number"===typeof t.seconds?new Date(1e3*t.seconds):new Date(t):null;var t;if(!e||isNaN(e.getTime()))return void r("Completed");const s=()=>{const t=new Date,n=e-t;if(n>0){const e=Math.ceil(n/1e3),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;r(`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}else r("Completed")};s();const i=setInterval(s,1e3);return()=>clearInterval(i)},[n]),(0,Lm.jsx)("span",{children:s})},zf={},qf=n(4731);qf.keys().forEach(e=>{const t=e.replace("./","");zf[t]=qf(e)});const Wf=e=>{var t;let{cityGameState:n,onClose:s,onReleaseHero:r}=e;const i=n.prisoners||[],a=(null===(t=n.buildings.prison)||void 0===t?void 0:t.level)||0,o=a>0?a+4:0;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"prison-menu-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"prison-header",children:[(0,Lm.jsxs)("h3",{children:["Prison (Level ",a,")"]}),(0,Lm.jsxs)("p",{children:["Capacity: ",i.length," / ",o]}),(0,Lm.jsx)("button",{onClick:s,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"prison-content",children:i.length>0?i.map((e,t)=>{const n=Hm[e.heroId];if(!n)return null;const s=28800+9600*(a-1),i=(e=>{if(!e)return null;if("function"===typeof e.toDate)return e.toDate();if(e.seconds&&"number"===typeof e.seconds)return new Date(1e3*e.seconds);const t=new Date(e);return isNaN(t.getTime())?null:t})(e.capturedAt),o=i?new Date(i.getTime()+1e3*s):null;return(0,Lm.jsxs)("div",{className:"prisoner-item",children:[(0,Lm.jsx)("img",{src:zf[n.image],alt:n.name,className:"prisoner-avatar"}),(0,Lm.jsxs)("div",{className:"prisoner-info",children:[(0,Lm.jsx)("p",{className:"prisoner-name",children:n.name}),(0,Lm.jsxs)("p",{className:"prisoner-owner",children:["Owner: ",e.ownerUsername]}),(0,Lm.jsxs)("p",{className:"prisoner-city",children:["From: ",e.originCityName||"Unknown City"]}),(0,Lm.jsxs)("p",{className:"execution-timer",children:["Execution in:",o?(0,Lm.jsx)(Bf,{arrivalTime:o}):"Calculating..."]})]}),(0,Lm.jsx)("div",{className:"prisoner-actions",children:(0,Lm.jsx)("button",{onClick:()=>r(e),className:"release-btn",children:"Release"})})]},`${e.heroId}-${t}`)}):(0,Lm.jsx)("p",{className:"text-center text-gray-500",children:"The prison is empty."})}),(0,Lm.jsx)("div",{className:"prison-footer",children:(0,Lm.jsx)("p",{className:"text-xs italic",children:"Heroes are executed after their timer runs out. Executed heroes can only be revived with a 'Soulstone'. If this city is conquered, all prisoners will be freed."})})]})})},Hf=e=>{var t,n,s,r;let{cityGameState:i,worldId:a,currentUser:o,userProfile:l,isInstantBuild:c,getUpgradeCost:u,getFarmCapacity:d,getWarehouseCapacity:h,getHospitalCapacity:m,getProductionRates:p,calculateUsedPopulation:f,saveGameState:g,handleUpgrade:v,handleCancelBuild:y,handleTrainTroops:x,handleCancelTrain:b,handleFireTroops:w,handleStartResearch:k,handleCancelResearch:N,handleWorshipGod:j,handleCheat:C,handleHealTroops:S,handleCancelHeal:_,availablePopulation:T,modalState:I,openModal:E,closeModal:A,setMessage:P,onAddWorker:M,onRemoveWorker:D,getMaxWorkerSlots:O,getMarketCapacity:R,handleBuildSpecialBuilding:L,handleDemolish:$,handleDemolishSpecialBuilding:F,handleSpawnGodTown:U,onRecruitHero:V,onActivateSkill:B,onAssignHero:z,onUnassignHero:q,onApplyWorkerPreset:W,onReleaseHero:H}=e;const{selectedBuildingId:G,isSenateViewOpen:Q,isBarracksMenuOpen:Y,isShipyardMenuOpen:K,isTempleMenuOpen:X,isCaveMenuOpen:J,isAcademyMenuOpen:Z,isHospitalMenuOpen:ee,isCheatMenuOpen:te,isMarketMenuOpen:ne,isDivineTempleMenuOpen:se,isSpecialBuildingMenuOpen:re,isSpecialBuildingPanelOpen:ie,isHeroesAltarOpen:ae,isPrisonMenuOpen:oe}=I;if(!i)return null;const le=R(null===(t=i.buildings)||void 0===t||null===(n=t.market)||void 0===n?void 0:n.level);return(0,Lm.jsxs)(Lm.Fragment,{children:[G&&(0,Lm.jsx)(Qp,{buildingId:G,buildingData:i.buildings[G],onClose:()=>A("selectedBuildingId"),getProductionRates:p,getWarehouseCapacity:h,getFarmCapacity:d,onOpenBarracks:()=>{A("selectedBuildingId"),E("isBarracksMenuOpen")},onOpenShipyard:()=>{A("selectedBuildingId"),E("isShipyardMenuOpen")},onOpenMarket:()=>{A("selectedBuildingId"),E("isMarketMenuOpen")},onAddWorker:M,onRemoveWorker:D,availablePopulation:T,getMaxWorkerSlots:O}),Q&&(0,Lm.jsx)(of,{buildings:i.buildings,resources:i.resources,onUpgrade:v,onDemolish:$,getUpgradeCost:u,onClose:()=>A("isSenateViewOpen"),usedPopulation:f(i),maxPopulation:d(null===(s=i.buildings)||void 0===s||null===(r=s.farm)||void 0===r?void 0:r.level),buildQueue:i.buildQueue,onCancelBuild:y,cityGameState:i,onOpenSpecialBuildingMenu:()=>E("isSpecialBuildingMenuOpen"),onDemolishSpecialBuilding:F,currentUser:o,worldId:a,setMessage:P,onAddWorker:M,onRemoveWorker:D,getMaxWorkerSlots:O,availablePopulation:T,onApplyWorkerPreset:W}),Y&&(0,Lm.jsx)(zp,{resources:i.resources,availablePopulation:T,onTrain:x,onFire:w,onClose:()=>A("isBarracksMenuOpen"),cityGameState:i,unitQueue:i.barracksQueue,onCancelTrain:e=>b(e,"barracks")}),se&&(0,Lm.jsx)(Ef,{resources:i.resources,availablePopulation:T,onTrain:x,onClose:()=>A("isDivineTempleMenuOpen"),unitQueue:i.divineTempleQueue,onCancelTrain:e=>b(e,"divineTemple"),cityGameState:i}),K&&(0,Lm.jsx)(Gp,{resources:i.resources,availablePopulation:T,onTrain:x,onClose:()=>A("isShipyardMenuOpen"),cityGameState:i,unitQueue:i.shipyardQueue,onCancelTrain:e=>b(e,"shipyard")}),X&&(0,Lm.jsx)(df,{city:i,onWorship:j,onClose:()=>A("isTempleMenuOpen"),favorData:i.worship||{}}),Z&&(0,Lm.jsx)(Sf,{cityGameState:i,onResearch:k,onClose:()=>A("isAcademyMenuOpen"),researchQueue:i.researchQueue,onCancelResearch:N}),J&&(0,Lm.jsx)(hf,{cityGameState:i,onClose:()=>A("isCaveMenuOpen"),saveGameState:g,currentUser:o,worldId:a}),ee&&(0,Lm.jsx)(ff,{cityGameState:i,onClose:()=>A("isHospitalMenuOpen"),onHeal:S,onCancelHeal:_,getHospitalCapacity:m,availablePopulation:T}),ne&&(0,Lm.jsx)(bf,{onClose:()=>A("isMarketMenuOpen"),cityGameState:i,worldId:a,marketCapacity:le}),re&&(0,Lm.jsx)(Mf,{cityGameState:i,onBuild:L,onClose:()=>A("isSpecialBuildingMenuOpen"),availablePopulation:T}),ie&&(0,Lm.jsx)(Rf,{buildingId:i.specialBuilding,onClose:()=>A("isSpecialBuildingPanelOpen"),onDemolish:F}),ae&&(0,Lm.jsx)(Vf,{cityGameState:i,onRecruitHero:V,onActivateSkill:B,onClose:()=>A("isHeroesAltarOpen"),onAssignHero:z,onUnassignHero:q}),oe&&(0,Lm.jsx)(Wf,{cityGameState:i,onClose:()=>A("isPrisonMenuOpen"),onReleaseHero:H}),te&&(null===l||void 0===l?void 0:l.is_admin)&&(0,Lm.jsx)(Ep,{onCheat:C,onClose:()=>A("isCheatMenuOpen"),isInstantBuildActive:c,onSpawnGodTown:U})]})},Gf=e=>{let{building:t,level:n,onClick:s,image:r}=e;const{id:i,name:a,position:o}=t,l="city_wall"===i,c={top:`${o.y}px`,left:`${o.x}px`,width:l?"2000px":"200px",height:"150px",backgroundImage:n>0&&r?`url(${r})`:"none",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"};return 0===n?(0,Lm.jsx)("div",{className:"building-spot absolute flex items-center justify-center p-2 rounded-lg cursor-pointer hover:bg-black/20",style:c,onClick:s,title:`Build ${a}`,children:(0,Lm.jsx)("span",{className:"text-gray-400 text-sm",children:l?`Build ${a}`:"Empty Plot"})}):(0,Lm.jsx)("div",{className:"building-spot absolute flex flex-col items-center justify-center p-2 rounded-lg transition-colors duration-200 cursor-pointer",style:{...c,backgroundColor:r?"transparent":"rgba(139, 69, 19, 0.7)"},onClick:s})},Qf=e=>{let{building:t,onClick:n,image:s,name:r,isConstructed:i}=e;const{position:a}=t,o={top:`${a.y}px`,left:`${a.x}px`,width:"200px",height:"150px",backgroundImage:i&&s?`url(${s})`:"none",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"};return i?(0,Lm.jsx)("div",{className:"building-spot absolute flex flex-col items-center justify-end p-2 rounded-lg transition-colors duration-200 cursor-pointer",style:{...o,backgroundColor:s?"transparent":"rgba(139, 69, 19, 0.7)"},onClick:n,title:r,children:(0,Lm.jsx)("span",{className:"text-white text-sm font-bold bg-black/50 px-2 py-1 rounded",children:r})}):(0,Lm.jsx)("div",{className:"building-spot absolute flex items-center justify-center p-2 rounded-lg cursor-pointer hover:bg-black/20",style:o,onClick:n,title:`Build ${r}`,children:(0,Lm.jsx)("span",{className:"text-gray-400 text-sm",children:"Empty Plot"})})},Yf=JSON.parse('[{"id":"city_wall","name":"City Wall","position":{"x":0,"y":650}},{"id":"senate","name":"Senate","position":{"x":1105,"y":360}},{"id":"timber_camp","name":"Lumber Mill","position":{"x":200,"y":470}},{"id":"quarry","name":"Stone Quarry","position":{"x":750,"y":70}},{"id":"barracks","name":"Barracks","position":{"x":840,"y":410}},{"id":"silver_mine","name":"Silver Mine","position":{"x":605,"y":330}},{"id":"market","name":"Market","position":{"x":1500,"y":400}},{"id":"warehouse","name":"Warehouse","position":{"x":200,"y":10}},{"id":"farm","name":"Farm","position":{"x":1400,"y":90}},{"id":"temple","name":"Temple","position":{"x":500,"y":100}},{"id":"divine_temple","name":"Divine Temple","position":{"x":450,"y":400}},{"id":"cave","name":"Cave","position":{"x":1300,"y":600}},{"id":"academy","name":"Academy","position":{"x":1100,"y":250}},{"id":"hospital","name":"Hospital","position":{"x":1050,"y":100}},{"id":"shipyard","name":"Shipyard","position":{"x":1043,"y":840}},{"id":"special_building_plot","name":"Special Building","position":{"x":1525,"y":700}},{"id":"heroes_altar","name":"Heroes\' Altar","position":{"x":1750,"y":700}},{"id":"prison","name":"Prison","position":{"x":840,"y":250}}]');var Kf=n(5297);const Xf=e=>{let{buildings:t,onBuildingClick:n,buildingImages:s,cityGameState:r,onOpenSpecialBuildingMenu:i}=e;return(0,Lm.jsx)("div",{style:{width:"2000px",height:"1200px",position:"relative",backgroundImage:`url(${Kf})`,backgroundSize:"cover",backgroundPosition:"center"},children:Yf.map(e=>{if("special_building_plot"===e.id){if(!r)return null;const t=r.specialBuilding,i=t?Yp[t]:zm.special_building_plot,a=null!==i&&void 0!==i&&i.image?s[i.image]:null;return(0,Lm.jsx)(Qf,{building:e,onClick:()=>n(e.id),image:a,name:i.name,isConstructed:!!t},e.id)}const i=t[e.id],a=(null===i||void 0===i?void 0:i.level)||0,o=zm[e.id];return(0,Lm.jsx)(Gf,{building:e,level:a,onClick:()=>n(e.id),image:null!==o&&void 0!==o&&o.image?s[o.image]:null},e.id)})})};var Jf=n(1538);const Zf=n(5316),eg=Zf.keys().reduce((e,t)=>(e[t.replace("./","")]=Zf(t),e),{}),tg=e=>{var t;let{godName:n,playerReligion:s,worship:r,buildings:i,onOpenPowers:a}=e;const o=((e,t)=>{if(!e||!t)return null;const n=t.toLowerCase(),s=lf[n];return s?Object.values(s).find(t=>t.name===e):null})(n,s),l=n&&r&&r[n]||0,c=(null===i||void 0===i||null===(t=i.temple)||void 0===t?void 0:t.level)||0,u=c>0?100+20*c:0;return(0,Lm.jsx)("div",{className:"worship-display-container",children:n&&o?(0,Lm.jsxs)("div",{className:"text-center",children:[(0,Lm.jsx)("img",{src:eg[o.image],alt:o.name,className:"w-24 h-24 mx-auto rounded-full border-4 border-yellow-500"}),(0,Lm.jsx)("p",{className:"text-lg font-bold mt-2",children:n}),(0,Lm.jsxs)("p",{className:"text-sm text-blue-600 mt-2",children:["Favor: ",Math.floor(l)," / ",u]}),(0,Lm.jsx)("button",{onClick:a,className:"spells-button",children:(0,Lm.jsx)("img",{src:Jf,alt:"View Spells",className:"w-10 h-10 object-contain"})})]}):(0,Lm.jsx)("p",{className:"text-gray-500 text-center text-sm",children:"Build a Temple to worship a god."})})},ng={};[n(3542),n(326),n(5316)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");ng[n]=e(t)})});const sg=t=>{let{units:n,reinforcements:s,title:r}=t;const[i,a]=(0,e.useState)(null),[o,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(5),d=(0,e.useRef)(null),h=(0,e.useRef)(null),m=(0,e.useRef)(null),p=(0,e.useRef)(null);(0,e.useEffect)(()=>{const e=e=>{o&&p.current&&!p.current.contains(e.target)&&(l(!1),a(null))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o]),(0,e.useEffect)(()=>(clearTimeout(h.current),clearInterval(m.current),u(5),i&&!o&&(m.current=setInterval(()=>{u(e=>e<=1?(clearInterval(m.current),0):e-1)},1e3),h.current=setTimeout(()=>{l(!0),clearInterval(m.current)},5e3)),()=>{clearTimeout(h.current),clearInterval(m.current)}),[i,o]);const f=()=>{o||(d.current=setTimeout(()=>{a(null)},300))},g=Object.entries(n||{}).filter(e=>{var t,n;let[s,r]=e;return r>0&&"land"===(null===(t=qm[s])||void 0===t?void 0:t.type)&&!(null!==(n=qm[s])&&void 0!==n&&n.mythical)}),v=Object.entries(n||{}).filter(e=>{var t,n;let[s,r]=e;return r>0&&"naval"===(null===(t=qm[s])||void 0===t?void 0:t.type)&&!(null!==(n=qm[s])&&void 0!==n&&n.mythical)}),y=Object.entries(n||{}).filter(e=>{var t;let[n,s]=e;return s>0&&(null===(t=qm[n])||void 0===t?void 0:t.mythical)}),x=s&&Object.keys(s).length>0,b=g.length>0||v.length>0||y.length>0,w=e=>{let[t,n]=e;const s=qm[t];if(!s||!s.image)return null;const r=ng[s.image];return r?(0,Lm.jsxs)("div",{className:"troop-item",onMouseEnter:()=>(e=>{o&&i!==e&&l(!1),clearTimeout(d.current),a(e)})(t),onClick:e=>((e,t)=>{e.stopPropagation(),o&&i===t?(l(!1),a(null)):(l(!0),a(t))})(e,t),children:[(0,Lm.jsx)("img",{src:r,alt:s.name,className:"troop-image"}),(0,Lm.jsx)("span",{className:"troop-count",children:n})]},t):null};return(0,Lm.jsxs)("div",{className:"troop-display-container",ref:p,onMouseLeave:f,children:[(()=>{var e;if(!i)return null;const t=qm[i];if(!t)return null;const n=null===(e=t.counters)||void 0===e?void 0:e.map(e=>{var t;return null===(t=qm[e])||void 0===t?void 0:t.name}).join(", ");return(0,Lm.jsxs)("div",{className:"unit-tooltip",onMouseEnter:()=>clearTimeout(d.current),onMouseLeave:f,children:[(0,Lm.jsx)("div",{className:"tooltip-header",children:(0,Lm.jsx)("h3",{className:"tooltip-title",children:t.name})}),(0,Lm.jsxs)("div",{className:"tooltip-body",children:[(0,Lm.jsx)("img",{src:ng[t.image],alt:t.name,className:"tooltip-image"}),(0,Lm.jsxs)("div",{className:"tooltip-stats",children:[(0,Lm.jsxs)("div",{className:"stat-row",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack"}),(0,Lm.jsx)("span",{children:t.attack})]}),(0,Lm.jsxs)("div",{className:"stat-row",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense"}),(0,Lm.jsx)("span",{children:t.defense})]}),(0,Lm.jsxs)("div",{className:"stat-row",children:[(0,Lm.jsx)("span",{children:"\ud83c\udfc3 Speed"}),(0,Lm.jsx)("span",{children:t.speed})]})]}),n&&(0,Lm.jsxs)("div",{className:"tooltip-counters",children:[(0,Lm.jsx)("strong",{children:"Counters:"})," ",n]}),(0,Lm.jsx)("p",{className:"tooltip-description",children:t.description})]}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:o?"\ud83d\udd12":c})]})})(),g.length>0&&(0,Lm.jsxs)("div",{className:"troop-section",children:[(0,Lm.jsx)("h4",{className:"troop-section-header",children:"Units"}),(0,Lm.jsx)("div",{className:"troop-grid",children:g.map(w)})]}),y.length>0&&(0,Lm.jsxs)("div",{className:"troop-section",children:[(0,Lm.jsx)("h4",{className:"troop-section-header",children:"Mythic Units"}),(0,Lm.jsx)("div",{className:"troop-grid",children:y.map(w)})]}),v.length>0&&(0,Lm.jsxs)("div",{className:"troop-section",children:[(0,Lm.jsx)("h4",{className:"troop-section-header",children:"Ships"}),(0,Lm.jsx)("div",{className:"troop-grid",children:v.map(w)})]}),x&&(0,Lm.jsxs)("div",{className:"troop-section",children:[(0,Lm.jsx)("h4",{className:"troop-section-header",children:"Reinforcements"}),Object.entries(s).map(e=>{let[t,n]=e;return(0,Lm.jsxs)("div",{className:"mb-2 last:mb-0",children:[(0,Lm.jsx)("p",{className:"text-xs text-center font-semibold text-yellow-600",children:n.originCityName}),(0,Lm.jsx)("div",{className:"troop-grid",children:Object.entries(n.units||{}).map(w)})]},t)})]}),!b&&!x&&(0,Lm.jsx)("p",{className:"text-gray-500 text-xs text-center p-4",children:"No troops in this city."})]})},rg={},ig=n(4731);ig.keys().forEach(e=>{const t=e.replace("./","");rg[t]=ig(e)});const ag=e=>{let{heroes:t}=e;const n=Object.keys(t||{}).filter(e=>t[e].active);return 0===n.length?null:(0,Lm.jsxs)("div",{className:"hero-display-container",children:[(0,Lm.jsx)("h3",{className:"hero-display-header",children:"Hero"}),(0,Lm.jsx)("div",{className:"heroes-grid",children:n.map(e=>{const t=Hm[e];return(0,Lm.jsx)("div",{className:"hero-item",title:t.name,children:(0,Lm.jsx)("img",{src:rg[t.image],alt:t.name})},e)})})]})},og=e=>{let{gameState:t,className:n,onOpenPowers:s}=e;return t?(0,Lm.jsxs)("div",{className:n,children:[(0,Lm.jsx)(tg,{godName:t.god,playerReligion:t.playerInfo.religion,worship:t.worship,buildings:t.buildings,onOpenPowers:s}),(0,Lm.jsx)(ag,{heroes:t.heroes}),(0,Lm.jsx)(sg,{units:t.units||{}})]}):null},lg={};[n(326),n(3938)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");lg[n]=e(t)})});const cg=t=>{let{cityGameState:n,handlePlotClick:s,onOpenPowers:r,gameSettings:i,onOpenSpecialBuildingMenu:a}=t;const o=(0,e.useRef)(null),l=(0,e.useRef)(null),[c,u]=(0,e.useState)({x:0,y:0}),[d,h]=(0,e.useState)(!1),[m,p]=(0,e.useState)({x:0,y:0}),f=(0,e.useCallback)(e=>{if(!o.current)return{x:0,y:0};const{clientWidth:t,clientHeight:n}=o.current,s=t-2e3,r=n-1200;return{x:Math.max(s,Math.min(0,e.x)),y:Math.max(r,Math.min(0,e.y))}},[]);(0,e.useLayoutEffect)(()=>{if(!o.current)return;const{clientWidth:e,clientHeight:t}=o.current;u(f({x:(e-2e3)/2,y:(t-1200)/2}))},[f]),(0,e.useEffect)(()=>{const e=l.current;e&&(e.style.transform=`translate(${c.x}px, ${c.y}px)`)},[c]);const g=(0,e.useCallback)(e=>{0===e.button&&(e.preventDefault(),p({x:e.clientX-c.x,y:e.clientY-c.y}),h(!0))},[c]);return(0,e.useEffect)(()=>{const e=e=>{d&&u(f({x:e.clientX-m.x,y:e.clientY-m.y}))},t=()=>h(!1);return d&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[d,m,f]),i.showVisuals?(0,Lm.jsxs)("main",{className:"flex-grow w-full h-full relative overflow-hidden cursor-grab",ref:o,onMouseDown:g,children:[(0,Lm.jsx)("div",{ref:l,style:{transformOrigin:"0 0"},children:(0,Lm.jsx)(Xf,{buildings:n.buildings,onBuildingClick:s,buildingImages:lg,cityGameState:n,onOpenSpecialBuildingMenu:a})}),(0,Lm.jsx)(og,{gameState:n,className:"absolute top-1/2 right-4 transform -translate-y-1/2 z-20 flex flex-col gap-4",onOpenPowers:r})]}):(0,Lm.jsxs)("main",{className:"flex-grow w-full h-full relative overflow-y-auto p-4",children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"City Buildings"}),(0,Lm.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.entries(n.buildings).map(e=>{let[t,n]=e;var r;return n.level>0?(0,Lm.jsxs)("div",{className:"bg-gray-800 p-3 rounded-lg cursor-pointer hover:bg-gray-700",onClick:()=>s(t),children:[(0,Lm.jsx)("p",{className:"font-bold text-lg text-yellow-400",children:null===(r=zm[t])||void 0===r?void 0:r.name}),(0,Lm.jsxs)("p",{children:["Level ",n.level]})]},t):null})}),(0,Lm.jsx)(og,{gameState:n,className:"absolute top-1/2 right-4 transform -translate-y-1/2 z-20",onOpenPowers:r})]})},ug=e=>{let{godName:t,playerReligion:n,favor:s,onCastSpell:r,onClose:i,targetType:a="self",isMenu:o=!1}=e;const l=((e,t)=>{if(!e||!t)return null;const n=t.toLowerCase(),s=lf[n];return s?Object.values(s).find(t=>t.name===e):null})(t,n);if(!l)return null;const c=l.powers.filter(e=>e.effect.target===a||"both"===e.effect.target),u=(0,Lm.jsxs)("div",{className:o?"divine-powers-menu-content":"divine-powers-modal-content",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"divine-powers-header",children:[(0,Lm.jsxs)("h2",{children:[l.name,"'s Powers"]}),(0,Lm.jsx)("button",{onClick:i,className:"close-button",children:"\xd7"})]}),c.length>0?(0,Lm.jsx)("div",{className:"powers-grid",children:c.map(e=>(0,Lm.jsxs)("div",{className:"power-card",children:[(0,Lm.jsx)("h3",{children:e.name}),(0,Lm.jsx)("p",{children:e.description}),(0,Lm.jsxs)("div",{className:"power-cost",children:["Cost: ",e.favorCost," Favor"]}),(0,Lm.jsx)("button",{onClick:()=>r(e),disabled:s<e.favorCost,className:"cast-spell-button",children:"Cast Spell"})]},e.name))}):(0,Lm.jsxs)("p",{className:"text-gray-400 text-center",children:["No ","self"===a?"self-targeted":"targeted"," spells available for ",l.name,"."]})]});return o?u:(0,Lm.jsx)("div",{className:"divine-powers-modal-overlay",onClick:i,children:u})},dg=["island_1.png"],hg={"island_1.png":{citySlots:[{x:-1,y:4},{x:5,y:1},{x:2,y:5},{x:5,y:-1},{x:-6,y:1},{x:-6,y:1},{x:-3,y:1},{x:-6,y:-2},{x:4,y:-4},{x:0,y:-5}],villages:[{x:-3,y:-1},{x:1,y:-1},{x:4,y:-1},{x:0,y:0},{x:-2,y:0}]}};const mg=["Oakhaven","Willow Creek","Stonebridge","Riverbend","Greenfield","Fairview","Maplewood","Pinehurst","Cedarbrook","Elmwood","Ashworth","Birchwood","Silver Creek","Goldcrest","Ironwood","Copperhill","Crystal Falls","Amberwood"],pg=function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r={},i=(t,n)=>{for(const s of e){if(Math.pow(t-s.x,2)+Math.pow(n-s.y,2)<=Math.pow(s.radius+5,2))return!0}return!1};for(let a=0;a<s;a++){let e,s,o=0;do{e=Math.floor(Math.random()*t),s=Math.floor(Math.random()*n),o++}while(i(e,s)&&o<100);if(o<100){const t=`god-town-${Date.now()}-${a}`,n=new Date;r[t]={id:t,x:e,y:s,name:"Strange Ruins",stage:"ruins",puzzleId:"puzzle_"+(a%3+1),troops:{manticore:500,medusa:500,pegasus:500,sphinx:500,phoenix:500,serpopard:500},spawnTime:n,transformationTime:new Date(n.getTime()+864e5)}}}return r},fg=t=>{let{type:n,data:s,onSelect:r,onClose:i,buttonRef:a}=t;const[o,l]=(0,e.useState)(""),[c,u]=(0,e.useState)([]),d=(0,e.useRef)(null),h=(0,e.useRef)(null);(0,e.useEffect)(()=>{if("player"===n||"city"===n||"alliance"===n)if(o.length>0){const e=s.filter(e=>e.toLowerCase().startsWith(o.toLowerCase()));u(e.slice(0,5))}else u([])},[o,s,n]),(0,e.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},[]),(0,e.useEffect)(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&i()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const m=e=>{e.trim()&&r(e.trim())};return(0,Lm.jsxs)("div",{ref:d,className:"mention-input-popup",style:(()=>{if(!a)return{};const e=a.getBoundingClientRect();return{top:`${e.bottom+window.scrollY+5}px`,left:`${e.left+window.scrollX}px`}})(),children:[(0,Lm.jsx)("input",{ref:h,type:"text",value:o,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),m(o)):"Escape"===e.key&&i()},placeholder:`Enter ${n} name...`,className:"mention-input"}),("player"===n||"city"===n||"alliance"===n)&&c.length>0&&(0,Lm.jsx)("ul",{className:"mention-suggestions",children:c.map(e=>(0,Lm.jsx)("li",{onClick:()=>m(e),children:e},e))})]})},gg={players:null,cities:null,alliances:null,timestamp:0},vg=t=>{let{value:n,onChange:s}=t;const{worldId:r}=up(),i=(0,e.useRef)(null),[a,o]=(0,e.useState)(!1),[l,c]=(0,e.useState)({visible:!1,type:null,buttonRef:null}),[u,d]=(0,e.useState)([]),[h,m]=(0,e.useState)([]),[p,f]=(0,e.useState)([]);(0,e.useEffect)(()=>{if(!r)return;(async()=>{const e=Date.now();if(e-gg.timestamp<3e5&&gg.players)return d(gg.players),m(gg.cities),void f(gg.alliances);const t=Jd(Om,"users"),n=Jd(Om,"worlds",r,"citySlots"),s=Jd(Om,"worlds",r,"alliances"),i=cm(t),a=cm(Bh(n,qh("ownerId","!=",null))),o=cm(s),[l,c,u]=await Promise.all([i,a,o]),h=l.docs.map(e=>e.data().username),p=c.docs.map(e=>e.data().cityName),g=u.docs.map(e=>e.data().name);d(h),m(p),f(g),gg.players=h,gg.cities=p,gg.alliances=g,gg.timestamp=e})()},[r]);const g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=i.current,a=r.selectionStart,o=r.selectionEnd;let l=n.substring(a,o);!l&&t&&(l=t);let c=`[${e}${t&&"url"!==e?`=${t}`:""}]`;"url"===e&&t&&(c=`[url=${l}]`,l=t);const u=`[/${e}]`,d=`${n.substring(0,a)}${c}${l}${u}${n.substring(o)}`;s(d),setTimeout(()=>{r.focus();const e=a+c.length+l.length+u.length;r.setSelectionRange(e,e)},0)},v=(e,t)=>{c({visible:!0,type:e,buttonRef:t.currentTarget})};return(0,Lm.jsxs)("div",{className:"text-editor-container",children:[l.visible&&(0,Lm.jsx)(fg,{type:l.type,data:"player"===l.type?u:"city"===l.type?h:"alliance"===l.type?p:[],onSelect:e=>{g(l.type,e),c({visible:!1,type:null,buttonRef:null})},onClose:()=>c({visible:!1,type:null,buttonRef:null}),buttonRef:l.buttonRef}),(0,Lm.jsxs)("div",{className:"editor-toolbar",children:[(0,Lm.jsx)("button",{type:"button",onClick:()=>g("b"),className:"toolbar-btn",title:"Bold",children:"B"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("i"),className:"toolbar-btn italic",title:"Italic",children:"I"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("u"),className:"toolbar-btn underline",title:"Underline",children:"U"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("spoiler"),className:"toolbar-btn",title:"Spoiler",children:"S"}),(0,Lm.jsxs)("div",{className:"relative",children:[(0,Lm.jsx)("button",{type:"button",onClick:()=>o(!a),className:"toolbar-btn",title:"Text Color",children:"A"}),a&&(0,Lm.jsx)("div",{className:"color-palette",children:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"].map(e=>(0,Lm.jsx)("button",{type:"button",onClick:()=>(e=>{g("color",e),o(!1)})(e),className:"color-swatch",style:{backgroundColor:e}},e))})]}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("size","10"),className:"toolbar-btn",title:"Font Size",children:"Size"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("img"),className:"toolbar-btn",title:"Image",children:"Img"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>g("url","Link Text"),className:"toolbar-btn",title:"URL",children:"URL"}),(0,Lm.jsx)("button",{type:"button",onClick:e=>v("player",e),className:"toolbar-btn",title:"Player",children:"P"}),(0,Lm.jsx)("button",{type:"button",onClick:e=>v("alliance",e),className:"toolbar-btn",title:"Alliance",children:"A"}),(0,Lm.jsx)("button",{type:"button",onClick:e=>v("city",e),className:"toolbar-btn",title:"City",children:"C"}),(0,Lm.jsx)("button",{type:"button",onClick:e=>v("island",e),className:"toolbar-btn",title:"Island",children:"I"})]}),(0,Lm.jsx)("textarea",{ref:i,value:n,onChange:e=>s(e.target.value),className:"editor-textarea"})]})};var yg=n(8258);const xg={},bg=t=>{let{onClose:n,viewUserId:s,onGoToCity:r,onInviteToAlliance:i,onOpenAllianceProfile:a}=t;const{currentUser:o,userProfile:l,updateUserProfile:c}=Fm(),{worldId:u}=up(),{playerAlliance:d}=sp(),{calculateTotalPoints:h}=lp(u),[m,p]=(0,e.useState)(null),[f,g]=(0,e.useState)(null),[v,y]=(0,e.useState)([]),[x,b]=(0,e.useState)(0),[w,k]=(0,e.useState)(0),[N,j]=(0,e.useState)(0),[C,S]=(0,e.useState)(!0),[_,T]=(0,e.useState)(""),[I,E]=(0,e.useState)(""),[A,P]=(0,e.useState)(!1),M=!s||s===o.uid;(0,e.useEffect)(()=>{const e=s||o.uid,t=Date.now();if(xg[e]&&t-xg[e].timestamp<12e5){const t=xg[e].data;p(t.profileData),g(t.gameData),y(t.cities),b(t.points),k(t.totalAttack),j(t.totalDefense),T(t.profileData.description||""),E(t.profileData.imageUrl||""),S(!1)}else(async()=>{S(!0);const e=s||o.uid;try{const t=eh(Om,"users",e),n=await om(t);let s=null;n.exists()&&(s=n.data(),p(s),T(s.description||""),E(s.imageUrl||""));const r=eh(Om,`users/${e}/games`,u),i=await om(r),a=i.exists()?i.data():null;g(a);const o=Jd(Om,`users/${e}/games`,u,"cities"),l=(await cm(o)).docs.map(e=>({id:e.id,...e.data()}));y(l);let c=0,d=0,m=0;for(const e of l)if(c+=h(e),e.units)for(const[t,n]of Object.entries(e.units)){const e=qm[t];e&&(d+=(e.attack||0)*n,m+=(e.defense||0)*n)}b(c),k(d),j(m),xg[e]={data:{profileData:s,gameData:a,cities:l,points:c,totalAttack:d,totalDefense:m},timestamp:Date.now()}}catch(t){console.error("Error fetching user data:",t)}S(!1)})()},[s,o.uid,u,h]);if(C)return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsx)("div",{className:"text-white",children:"Loading Profile..."})});const D=M?l:m,O=(e,t)=>void 0===e||void 0===t?"?":`${Math.floor(t/10)}${Math.floor(e/10)}`,R=(e=>{if(!d||M)return!1;const t=d.members.find(e=>e.uid===o.uid);if(!t)return!1;const n=d.ranks.find(e=>e.id===t.rank);return(null===n||void 0===n||null===(e=n.permissions)||void 0===e?void 0:e.inviteMembers)||!1})();return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"profile-papyrus !h-auto max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("button",{onClick:n,className:"profile-close-button",children:"\xd7"}),(0,Lm.jsxs)("div",{className:"profile-grid",children:[(0,Lm.jsxs)("div",{className:"profile-left-column",children:[(0,Lm.jsxs)("div",{className:"profile-box",children:[(0,Lm.jsx)("div",{className:"profile-box-header",children:null===D||void 0===D?void 0:D.username}),(0,Lm.jsx)("div",{className:"player-info-content",children:null!==f&&void 0!==f&&f.alliance?(0,Lm.jsxs)("button",{onClick:()=>a(f.alliance),className:"text-blue-400 hover:underline font-bold",children:["[",f.alliance,"]"]}):"No Alliance"}),(0,Lm.jsxs)("div",{className:"player-stats",children:[(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack Points"})," ",(0,Lm.jsx)("span",{children:w.toLocaleString()})]}),(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense Points"})," ",(0,Lm.jsx)("span",{children:N.toLocaleString()})]}),(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\ud83c\udfc6 Total Points"})," ",(0,Lm.jsx)("span",{children:x.toLocaleString()})]})]})]}),(0,Lm.jsxs)("div",{className:"profile-box flex-grow min-h-0",children:[(0,Lm.jsxs)("div",{className:"profile-box-header flex justify-between items-center",children:[(0,Lm.jsxs)("span",{children:["Cities (",v.length,")"]}),(0,Lm.jsx)("button",{className:"text-xs bg-gray-500/50 px-2 py-0.5 rounded",children:"BBCode"})]}),(0,Lm.jsx)("div",{className:"cities-list overflow-y-auto",children:v.length>0?v.map(e=>(0,Lm.jsxs)("div",{className:"city-item",children:[(0,Lm.jsx)("button",{onClick:()=>r(e.x,e.y),className:"city-name-btn",children:e.cityName}),(0,Lm.jsxs)("span",{children:[h(e).toLocaleString()," points | Ocean ",O(e.x,e.y)]})]},e.id)):(0,Lm.jsx)("p",{className:"text-sm text-center p-4",children:"No cities in this world."})})]})]}),(0,Lm.jsx)("div",{className:"profile-right-column",children:(0,Lm.jsxs)("div",{className:"profile-box",children:[(0,Lm.jsx)("div",{className:"profile-box-header",children:"Profile"}),(0,Lm.jsxs)("div",{className:"profile-description-box",children:[(0,Lm.jsx)("img",{src:(null===D||void 0===D?void 0:D.imageUrl)||yg,onError:e=>{e.target.onerror=null,e.target.src=yg},alt:"Profile Avatar",className:"profile-avatar-large"}),(0,Lm.jsx)("div",{className:"profile-description-text",children:A?(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!M)return;const t={description:_,imageUrl:I};try{await c(t),P(!1)}catch(n){console.error("Failed to update profile.",n)}},className:"h-full flex flex-col",children:[(0,Lm.jsx)(vg,{value:_,onChange:T}),(0,Lm.jsx)("input",{type:"text",value:I,onChange:e=>E(e.target.value),placeholder:"Image URL",className:"w-full mt-2 bg-white/50 border border-yellow-800/50 p-1"}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,Lm.jsx)("button",{type:"button",onClick:()=>P(!1),className:"btn-cancel",children:"Cancel"}),(0,Lm.jsx)("button",{type:"submit",className:"btn-save",children:"Save"})]})]}):(0,Lm.jsx)("p",{children:(null===D||void 0===D?void 0:D.description)||"This player has not written a profile text."})})]})]})})]}),M&&!A&&(0,Lm.jsx)("button",{onClick:()=>P(!0),className:"profile-edit-button",children:"Edit Profile"}),R&&(0,Lm.jsx)("button",{onClick:()=>i(s),className:"profile-edit-button",children:"Invite to Alliance"})]})})};var wg=n(8559);let kg={playerLeaderboard:null,allianceLeaderboard:null,fightersLeaderboard:null,lastFetchTimestamp:0};const Ng=t=>{let{onClose:n,onOpenProfile:s,onOpenAllianceProfile:r}=t;const{worldId:i,worldState:a}=up(),[o,l]=(0,e.useState)([]),[c,u]=(0,e.useState)([]),[d,h]=(0,e.useState)([]),[m,p]=(0,e.useState)(!0),[f,g]=(0,e.useState)("players"),v=(0,e.useCallback)(async()=>{if(!i||!a)return new Map;const e=Bh(Zd(Om,"games"),qh("worldName","==",a.name)),t=await cm(e),n=[],s=new Map;if(t.forEach(e=>{const t=e.ref.parent.parent.id;n.push(t),s.set(t,e.data())}),0===n.length)return new Map;const r=new Map,o=[];for(let i=0;i<n.length;i+=30){const e=n.slice(i,i+30),t=Bh(Jd(Om,"users"),qh("__name__","in",e));o.push(cm(t))}(await Promise.all(o)).forEach(e=>{e.forEach(e=>{r.set(e.id,e.data())})});const l=new Map;for(const[i,a]of s.entries()){const e=r.get(i);e&&l.set(i,{id:i,username:e.username,alliance:a.alliance||"No Alliance",points:a.totalPoints||0,battlePoints:a.battlePoints||0})}return l},[i,a]);(0,e.useEffect)(()=>{Date.now()-kg.lastFetchTimestamp>12e5||!kg.playerLeaderboard?(async()=>{p(!0);const e=await v(),t=Array.from(e.values());t.sort((e,t)=>t.points-e.points);const n=Array.from(e.values());n.sort((e,t)=>t.battlePoints-e.battlePoints);const s=[];if(i){const t=Jd(Om,"worlds",i,"alliances"),n=await cm(t);for(const i of n.docs){var r,a;const t=i.data();let n=0;t.members.forEach(t=>{e.has(t.uid)&&(n+=e.get(t.uid).points)});const o=20,l=(null===(r=t.research)||void 0===r||null===(a=r.expanded_charter)||void 0===a?void 0:a.level)||0,c=o+mp.expanded_charter.effect.value*l;s.push({id:i.id,name:t.name,tag:t.tag,points:n,memberCount:t.members.length,maxMembers:c})}s.sort((e,t)=>t.points-e.points)}l(t),h(n),u(s),kg={playerLeaderboard:t,allianceLeaderboard:s,fightersLeaderboard:n,lastFetchTimestamp:Date.now()},p(!1)})():(l(kg.playerLeaderboard),u(kg.allianceLeaderboard),h(kg.fightersLeaderboard),p(!1))},[i,v]);const y=()=>(0,Lm.jsxs)("table",{className:"leaderboard-table",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("th",{className:"text-center",children:"Rank"}),(0,Lm.jsx)("th",{className:"text-left",children:"Player"}),(0,Lm.jsx)("th",{className:"text-left",children:"Alliance"}),(0,Lm.jsx)("th",{className:"text-right",children:"Points"})]})}),(0,Lm.jsx)("tbody",{children:o.map((e,t)=>(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("td",{className:"text-center",children:t+1}),(0,Lm.jsx)("td",{className:"text-left",children:(0,Lm.jsx)("button",{onClick:()=>s(e.id),className:"player-name-btn",children:e.username})}),(0,Lm.jsx)("td",{className:"text-left",children:e.alliance}),(0,Lm.jsx)("td",{className:"text-right",children:e.points.toLocaleString()})]},e.id))})]});return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"leaderboard-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("div",{className:"leaderboard-header"}),(0,Lm.jsxs)("div",{className:"leaderboard-tabs",children:[(0,Lm.jsx)("button",{onClick:()=>g("players"),className:"leaderboard-tab-btn "+("players"===f?"active":""),children:"Players"}),(0,Lm.jsx)("button",{onClick:()=>g("alliances"),className:"leaderboard-tab-btn "+("alliances"===f?"active":""),children:"Alliances"}),(0,Lm.jsx)("button",{onClick:()=>g("fighters"),className:"leaderboard-tab-btn "+("fighters"===f?"active":""),children:"Fighters"})]}),(0,Lm.jsx)("div",{className:"overflow-y-auto flex-grow pr-4",children:(()=>{if(m)return(0,Lm.jsx)("p",{children:"Loading leaderboard..."});switch(f){case"players":default:return y();case"alliances":return(0,Lm.jsxs)("table",{className:"leaderboard-table",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("th",{className:"text-center",children:"Rank"}),(0,Lm.jsx)("th",{className:"text-left",children:"Alliance"}),(0,Lm.jsx)("th",{className:"text-left",children:"Tag"}),(0,Lm.jsx)("th",{className:"text-center",children:"Members"}),(0,Lm.jsx)("th",{className:"text-right",children:"Points"})]})}),(0,Lm.jsx)("tbody",{children:c.map((e,t)=>(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("td",{className:"text-center",children:t+1}),(0,Lm.jsx)("td",{className:"text-left",children:(0,Lm.jsx)("button",{onClick:()=>r(e.id),className:"player-name-btn",children:e.name})}),(0,Lm.jsx)("td",{className:"text-left",children:e.tag}),(0,Lm.jsxs)("td",{className:"text-center",children:[e.memberCount,"/",e.maxMembers]}),(0,Lm.jsx)("td",{className:"text-right",children:e.points.toLocaleString()})]},e.id))})]});case"fighters":return(0,Lm.jsxs)("table",{className:"leaderboard-table",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("th",{className:"text-center",children:"Rank"}),(0,Lm.jsx)("th",{className:"text-left",children:"Player"}),(0,Lm.jsx)("th",{className:"text-left",children:"Alliance"}),(0,Lm.jsx)("th",{className:"text-right",children:"Points"})]})}),(0,Lm.jsx)("tbody",{children:d.map((e,t)=>(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("td",{className:"text-center",children:t+1}),(0,Lm.jsx)("td",{className:"text-left",children:(0,Lm.jsx)("button",{onClick:()=>s(e.id),className:"player-name-btn",children:e.username})}),(0,Lm.jsx)("td",{className:"text-left",children:e.alliance}),(0,Lm.jsxs)("td",{className:"text-right flex items-center justify-end",children:[e.battlePoints.toLocaleString(),(0,Lm.jsx)("img",{src:wg,alt:"Battle Points",className:"w-5 h-5 ml-1 inline-block"})]})]},e.id))})]})}})()})]})})},jg=e=>{let{userProfile:t,worldId:n,cityGameState:s,currentUser:r,setIsInstantBuild:i,setIsInstantResearch:a,setIsInstantUnits:o,saveGameState:l,setMessage:c}=e;const{worldState:u,playerCities:d}=up();return{handleSpawnGodTown:async()=>{if(null!==t&&void 0!==t&&t.is_admin&&u){c("Spawning a God Town...");try{const e=pg(u.islands,u.width,u.height,1);if(0===Object.keys(e).length)throw new Error("Failed to find a suitable location in the sea. Try again.");const[t,s]=Object.entries(e)[0],r=eh(Om,"worlds",n,"godTowns",t);await um(r,s),c(`God Town spawned as "Strange Ruins" at (${s.x}, ${s.y})!`)}catch(e){console.error("Error spawning God Town:",e),c(`Failed to spawn God Town: ${e.message}`)}}else c("You are not authorized or world data is not loaded.")},handleCheat:async(e,u,h,m,p,f,g,v,y,x,b)=>{if(!s||null===t||void 0===t||!t.is_admin)return;if(b)return(()=>{for(const e in xg)delete xg[e]})(),fp(),kg={playerLeaderboard:null,allianceLeaderboard:null,fightersLeaderboard:null,lastFetchTimestamp:0},void c("All data caches have been cleared successfully!");if(x){if(!n)return c("Cannot found city: World ID is missing."),void console.error("worldId is missing in handleCheat");c("Finding a suitable location for your new city...");const e=Bh(Jd(Om,"worlds",n,"citySlots"),qh("ownerId","==",null),Yh(10));let i=null;try{const t=await cm(e);if(!t.empty){const e=t.docs[Math.floor(Math.random()*t.docs.length)];i={id:e.id,...e.data()}}}catch(C){return console.error("Error finding an empty slot:",C),void c("Error finding a location.")}if(!i)return void c("Could not find an available city slot. This world might be full.");c(`Location found at (${i.x}, ${i.y}). Founding city...`);const a=eh(Om,"worlds",n,"citySlots",i.id),o=eh(Jd(Om,"users",r.uid,"games",n,"cities"));try{await wm(Om,async e=>{const n=await e.get(a);if(!n.exists()||null!==n.data().ownerId)throw new Error("This location was taken while processing. Please try again.");const l=Object.values(d).map(e=>e.cityName),c=`${t.username}'s Colony`;let u=c;if(l.includes(u)){let e,t=2;do{e=`${c} ${t}`,t++}while(l.includes(e));u=e}e.update(a,{ownerId:r.uid,ownerUsername:t.username,cityName:u});const h={};Object.keys(zm).forEach(e=>{h[e]={level:0}}),["senate","farm","warehouse","timber_camp","quarry","silver_mine","cave"].forEach(e=>{h[e]={level:1}});const m={id:o.id,slotId:i.id,x:i.x,y:i.y,islandId:i.islandId,cityName:u,playerInfo:s.playerInfo,resources:{wood:1e3,stone:1e3,silver:500},buildings:h,units:{},wounded:{},research:{},worship:{},cave:{silver:0},buildQueue:[],barracksQueue:[],shipyardQueue:[],divineTempleQueue:[],healQueue:[],lastUpdated:Date.now()};e.set(o,m)}),c("New city founded successfully!")}catch(C){console.error("Error founding city with cheat: ",C),c(`Failed to found city: ${C.message}`)}return}i(p),a(g),o(v);const w={...s};var k;if(w.resources.wood+=e.wood,w.resources.stone+=e.stone,w.resources.silver+=e.silver,h>0&&(w.buildings.farm.level=h),u.amount>0&&(w.units[u.unit]=(w.units[u.unit]||0)+u.amount),m>0&&(w.buildings.warehouse.level=m),f&&w.research[f])delete w.research[f],c(`Research "${null===(k=Wm[f])||void 0===k?void 0:k.name}" unreasearched!`);else if(f){var N;c(`Research "${null===(N=Wm[f])||void 0===N?void 0:N.name}" is not researched.`)}if(y>0&&w.god){var j;const e=w.worship[w.god]||0,t=(null===(j=w.buildings.temple)||void 0===j?void 0:j.level)||0,n=t>0?100+20*t:0;w.worship[w.god]=Math.min(n,e+y),c(`Added ${y} favor to ${w.god}!`)}else y>0&&!w.god&&c("No god is currently worshipped to add favor.");await l(w),c("Admin cheat applied!")}}},Cg=e=>{let{cityGameState:t,setCityGameState:n,saveGameState:s,worldId:r,currentUser:i,getFarmCapacity:a,calculateUsedPopulation:o,isInstantUnits:l,setMessage:c}=e;const u=async(e,n)=>{const s=t;let a,o,l;switch(n){case"barracks":case"shipyard":case"divineTemple":a=`${n}Queue`,o="cost",l="units";break;case"heal":a="healQueue",o="heal_cost",l="wounded";break;default:return console.error("Invalid queueType for cancellation:",n),void c("Error: Invalid queue type for cancellation.")}if(!s||!s[a])return;const u=[...s[a]],d=u.findIndex(t=>t.id===e.id);if(-1===d)return console.error("Item not found in queue for cancellation:",e),void c("Error: Item not found in queue.");if(d!==u.length-1)return void c("You can only cancel the last item in the queue.");const h=[...u],m=h.splice(d,1)[0],p=qm[m.unitId];if(!p)return console.error("Unit not found for canceled task:",m.unitId),void c("Error: Unit data missing for canceled task.");const f=eh(Om,"users",i.uid,"games",r,"cities",s.id);try{await wm(Om,async e=>{var t,s,r,i;const c=await e.get(f);if(!c.exists())throw new Error("City data not found.");const u=c.data(),g=(v=null===(t=u.buildings.warehouse)||void 0===t?void 0:t.level)?Math.floor(1500*Math.pow(1.4,v-1)):0;var v;const y={...u.resources,wood:Math.min(g,(u.resources.wood||0)+((null===(s=p[o])||void 0===s?void 0:s.wood)||0)*m.amount),stone:Math.min(g,(u.resources.stone||0)+((null===(r=p[o])||void 0===r?void 0:r.stone)||0)*m.amount),silver:Math.min(g,(u.resources.silver||0)+((null===(i=p[o])||void 0===i?void 0:i.silver)||0)*m.amount)},x={...u[l]};"heal"===n&&(x[m.unitId]=(x[m.unitId]||0)+m.amount);for(let a=d;a<h.length;a++){var b;const e=0===a?Date.now():null!==(b=h[a-1])&&void 0!==b&&b.endTime?new Date(h[a-1].endTime).getTime():Date.now(),t=h[a],s=qm[t.unitId],r=("heal"===n?s.heal_time:s.cost.time)*t.amount,i=new Date(e+1e3*r);h[a]={...t,endTime:i}}const w={resources:y,[a]:h};"heal"===n&&(w[l]=x),e.update(f,w)})}catch(g){console.error("Error cancelling training/healing:",g),c("Could not cancel. Please try again.")}};return{handleTrainTroops:async(e,i)=>{const u=t;if(!u||!r||i<=0)return;const d=qm[e];if(!d)return void c("Invalid unit type");let h,m=0;var p;if("naval"===d.type){if(h="shipyardQueue",m=(null===(p=u.buildings.shipyard)||void 0===p?void 0:p.level)||0,0===m)return void c("Naval units can only be built in the Shipyard.")}else if(d.mythical){var f;if(h="divineTempleQueue",m=(null===(f=u.buildings.divine_temple)||void 0===f?void 0:f.level)||0,0===m)return void c("Mythical units can only be trained in the Divine Temple.")}else{if("land"!==d.type)return void c("Unknown unit type.");var g;if(h="barracksQueue",m=(null===(g=u.buildings.barracks)||void 0===g?void 0:g.level)||0,0===m)return void c("Land units can only be trained in the Barracks.")}const v=u[h]||[];if(v.length>=5)return void c("Unit training queue is full (max 5).");const y=d.cost.wood*i,x=d.cost.stone*i,b=d.cost.silver*i,w=d.cost.population*i,k=d.cost.favor?d.cost.favor*i:0,N=o(u),j=a(u.buildings.farm.level)-N;if(u.resources.wood<y)return void c(`Need ${y-u.resources.wood} more wood`);if(u.resources.stone<x)return void c(`Need ${x-u.resources.stone} more stone`);if(u.resources.silver<b)return void c(`Need ${b-u.resources.silver} more silver`);if(j<w)return void c(`Need ${w-j} more population capacity`);if(d.mythical&&u.worship[u.god]<k)return void c(`Need ${k-u.worship[u.god]} more favor for ${u.god}`);const C=JSON.parse(JSON.stringify(u));C.resources.wood-=y,C.resources.stone-=x,C.resources.silver-=b,d.mythical&&(C.worship[C.god]-=k);const S=v.filter(e=>{var t;return(null!==(t=e.endTime)&&void 0!==t&&t.toDate?e.endTime.toDate():new Date(e.endTime)).getTime()>Date.now()});let _=Date.now();if(S.length>0){var T;const e=S[S.length-1];_=(null!==(T=e.endTime)&&void 0!==T&&T.toDate?e.endTime.toDate():new Date(e.endTime)).getTime()}const I=l?1:d.cost.time*i,E=new Date(_+1e3*I),A={id:tp(),unitId:e,amount:i,endTime:E};C[h]=[...S,A];try{await s(C),n(C)}catch(P){console.error("Error adding to unit queue:",P),c("Could not start training. Please try again.")}},handleCancelTrain:u,handleHealTroops:async e=>{const i=t;if(!i||!r||0===Object.keys(e).length)return;const l=JSON.parse(JSON.stringify(i));let u=l.healQueue||[];const d=a(i.buildings.farm.level)-o(i.buildings,i.units,i.specialBuilding);let h=0;for(const t in e){const n=e[t];h+=(qm[t].cost.population||0)*n}if(d<h)return void c("Not enough available population to heal these units.");const m=[],p={wood:0,stone:0,silver:0};for(const t in e){const n=e[t];if(n>0){const e=qm[t];m.push({unitId:t,amount:n,cost:{wood:(e.heal_cost.wood||0)*n,stone:(e.heal_cost.stone||0)*n,silver:(e.heal_cost.silver||0)*n},time:(e.heal_time||0)*n}),p.wood+=m[m.length-1].cost.wood,p.stone+=m[m.length-1].cost.stone,p.silver+=m[m.length-1].cost.silver}}if(m.length+u.length>5)c("Not enough space in the healing queue.");else if(i.resources.wood>=p.wood&&i.resources.stone>=p.stone&&i.resources.silver>=p.silver){l.resources.wood-=p.wood,l.resources.stone-=p.stone,l.resources.silver-=p.silver;const e={...l.wounded};for(const n of m)e[n.unitId]-=n.amount,e[n.unitId]<=0&&delete e[n.unitId];l.wounded=e;let t=Date.now();if(u.length>0){const e=u[u.length-1];t=e.endTime.toDate?e.endTime.toDate().getTime():new Date(e.endTime).getTime()}for(const n of m){const e=new Date(t+1e3*n.time),s={id:tp(),unitId:n.unitId,amount:n.amount,endTime:e};u.push(s),t=e.getTime()}l.healQueue=u;try{await s(l),n(l),c("Healing started.")}catch(f){console.error("Error starting healing:",f),c("Could not start healing. Please try again.")}}else c("Not enough resources to heal troops!")},handleCancelHeal:async e=>{await u(e,"heal")},handleFireTroops:async e=>{if(!t||!r||0===Object.keys(e).length)return;const n=eh(Om,"users",i.uid,"games",r,"cities",t.id);try{await wm(Om,async t=>{const s=await t.get(n);if(!s.exists())throw new Error("City document not found!");const r={...s.data().units};for(const n in e){const t=e[n];if(!(r[n]&&r[n]>=t))throw new Error(`Trying to dismiss more ${n} than available.`);r[n]-=t,0===r[n]&&delete r[n]}t.update(n,{units:r})}),c("Units dismissed.")}catch(s){console.error("Error firing units:",s),c(`Could not dismiss units: ${s.message}`)}}}},Sg=e=>{const{cityGameState:t,openModal:n,setModalState:s}=e,r=jg(e),i=(e=>{let{cityGameState:t,setCityGameState:n,saveGameState:s,worldId:r,getUpgradeCost:i,getFarmCapacity:a,calculateUsedPopulation:o,isInstantBuild:l,setMessage:c,closeModal:u}=e;return{handleUpgrade:async e=>{const l=t;if(!l||!r)return;const u=l.buildQueue||[];if(u.length>=5)return void c("Build queue is full (max 5).");let d=(l.buildings[e]||{level:0}).level;u.forEach(t=>{t.buildingId===e&&"demolish"!==t.type&&t.level>d&&(d=t.level)});const h=d+1,m=zm[e];if(m&&h>m.maxLevel)return void c("Building is already at its maximum level or queued to be.");const p=m.requirements;if(p)for(const t in p){var f;const e=p[t];if(((null===(f=l.buildings[t])||void 0===f?void 0:f.level)||0)<e)return void c(`Requires ${zm[t].name} Level ${e}.`)}const g=i(e,h);if(!(l.resources.wood>=g.wood&&l.resources.stone>=g.stone&&l.resources.silver>=g.silver))return void c("Not enough resources to upgrade!");let v=0;u.forEach(e=>{if("demolish"!==e.type){const t=i(e.buildingId,e.level);v+=t.population}});const y=o(l.buildings,l.units,l.specialBuilding),x=a(l.buildings.farm.level);if(!(y+v+g.population<=x)&&"farm"!==e&&"warehouse"!==e)return void c("Not enough population capacity!");const b=JSON.parse(JSON.stringify(l));b.resources.wood-=g.wood,b.resources.stone-=g.stone,b.resources.silver-=g.silver,"academy"===e&&(b.researchPoints=(b.researchPoints||0)+4);let w=Date.now();if(u.length>0){const e=u[u.length-1];e.endTime&&(w=e.endTime.toDate?e.endTime.toDate().getTime():new Date(e.endTime).getTime())}const k=new Date(w+1e3*g.time),N={id:tp(),buildingId:e,level:h,endTime:k};b.buildQueue=[...u,N];try{await s(b),n(b)}catch(j){console.error("Error adding to build queue:",j),c("Could not start upgrade. Please try again.")}},handleCancelBuild:async e=>{console.log(`[handleCancelBuild] Triggered at ${(new Date).toLocaleTimeString()} for item:`,JSON.parse(JSON.stringify(e)));const r=t;if(!r||!r.buildQueue)return;const a=r.buildQueue.findIndex(t=>t.id===e.id);if(-1===a)return void console.error("Could not find item to cancel in build queue.");if(a!==r.buildQueue.length-1)return void c("You can only cancel the last item in the queue.");const o=[...r.buildQueue],u=o.splice(a,1)[0],d={...r,buildQueue:o};if("demolish"!==u.type){let e;e=u.isSpecial?{wood:15e3,stone:15e3,silver:15e3,population:60}:i(u.buildingId,u.level),d.resources={...r.resources,wood:r.resources.wood+Math.floor(.5*e.wood),stone:r.resources.stone+Math.floor(.5*e.stone),silver:r.resources.silver+Math.floor(.5*e.silver)},"academy"!==u.buildingId||u.isSpecial||(d.researchPoints=(d.researchPoints||0)-4)}for(let t=a;t<o.length;t++){var h;const e=0===t?Date.now():null!==(h=o[t-1])&&void 0!==h&&h.endTime?new Date(o[t-1].endTime).getTime():Date.now(),n=o[t];let s;if(n.isSpecial)s=7200;else if("demolish"===n.type){const e=zm[n.buildingId].baseCost,t=Math.floor(e.time*Math.pow(1.25,n.currentLevel-1));s=l?1:Math.floor(t/2)}else s=i(n.buildingId,n.level).time;const r=new Date(e+1e3*s);o[t]={...n,endTime:r}}await s(d),n(d)},handleDemolish:async e=>{const i=t;if(!i||!r)return;const a=i.buildQueue||[];if(a.length>=5)return void c("Build queue is full (max 5).");const o=i.buildings[e];if(!o)return void c("Building not found.");let u=o.level;const d=a.filter(t=>t.buildingId===e);if(d.length>0&&(u=d[d.length-1].level),u<=0)return void c("Building is already at or being demolished to level 0.");const h=u,m=u-1,p=zm[e].baseCost,f=Math.floor(p.time*Math.pow(1.25,h-1)),g=l?1:Math.floor(f/2);let v=Date.now();if(a.length>0){const e=a[a.length-1];e.endTime&&(v=e.endTime.toDate?e.endTime.toDate().getTime():new Date(e.endTime).getTime())}const y=new Date(v+1e3*g),x={id:tp(),type:"demolish",buildingId:e,level:m,currentLevel:h,endTime:y},b=JSON.parse(JSON.stringify(i));b.buildQueue=[...a,x];try{await s(b),n(b)}catch(w){console.error("Error adding demolition to build queue:",w),c("Could not start demolition. Please try again.")}},handleBuildSpecialBuilding:async(e,r)=>{const i=t;if(i.specialBuilding||(i.buildQueue||[]).some(e=>e.isSpecial))return void c("You can only build one special building per city.");const l=i.buildQueue||[];if(l.length>=5)return void c("Build queue is full (max 5).");const d=o(i.buildings,i.units,i.specialBuilding);if(a(i.buildings.farm.level)-d<r.population)return void c("Not enough population to construct this wonder.");if(i.resources.wood<r.wood||i.resources.stone<r.stone||i.resources.silver<r.silver)return void c("Not enough resources to construct this wonder.");const h=JSON.parse(JSON.stringify(i));h.resources.wood-=r.wood,h.resources.stone-=r.stone,h.resources.silver-=r.silver;let m=Date.now();if(l.length>0){const e=l[l.length-1];e.endTime&&(m=e.endTime.toDate?e.endTime.toDate().getTime():new Date(e.endTime).getTime())}const p=new Date(m+72e5),f={id:tp(),buildingId:e,isSpecial:!0,level:1,endTime:p};h.buildQueue=[...l,f],await s(h),n(h),u("isSpecialBuildingMenuOpen"),c("Construction of your wonder has begun!")},handleDemolishSpecialBuilding:async()=>{const e=t;if(!e.specialBuilding)return void c("No special building to demolish.");const r=15e3,i=15e3,a=15e3,o=Math.floor(.5*r),l=Math.floor(.5*i),u=Math.floor(.5*a),d=JSON.parse(JSON.stringify(e));d.resources.wood+=o,d.resources.stone+=l,d.resources.silver+=u,delete d.specialBuilding,await s(d),n(d),c("The wonder has been demolished and half of its resources have been returned.")}}})(e),a=(e=>{let{cityGameState:t,setCityGameState:n,saveGameState:s,closeModal:r,setMessage:i}=e;return{handleWorshipGod:async e=>{if(!t||!e)return;const i={...t.worship||{}};void 0===i[e]&&(i[e]=0),i.lastFavorUpdate=Date.now();const a={...t,god:e,worship:i};await s(a),n(a),r("isTempleMenuOpen")},handleCastSpell:async e=>{const a=t;if(!a||!a.god||(a.worship[a.god]||0)<e.favorCost)return void i("Not enough favor to cast this spell.");const o=JSON.parse(JSON.stringify(a));switch(o.worship[a.god]-=e.favorCost,e.effect.type){case"add_resources":o.resources[e.effect.resource]=(o.resources[e.effect.resource]||0)+e.effect.amount;break;case"add_multiple_resources":for(const t in e.effect.resources)o.resources[t]=(o.resources[t]||0)+e.effect.resources[t];break;default:return void i("This spell's effect is not yet implemented.")}try{await s(o),n(o),i(`${e.name} has been cast!`),r("isDivinePowersOpen")}catch(l){console.error("Error casting spell:",l),i("Failed to cast the spell. Please try again.")}}}})(e),o=(e=>{let{cityGameState:t,setCityGameState:n,saveGameState:s,getResearchCost:r,setMessage:i}=e;return{handleStartResearch:async e=>{const a=t;if(!a||!Wm[e])return;const o=a.researchQueue||[];if(o.length>=5)return void i("Research queue is full (max 5).");const l=Wm[e],{cost:c,requirements:u}=l;if(a.research[e])return void i("Research already completed.");if(o.some(t=>t.researchId===e))return void i("Research is already in the queue.");if(u.academy&&a.buildings.academy.level<u.academy)return void i(`Requires Academy Level ${u.academy}.`);if(u.research&&!a.research[u.research])return void i(`Requires "${Wm[u.research].name}" research first.`);if(a.resources.wood<c.wood||a.resources.stone<c.stone||a.resources.silver<c.silver||(a.researchPoints||0)<(c.points||0))return void i("Not enough resources or research points.");const d=JSON.parse(JSON.stringify(a));d.resources.wood-=c.wood,d.resources.stone-=c.stone,d.resources.silver-=c.silver,d.researchPoints=(d.researchPoints||0)-(c.points||0);let h=Date.now();if(o.length>0){const e=o[o.length-1];e.endTime&&(h=e.endTime.toDate?e.endTime.toDate().getTime():new Date(e.endTime).getTime())}const m=r(e).time,p=new Date(h+1e3*m),f={researchId:e,endTime:p};d.researchQueue=[...o,f];try{await s(d),n(d),i(`Research for "${l.name}" started.`)}catch(g){console.error("Error starting research:",g),i("Could not start research. Please try again.")}},handleCancelResearch:async e=>{const a=t;if(!a||!a.researchQueue||e<0||e>=a.researchQueue.length)return;if(e!==a.researchQueue.length-1)return void i("You can only cancel the last item in the research queue.");const o=[...a.researchQueue],l=o.splice(e,1)[0],c=Wm[l.researchId],u={...a.resources,wood:a.resources.wood+c.cost.wood,stone:a.resources.stone+c.cost.stone,silver:a.resources.silver+c.cost.silver},d=(a.researchPoints||0)+(c.cost.points||0);for(let t=e;t<o.length;t++){var h;const e=0===t?Date.now():null!==(h=o[t-1])&&void 0!==h&&h.endTime?o[t-1].endTime.getTime():Date.now(),n=o[t],s=r(n.researchId).time,i=new Date(e+1e3*s);o[t]={...n,endTime:i}}const m={...a,resources:u,researchQueue:o,researchPoints:d};await s(m),n(m)}}})(e),l=Cg(e),c=(e=>{let{cityGameState:t,saveGameState:n,getMaxWorkerSlots:s,calculateUsedPopulation:r,getFarmCapacity:i,setMessage:a}=e;const{gameSettings:o}=up();return{handleAddWorker:async e=>{const s={...t};s.buildings[e].workers||(s.buildings[e].workers=0),s.buildings[e].workers+=1,await n(s)},handleRemoveWorker:async e=>{const s={...t},r=s.buildings[e].workers||0;s.buildings[e].workers=Math.max(0,r-1),await n(s)},applyWorkerPresets:async()=>{const e=o.workerPresets;if(!e)return void a("Worker presets not configured.");const l=["timber_camp","quarry","silver_mine"];let c=i(t.buildings.farm.level)-r(t.buildings,t.units,t.specialBuilding);const u=JSON.parse(JSON.stringify(t));let d=!1;for(const t of l){const n=u.buildings[t];if(!n||0===n.level)continue;const r=n.workers||0,i=e[t]||0,a=Math.min(i,s(n.level)),o=a-r;o<0&&(n.workers=a,c-=20*o,d=!0)}for(const t of l){const n=u.buildings[t];if(!n||0===n.level)continue;const r=n.workers||0,i=e[t]||0,a=s(n.level),o=Math.min(i,a)-r;if(o>0){const e=Math.min(o,Math.floor(c/20));e>0&&(n.workers+=e,c-=20*e,d=!0)}}d?(await n(u),a("Applied presets with available population.")):a("Worker distribution already matches presets or no population is available to add more.")},applySenateWorkerPreset:async e=>{if(!e||!e.workers)return void a("Invalid preset.");const o=["timber_camp","quarry","silver_mine"];let l=i(t.buildings.farm.level)-r(t.buildings,t.units,t.specialBuilding);const c=JSON.parse(JSON.stringify(t.buildings));let u=!1,d=0,h=0;for(const t of o){const n=c[t];if(!n||0===n.level)continue;const r=n.workers||0,i=s(n.level),a=Math.min(e.workers[t]||0,i)-r;a>0?d+=20*a:a<0&&(h+=20*-a)}if(d>l+h)a(`Not enough population. Need ${d}, but only ${l+h} will be available.`);else{for(const t of o){const n=c[t];if(!n||0===n.level)continue;const r=n.workers||0,i=s(n.level),a=Math.min(e.workers[t]||0,i);a!==r&&(n.workers=a,u=!0)}if(u){const e={...t,buildings:c};await n(e),a("Worker presets applied successfully.")}else a("All buildings already match the worker counts in the preset.")}}}})(e);return{...r,...i,...a,...o,...l,...c,handlePlotClick:e=>{const r=t.buildings[e];if(!r||0===r.level)return"special_building_plot"===e?void(t.specialBuilding?n("isSpecialBuildingPanelOpen"):n("isSpecialBuildingMenuOpen")):void n("isSenateViewOpen");switch(e){case"senate":n("isSenateViewOpen");break;case"barracks":n("isBarracksMenuOpen");break;case"shipyard":n("isShipyardMenuOpen");break;case"temple":n("isTempleMenuOpen");break;case"divine_temple":n("isDivineTempleMenuOpen");break;case"cave":n("isCaveMenuOpen");break;case"academy":n("isAcademyMenuOpen");break;case"hospital":n("isHospitalMenuOpen");break;case"market":n("isMarketMenuOpen");break;case"heroes_altar":n("isHeroesAltarOpen");break;case"prison":n("isPrisonMenuOpen");break;case"special_building_plot":t.specialBuilding?n("isSpecialBuildingPanelOpen"):n("isSpecialBuildingMenuOpen");break;default:s(t=>({...t,selectedBuildingId:e}))}}}};function _g(e,t){if(!e||!t)return 0;const n=e.x-t.x,s=e.y-t.y;return Math.sqrt(n*n+s*s)}function Tg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if("scout"===n||"trade"===n){const t=15,n=300,s=15;return Math.max(t,Math.min(n,e*s))}let a=t;const o=r.includes("land"),l=r.includes("naval"),c=r.includes("flying");if(s){if(o)switch(s.season){case"Summer":a*=1.1;break;case"Winter":a*=.8}if(l||c){a*=1+(i-5)/10*.5}switch(s.weather){case"Rainy":o&&(a*=.9);break;case"Stormy":(l||c)&&(a*=.8),o&&(a*=.8);break;case"Foggy":a*=.75}}if(a<=0)return 1/0;return 3600*(e/(5*a))}const Ig=e=>{let{onToggleView:t,view:n,onOpenReports:s,onOpenAlliance:r,onOpenMessages:i,onOpenSettings:a,onOpenProfile:o,unreadReportsCount:l,unreadMessagesCount:c,isAdmin:u,onToggleDummyCityPlacement:d,onOpenForum:h,onOpenLeaderboard:m,onOpenQuests:p,onOpenCheats:f,isAllianceMember:g,handleOpenEvents:v,onOpenHeroesAltar:y}=e;const x=e=>{let{icon:t,text:n,onClick:s,notificationCount:r,glowing:i,disabled:a,title:o}=e;return(0,Lm.jsxs)("button",{onClick:s,className:"sidebar-button "+(i?"glowing-border":""),disabled:a,title:o,children:[(0,Lm.jsx)("div",{className:"icon-container",children:t}),(0,Lm.jsx)("span",{className:"button-text",children:n}),r>0&&(0,Lm.jsx)("span",{className:"notification-badge",children:r})]})};return(0,Lm.jsxs)("div",{className:"sidebar",onMouseDown:e=>e.stopPropagation(),children:[(0,Lm.jsx)(x,{icon:"\ud83d\uddfa\ufe0f",text:"map"===n?"City View":"Map View",onClick:t}),(0,Lm.jsx)(x,{icon:"\ud83d\udcdc",text:"Reports",onClick:s,notificationCount:l,glowing:l>0}),(0,Lm.jsx)(x,{icon:"\ud83c\udfdb\ufe0f",text:"Alliance",onClick:r}),(0,Lm.jsx)(x,{icon:"\ud83d\udd8b\ufe0f",text:"Forum",onClick:h,disabled:!g,title:g?"Forum":"You must be in an alliance to access the forum"}),(0,Lm.jsx)(x,{icon:"\u2709\ufe0f",text:"Messages",onClick:i,notificationCount:c,glowing:c>0}),(0,Lm.jsx)(x,{icon:"\ud83c\udfc6",text:"Leaderboard",onClick:m}),(0,Lm.jsx)(x,{icon:"\ud83d\udc64",text:"Profile",onClick:()=>o()}),(0,Lm.jsx)(x,{icon:"\u2699\ufe0f",text:"Settings",onClick:a}),u&&(0,Lm.jsxs)(Lm.Fragment,{children:["city"===n&&(0,Lm.jsx)(x,{icon:"\ud83d\udd27",text:"Admin Cheats",onClick:f}),(0,Lm.jsx)(x,{icon:"\u2728",text:"Events",onClick:v}),"map"===n&&(0,Lm.jsxs)("button",{onClick:d,className:"sidebar-button bg-yellow-700 hover:bg-yellow-600",children:[(0,Lm.jsx)("div",{className:"icon-container",children:"\ud83d\udc51"}),(0,Lm.jsx)("span",{className:"button-text",children:"Place Dummy"})]})]})]})};var Eg=n(3448),Ag=n(2532),Pg=n(481),Mg=n(5708);const Dg={},Og=n(3542);Og.keys().forEach(e=>{const t=e.replace("./","");Dg[t]=Og(e)});const Rg=e=>{let{playerCities:t,onCancelTrain:n,isLocked:s,countdown:r}=e;const i=e=>e?"function"===typeof e.toDate?e.toDate():new Date(e):null,a=Object.values(t).flatMap(e=>[...(e.barracksQueue||[]).map((t,n)=>({...t,cityId:e.id,cityName:e.cityName,isHealing:!1,queueType:"barracks",index:n})),...(e.shipyardQueue||[]).map((t,n)=>({...t,cityId:e.id,cityName:e.cityName,isHealing:!1,queueType:"shipyard",index:n})),...(e.divineTempleQueue||[]).map((t,n)=>({...t,cityId:e.id,cityName:e.cityName,isHealing:!1,queueType:"divineTemple",index:n})),...(e.healQueue||[]).map((t,n)=>({...t,cityId:e.id,cityName:e.cityName,isHealing:!0,queueType:"heal",index:n}))]).filter(e=>{const t=i(e.endTime);return t&&t>new Date}).sort((e,t)=>(i(e.endTime)||new Date(0))-(i(t.endTime)||new Date(0))),o=a.length>0?a.map(e=>{const t=qm[e.unitId];return(0,Lm.jsxs)("div",{className:"recruitment-tooltip-item",children:[(0,Lm.jsx)("img",{src:Dg[t.image],alt:t.name,className:"recruitment-tooltip-item-image"}),(0,Lm.jsxs)("div",{className:"recruitment-tooltip-item-details",children:[(0,Lm.jsxs)("p",{className:"font-bold",children:[e.amount,"x ",t.name," ",(0,Lm.jsxs)("span",{className:"text-xs text-gray-400",children:["(",e.cityName,")"]})]}),(0,Lm.jsx)("div",{className:"recruitment-tooltip-timer",children:(0,Lm.jsx)(Bf,{arrivalTime:e.endTime})})]}),(0,Lm.jsx)("button",{onClick:()=>n(e,e.queueType),className:"recruitment-tooltip-cancel-btn",children:"\xd7"})]},`${e.cityId}-${e.queueType}-${e.index}`)}):(0,Lm.jsx)("p",{className:"p-4 text-center text-sm",children:"No active recruitments."});return(0,Lm.jsxs)("div",{className:"recruitment-tooltip",children:[o,(0,Lm.jsx)("div",{className:"recruitment-tooltip-lock-timer",children:s?"\ud83d\udd12":r})]})},Lg={},$g=n(3542);$g.keys().forEach(e=>{const t=e.replace("./","");Lg[t]=$g(e)});const Fg=n(4731);Fg.keys().forEach(e=>{const t=e.replace("./","");Lg[t]=Fg(e)});const Ug=t=>{var n,s;let{movement:r,citySlots:i,onCancel:a,onRush:o,isAdmin:l}=t;const[c,u]=(0,e.useState)(!1),d=i[r.originCityId],h=i[r.targetCityId||r.targetSlotId||r.targetVillageId||r.targetRuinId||r.targetTownId],m={attack:{icon:"\u2694\ufe0f"},attack_village:{icon:"\u2694\ufe0f"},attack_ruin:{icon:"\u2694\ufe0f"},attack_god_town:{icon:"\u2694\ufe0f"},reinforce:{icon:"\ud83d\udee1\ufe0f"},scout:{icon:"\ud83d\udc41\ufe0f"},trade:{icon:"\ud83d\udcb0"},return:{icon:"\u21a9\ufe0f"},default:{icon:"\u27a1\ufe0f"}},p=m[r.type]||m.default;(0,e.useEffect)(()=>{const e=()=>{var e;if(null!==(e=r.cancellableUntil)&&void 0!==e&&e.toDate){const e=r.cancellableUntil.toDate();u(new Date<e)}else u(!1)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[r.cancellableUntil]);const f=(null===h||void 0===h?void 0:h.cityName)||(null===h||void 0===h?void 0:h.name)||r.targetCityName||r.targetVillageName||r.targetRuinName||r.targetTownName||"Unknown",g=(null===d||void 0===d?void 0:d.cityName)||r.originCityName||"Unknown",v=r.type.replace(/_/g," "),y="returning"===r.status?`Returning from ${f}`:`${v} from ${g} to ${f}`,x=null===(n=r.cancellableUntil)||void 0===n?void 0:n.toDate(),b=null===(s=r.arrivalTime)||void 0===s?void 0:s.toDate();return(0,Lm.jsxs)("div",{className:"movement-item-row",children:[(0,Lm.jsx)("span",{className:"movement-type-icon",children:p.icon}),(0,Lm.jsxs)("div",{className:"movement-details",children:[(0,Lm.jsx)("p",{className:"title capitalize",children:y}),(0,Lm.jsxs)("p",{className:"timing",children:[(0,Lm.jsx)(Bf,{arrivalTime:r.arrivalTime}),"(Arrival: ",b?b.toLocaleTimeString():"N/A",")",x&&` (Cancellable until: ${x.toLocaleTimeString()})`]})]}),(0,Lm.jsx)("button",{onClick:()=>a(r.id),disabled:!c,className:"cancel-button",title:c?"Cancel Movement":"Cannot be cancelled",children:"\xd7"}),(0,Lm.jsxs)("div",{className:"unit-icons-container",children:[r.units&&Object.entries(r.units).map(e=>{let[t,n]=e;if(n>0){const e=qm[t];return(0,Lm.jsx)("img",{src:Lg[e.image],alt:e.name,className:"unit-icon",title:`${n}x ${e.name}`},t)}return null}),r.hero&&(()=>{const e=Hm[r.hero];return e?(0,Lm.jsx)("img",{src:Lg[e.image],alt:e.name,className:"unit-icon",title:e.name},r.hero):null})()]}),l&&(0,Lm.jsx)("button",{onClick:()=>o(r.id),className:"btn btn-primary text-xs px-2 py-1",children:"Rush"})]})},Vg=e=>{let{movements:t,combinedSlots:n,onCancel:s,isLocked:r,countdown:i}=e;const a=t.filter(e=>"trade"===e.type||!("returning"!==e.status||!e.resources||!Object.values(e.resources).some(e=>e>0)||e.units&&!Object.values(e.units).every(e=>0===e)));return(0,Lm.jsxs)("div",{className:"activity-tooltip",children:[a.length>0?a.map(e=>(0,Lm.jsx)(Ug,{movement:e,citySlots:n,onCancel:s},e.id)):(0,Lm.jsx)("p",{className:"p-4 text-center text-sm",children:"No active trade movements."}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:r?"\ud83d\udd12":i})]})},Bg=e=>{let{movements:t,combinedSlots:n,onCancel:s,isLocked:r,countdown:i}=e;const{gameSettings:a}=up(),o=t.filter(e=>(!a.hideReturningReports||"returning"!==e.status)&&!(e=>"trade"===e.type||!("returning"!==e.status||!e.resources||!Object.values(e.resources).some(e=>e>0)||e.units&&!Object.values(e.units).every(e=>0===e)))(e));return(0,Lm.jsxs)("div",{className:"activity-tooltip",children:[o.length>0?o.map(e=>(0,Lm.jsx)(Ug,{movement:e,citySlots:n,onCancel:s},e.id)):(0,Lm.jsx)("p",{className:"p-4 text-center text-sm",children:"No active movements."}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:r?"\ud83d\udd12":i})]})},zg=t=>{let{cities:n,onSelect:s,onClose:r,activeCityId:i}=t;const a=(0,e.useRef)(null);return(0,e.useEffect)(()=>{const e=e=>{a.current&&!a.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r]),(0,Lm.jsx)("div",{ref:a,className:"city-list-dropdown absolute top-full mt-2 w-64 rounded-lg shadow-lg z-50",children:(0,Lm.jsx)("ul",{children:Object.values(n).map(e=>(0,Lm.jsx)("li",{children:(0,Lm.jsx)("button",{onClick:()=>s(e.id),className:"city-list-item "+(e.id===i?"active":""),children:e.cityName})},e.id))})})},qg=e=>{let{season:t,weather:n}=e;return(0,Lm.jsxs)("div",{className:"weather-display",children:[(0,Lm.jsx)("span",{className:"text-xl mr-2",children:{Clear:"\u2600\ufe0f",Rainy:"\ud83c\udf27\ufe0f",Windy:"\ud83d\udca8",Foggy:"\ud83c\udf2b\ufe0f",Stormy:"\u26c8\ufe0f"}[n]||"\u2753"}),(0,Lm.jsx)("span",{className:`font-bold ${{Spring:"text-pink-600",Summer:"text-yellow-600",Autumn:"text-orange-600",Winter:"text-blue-600"}[t]||"text-inherit"}`,children:t}),(0,Lm.jsx)("span",{className:"mx-2",children:"|"}),(0,Lm.jsx)("span",{className:"font-bold",children:n})]})},Wg=e=>{let{resource:t,production:n,capacity:s,isLocked:r,countdown:i}=e;return t?(0,Lm.jsxs)("div",{className:"resource-tooltip",children:[(0,Lm.jsx)("h4",{className:"font-bold capitalize text-lg",children:t}),(0,Lm.jsxs)("p",{className:"text-sm",children:["Production: ",(0,Lm.jsxs)("span",{className:"font-semibold",children:["+",n,"/hr"]})]}),(0,Lm.jsxs)("p",{className:"text-sm",children:["Capacity: ",(0,Lm.jsx)("span",{className:"font-semibold",children:s.toLocaleString()})]}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:r?"\ud83d\udd12":i})]}):null},Hg=t=>{let{view:n,gameState:s,availablePopulation:r,happiness:i,worldState:a,productionRates:o,movements:l,onCancelTrain:c,onCancelMovement:u,combinedSlots:d,onOpenMovements:h,isUnderAttack:m,incomingAttackCount:p,onRenameCity:f,onOpenQuests:g,hasUnclaimedQuests:v,getWarehouseCapacity:y,onSwitchCity:x,battlePoints:b}=t;const{playerCities:w,activeCityId:k}=up(),[N,j]=(0,e.useState)(!1),[C,S]=(0,e.useState)(null),[_,T]=(0,e.useState)(!1),I=(0,e.useRef)(null),E=(0,e.useRef)(null),A=(0,e.useRef)(null),[P,M]=(0,e.useState)(!1),[D,O]=(0,e.useState)(""),[R,L]=(0,e.useState)(5),$=(0,e.useRef)(null);(0,e.useEffect)(()=>{const e=e=>{_&&A.current&&!A.current.contains(e.target)&&(T(!1),S(null))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[_]),(0,e.useEffect)(()=>(clearTimeout(E.current),clearInterval($.current),L(5),C&&!_&&($.current=setInterval(()=>{L(e=>e<=1?(clearInterval($.current),0):e-1)},1e3),E.current=setTimeout(()=>{T(!0),clearInterval($.current)},5e3)),()=>{clearTimeout(E.current),clearInterval($.current)}),[C,_]);const F=e=>e?"function"===typeof e.toDate?e.toDate():new Date(e):null,U=e=>!!e&&("trade"===e.type||!("returning"!==e.status||!e.resources||!Object.values(e.resources).some(e=>e>0)||e.units&&!Object.values(e.units).every(e=>0===e))),V=(0,e.useMemo)(()=>w?Object.values(w).reduce((e,t)=>{const n=(t.barracksQueue||[]).concat(t.shipyardQueue||[]).concat(t.divineTempleQueue||[]).filter(e=>{const t=F(e.endTime);return t&&t>new Date}),s=(t.healQueue||[]).filter(e=>{const t=F(e.endTime);return t&&t>new Date});return e+n.length+s.length},0):0,[w]),B=(0,e.useMemo)(()=>l?l.filter(U).length:0,[l]),z=(0,e.useMemo)(()=>l?l.filter(e=>!U(e)).length:0,[l]),q=(0,e.useMemo)(()=>{var e;if(null===s||void 0===s||!s.buildings)return`Happiness: ${i}%`;const t=5*((null===(e=s.buildings.senate)||void 0===e?void 0:e.level)||0);let n=0;["timber_camp","quarry","silver_mine"].forEach(e=>{var t;null!==(t=s.buildings[e])&&void 0!==t&&t.workers&&(n+=s.buildings[e].workers)});return`Happiness: ${i}%\nBase: ${t}%\nWorker Penalty: -${3*n}%`},[s,i]);if(!s)return null;const{resources:W,cityName:H}=s,G=i>70?"\ud83d\ude0a":i>40?"\ud83d\ude10":"\ud83d\ude20",Q=e=>{_&&C!==e&&T(!1),clearTimeout(I.current),S(e)},Y=()=>{_||(I.current=setTimeout(()=>{S(null)},300))},K=(e,t)=>{e.stopPropagation(),_&&C===t?(T(!1),S(null)):(T(!0),S(t))},X=async()=>{if(D.trim()&&D.trim()!==s.cityName)try{await f(k,D.trim())}catch(e){console.error("Failed to rename city:",e)}M(!1)};return(0,Lm.jsxs)("div",{className:"p-2 flex items-center justify-between top-bar-container z-30 "+("map"===n?"absolute top-0 left-0 right-0":"relative flex-shrink-0"),children:[(0,Lm.jsxs)("div",{className:"flex-1 flex justify-start items-center space-x-4",children:[a&&(0,Lm.jsxs)("div",{className:"relative",onMouseEnter:()=>Q("weather"),onMouseLeave:Y,onClick:e=>K(e,"weather"),children:[(0,Lm.jsx)(qg,{season:a.season,weather:a.weather}),"weather"===C&&(0,Lm.jsxs)("div",{className:"resource-tooltip",children:[(0,Lm.jsx)("h4",{className:"font-bold capitalize text-lg",children:"Weather"}),(0,Lm.jsx)("p",{className:"text-sm",children:"Current conditions affect travel times."}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:_?"\ud83d\udd12":R})]})]}),(0,Lm.jsxs)("div",{className:"resource-display",title:"Battle Points",children:[(0,Lm.jsx)("img",{src:wg,alt:"Battle Points",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("span",{className:"font-bold text-red-800",children:b.toLocaleString()})]})]}),(0,Lm.jsx)("div",{className:"flex-1 flex justify-center items-center",children:(0,Lm.jsx)("div",{className:"city-name-container",onDoubleClick:()=>{O(s.cityName),M(!0)},children:P?(0,Lm.jsx)("input",{type:"text",value:D,onChange:e=>{O(e.target.value)},onBlur:X,onKeyDown:e=>{"Enter"===e.key?X():"Escape"===e.key&&M(!1)},autoFocus:!0,className:"font-title text-xl text-center bg-transparent text-yellow-200 border-none focus:ring-0 w-full"}):(0,Lm.jsxs)("div",{className:"relative",children:[(0,Lm.jsx)("button",{className:"city-name-dropdown-btn",onClick:()=>j(e=>!e),title:"Click to switch city | Double-click to rename",children:H}),N&&(0,Lm.jsx)(zg,{cities:w,onSelect:e=>{x&&x(e),j(!1)},onClose:()=>j(!1),activeCityId:k})]})})}),(0,Lm.jsxs)("div",{className:"flex-1 flex justify-end items-center space-x-2",onMouseLeave:Y,children:[(0,Lm.jsxs)("div",{ref:A,className:"activity-tracker-container",onMouseLeave:Y,children:[(0,Lm.jsxs)("div",{className:"relative",onMouseEnter:()=>Q("recruitment"),onClick:e=>K(e,"recruitment"),children:[(0,Lm.jsx)("button",{className:"activity-icon-image-container",children:(0,Lm.jsx)("img",{src:Ag,alt:"Recruitment",className:"activity-icon-image"})}),V>0&&(0,Lm.jsx)("span",{className:"activity-badge",children:V}),"recruitment"===C&&(0,Lm.jsx)(Rg,{playerCities:w,onCancelTrain:c,isLocked:_,countdown:R})]}),(0,Lm.jsxs)("div",{className:"relative",onMouseEnter:()=>Q("trades"),onClick:e=>K(e,"trades"),children:[(0,Lm.jsx)("button",{className:"activity-icon-image-container",children:(0,Lm.jsx)("img",{src:Pg,alt:"Trade",className:"activity-icon-image"})}),B>0&&(0,Lm.jsx)("span",{className:"activity-badge",children:B}),"trades"===C&&(0,Lm.jsx)(Vg,{movements:l,combinedSlots:d,onCancel:u,isLocked:_,countdown:R})]}),(0,Lm.jsxs)("div",{className:"relative",onMouseEnter:()=>Q("movements"),onClick:e=>K(e,"movements"),children:[(0,Lm.jsx)("button",{onClick:e=>{e.stopPropagation(),h()},className:"activity-icon-image-container "+(m?"glowing-attack-icon":""),children:(0,Lm.jsx)("img",{src:Mg,alt:"Movement",className:"activity-icon-image"})}),z>0&&(0,Lm.jsx)("span",{className:"activity-badge",children:z}),"movements"===C&&(0,Lm.jsx)(Bg,{movements:l,combinedSlots:d,onCancel:u,isLocked:_,countdown:R})]})]}),(0,Lm.jsxs)("div",{className:"resource-display relative",onMouseEnter:()=>Q("wood"),onClick:e=>K(e,"wood"),children:[(0,Lm.jsx)("img",{src:gf,alt:"Wood",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("span",{className:"text-yellow-800 font-bold",children:Math.floor(W.wood||0)}),"wood"===C&&o&&y&&(0,Lm.jsx)(Wg,{resource:"wood",production:o.wood,capacity:y(s.buildings.warehouse.level),isLocked:_,countdown:R})]}),(0,Lm.jsxs)("div",{className:"resource-display relative",onMouseEnter:()=>Q("stone"),onClick:e=>K(e,"stone"),children:[(0,Lm.jsx)("img",{src:vf,alt:"Stone",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("span",{className:"text-gray-600 font-bold",children:Math.floor(W.stone||0)}),"stone"===C&&o&&y&&(0,Lm.jsx)(Wg,{resource:"stone",production:o.stone,capacity:y(s.buildings.warehouse.level),isLocked:_,countdown:R})]}),(0,Lm.jsxs)("div",{className:"resource-display relative",onMouseEnter:()=>Q("silver"),onClick:e=>K(e,"silver"),children:[(0,Lm.jsx)("img",{src:yf,alt:"Silver",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("span",{className:"text-blue-800 font-bold",children:Math.floor(W.silver||0)}),"silver"===C&&o&&y&&(0,Lm.jsx)(Wg,{resource:"silver",production:o.silver,capacity:y(s.buildings.warehouse.level),isLocked:_,countdown:R})]}),(0,Lm.jsxs)("div",{className:"resource-display",children:[(0,Lm.jsx)("img",{src:Eg,alt:"Population",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("span",{className:"font-bold text-red-800",children:Math.floor(r||0)})]}),(0,Lm.jsxs)("div",{className:"resource-display relative",onMouseEnter:()=>Q("happiness"),onClick:e=>K(e,"happiness"),children:[(0,Lm.jsx)("span",{className:"text-xl mr-2",children:G}),(0,Lm.jsxs)("span",{className:"font-bold text-green-800",children:[i,"%"]}),"happiness"===C&&(0,Lm.jsxs)("div",{className:"resource-tooltip happiness-tooltip",children:[(0,Lm.jsx)("pre",{children:q}),(0,Lm.jsx)("div",{className:"tooltip-lock-timer",children:_?"\ud83d\udd12":R})]})]})]})]})},Gg=n.p+"static/media/quest_spritesheet.aa45892952ab931fb187.png",Qg=t=>{let{quests:n=[],onOpenQuests:s}=t;const{gameSettings:r}=up(),i=(0,e.useMemo)(()=>{const e=n.some(e=>e.isComplete&&!e.isClaimed),t=n.length>0&&n.every(e=>e.isComplete&&e.isClaimed);return e?"unclaimed":t?"completed":"idle"},[n]);return"completed"===i&&r.hideCompletedQuestsIcon?null:(0,Lm.jsx)("div",{className:"quests-button-container",children:(0,Lm.jsx)("button",{onClick:s,className:`quests-button ${i}`,title:"Open Quests",style:{backgroundImage:`url(${Gg})`},"aria-label":"Quests"})})},Yg=t=>{let{showMap:n,worldId:s,openModal:r,unreadReportsCount:i,unreadMessagesCount:a,isUnderAttack:o,incomingAttackCount:l,handleOpenAlliance:c,handleOpenProfile:u,movements:d,onCancelTrain:h,onCancelMovement:m,combinedSlots:p,onRenameCity:f,quests:g,handleOpenEvents:v,onSwitchCity:y,battlePoints:x,cityModalState:b,openCityModal:w,closeCityModal:k,setCityModalState:N}=t;const{currentUser:j,userProfile:C}=Fm(),{gameSettings:S,worldState:_}=up(),{playerAlliance:T}=sp(),{isInstantBuild:I,setIsInstantBuild:E}=up(),{isInstantResearch:A,setIsInstantResearch:P}=up(),{isInstantUnits:M,setIsInstantUnits:D}=up(),[O,R]=(0,e.useState)(""),{cityGameState:L,setCityGameState:$,getUpgradeCost:F,getFarmCapacity:U,calculateUsedPopulation:V,getProductionRates:B,getWarehouseCapacity:z,getHospitalCapacity:q,saveGameState:W,getResearchCost:H,calculateHappiness:G,getMaxWorkerSlots:Q,getMarketCapacity:Y}=lp(s,I,A),K=Sg({cityGameState:L,setCityGameState:$,saveGameState:W,worldId:s,userProfile:C,currentUser:j,getUpgradeCost:F,getResearchCost:H,getFarmCapacity:U,calculateUsedPopulation:V,isInstantUnits:M,setMessage:R,openModal:w,closeModal:k,setModalState:N,setIsInstantBuild:E,setIsInstantResearch:P,setIsInstantUnits:D,getMaxWorkerSlots:Q}),{onRecruitHero:X,onActivateSkill:J,onAssignHero:Z,onUnassignHero:ee,onReleaseHero:te}=((e,t,n)=>{const{currentUser:s}=Fm(),{worldId:r,activeCityId:i,playerCities:a}=up();return{onRecruitHero:async e=>{const t=Hm[e];if(!t)return;const a=eh(Om,`users/${s.uid}/games`,r,"cities",i);try{await wm(Om,async n=>{const s=await n.get(a);if(!s.exists())throw new Error("City data not found.");const r=s.data();if(r.resources.silver<t.cost.silver)throw new Error("Not enough silver.");if((r.worship[r.god]||0)<t.cost.favor)throw new Error("Not enough favor.");const i={...r.resources,silver:r.resources.silver-t.cost.silver},o={...r.worship,[r.god]:r.worship[r.god]-t.cost.favor},l={...r.heroes,[e]:{active:!0,cityId:null,level:1,xp:0}};n.update(a,{resources:i,worship:o,heroes:l})}),n(`${t.name} has been recruited!`)}catch(o){n(`Failed to recruit hero: ${o.message}`)}},onActivateSkill:async(e,t)=>{if(!Hm[e])return;const a=eh(Om,`users/${s.uid}/games`,r,"cities",i);try{await wm(Om,async n=>{var s,r;const i=await n.get(a);if(!i.exists())throw new Error("City data not found.");const o=i.data(),l=(null===(s=o.heroes)||void 0===s?void 0:s[e])||{level:1},c=t.cost.favor,u=(c.base||0)+(l.level-1)*(c.perLevel||0);if(((null===(r=o.worship)||void 0===r?void 0:r[o.god])||0)<u)throw new Error("Not enough favor.");const d=o.activeSkills||{},h=Date.now();if(d[t.name]&&h<d[t.name].expires){const e=Math.ceil((d[t.name].expires-h)/1e3);throw new Error(`Skill is on cooldown. Time left: ${e}s`)}const m={...o.worship,[o.god]:o.worship[o.god]-u};let p={...o.buffs||{}};const f={...d},g=1e3*(t.cooldown||0);f[t.name]={activatedAt:h,expires:h+g};const v=(t.effect.baseValue||0)+(l.level-1)*(t.effect.valuePerLevel||0);if("troop_buff"===t.effect.type)p.battle={...p.battle||{},[t.effect.subtype]:{value:v,unit_type:t.effect.unit_type}};else if("city_buff"===t.effect.type){const e=1e3*(t.effect.duration||0);p.city={...p.city||{},[t.effect.subtype]:{value:v,expires:h+e}}}n.update(a,{worship:m,buffs:p,activeSkills:f})}),n(`${t.name} has been activated!`)}catch(o){n(`Failed to activate skill: ${o.message}`)}},onAssignHero:async e=>{const t=eh(Om,`users/${s.uid}/games`,r,"cities",i);try{await wm(Om,async n=>{const s=await n.get(t);if(!s.exists())throw new Error("City data not found.");const r=s.data().heroes||{};for(const e in r)if(r[e].cityId===i)throw new Error("Another hero is already stationed in this city.");const a={...r,[e]:{...r[e],cityId:i}};n.update(t,{heroes:a})}),n(`${Hm[e].name} is now stationed in this city.`)}catch(a){n(`Failed to assign hero: ${a.message}`)}},onUnassignHero:async e=>{const t=eh(Om,`users/${s.uid}/games`,r,"cities",i);try{await wm(Om,async n=>{const s=await n.get(t);if(!s.exists())throw new Error("City data not found.");const r=s.data().heroes||{},i={...r,[e]:{...r[e],cityId:null}};n.update(t,{heroes:i})}),n(`${Hm[e].name} is no longer stationed in this city.`)}catch(a){n(`Failed to unassign hero: ${a.message}`)}},onReleaseHero:async e=>{if(!e||!e.captureId)return void n("Invalid prisoner data.");const t=eh(Om,`users/${s.uid}/games`,r,"cities",i);try{await wm(Om,async n=>{const o=await n.get(t);if(!o.exists())throw new Error("Your city data could not be found.");const l=o.data(),c=l.prisoners||[],u=c.filter(t=>t.captureId!==e.captureId);if(u.length===c.length)throw new Error("Could not find the specified prisoner to release.");n.update(t,{prisoners:u});const d=eh(Jd(Om,"worlds",r,"movements")),h=Object.values(a).find(t=>t.id===e.originCityId)||{x:0,y:0},m=Tg(_g(l,h),10),p=new Date(Date.now()+1e3*m),f={type:"return",status:"returning",hero:e.heroId,originCityId:i,originCoords:{x:l.x,y:l.y},originOwnerId:s.uid,originCityName:l.cityName,targetCityId:e.originCityId,targetCoords:{x:h.x,y:h.y},targetOwnerId:e.ownerId,departureTime:km(),arrivalTime:p,involvedParties:[s.uid,e.ownerId]};n.set(d,f)}),n(`${Hm[e.heroId].name} has been released and is returning home.`)}catch(o){n(`Failed to release hero: ${o.message}`),console.error(o)}}}})(0,0,R),{availablePopulation:ne,happiness:se}=(0,e.useMemo)(()=>{var e,t;if(!L)return{availablePopulation:0,happiness:0};return{availablePopulation:U(null===(e=L.buildings)||void 0===e||null===(t=e.farm)||void 0===t?void 0:t.level)-V(L),happiness:G(L.buildings)}},[L,U,V,G]),re=(0,e.useMemo)(()=>L?B(L.buildings):{wood:0,stone:0,silver:0},[L,B]);return L?(0,Lm.jsxs)("div",{className:"w-full h-screen bg-gray-900 city-view-wrapper relative",children:[(0,Lm.jsx)(Sp,{message:O,onClose:()=>R("")}),(0,Lm.jsx)(Qg,{onOpenQuests:()=>r("quests"),quests:g}),(0,Lm.jsx)(Ig,{onToggleView:n,view:"city",onOpenReports:()=>r("reports"),onOpenAlliance:c,onOpenForum:()=>r("allianceForum"),onOpenMessages:()=>r("messages"),onOpenSettings:()=>r("settings"),onOpenProfile:()=>u(),onOpenLeaderboard:()=>r("leaderboard"),onOpenQuests:()=>r("quests"),unreadReportsCount:i,unreadMessagesCount:a,isAdmin:null===C||void 0===C?void 0:C.is_admin,onToggleDummyCityPlacement:()=>{},onOpenCheats:()=>w("isCheatMenuOpen"),isAllianceMember:!!T,handleOpenEvents:v,onOpenHeroesAltar:()=>w("isHeroesAltarOpen")}),(0,Lm.jsxs)("div",{className:"h-full w-full flex flex-col",children:[(0,Lm.jsx)(Hg,{view:"city",gameState:L,availablePopulation:ne,happiness:se,worldState:_,productionRates:re,movements:d,onCancelTrain:h,onCancelMovement:m,combinedSlots:p,onOpenMovements:()=>r("movements"),isUnderAttack:o,incomingAttackCount:l,onRenameCity:f,getWarehouseCapacity:z,onSwitchCity:y,battlePoints:x}),(0,Lm.jsx)(cg,{cityGameState:L,handlePlotClick:K.handlePlotClick,onOpenPowers:()=>w("isDivinePowersOpen"),gameSettings:S,onOpenSpecialBuildingMenu:()=>w("isSpecialBuildingMenuOpen")})]}),(0,Lm.jsx)(Hf,{cityGameState:L,worldId:s,currentUser:j,userProfile:C,isInstantBuild:I,getUpgradeCost:F,getFarmCapacity:U,getWarehouseCapacity:z,getHospitalCapacity:q,getProductionRates:B,calculateUsedPopulation:V,saveGameState:W,handleUpgrade:K.handleUpgrade,handleCancelBuild:K.handleCancelBuild,handleTrainTroops:K.handleTrainTroops,handleCancelTrain:K.handleCancelTrain,handleFireTroops:K.handleFireTroops,handleStartResearch:K.handleStartResearch,handleCancelResearch:K.handleCancelResearch,handleWorshipGod:K.handleWorshipGod,handleCheat:K.handleCheat,handleHealTroops:K.handleHealTroops,handleCancelHeal:K.handleCancelHeal,availablePopulation:ne,modalState:b,openModal:w,closeModal:k,setMessage:R,onAddWorker:K.handleAddWorker,onRemoveWorker:K.handleRemoveWorker,getMaxWorkerSlots:Q,getMarketCapacity:Y,handleBuildSpecialBuilding:K.handleBuildSpecialBuilding,handleDemolish:K.handleDemolish,handleDemolishSpecialBuilding:K.handleDemolishSpecialBuilding,handleSpawnGodTown:K.handleSpawnGodTown,onRecruitHero:X,onActivateSkill:J,onAssignHero:Z,onUnassignHero:ee,onApplyWorkerPreset:K.applySenateWorkerPreset,onReleaseHero:te}),b.isDivinePowersOpen&&(0,Lm.jsx)(ug,{godName:L.god,playerReligion:L.playerInfo.religion,favor:L.worship[L.god]||0,onCastSpell:K.handleCastSpell,onClose:()=>k("isDivinePowersOpen")})]}):(0,Lm.jsx)("div",{className:"text-white text-center p-10",children:"Loading City..."})},Kg=n.p+"static/media/island_1.4a96bf1f286ea09c6a25.png",Xg=n.p+"static/media/island_2.3424e76eeafd1ed917a0.png";var Jg=n(7200);const Zg={};[n(4004),n(3542)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");Zg[n]||(Zg[n]=e(t))})});const ev={showVisuals:!0,showGrid:!0},tv=e=>{let{gameSettings:t=ev}=e;return(0,Lm.jsx)("div",{className:"w-full h-full bg-transparent"})},nv=e=>{let{gameSettings:t=ev}=e;const n=t.showVisuals?"bg-transparent":"bg-gray-800",s=t.showGrid?"border-r border-b "+(t.showVisuals?"border-green-700/20":"border-gray-700"):"border-r border-b border-transparent";return(0,Lm.jsx)("div",{className:`w-full h-full ${n} ${s}`})},sv=e=>{let{slotData:t,onClick:n,isPlacingDummyCity:s,playerAlliance:r,gameSettings:i=ev,cityPoints:a,scoutedCities:o,islandCenterX:l}=e;const{currentUser:c}=Fm();let u="empty-slot",d=`Empty Plot (${t.x}, ${t.y})`,h={},m=!1;const p=e=>{if(!e||0===Object.keys(e).length)return"";const t=Object.entries(e).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;const s=qm[t];if(!s)return"";return`\n                    <div class="tooltip-troop-item">\n                        <img src="${Zg[s.image]}" alt="${s.name}" class="tooltip-troop-image" />\n                        <span class="tooltip-troop-count">${n}</span>\n                    </div>\n                `}).join("");return t?`<hr class="tooltip-hr"><b>City Units</b><br><div class="tooltip-troop-grid">${t}</div>`:""};if(t.ownerId){m=!0;const e=t.ownerUsername||"Unknown",n=t.ownerId===c.uid,s=n?null===r||void 0===r?void 0:r.tag:t.alliance,v=n?null===r||void 0===r?void 0:r.name:t.allianceName,y=a[n?t.slotId:t.id]||0;let x="";n?(u="my-city",x=p(t.units)):"ghost"===t.ownerId?(u="ghost-city",m=!1,x=p(t.units)):o&&o[t.id]&&(x=p(o[t.id]));if(d=`${`\n            <div class="tooltip-info-section">\n                <b>${t.cityName}</b><br>\n                Owner: ${e}<br>\n                Points: ${y.toLocaleString()}<br>\n                Alliance: ${v||"None"}\n            </div>\n        `}${x}`,t.ownerId!==c.uid&&"ghost"!==t.ownerId)if(r&&r.tag&&s){var f,g;const e=(null===(f=r.diplomacy)||void 0===f?void 0:f.allies)||[],t=(null===(g=r.diplomacy)||void 0===g?void 0:g.enemies)||[];u=s.toUpperCase()===r.tag.toUpperCase()?"alliance-city":e.some(e=>e&&e.tag&&e.tag.toUpperCase()===s.toUpperCase())?"ally-city":t.some(e=>e&&e.tag&&e.tag.toUpperCase()===s.toUpperCase())?"enemy-city":"neutral-city"}else t.ownerId.startsWith("dummy_")?(u="dummy-city-plot",m=!1):u="neutral-city";if(i.showVisuals&&m){const e=t.x<l?"0%":"100%";let n;n=y<2e3?"0%":y<=1e4?"50%":"100%",h={backgroundImage:`url(${Zg["city_modal.png"]})`,backgroundSize:"200% 300%",backgroundPosition:`${e} ${n}`}}}else s&&(u="dummy-placement-plot",d="Click to place dummy city");const v=i.showGrid?"border-r border-b "+(i.showVisuals?"border-green-700/20":"border-gray-700"):"border-r border-b border-transparent";return(0,Lm.jsx)("div",{className:`w-full h-full bg-transparent ${v} flex justify-center items-center`,children:(0,Lm.jsxs)("div",{onClick:e=>n(e,t),className:`city-slot ${u}`,children:[i.showVisuals&&m&&(0,Lm.jsx)("div",{className:"city-sprite",style:h}),(0,Lm.jsx)("span",{className:"map-object-tooltip",dangerouslySetInnerHTML:{__html:d}})]})})},rv=e=>{let{villageData:t,onClick:n,conqueredVillages:s,gameSettings:r=ev}=e;const i=t.level||1;let a=`village-level-${i}`,o=`Village: ${t.name}<br>Level: ${i}`;const l=s?s[t.id]:null;if(l){a+=" my-village";const e=void 0!==l.happiness?l.happiness:100;o=`Your Village: ${t.name}<br>Happiness: ${Math.floor(e)}%`}else a+=" other-village-plot";const c=r.showGrid?"border-r border-b "+(r.showVisuals?"border-green-700/20":"border-gray-700"):"border-r border-b border-transparent";return(0,Lm.jsx)("div",{className:`w-full h-full bg-transparent ${c} flex justify-center items-center`,children:(0,Lm.jsx)("div",{onClick:e=>n(e,t),className:`village-slot ${a}`,children:(0,Lm.jsx)("span",{className:"map-object-tooltip",dangerouslySetInnerHTML:{__html:o}})})})},iv=e=>{let{ruinData:t,onClick:n,gameSettings:s=ev}=e,r="ruin-slot",i=`Ruin: ${t.name}`;t.ownerId&&"ruins"!==t.ownerId?(r+=" ruin-occupied",i=`Conquered Ruin<br>Owner: ${t.ownerUsername}`):r+=" ruin-unoccupied";return(0,Lm.jsx)("div",{className:"w-full h-full bg-transparent flex justify-center items-center",children:(0,Lm.jsx)("div",{onClick:e=>n(e,t),className:r,children:(0,Lm.jsx)("span",{className:"map-object-tooltip",dangerouslySetInnerHTML:{__html:i}})})})},av=e=>{let{townData:t,onClick:n,gameSettings:s=ev}=e,r="god-town-slot",i=`God Town: ${t.name}`,a="ruins"===t.stage?Zg["ruin_new.png"]:Jg;"ruins"===t.stage?(r+=" ruins",i="Strange Ruins"):"city"===t.stage&&(r+=" city",i=`God Town: ${t.name}<br>Health: ${t.health}`);return(0,Lm.jsx)("div",{className:"w-full h-full bg-transparent flex justify-center items-center",children:(0,Lm.jsx)("div",{onClick:()=>n(t.id),className:r,style:{backgroundImage:`url(${a})`},children:(0,Lm.jsx)("span",{className:"map-object-tooltip",dangerouslySetInnerHTML:{__html:i}})})})},ov=e=>{let{spotData:t,onClick:n,playerAlliance:s,controlledIslands:r}=e;const i=null===s||void 0===s?void 0:s.tag,a=r?r[t.islandId]:null,o=i&&i===a,l="wonder-spot-tile "+(o?"active":""),c=o?"Click to build an Alliance Wonder":"Your alliance must control this entire island to build a wonder.",u=o?()=>n(t):void 0;return(0,Lm.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,Lm.jsx)("div",{onClick:u,className:l,children:(0,Lm.jsx)("span",{className:"map-object-tooltip",children:c})})})},lv=e=>{let{wonderData:t,onClick:n}=e;const s=`${ip[t.id].name} (Lvl ${t.level})<br>Alliance: ${t.allianceName||"Unknown"}`;return(0,Lm.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,Lm.jsx)("div",{onClick:()=>n(t),className:"constructing-wonder-tile",children:(0,Lm.jsx)("span",{className:"map-object-tooltip",dangerouslySetInnerHTML:{__html:s}})})})},cv=e.memo(tv),uv=e.memo(nv),dv=e.memo(sv),hv=e.memo(rv),mv=e.memo(iv),pv=e.memo(av),fv=e.memo(ov),gv=e.memo(lv),vv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],yv=(()=>new Set(vv))(),xv=e=>180*e/Math.PI,bv=e=>{const t=xv(Math.atan2(e[1],e[0]));return kv(t)},wv={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:bv,rotateZ:bv,skewX:e=>xv(Math.atan(e[1])),skewY:e=>xv(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},kv=e=>((e%=360)<0&&(e+=360),e),Nv=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),jv=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Cv={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Nv,scaleY:jv,scale:e=>(Nv(e)+jv(e))/2,rotateX:e=>kv(xv(Math.atan2(e[6],e[5]))),rotateY:e=>kv(xv(Math.atan2(-e[2],e[0]))),rotateZ:bv,rotate:bv,skewX:e=>xv(Math.atan(e[4])),skewY:e=>xv(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function Sv(e){return e.includes("scale")?1:0}function _v(e,t){if(!e||"none"===e)return Sv(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,r;if(n)s=Cv,r=n;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=wv,r=t}if(!r)return Sv(t);const i=s[t],a=r[1].split(",").map(Tv);return"function"===typeof i?i(a):a[i]}function Tv(e){return parseFloat(e.trim())}const Iv=e=>t=>"string"===typeof t&&t.startsWith(e),Ev=Iv("--"),Av=Iv("var(--"),Pv=e=>!!Av(e)&&Mv.test(e.split("/*")[0].trim()),Mv=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Dv(e){let{top:t,left:n,right:s,bottom:r}=e;return{x:{min:n,max:s},y:{min:t,max:r}}}const Ov=(e,t,n)=>e+(t-e)*n;function Rv(e){return void 0===e||1===e}function Lv(e){let{scale:t,scaleX:n,scaleY:s}=e;return!Rv(t)||!Rv(n)||!Rv(s)}function $v(e){return Lv(e)||Fv(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Fv(e){return Uv(e.x)||Uv(e.y)}function Uv(e){return e&&"0%"!==e}function Vv(e,t,n){return n+t*(e-n)}function Bv(e,t,n,s,r){return void 0!==r&&(e=Vv(e,r,s)),Vv(e,n,s)+t}function zv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;e.min=Bv(e.min,t,n,s,r),e.max=Bv(e.max,t,n,s,r)}function qv(e,t){let{x:n,y:s}=t;zv(e.x,n.translate,n.scale,n.originPoint),zv(e.y,s.translate,s.scale,s.originPoint)}const Wv=.999999999999,Hv=1.0000000000001;function Gv(e,t){e.min=e.min+t,e.max=e.max+t}function Qv(e,t,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;zv(e,t,n,Ov(e.min,e.max,r),s)}function Yv(e,t){Qv(e.x,t.x,t.scaleX,t.scale,t.originX),Qv(e.y,t.y,t.scaleY,t.scale,t.originY)}function Kv(e,t){return Dv(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}(e.getBoundingClientRect(),t))}const Xv=new Set(["width","height","top","left","right","bottom",...vv]),Jv=(e,t,n)=>n>t?t:n<e?e:n,Zv={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},ey={...Zv,transform:e=>Jv(0,1,e)},ty={...Zv,default:1},ny=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),sy=ny("deg"),ry=ny("%"),iy=ny("px"),ay=ny("vh"),oy=ny("vw"),ly=(()=>({...ry,parse:e=>ry.parse(e)/100,transform:e=>ry.transform(100*e)}))(),cy=e=>t=>t.test(e),uy=[Zv,iy,ry,sy,oy,ay,{test:e=>"auto"===e,parse:e=>e}],dy=e=>uy.find(cy(e));const hy=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),my=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function py(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const[s,r]=function(e){const t=my.exec(e);if(!t)return[,];const[,n,s,r]=t;return[`--${n??s}`,r]}(e);if(!s)return;const i=window.getComputedStyle(t).getPropertyValue(s);if(i){const e=i.trim();return hy(e)?parseFloat(e):e}return Pv(r)?py(r,t,n+1):r}const fy=e=>e===Zv||e===iy,gy=new Set(["x","y","z"]),vy=vv.filter(e=>!gy.has(e));const yy={width:(e,t)=>{let{x:n}=e,{paddingLeft:s="0",paddingRight:r="0"}=t;return n.max-n.min-parseFloat(s)-parseFloat(r)},height:(e,t)=>{let{y:n}=e,{paddingTop:s="0",paddingBottom:r="0"}=t;return n.max-n.min-parseFloat(s)-parseFloat(r)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:s}=t;return parseFloat(s)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:s}=t;return parseFloat(s)+(n.max-n.min)},x:(e,t)=>{let{transform:n}=t;return _v(n,"x")},y:(e,t)=>{let{transform:n}=t;return _v(n,"y")}};yy.translateX=yy.x,yy.translateY=yy.y;const xy=e=>e,by={},wy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],ky={value:null,addProjectionMetrics:null};function Ny(e,t){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,a=wy.reduce((e,n)=>(e[n]=function(e,t){let n=new Set,s=new Set,r=!1,i=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){a.has(t)&&(u.schedule(t),e()),l++,t(o)}const u={schedule:function(e){const t=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r?n:s;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&a.add(e),t.has(e)||t.add(e),e},cancel:e=>{s.delete(e),a.delete(e)},process:e=>{o=e,r?i=!0:(r=!0,[n,s]=[s,n],n.forEach(c),t&&ky.value&&ky.value.frameloop[t].push(l),l=0,n.clear(),r=!1,i&&(i=!1,u.process(e)))}};return u}(i,t?n:void 0),e),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:u,update:d,preRender:h,render:m,postRender:p}=a,f=()=>{const i=by.useManualTiming?r.timestamp:performance.now();n=!1,by.useManualTiming||(r.delta=s?1e3/60:Math.max(Math.min(i-r.timestamp,40),1)),r.timestamp=i,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),u.process(r),d.process(r),h.process(r),m.process(r),p.process(r),r.isProcessing=!1,n&&t&&(s=!1,e(f))},g=wy.reduce((t,i)=>{const o=a[i];return t[i]=function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,s=!0,r.isProcessing||e(f)),o.schedule(t,i,a)},t},{});return{schedule:g,cancel:e=>{for(let t=0;t<wy.length;t++)a[wy[t]].cancel(e)},state:r,steps:a}}const{schedule:jy,cancel:Cy,state:Sy,steps:_y}=Ny("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:xy,!0),Ty=new Set;let Iy=!1,Ey=!1,Ay=!1;function Py(){if(Ey){const e=Array.from(Ty).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{const t=function(e){const t=[];return vy.forEach(n=>{const s=e.getValue(n);void 0!==s&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}(e);t.length&&(n.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=n.get(e);t&&t.forEach(t=>{let[n,s]=t;e.getValue(n)?.set(s)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}Ey=!1,Iy=!1,Ty.forEach(e=>e.complete(Ay)),Ty.clear()}function My(){Ty.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Ey=!0)})}class Dy{constructor(e,t,n,s,r){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=s,this.element=r,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(Ty.add(this),Iy||(Iy=!0,jy.read(My),jy.resolveKeyframes(Py))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:s}=this;if(null===e[0]){const r=s?.get(),i=e[e.length-1];if(void 0!==r)e[0]=r;else if(n&&t){const s=n.readValue(t,i);void 0!==s&&null!==s&&(e[0]=s)}void 0===e[0]&&(e[0]=i),s&&void 0===r&&s.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Ty.delete(this)}cancel(){"scheduled"===this.state&&(Ty.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const Oy=e=>/^0[^.\s]+$/u.test(e);function Ry(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||Oy(e))}const Ly=e=>Math.round(1e5*e)/1e5,$y=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Fy=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Uy=(e,t)=>n=>Boolean("string"===typeof n&&Fy.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),Vy=(e,t,n)=>s=>{if("string"!==typeof s)return s;const[r,i,a,o]=s.match($y);return{[e]:parseFloat(r),[t]:parseFloat(i),[n]:parseFloat(a),alpha:void 0!==o?parseFloat(o):1}},By={...Zv,transform:e=>Math.round((e=>Jv(0,255,e))(e))},zy={test:Uy("rgb","red"),parse:Vy("red","green","blue"),transform:e=>{let{red:t,green:n,blue:s,alpha:r=1}=e;return"rgba("+By.transform(t)+", "+By.transform(n)+", "+By.transform(s)+", "+Ly(ey.transform(r))+")"}};const qy={test:Uy("#"),parse:function(e){let t="",n="",s="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,s+=s,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}},transform:zy.transform},Wy={test:Uy("hsl","hue"),parse:Vy("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:s,alpha:r=1}=e;return"hsla("+Math.round(t)+", "+ry.transform(Ly(n))+", "+ry.transform(Ly(s))+", "+Ly(ey.transform(r))+")"}},Hy={test:e=>zy.test(e)||qy.test(e)||Wy.test(e),parse:e=>zy.test(e)?zy.parse(e):Wy.test(e)?Wy.parse(e):qy.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?zy.transform(e):Wy.transform(e),getAnimatableNone:e=>{const t=Hy.parse(e);return t.alpha=0,Hy.transform(t)}},Gy=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const Qy="number",Yy="color",Ky=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Xy(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},r=[];let i=0;const a=t.replace(Ky,e=>(Hy.test(e)?(s.color.push(i),r.push(Yy),n.push(Hy.parse(e))):e.startsWith("var(")?(s.var.push(i),r.push("var"),n.push(e)):(s.number.push(i),r.push(Qy),n.push(parseFloat(e))),++i,"${}")).split("${}");return{values:n,split:a,indexes:s,types:r}}function Jy(e){return Xy(e).values}function Zy(e){const{split:t,types:n}=Xy(e),s=t.length;return e=>{let r="";for(let i=0;i<s;i++)if(r+=t[i],void 0!==e[i]){const t=n[i];r+=t===Qy?Ly(e[i]):t===Yy?Hy.transform(e[i]):e[i]}return r}}const ex=e=>"number"===typeof e?0:Hy.test(e)?Hy.getAnimatableNone(e):e;const tx={test:function(e){return isNaN(e)&&"string"===typeof e&&(e.match($y)?.length||0)+(e.match(Gy)?.length||0)>0},parse:Jy,createTransformer:Zy,getAnimatableNone:function(e){const t=Jy(e);return Zy(e)(t.map(ex))}},nx=new Set(["brightness","contrast","saturate","opacity"]);function sx(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[s]=n.match($y)||[];if(!s)return e;const r=n.replace(s,"");let i=nx.has(t)?1:0;return s!==n&&(i*=100),t+"("+i+r+")"}const rx=/\b([a-z-]*)\(.*?\)/gu,ix={...tx,getAnimatableNone:e=>{const t=e.match(rx);return t?t.map(sx).join(" "):e}},ax={...Zv,transform:Math.round},ox={borderWidth:iy,borderTopWidth:iy,borderRightWidth:iy,borderBottomWidth:iy,borderLeftWidth:iy,borderRadius:iy,radius:iy,borderTopLeftRadius:iy,borderTopRightRadius:iy,borderBottomRightRadius:iy,borderBottomLeftRadius:iy,width:iy,maxWidth:iy,height:iy,maxHeight:iy,top:iy,right:iy,bottom:iy,left:iy,padding:iy,paddingTop:iy,paddingRight:iy,paddingBottom:iy,paddingLeft:iy,margin:iy,marginTop:iy,marginRight:iy,marginBottom:iy,marginLeft:iy,backgroundPositionX:iy,backgroundPositionY:iy,...{rotate:sy,rotateX:sy,rotateY:sy,rotateZ:sy,scale:ty,scaleX:ty,scaleY:ty,scaleZ:ty,skew:sy,skewX:sy,skewY:sy,distance:iy,translateX:iy,translateY:iy,translateZ:iy,x:iy,y:iy,z:iy,perspective:iy,transformPerspective:iy,opacity:ey,originX:ly,originY:ly,originZ:iy},zIndex:ax,fillOpacity:ey,strokeOpacity:ey,numOctaves:ax},lx={...ox,color:Hy,backgroundColor:Hy,outlineColor:Hy,fill:Hy,stroke:Hy,borderColor:Hy,borderTopColor:Hy,borderRightColor:Hy,borderBottomColor:Hy,borderLeftColor:Hy,filter:ix,WebkitFilter:ix},cx=e=>lx[e];function ux(e,t){let n=cx(e);return n!==ix&&(n=tx),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const dx=new Set(["auto","none","0"]);class hx extends Dy{constructor(e,t,n,s,r){super(e,t,n,s,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let n=e[o];if("string"===typeof n&&(n=n.trim(),Pv(n))){const s=py(n,t.current);void 0!==s&&(e[o]=s),o===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!Xv.has(n)||2!==e.length)return;const[s,r]=e,i=dy(s),a=dy(r);if(i!==a)if(fy(i)&&fy(a))for(let o=0;o<e.length;o++){const t=e[o];"string"===typeof t&&(e[o]=parseFloat(t))}else yy[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let s=0;s<e.length;s++)(null===e[s]||Ry(e[s]))&&n.push(s);n.length&&function(e,t,n){let s,r=0;for(;r<e.length&&!s;){const t=e[r];"string"===typeof t&&!dx.has(t)&&Xy(t).values.length&&(s=e[r]),r++}if(s&&n)for(const i of t)e[i]=ux(n,s)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=yy[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const s=t[t.length-1];void 0!==s&&e.getValue(n,s).jump(s,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const s=e.getValue(t);s&&s.jump(this.measuredOrigin,!1);const r=n.length-1,i=n[r];n[r]=yy[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==i&&void 0===this.finalKeyframe&&(this.finalKeyframe=i),this.removedTransforms?.length&&this.removedTransforms.forEach(t=>{let[n,s]=t;e.getValue(n).set(s)}),this.resolveNoneKeyframes()}}const mx=e=>Boolean(e&&e.getVelocity);let px;function fx(){px=void 0}const gx={now:()=>(void 0===px&&gx.set(Sy.isProcessing||by.useManualTiming?Sy.timestamp:performance.now()),px),set:e=>{px=e,queueMicrotask(fx)}};function vx(e,t){-1===e.indexOf(t)&&e.push(t)}function yx(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class xx{constructor(){this.subscriptions=[]}add(e){return vx(this.subscriptions,e),()=>yx(this.subscriptions,e)}notify(e,t,n){const s=this.subscriptions.length;if(s)if(1===s)this.subscriptions[0](e,t,n);else for(let r=0;r<s;r++){const s=this.subscriptions[r];s&&s(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function bx(e,t){return t?e*(1e3/t):0}const wx={current:void 0};class kx{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=gx.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=gx.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new xx);const n=this.events[e].add(t);return"change"===e?()=>{n(),jy.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return wx.current&&wx.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=gx.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return bx(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Nx(e,t){return new kx(e,t)}const jx=[...uy,Hy,tx],{schedule:Cx,cancel:Sx}=Ny(queueMicrotask,!1),_x={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Tx={};for(const n in _x)Tx[n]={isEnabled:e=>_x[n].some(t=>!!e[t])};const Ix=()=>({x:{min:0,max:0},y:{min:0,max:0}}),Ex="undefined"!==typeof window,Ax={current:null},Px={current:!1};const Mx=new WeakMap;function Dx(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}function Ox(e){return"string"===typeof e||Array.isArray(e)}const Rx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Lx=["initial",...Rx];function $x(e){return Dx(e.animate)||Lx.some(t=>Ox(e[t]))}function Fx(e){return Boolean($x(e)||e.variants)}function Ux(e){const t=[{},{}];return e?.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function Vx(e,t,n,s){if("function"===typeof t){const[r,i]=Ux(s);t=t(void 0!==n?n:e.custom,r,i)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[r,i]=Ux(s);t=t(void 0!==n?n:e.custom,r,i)}return t}const Bx=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class zx{scrapeMotionValuesFromProps(e,t,n){return{}}constructor(e){let{parent:t,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:a}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Dy,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=gx.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,jy.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=$x(n),this.isVariantNode=Fx(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in d){const e=d[h];void 0!==l[h]&&mx(e)&&e.set(l[h])}}mount(e){this.current=e,Mx.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),Px.current||function(){if(Px.current=!0,Ex)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Ax.current=e.matches;e.addEventListener("change",t),t()}else Ax.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Ax.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Cy(this.notifyUpdate),Cy(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=yv.has(e);n&&this.onBindTransform&&this.onBindTransform();const s=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&jy.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{s(),r&&r(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Tx){const t=Tx[e];if(!t)continue;const{isEnabled:n,Feature:s}=t;if(!this.features[e]&&s&&n(this.props)&&(this.features[e]=new s(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Bx.length;n++){const t=Bx[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const s=e["on"+t];s&&(this.propEventSubscriptions[t]=this.on(t,s))}this.prevMotionValues=function(e,t,n){for(const s in t){const r=t[s],i=n[s];if(mx(r))e.addValue(s,r);else if(mx(i))e.addValue(s,Nx(r,{owner:e}));else if(i!==r)if(e.hasValue(s)){const t=e.getValue(s);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(s);e.addValue(s,Nx(void 0!==t?t:r,{owner:e}))}}for(const s in n)void 0===t[s]&&e.removeValue(s);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=Nx(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return void 0!==n&&null!==n&&("string"===typeof n&&(hy(n)||Oy(n))?n=parseFloat(n):!(e=>jx.find(cy(e)))(n)&&tx.test(t)&&(n=ux(e,t)),this.setBaseTarget(e,mx(n)?n.get():n)),mx(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let n;if("string"===typeof t||"object"===typeof t){const s=Vx(this.props,t,this.presenceContext?.custom);s&&(n=s[e])}if(t&&void 0!==n)return n;const s=this.getBaseTargetFromProps(this.props,e);return void 0===s||mx(s)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:s}on(e,t){return this.events[e]||(this.events[e]=new xx),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];this.events[e].notify(...n)}}scheduleRenderMicrotask(){Cx.render(this.render)}}class qx extends zx{constructor(){super(...arguments),this.KeyframeResolver=hx}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:s}=t;delete n[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;mx(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}const Wx=(e,t)=>t&&"number"===typeof e?t.transform(e):e,Hx={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Gx=vv.length;function Qx(e,t,n){const{style:s,vars:r,transformOrigin:i}=e;let a=!1,o=!1;for(const l in t){const e=t[l];if(yv.has(l))a=!0;else if(Ev(l))r[l]=e;else{const t=Wx(e,ox[l]);l.startsWith("origin")?(o=!0,i[l]=t):s[l]=t}}if(t.transform||(a||n?s.transform=function(e,t,n){let s="",r=!0;for(let i=0;i<Gx;i++){const a=vv[i],o=e[a];if(void 0===o)continue;let l=!0;if(l="number"===typeof o?o===(a.startsWith("scale")?1:0):0===parseFloat(o),!l||n){const e=Wx(o,ox[a]);l||(r=!1,s+=`${Hx[a]||a}(${e}) `),n&&(t[a]=e)}}return s=s.trim(),n?s=n(t,r?"":s):r&&(s="none"),s}(t,e.transform,n):s.transform&&(s.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:n=0}=i;s.transformOrigin=`${e} ${t} ${n}`}}function Yx(e,t,n,s){let{style:r,vars:i}=t;const a=e.style;let o;for(o in r)a[o]=r[o];for(o in s?.applyProjectionStyles(a,n),i)a.setProperty(o,i[o])}const Kx={};function Xx(e,t){let{layout:n,layoutId:s}=t;return yv.has(e)||e.startsWith("origin")||(n||void 0!==s)&&(!!Kx[e]||"opacity"===e)}function Jx(e,t,n){const{style:s}=e,r={};for(const i in s)(mx(s[i])||t.style&&mx(t.style[i])||Xx(i,e)||void 0!==n?.getValue(i)?.liveStyle)&&(r[i]=s[i]);return r}class Zx extends qx{constructor(){super(...arguments),this.type="html",this.renderInstance=Yx}readValueFromInstance(e,t){if(yv.has(t))return this.projection?.isProjecting?Sv(t):((e,t)=>{const{transform:n="none"}=getComputedStyle(e);return _v(n,t)})(e,t);{const s=(n=e,window.getComputedStyle(n)),r=(Ev(t)?s.getPropertyValue(t):s[t])||0;return"string"===typeof r?r.trim():r}var n}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return Kv(e,n)}build(e,t,n){Qx(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return Jx(e,t,n)}}const eb=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),tb={offset:"stroke-dashoffset",array:"stroke-dasharray"},nb={offset:"strokeDashoffset",array:"strokeDasharray"};function sb(e,t,n,s,r){let{attrX:i,attrY:a,attrScale:o,pathLength:l,pathSpacing:c=1,pathOffset:u=0,...d}=t;if(Qx(e,d,s),n)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:m}=e;h.transform&&(m.transform=h.transform,delete h.transform),(m.transform||h.transformOrigin)&&(m.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),m.transform&&(m.transformBox=r?.transformBox??"fill-box",delete h.transformBox),void 0!==i&&(h.x=i),void 0!==a&&(h.y=a),void 0!==o&&(h.scale=o),void 0!==l&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const i=r?tb:nb;e[i.offset]=iy.transform(-s);const a=iy.transform(t),o=iy.transform(n);e[i.array]=`${a} ${o}`}(h,l,c,u,!1)}const rb=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),ib=e=>"string"===typeof e&&"svg"===e.toLowerCase();function ab(e,t,n){const s=Jx(e,t,n);for(const r in e)if(mx(e[r])||mx(t[r])){s[-1!==vv.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return s}class ob extends qx{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ix}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(yv.has(t)){const e=cx(t);return e&&e.default||0}return t=rb.has(t)?t:eb(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return ab(e,t,n)}build(e,t,n){sb(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,s){!function(e,t,n,s){Yx(e,t,void 0,s);for(const r in t.attrs)e.setAttribute(rb.has(r)?r:eb(r),t.attrs[r])}(e,t,0,s)}mount(e){this.isSVGTag=ib(e.tagName),super.mount(e)}}const lb=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cb(e){return"string"===typeof e&&!e.includes("-")&&!!(lb.indexOf(e)>-1||/[A-Z]/u.test(e))}const ub=(t,n)=>cb(t)?new ob(n):new Zx(n,{allowProjection:t!==e.Fragment}),db=(0,e.createContext)({}),hb=(0,e.createContext)({strict:!1}),mb=(0,e.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),pb=(0,e.createContext)({});function fb(t){const{initial:n,animate:s}=function(e,t){if($x(e)){const{initial:t,animate:n}=e;return{initial:!1===t||Ox(t)?t:void 0,animate:Ox(n)?n:void 0}}return!1!==e.inherit?t:{}}(t,(0,e.useContext)(pb));return(0,e.useMemo)(()=>({initial:n,animate:s}),[gb(n),gb(s)])}function gb(e){return Array.isArray(e)?e.join(" "):e}const vb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function yb(e,t,n){for(const s in t)mx(t[s])||Xx(s,n)||(e[s]=t[s])}function xb(t,n){const s={};return yb(s,t.style||{},t),Object.assign(s,function(t,n){let{transformTemplate:s}=t;return(0,e.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return Qx(e,n,s),Object.assign({},e.vars,e.style)},[n])}(t,n)),s}function bb(e,t){const n={},s=xb(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const wb=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}});function kb(t,n,s,r){const i=(0,e.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return sb(e,n,ib(r),t.transformTemplate,t.style),{...e.attrs,style:{...e.style}}},[n]);if(t.style){const e={};yb(e,t.style,t),i.style={...e,...i.style}}return i}const Nb=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function jb(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Nb.has(e)}let Cb=e=>!jb(e);try{"function"===typeof(Sb=require("@emotion/is-prop-valid").default)&&(Cb=e=>e.startsWith("on")?!jb(e):Sb(e))}catch{}var Sb;function _b(t,n,s,r,i){let{latestValues:a}=r,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=(cb(t)?kb:bb)(n,a,i,t),c=function(e,t,n){const s={};for(const r in e)"values"===r&&"object"===typeof e.values||(Cb(r)||!0===n&&jb(r)||!t&&!jb(r)||e.draggable&&r.startsWith("onDrag"))&&(s[r]=e[r]);return s}(n,"string"===typeof t,o),u=t!==e.Fragment?{...c,...l,ref:s}:{},{children:d}=n,h=(0,e.useMemo)(()=>mx(d)?d.get():d,[d]);return(0,e.createElement)(t,{...u,children:h})}const Tb=(0,e.createContext)(null);function Ib(e){return mx(e)?e.get():e}function Eb(e,t,n,s){const r={},i=s(e,{});for(const h in i)r[h]=Ib(i[h]);let{initial:a,animate:o}=e;const l=$x(e),c=Fx(e);t&&c&&!l&&!1!==e.inherit&&(void 0===a&&(a=t.initial),void 0===o&&(o=t.animate));let u=!!n&&!1===n.initial;u=u||!1===a;const d=u?o:a;if(d&&"boolean"!==typeof d&&!Dx(d)){const t=Array.isArray(d)?d:[d];for(let n=0;n<t.length;n++){const s=Vx(e,t[n]);if(s){const{transitionEnd:e,transition:t,...n}=s;for(const s in n){let e=n[s];if(Array.isArray(e)){e=e[u?e.length-1:0]}null!==e&&(r[s]=e)}for(const s in e)r[s]=e[s]}}}return r}const Ab=t=>(n,s)=>{const r=(0,e.useContext)(pb),i=(0,e.useContext)(Tb),a=()=>function(e,t,n,s){let{scrapeMotionValuesFromProps:r,createRenderState:i}=e;return{latestValues:Eb(t,n,s,r),renderState:i()}}(t,n,r,i);return s?a():function(t){const n=(0,e.useRef)(null);return null===n.current&&(n.current=t()),n.current}(a)},Pb=Ab({scrapeMotionValuesFromProps:Jx,createRenderState:vb}),Mb=Ab({scrapeMotionValuesFromProps:ab,createRenderState:wb});const Db=Symbol.for("motionComponentSymbol");function Ob(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Rb(t,n,s){return(0,e.useCallback)(e=>{e&&t.onMount&&t.onMount(e),n&&(e?n.mount(e):n.unmount()),s&&("function"===typeof s?s(e):Ob(s)&&(s.current=e))},[n])}const Lb="data-"+eb("framerAppearId"),$b=(0,e.createContext)({}),Fb=Ex?e.useLayoutEffect:e.useEffect;function Ub(t,n,s,r,i){const{visualElement:a}=(0,e.useContext)(pb),o=(0,e.useContext)(hb),l=(0,e.useContext)(Tb),c=(0,e.useContext)(mb).reducedMotion,u=(0,e.useRef)(null);r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:n,parent:a,props:s,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const d=u.current,h=(0,e.useContext)($b);!d||d.projection||!i||"html"!==d.type&&"svg"!==d.type||function(e,t,n,s){const{layoutId:r,layout:i,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Vb(e.parent)),e.projection.setOptions({layoutId:r,layout:i,alwaysMeasureLayout:Boolean(a)||o&&Ob(o),visualElement:e,animationType:"string"===typeof i?i:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:c})}(u.current,s,i,h);const m=(0,e.useRef)(!1);(0,e.useInsertionEffect)(()=>{d&&m.current&&d.update(s,l)});const p=s[Lb],f=(0,e.useRef)(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Fb(()=>{d&&(m.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),f.current&&d.animationState&&d.animationState.animateChanges())}),(0,e.useEffect)(()=>{d&&(!f.current&&d.animationState&&d.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),f.current=!1))}),d}function Vb(e){if(e)return!1!==e.options.allowProjection?e.projection:Vb(e.parent)}function Bb(t){let{forwardMotionProps:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;s&&function(e){for(const t in e)Tx[t]={...Tx[t],...e[t]}}(s);const i=cb(t)?Mb:Pb;function a(s,a){let o;const l={...(0,e.useContext)(mb),...s,layoutId:zb(s)},{isStatic:c}=l,u=fb(s),d=i(s,c);if(!c&&Ex){!function(){(0,e.useContext)(hb).strict;0}();const n=function(e){const{drag:t,layout:n}=Tx;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}(l);o=n.MeasureLayout,u.visualElement=Ub(t,d,l,r,n.ProjectionNode)}return(0,Lm.jsxs)(pb.Provider,{value:u,children:[o&&u.visualElement?(0,Lm.jsx)(o,{visualElement:u.visualElement,...l}):null,_b(t,s,Rb(d,u.visualElement,a),d,c,n)]})}a.displayName=`motion.${"string"===typeof t?t:`create(${t.displayName??t.name??""})`}`;const o=(0,e.forwardRef)(a);return o[Db]=t,o}function zb(t){let{layoutId:n}=t;const s=(0,e.useContext)(db).id;return s&&void 0!==n?s+"-"+n:n}function qb(e,t){if("undefined"===typeof Proxy)return Bb;const n=new Map,s=(n,s)=>Bb(n,s,e,t);return new Proxy((e,t)=>s(e,t),{get:(r,i)=>"create"===i?s:(n.has(i)||n.set(i,Bb(i,void 0,e,t)),n.get(i))})}function Wb(e,t,n){const s=e.getProps();return Vx(s,t,void 0!==n?n:s.custom,e)}function Hb(e,t){return e?.[t]??e?.default??e}const Gb=e=>Array.isArray(e);function Qb(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Nx(n))}function Yb(e){return Gb(e)?e[e.length-1]||0:e}function Kb(e,t){const n=e.getValue("willChange");if(s=n,Boolean(mx(s)&&s.add))return n.add(t);if(!n&&by.WillChange){const n=new by.WillChange("auto");e.addValue("willChange",n),n.add(t)}var s}function Xb(e){return e.props[Lb]}function Jb(e){e.duration=0,e.type}const Zb=(e,t)=>n=>t(e(n)),ew=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(Zb)},tw=e=>1e3*e,nw=e=>e/1e3,sw={layout:0,mainThread:0,waapi:0};function rw(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function iw(e,t){return n=>n>0?t:e}const aw=(e,t,n)=>{const s=e*e,r=n*(t*t-s)+s;return r<0?0:Math.sqrt(r)},ow=[qy,zy,Wy];function lw(e){const t=(e=>ow.find(t=>t.test(e)))(e);if(Boolean(t),!Boolean(t))return!1;let n=t.parse(e);return t===Wy&&(n=function(e){let{hue:t,saturation:n,lightness:s,alpha:r}=e;t/=360,n/=100,s/=100;let i=0,a=0,o=0;if(n){const e=s<.5?s*(1+n):s+n-s*n,r=2*s-e;i=rw(r,e,t+1/3),a=rw(r,e,t),o=rw(r,e,t-1/3)}else i=a=o=s;return{red:Math.round(255*i),green:Math.round(255*a),blue:Math.round(255*o),alpha:r}}(n)),n}const cw=(e,t)=>{const n=lw(e),s=lw(t);if(!n||!s)return iw(e,t);const r={...n};return e=>(r.red=aw(n.red,s.red,e),r.green=aw(n.green,s.green,e),r.blue=aw(n.blue,s.blue,e),r.alpha=Ov(n.alpha,s.alpha,e),zy.transform(r))},uw=new Set(["none","hidden"]);function dw(e,t){return n=>Ov(e,t,n)}function hw(e){return"number"===typeof e?dw:"string"===typeof e?Pv(e)?iw:Hy.test(e)?cw:fw:Array.isArray(e)?mw:"object"===typeof e?Hy.test(e)?cw:pw:iw}function mw(e,t){const n=[...e],s=n.length,r=e.map((e,n)=>hw(e)(e,t[n]));return e=>{for(let t=0;t<s;t++)n[t]=r[t](e);return n}}function pw(e,t){const n={...e,...t},s={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(s[r]=hw(e[r])(e[r],t[r]));return e=>{for(const t in s)n[t]=s[t](e);return n}}const fw=(e,t)=>{const n=tx.createTransformer(t),s=Xy(e),r=Xy(t);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?uw.has(e)&&!r.values.length||uw.has(t)&&!s.values.length?function(e,t){return uw.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):ew(mw(function(e,t){const n=[],s={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const i=t.types[r],a=e.indexes[i][s[i]],o=e.values[a]??0;n[r]=o,s[i]++}return n}(s,r),r.values),n):iw(e,t)};function gw(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return Ov(e,t,n);return hw(e)(e,t)}const vw=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return jy.update(t,e)},stop:()=>Cy(t),now:()=>Sy.isProcessing?Sy.timestamp:gx.now()}},yw=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s="";const r=Math.max(Math.round(t/n),2);for(let i=0;i<r;i++)s+=Math.round(1e4*e(i/(r-1)))/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},xw=2e4;function bw(e){let t=0;let n=e.next(t);for(;!n.done&&t<xw;)t+=50,n=e.next(t);return t>=xw?1/0:t}function ww(e,t,n){const s=Math.max(t-5,0);return bx(n-e(s),t-s)}const kw={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Nw=.001;function jw(e){let t,n,{duration:s=kw.duration,bounce:r=kw.bounce,velocity:i=kw.velocity,mass:a=kw.mass}=e;tw(kw.maxDuration);let o=1-r;o=Jv(kw.minDamping,kw.maxDamping,o),s=Jv(kw.minDuration,kw.maxDuration,nw(s)),o<1?(t=e=>{const t=e*o,n=t*s,r=t-i,a=Sw(e,o),l=Math.exp(-n);return Nw-r/a*l},n=e=>{const n=e*o*s,r=n*i+i,a=Math.pow(o,2)*Math.pow(e,2)*s,l=Math.exp(-n),c=Sw(Math.pow(e,2),o);return(-t(e)+Nw>0?-1:1)*((r-a)*l)/c}):(t=e=>Math.exp(-e*s)*((e-i)*s+1)-.001,n=e=>Math.exp(-e*s)*(s*s*(i-e)));const l=function(e,t,n){let s=n;for(let r=1;r<Cw;r++)s-=e(s)/t(s);return s}(t,n,5/s);if(s=tw(s),isNaN(l))return{stiffness:kw.stiffness,damping:kw.damping,duration:s};{const e=Math.pow(l,2)*a;return{stiffness:e,damping:2*o*Math.sqrt(a*e),duration:s}}}const Cw=12;function Sw(e,t){return e*Math.sqrt(1-t*t)}const _w=["duration","bounce"],Tw=["stiffness","damping","mass"];function Iw(e,t){return t.some(t=>void 0!==e[t])}function Ew(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kw.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kw.bounce;const n="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:s,restDelta:r}=n;const i=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],o={done:!1,value:i},{stiffness:l,damping:c,mass:u,duration:d,velocity:h,isResolvedFromDuration:m}=function(e){let t={velocity:kw.velocity,stiffness:kw.stiffness,damping:kw.damping,mass:kw.mass,isResolvedFromDuration:!1,...e};if(!Iw(e,Tw)&&Iw(e,_w))if(e.visualDuration){const n=e.visualDuration,s=2*Math.PI/(1.2*n),r=s*s,i=2*Jv(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:kw.mass,stiffness:r,damping:i}}else{const n=jw(e);t={...t,...n,mass:kw.mass},t.isResolvedFromDuration=!0}return t}({...n,velocity:-nw(n.velocity||0)}),p=h||0,f=c/(2*Math.sqrt(l*u)),g=a-i,v=nw(Math.sqrt(l/u)),y=Math.abs(g)<5;let x;if(s||(s=y?kw.restSpeed.granular:kw.restSpeed.default),r||(r=y?kw.restDelta.granular:kw.restDelta.default),f<1){const e=Sw(v,f);x=t=>{const n=Math.exp(-f*v*t);return a-n*((p+f*v*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===f)x=e=>a-Math.exp(-v*e)*(g+(p+v*g)*e);else{const e=v*Math.sqrt(f*f-1);x=t=>{const n=Math.exp(-f*v*t),s=Math.min(e*t,300);return a-n*((p+f*v*g)*Math.sinh(s)+e*g*Math.cosh(s))/e}}const b={calculatedDuration:m&&d||null,next:e=>{const t=x(e);if(m)o.done=e>=d;else{let n=0===e?p:0;f<1&&(n=0===e?tw(p):ww(x,e,t));const i=Math.abs(n)<=s,l=Math.abs(a-t)<=r;o.done=i&&l}return o.value=o.done?a:t,o},toString:()=>{const e=Math.min(bw(b),xw),t=yw(t=>b.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return b}function Aw(e){let{keyframes:t,velocity:n=0,power:s=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:u=.5,restSpeed:d}=e;const h=t[0],m={done:!1,value:h},p=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let f=s*n;const g=h+f,v=void 0===o?g:o(g);v!==g&&(f=v-h);const y=e=>-f*Math.exp(-e/r),x=e=>v+y(e),b=e=>{const t=y(e),n=x(e);m.done=Math.abs(t)<=u,m.value=m.done?v:n};let w,k;const N=e=>{(e=>void 0!==l&&e<l||void 0!==c&&e>c)(m.value)&&(w=e,k=Ew({keyframes:[m.value,p(m.value)],velocity:ww(x,e,m.value),damping:i,stiffness:a,restDelta:u,restSpeed:d}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return k||void 0!==w||(t=!0,b(e),N(e)),void 0!==w&&e>=w?k.next(e-w):(!t&&b(e),m)}}}Ew.applyToOptions=e=>{const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const n=(arguments.length>2?arguments[2]:void 0)({...e,keyframes:[0,t]}),s=Math.min(bw(n),xw);return{type:"keyframes",ease:e=>n.next(s*e).value/t,duration:nw(s)}}(e,100,Ew);return e.ease=t.ease,e.duration=tw(t.duration),e.type="keyframes",e};const Pw=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function Mw(e,t,n,s){if(e===t&&n===s)return xy;const r=t=>function(e,t,n,s,r){let i,a,o=0;do{a=t+(n-t)/2,i=Pw(a,s,r)-e,i>0?n=a:t=a}while(Math.abs(i)>1e-7&&++o<12);return a}(t,0,1,e,n);return e=>0===e||1===e?e:Pw(r(e),t,s)}const Dw=Mw(.42,0,1,1),Ow=Mw(0,0,.58,1),Rw=Mw(.42,0,.58,1),Lw=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,$w=e=>t=>1-e(1-t),Fw=Mw(.33,1.53,.69,.99),Uw=$w(Fw),Vw=Lw(Uw),Bw=e=>(e*=2)<1?.5*Uw(e):.5*(2-Math.pow(2,-10*(e-1))),zw=e=>1-Math.sin(Math.acos(e)),qw=$w(zw),Ww=Lw(zw),Hw=e=>Array.isArray(e)&&"number"===typeof e[0],Gw={linear:xy,easeIn:Dw,easeInOut:Rw,easeOut:Ow,circIn:zw,circInOut:Ww,circOut:qw,backIn:Uw,backInOut:Vw,backOut:Fw,anticipate:Bw},Qw=e=>{if(Hw(e)){e.length;const[t,n,s,r]=e;return Mw(t,n,s,r)}return"string"===typeof e?Gw[e]:e},Yw=(e,t,n)=>{const s=t-e;return 0===s?1:(n-e)/s};function Kw(e,t){let{clamp:n=!0,ease:s,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.length;if(t.length,1===i)return()=>t[0];if(2===i&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,n){const s=[],r=n||by.mix||gw,i=e.length-1;for(let a=0;a<i;a++){let n=r(e[a],e[a+1]);if(t){const e=Array.isArray(t)?t[a]||xy:t;n=ew(e,n)}s.push(n)}return s}(t,s,r),l=o.length,c=n=>{if(a&&n<e[0])return t[0];let s=0;if(l>1)for(;s<e.length-2&&!(n<e[s+1]);s++);const r=Yw(e[s],e[s+1],n);return o[s](r)};return n?t=>c(Jv(e[0],e[i-1],t)):c}function Xw(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const r=Yw(0,t,s);e.push(Ov(n,1,r))}}(t,e.length-1),t}function Jw(e){let{duration:t=300,keyframes:n,times:s,ease:r="easeInOut"}=e;const i=(e=>Array.isArray(e)&&"number"!==typeof e[0])(r)?r.map(Qw):Qw(r),a={done:!1,value:n[0]},o=function(e,t){return e.map(e=>e*t)}(s&&s.length===n.length?s:Xw(n),t),l=Kw(o,n,{ease:Array.isArray(i)?i:(c=n,u=i,c.map(()=>u||Rw).splice(0,c.length-1))});var c,u;return{calculatedDuration:t,next:e=>(a.value=l(e),a.done=e>=t,a)}}const Zw=e=>null!==e;function ek(e,t,n){let{repeat:s,repeatType:r="loop"}=t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const a=e.filter(Zw),o=i<0||s&&"loop"!==r&&s%2===1?0:a.length-1;return o&&void 0!==n?n:a[o]}const tk={decay:Aw,inertia:Aw,tween:Jw,keyframes:Jw,spring:Ew};function nk(e){"string"===typeof e.type&&(e.type=tk[e.type])}class sk{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const rk=e=>e/100;class ik extends sk{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==gx.now()&&this.tick(gx.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},sw.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;nk(e);const{type:t=Jw,repeat:n=0,repeatDelay:s=0,repeatType:r,velocity:i=0}=e;let{keyframes:a}=e;const o=t||Jw;o!==Jw&&"number"!==typeof a[0]&&(this.mixKeyframes=ew(rk,gw(a[0],a[1])),a=[0,100]);const l=o({...e,keyframes:a});"mirror"===r&&(this.mirroredGenerator=o({...e,keyframes:[...a].reverse(),velocity:-i})),null===l.calculatedDuration&&(l.calculatedDuration=bw(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+s,this.totalDuration=this.resolvedDuration*(n+1)-s,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{generator:n,totalDuration:s,mixKeyframes:r,mirroredGenerator:i,resolvedDuration:a,calculatedDuration:o}=this;if(null===this.startTime)return n.next(0);const{delay:l=0,keyframes:c,repeat:u,repeatType:d,repeatDelay:h,type:m,onUpdate:p,finalKeyframe:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>s;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=s);let y=this.currentTime,x=n;if(u){const e=Math.min(this.currentTime,s)/a;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===d?(n=1-n,h&&(n-=h/a)):"mirror"===d&&(x=i)),y=Jv(0,1,n)*a}const b=v?{done:!1,value:c[0]}:x.next(y);r&&(b.value=r(b.value));let{done:w}=b;v||null===o||(w=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const k=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return k&&m!==Aw&&(b.value=ek(c,this.options,f,this.speed)),p&&p(b.value),k&&this.finish(),b}then(e,t){return this.finished.then(e,t)}get duration(){return nw(this.calculatedDuration)}get time(){return nw(this.currentTime)}set time(e){e=tw(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(gx.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=nw(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=vw,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();const n=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=n):null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(gx.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,sw.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function ak(e){let t;return()=>(void 0===t&&(t=e()),t)}const ok=ak(()=>void 0!==window.ScrollTimeline),lk={};function ck(e,t){const n=ak(e);return()=>lk[t]??n()}const uk=ck(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),dk=e=>{let[t,n,s,r]=e;return`cubic-bezier(${t}, ${n}, ${s}, ${r})`},hk={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:dk([0,.65,.55,1]),circOut:dk([.55,0,1,.45]),backIn:dk([.31,.01,.66,-.59]),backOut:dk([.33,1.53,.69,.99])};function mk(e,t){return e?"function"===typeof e?uk()?yw(e,t):"ease-out":Hw(e)?dk(e):Array.isArray(e)?e.map(e=>mk(e,t)||hk.easeOut):hk[e]:void 0}function pk(e,t,n){let{delay:s=0,duration:r=300,repeat:i=0,repeatType:a="loop",ease:o="easeOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const u={[t]:n};l&&(u.offset=l);const d=mk(o,r);Array.isArray(d)&&(u.easing=d),ky.value&&sw.waapi++;const h={delay:s,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:"reverse"===a?"alternate":"normal"};c&&(h.pseudoElement=c);const m=e.animate(u,h);return ky.value&&m.finished.finally(()=>{sw.waapi--}),m}function fk(e){return"function"===typeof e&&"applyToOptions"in e}class gk extends sk{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:s,pseudoElement:r,allowFlatten:i=!1,finalKeyframe:a,onComplete:o}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=i,this.options=e,e.type;const l=function(e){let{type:t,...n}=e;return fk(t)&&uk()?t.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}(e);this.animation=pk(t,n,s,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=ek(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,n){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,n):e.style[t]=n}(t,n,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return nw(Number(e))}get time(){return nw(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=tw(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline(e){let{timeline:t,observe:n}=e;return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&ok()?(this.animation.timeline=t,xy):n(this)}}const vk={anticipate:Bw,backInOut:Vw,circInOut:Ww};function yk(e){"string"===typeof e.ease&&e.ease in vk&&(e.ease=vk[e.ease])}class xk extends gk{constructor(e){yk(e),nk(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:s,element:r,...i}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const a=new ik({...i,autoplay:!1}),o=tw(this.finishedTime??this.time);t.setWithVelocity(a.sample(o-10).value,a.sample(o).value,10),a.stop()}}const bk=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!tx.test(e)&&"0"!==e||e.startsWith("url(")));const wk=new Set(["opacity","clipPath","filter","transform"]),kk=ak(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class Nk extends sk{constructor(e){let{autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:a="loop",keyframes:o,name:l,motionValue:c,element:u,...d}=e;super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=gx.now();const h={autoplay:t,delay:n,type:s,repeat:r,repeatDelay:i,repeatType:a,name:l,motionValue:c,element:u,...d},m=u?.KeyframeResolver||Dy;this.keyframeResolver=new m(o,(e,t,n)=>this.onKeyframesResolved(e,t,h,!n),l,c,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,n,s){this.keyframeResolver=void 0;const{name:r,type:i,velocity:a,delay:o,isHandoff:l,onUpdate:c}=n;this.resolvedAt=gx.now(),function(e,t,n,s){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const i=e[e.length-1],a=bk(r,t),o=bk(i,t);return!(!a||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||fk(n))&&s)}(e,r,i,a)||(!by.instantAnimations&&o||c?.(ek(e,n,t)),e[0]=e[e.length-1],Jb(n),n.repeat=0);const u={startTime:s?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},d=!l&&function(e){const{motionValue:t,name:n,repeatDelay:s,repeatType:r,damping:i,type:a}=e,o=t?.owner?.current;if(!(o instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=t.owner.getProps();return kk()&&n&&wk.has(n)&&("transform"!==n||!c)&&!l&&!s&&"mirror"!==r&&0!==i&&"inertia"!==a}(u)?new xk({...u,element:u.motionValue.owner.current}):new ik(u);d.finished.then(()=>this.notifyFinished()).catch(xy),this.pendingTimeline&&(this.stopTimeline=d.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=d}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Ay=!0,My(),Py(),Ay=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const jk=e=>null!==e;const Ck={type:"spring",stiffness:500,damping:25,restSpeed:10},Sk={type:"keyframes",duration:.8},_k={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Tk=(e,t)=>{let{keyframes:n}=t;return n.length>2?Sk:yv.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Ck:_k};const Ik=function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return a=>{const o=Hb(s,e)||{},l=o.delay||s.delay||0;let{elapsed:c=0}=s;c-=tw(l);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:i?void 0:r};(function(e){let{when:t,delay:n,delayChildren:s,staggerChildren:r,staggerDirection:i,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:u,...d}=e;return!!Object.keys(d).length})(o)||Object.assign(u,Tk(e,u)),u.duration&&(u.duration=tw(u.duration)),u.repeatDelay&&(u.repeatDelay=tw(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(Jb(u),0===u.delay&&(d=!0)),(by.instantAnimations||by.skipAnimations)&&(d=!0,Jb(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,d&&!i&&void 0!==t.get()){const e=function(e,t,n){let{repeat:s,repeatType:r="loop"}=t;const i=e.filter(jk),a=s&&"loop"!==r&&s%2===1?0:i.length-1;return a&&void 0!==n?n:i[a]}(u.keyframes,o);if(void 0!==e)return void jy.update(()=>{u.onUpdate(e),u.onComplete()})}return o.isSync?new ik(u):new Nk(u)}};function Ek(e,t){let{protectedKeys:n,needsAnimating:s}=e;const r=n.hasOwnProperty(t)&&!0!==s[t];return s[t]=!1,r}function Ak(e,t){let{delay:n=0,transitionOverride:s,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{transition:i=e.getDefaultTransition(),transitionEnd:a,...o}=t;s&&(i=s);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const u in o){const t=e.getValue(u,e.latestValues[u]??null),s=o[u];if(void 0===s||c&&Ek(c,u))continue;const r={delay:n,...Hb(i||{},u)},a=t.get();if(void 0!==a&&!t.isAnimating&&!Array.isArray(s)&&s===a&&!r.velocity)continue;let d=!1;if(window.MotionHandoffAnimation){const t=Xb(e);if(t){const e=window.MotionHandoffAnimation(t,u,jy);null!==e&&(r.startTime=e,d=!0)}}Kb(e,u),t.start(Ik(u,t,s,e.shouldReduceMotion&&Xv.has(u)?{type:!1}:r,e,d));const h=t.animation;h&&l.push(h)}return a&&Promise.all(l).then(()=>{jy.update(()=>{a&&function(e,t){const n=Wb(e,t);let{transitionEnd:s={},transition:r={},...i}=n||{};i={...i,...s};for(const a in i)Qb(e,a,Yb(i[a]))}(e,a)})}),l}function Pk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=Wb(e,t,"exit"===n.type?e.presenceContext?.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(r=n.transitionOverride);const i=s?()=>Promise.all(Ak(e,s,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:i=0,staggerChildren:a,staggerDirection:o}=r;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0;const o=[],l=e.variantChildren.size,c=(l-1)*r,u="function"===typeof s,d=u?e=>s(e,l):1===i?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*r}:function(){return c-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*r};return Array.from(e.variantChildren).sort(Mk).forEach((e,r)=>{e.notify("AnimationStart",t),o.push(Pk(e,t,{...a,delay:n+(u?0:s)+d(r)}).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(o)}(e,t,s,i,a,o,n)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[i,a]:[a,i];return e().then(()=>t())}return Promise.all([i(),a(n.delay)])}function Mk(e,t){return e.sortNodePosition(t)}function Dk(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}const Ok=Lx.length;function Rk(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Rk(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<Ok;n++){const s=Lx[n],r=e.props[s];(Ox(r)||!1===r)&&(t[s]=r)}return t}const Lk=[...Rx].reverse(),$k=Rx.length;function Fk(e){return t=>Promise.all(t.map(t=>{let{animation:n,options:s}=t;return function(e,t){let n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map(t=>Pk(e,t,s));n=Promise.all(r)}else if("string"===typeof t)n=Pk(e,t,s);else{const r="function"===typeof t?Wb(e,t,s.custom):t;n=Promise.all(Ak(e,r,s))}return n.then(()=>{e.notify("AnimationComplete",t)})}(e,n,s)}))}function Uk(e){let t=Fk(e),n=zk(),s=!0;const r=t=>(n,s)=>{const r=Wb(e,s,"exit"===t?e.presenceContext?.custom:void 0);if(r){const{transition:e,transitionEnd:t,...s}=r;n={...n,...s,...t}}return n};function i(i){const{props:a}=e,o=Rk(e.parent)||{},l=[],c=new Set;let u={},d=1/0;for(let t=0;t<$k;t++){const h=Lk[t],m=n[h],p=void 0!==a[h]?a[h]:o[h],f=Ox(p),g=h===i?m.isActive:null;!1===g&&(d=t);let v=p===o[h]&&p!==a[h]&&f;if(v&&s&&e.manuallyAnimateOnMount&&(v=!1),m.protectedKeys={...u},!m.isActive&&null===g||!p&&!m.prevProp||Dx(p)||"boolean"===typeof p)continue;const y=Vk(m.prevProp,p);let x=y||h===i&&m.isActive&&!v&&f||t>d&&f,b=!1;const w=Array.isArray(p)?p:[p];let k=w.reduce(r(h),{});!1===g&&(k={});const{prevResolvedValues:N={}}=m,j={...N,...k},C=t=>{x=!0,c.has(t)&&(b=!0,c.delete(t)),m.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in j){const t=k[e],n=N[e];if(u.hasOwnProperty(e))continue;let s=!1;s=Gb(t)&&Gb(n)?!Dk(t,n):t!==n,s?void 0!==t&&null!==t?C(e):c.add(e):void 0!==t&&c.has(e)?C(e):m.protectedKeys[e]=!0}m.prevProp=p,m.prevResolvedValues=k,m.isActive&&(u={...u,...k}),s&&e.blockInitialAnimation&&(x=!1);x&&(!(v&&y)||b)&&l.push(...w.map(e=>({animation:e,options:{type:h}})))}if(c.size){const t={};if("boolean"!==typeof a.initial){const n=Wb(e,Array.isArray(a.initial)?a.initial[0]:a.initial);n&&n.transition&&(t.transition=n.transition)}c.forEach(n=>{const s=e.getBaseTarget(n),r=e.getValue(n);r&&(r.liveStyle=!0),t[n]=s??null}),l.push({animation:t})}let h=Boolean(l.length);return!s||!1!==a.initial&&a.initial!==a.animate||e.manuallyAnimateOnMount||(h=!1),s=!1,h?t(l):Promise.resolve()}return{animateChanges:i,setActive:function(t,s){if(n[t].isActive===s)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,s)),n[t].isActive=s;const r=i(t);for(const e in n)n[e].protectedKeys={};return r},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=zk(),s=!0}}}function Vk(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!Dk(t,e)}function Bk(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function zk(){return{animate:Bk(!0),whileInView:Bk(),whileHover:Bk(),whileTap:Bk(),whileDrag:Bk(),whileFocus:Bk(),exit:Bk()}}class qk{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Wk=0;const Hk={animation:{Feature:class extends qk{constructor(e){super(e),e.animationState||(e.animationState=Uk(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Dx(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends qk{constructor(){super(...arguments),this.id=Wk++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const s=this.node.animationState.setActive("exit",!e);t&&!e&&s.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}},Gk={x:!1,y:!1};function Qk(){return Gk.x||Gk.y}function Yk(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}const Kk=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function Xk(e){return{point:{x:e.pageX,y:e.pageY}}}function Jk(e,t,n,s){return Yk(e,t,(e=>t=>Kk(t)&&e(t,Xk(t)))(n),s)}function Zk(e){return e.max-e.min}function eN(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=s,e.originPoint=Ov(t.min,t.max,e.origin),e.scale=Zk(n)/Zk(t),e.translate=Ov(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function tN(e,t,n,s){eN(e.x,t.x,n.x,s?s.originX:void 0),eN(e.y,t.y,n.y,s?s.originY:void 0)}function nN(e,t,n){e.min=n.min+t.min,e.max=e.min+Zk(t)}function sN(e,t,n){e.min=t.min-n.min,e.max=e.min+Zk(t)}function rN(e,t,n){sN(e.x,t.x,n.x),sN(e.y,t.y,n.y)}function iN(e){return[e("x"),e("y")]}const aN=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},oN=(e,t)=>Math.abs(e-t);class lN{constructor(e,t){let{transformPagePoint:n,contextWindow:s=window,dragSnapToOrigin:r=!1,distanceThreshold:i=3}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=dN(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=oN(e.x,t.x),s=oN(e.y,t.y);return Math.sqrt(n**2+s**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!n)return;const{point:s}=e,{timestamp:r}=Sy;this.history.push({...s,timestamp:r});const{onStart:i,onMove:a}=this.handlers;t||(i&&i(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=cN(t,this.transformPagePoint),jy.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:s,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const i=dN("pointercancel"===e.type?this.lastMoveEventInfo:cN(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,i),s&&s(e,i)},!Kk(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=i,this.contextWindow=s||window;const a=cN(Xk(e),this.transformPagePoint),{point:o}=a,{timestamp:l}=Sy;this.history=[{...o,timestamp:l}];const{onSessionStart:c}=t;c&&c(e,dN(a,this.history)),this.removeListeners=ew(Jk(this.contextWindow,"pointermove",this.handlePointerMove),Jk(this.contextWindow,"pointerup",this.handlePointerUp),Jk(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Cy(this.updatePoint)}}function cN(e,t){return t?{point:t(e.point)}:e}function uN(e,t){return{x:e.x-t.x,y:e.y-t.y}}function dN(e,t){let{point:n}=e;return{point:n,delta:uN(n,mN(t)),offset:uN(n,hN(t)),velocity:pN(t,.1)}}function hN(e){return e[0]}function mN(e){return e[e.length-1]}function pN(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const r=mN(e);for(;n>=0&&(s=e[n],!(r.timestamp-s.timestamp>tw(t)));)n--;if(!s)return{x:0,y:0};const i=nw(r.timestamp-s.timestamp);if(0===i)return{x:0,y:0};const a={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function fN(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function gN(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}const vN=.35;function yN(e,t,n){return{min:xN(e,t),max:xN(e,n)}}function xN(e,t){return"number"===typeof e?e:e[t]||0}const bN=new WeakMap;class wN{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e){let{snapToCursor:t=!1,distanceThreshold:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new lN(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Xk(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:s,onDragStart:r}=this.getProps();if(n&&!s&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(i=n)||"y"===i?Gk[i]?null:(Gk[i]=!0,()=>{Gk[i]=!1}):Gk.x||Gk.y?null:(Gk.x=Gk.y=!0,()=>{Gk.x=Gk.y=!1}),!this.openDragLock))return;var i;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),iN(e=>{let t=this.getAxisMotionValue(e).get()||0;if(ry.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const s=n.layout.layoutBox[e];if(s){t=Zk(s)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),r&&jy.postRender(()=>r(e,t)),Kb(this.visualElement,"transform");const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:n,dragDirectionLock:s,onDirectionLock:r,onDrag:i}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:a}=t;if(s&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(a),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,a),this.updateAxis("y",t.point,a),this.visualElement.render(),i&&i(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>iN(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play())},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,distanceThreshold:n,contextWindow:aN(this.visualElement)})}stop(e,t){const n=e||this.latestPointerEvent,s=t||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!s||!n)return;const{velocity:i}=s;this.startAnimation(i);const{onDragEnd:a}=this.getProps();a&&jy.postRender(()=>a(n,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:s}=this.getProps();if(!n||!kN(e,s,this.currentDirection))return;const r=this.getAxisMotionValue(e);let i=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(i=function(e,t,n){let{min:s,max:r}=t;return void 0!==s&&e<s?e=n?Ov(s,e,n.min):Math.max(e,s):void 0!==r&&e>r&&(e=n?Ov(r,e,n.max):Math.min(e,r)),e}(i,this.constraints[e],this.elastic[e])),r.set(i)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;e&&Ob(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!n)&&function(e,t){let{top:n,left:s,bottom:r,right:i}=t;return{x:fN(e.x,s,i),y:fN(e.y,n,r)}}(n.layoutBox,e),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vN;return!1===e?e=0:!0===e&&(e=vN),{x:yN(e,"left","right"),y:yN(e,"top","bottom")}}(t),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&iN(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(n.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Ob(e))return!1;const n=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const r=function(e,t,n){const s=Kv(e,n),{scroll:r}=t;return r&&(Gv(s.x,r.offset.x),Gv(s.y,r.offset.y)),s}(n,s.root,this.visualElement.getTransformPagePoint());let i=function(e,t){return{x:gN(e.x,t.x),y:gN(e.y,t.y)}}(s.layout.layoutBox,r);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(i));this.hasMutatedConstraints=!!e,e&&(i=Dv(e))}return i}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:s,dragTransition:r,dragSnapToOrigin:i,onDragTransitionEnd:a}=this.getProps(),o=this.constraints||{},l=iN(a=>{if(!kN(a,t,this.currentDirection))return;let l=o&&o[a]||{};i&&(l={min:0,max:0});const c=s?200:1e6,u=s?40:1e7,d={type:"inertia",velocity:n?e[a]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(a,d)});return Promise.all(l).then(a)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return Kb(this.visualElement,e),n.start(Ik(e,n,0,t,this.visualElement,!1))}stopAnimation(){iN(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){iN(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),s=n[t];return s||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){iN(t=>{const{drag:n}=this.getProps();if(!kN(t,n,this.currentDirection))return;const{projection:s}=this.visualElement,r=this.getAxisMotionValue(t);if(s&&s.layout){const{min:n,max:i}=s.layout.layoutBox[t];r.set(e[t]-Ov(n,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Ob(t)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};iN(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();s[e]=function(e,t){let n=.5;const s=Zk(e),r=Zk(t);return r>s?n=Yw(t.min,t.max-s,e.min):s>r&&(n=Yw(e.min,e.max-r,t.min)),Jv(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),iN(t=>{if(!kN(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:i}=this.constraints[t];n.set(Ov(r,i,s[t]))})}addListeners(){if(!this.visualElement.current)return;bN.set(this.visualElement,this);const e=Jk(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();Ob(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),jy.read(t);const r=Yk(window,"resize",()=>this.scalePositionWithinConstraints()),i=n.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(iN(e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))}),this.visualElement.render())});return()=>{r(),e(),s(),i&&i()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:r=!1,dragElastic:i=vN,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:s,dragConstraints:r,dragElastic:i,dragMomentum:a}}}function kN(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const NN=e=>(t,n)=>{e&&jy.postRender(()=>e(t,n))};const jN={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function CN(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const SN={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!iy.test(e))return e;e=parseFloat(e)}return`${CN(e,t.target.x)}% ${CN(e,t.target.y)}%`}},_N={correct:(e,t)=>{let{treeScale:n,projectionDelta:s}=t;const r=e,i=tx.parse(e);if(i.length>5)return r;const a=tx.createTransformer(e),o="number"!==typeof i[0]?1:0,l=s.x.scale*n.x,c=s.y.scale*n.y;i[0+o]/=l,i[1+o]/=c;const u=Ov(l,c,.5);return"number"===typeof i[2+o]&&(i[2+o]/=u),"number"===typeof i[3+o]&&(i[3+o]/=u),a(i)}};let TN=!1;class IN extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:s}=this.props,{projection:r}=e;!function(e){for(const t in e)Kx[t]=e[t],Ev(t)&&(Kx[t].isCSSVariable=!0)}(AN),r&&(t.group&&t.group.add(r),n&&n.register&&s&&n.register(r),TN&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),jN.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:s,isPresent:r}=this.props,{projection:i}=n;return i?(i.isPresent=r,TN=!0,s||e.layoutDependency!==t||void 0===t||e.isPresent!==r?i.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?i.promote():i.relegate()||jy.postRender(()=>{const e=i.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Cx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function EN(t){const[n,s]=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=(0,e.useContext)(Tb);if(null===n)return[!0,null];const{isPresent:s,onExitComplete:r,register:i}=n,a=(0,e.useId)();(0,e.useEffect)(()=>{if(t)return i(a)},[t]);const o=(0,e.useCallback)(()=>t&&r&&r(a),[a,r,t]);return!s&&r?[!1,o]:[!0]}(),r=(0,e.useContext)(db);return(0,Lm.jsx)(IN,{...t,layoutGroup:r,switchLayoutGroup:(0,e.useContext)($b),isPresent:n,safeToRemove:s})}const AN={borderRadius:{...SN,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:SN,borderTopRightRadius:SN,borderBottomLeftRadius:SN,borderBottomRightRadius:SN,boxShadow:_N};function PN(e){return"object"===typeof e&&null!==e}function MN(e){return PN(e)&&"ownerSVGElement"in e}const DN=(e,t)=>e.depth-t.depth;class ON{constructor(){this.children=[],this.isDirty=!1}add(e){vx(this.children,e),this.isDirty=!0}remove(e){yx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(DN),this.isDirty=!1,this.children.forEach(e)}}function RN(e,t){const n=gx.now(),s=r=>{let{timestamp:i}=r;const a=i-n;a>=t&&(Cy(s),e(a-t))};return jy.setup(s,!0),()=>Cy(s)}const LN=["TopLeft","TopRight","BottomLeft","BottomRight"],$N=LN.length,FN=e=>"string"===typeof e?parseFloat(e):e,UN=e=>"number"===typeof e||iy.test(e);function VN(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const BN=qN(0,.5,qw),zN=qN(.5,.95,xy);function qN(e,t,n){return s=>s<e?0:s>t?1:n(Yw(e,t,s))}function WN(e,t){e.min=t.min,e.max=t.max}function HN(e,t){WN(e.x,t.x),WN(e.y,t.y)}function GN(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function QN(e,t,n,s,r){return e=Vv(e-=t,1/n,s),void 0!==r&&(e=Vv(e,1/r,s)),e}function YN(e,t,n,s,r){let[i,a,o]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;ry.test(t)&&(t=parseFloat(t),t=Ov(a.min,a.max,t/100)-a.min);if("number"!==typeof t)return;let o=Ov(i.min,i.max,s);e===i&&(o-=t),e.min=QN(e.min,t,n,o,r),e.max=QN(e.max,t,n,o,r)}(e,t[i],t[a],t[o],t.scale,s,r)}const KN=["x","scaleX","originX"],XN=["y","scaleY","originY"];function JN(e,t,n,s){YN(e.x,t,KN,n?n.x:void 0,s?s.x:void 0),YN(e.y,t,XN,n?n.y:void 0,s?s.y:void 0)}function ZN(e){return 0===e.translate&&1===e.scale}function ej(e){return ZN(e.x)&&ZN(e.y)}function tj(e,t){return e.min===t.min&&e.max===t.max}function nj(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function sj(e,t){return nj(e.x,t.x)&&nj(e.y,t.y)}function rj(e){return Zk(e.x)/Zk(e.y)}function ij(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class aj{constructor(){this.members=[]}add(e){vx(this.members,e),e.scheduleRender()}remove(e){if(yx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let s=t;s>=0;s--){const e=this.members[s];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;!1===s&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const oj={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},lj=["","X","Y","Z"];let cj=0;function uj(e,t,n,s){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),s&&(s[e]=0))}function dj(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=Xb(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",jy,!(t||s))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&dj(s)}function hj(e){let{attachResizeListener:t,defaultParent:n,measureScroll:s,checkIsScrollRoot:r,resetTransform:i}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n?.();this.id=cj++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ky.value&&(oj.nodes=oj.calculatedTargetDeltas=oj.calculatedProjections=0),this.nodes.forEach(fj),this.nodes.forEach(kj),this.nodes.forEach(Nj),this.nodes.forEach(gj),ky.addProjectionMetrics&&ky.addProjectionMetrics(oj)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new ON)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new xx),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];t&&t.notify(...s)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){if(this.instance)return;var n;this.isSVG=MN(e)&&!(MN(n=e)&&"svg"===n.tagName),this.instance=e;const{layoutId:s,layout:r,visualElement:i}=this.options;if(i&&!i.current&&i.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||s)&&(this.isLayoutDirty=!0),t){let n,s=0;const r=()=>this.root.updateBlockedByResize=!1;jy.read(()=>{s=window.innerWidth}),t(e,()=>{const e=window.innerWidth;e!==s&&(s=e,this.root.updateBlockedByResize=!0,n&&n(),n=RN(r,250),jN.hasAnimatedSinceResize&&(jN.hasAnimatedSinceResize=!1,this.nodes.forEach(wj)))})}s&&this.root.registerSharedNode(s,this),!1!==this.options.animate&&i&&(s||r)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n,hasRelativeLayoutChanged:s,layout:r}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||i.getDefaultTransition()||Ij,{onLayoutAnimationStart:o,onLayoutAnimationComplete:l}=i.getProps(),c=!this.targetLayout||!sj(this.targetLayout,r),u=!n&&s;if(this.options.layoutRoot||this.resumeFrom||u||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const e={...Hb(a,"layout"),onPlay:o,onComplete:l};(i.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e),this.setAnimationOrigin(t,u)}else n||wj(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Cy(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(jj),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&dj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const s=this.getTransformTemplate();this.prevTransformTemplateValue=s?s(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(yj);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(xj);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(bj),this.nodes.forEach(mj),this.nodes.forEach(pj)):this.nodes.forEach(xj),this.clearAllSnapshots();const e=gx.now();Sy.delta=Jv(0,1e3/60,e-Sy.timestamp),Sy.timestamp=e,Sy.isProcessing=!0,_y.update.process(Sy),_y.preRender.process(Sy),_y.render.process(Sy),Sy.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Cx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(vj),this.sharedNodes.forEach(Cj)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,jy.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){jy.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Zk(this.snapshot.measuredBox.x)||Zk(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!ej(this.projectionDelta),n=this.getTransformTemplate(),s=n?n(this.latestValues,""):void 0,r=s!==this.prevTransformTemplateValue;e&&this.instance&&(t||$v(this.latestValues)||r)&&(i(this.instance,s),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);var s;return e&&(n=this.removeTransform(n)),Pj((s=n).x),Pj(s.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Dj))){const{scroll:e}=this.root;e&&(Gv(t.x,e.offset.x),Gv(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(HN(t,e),this.scroll?.wasRoot)return t;for(let n=0;n<this.path.length;n++){const s=this.path[n],{scroll:r,options:i}=s;s!==this.root&&r&&i.layoutScroll&&(r.wasRoot&&HN(t,e),Gv(t.x,r.offset.x),Gv(t.y,r.offset.y))}return t}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};HN(n,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Yv(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),$v(e.latestValues)&&Yv(n,e.latestValues)}return $v(this.latestValues)&&Yv(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};HN(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!$v(e.latestValues))continue;Lv(e.latestValues)&&e.updateSnapshot();const s=Ix();HN(s,e.measurePageBox()),JN(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,s)}return $v(this.latestValues)&&JN(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Sy.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==t;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:s,layoutId:r}=this.options;if(this.layout&&(s||r)){if(this.resolvedRelativeTargetAt=Sy.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},rN(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),HN(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var i,a,o;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),i=this.target,a=this.relativeTarget,o=this.relativeParent.target,nN(i.x,a.x,o.x),nN(i.y,a.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):HN(this.target,this.layout.layoutBox),qv(this.target,this.targetDelta)):HN(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},rN(this.relativeTargetOrigin,this.target,e.target),HN(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ky.value&&oj.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Lv(this.parent.latestValues)&&!Fv(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let n=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(n=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===Sy.timestamp&&(n=!1),n)return;const{layout:s,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!s&&!r)return;HN(this.layoutCorrected,this.layout.layoutBox);const i=this.treeScale.x,a=this.treeScale.y;!function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let i,a;t.x=t.y=1;for(let o=0;o<r;o++){i=n[o],a=i.projectionDelta;const{visualElement:r}=i.options;r&&r.props.style&&"contents"===r.props.style.display||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Yv(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,qv(e,a)),s&&$v(i.latestValues)&&Yv(e,i.latestValues))}t.x<Hv&&t.x>Wv&&(t.x=1),t.y<Hv&&t.y>Wv&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(GN(this.prevProjectionDelta.x,this.projectionDelta.x),GN(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),tN(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===i&&this.treeScale.y===a&&ij(this.projectionDelta.x,this.prevProjectionDelta.x)&&ij(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o)),ky.value&&oj.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,s=n?n.latestValues:{},r={...this.latestValues},i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const a={x:{min:0,max:0},y:{min:0,max:0}},o=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Tj));let d;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;Sj(i.x,e.x,n),Sj(i.y,e.y,n),this.setTargetDelta(i),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(rN(a,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,s){_j(e.x,t.x,n.x,s),_j(e.y,t.y,n.y,s)}(this.relativeTarget,this.relativeTargetOrigin,a,n),d&&function(e,t){return tj(e.x,t.x)&&tj(e.y,t.y)}(this.relativeTarget,d)&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),HN(d,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,n,s,r,i){r?(e.opacity=Ov(0,n.opacity??1,BN(s)),e.opacityExit=Ov(t.opacity??1,0,zN(s))):i&&(e.opacity=Ov(t.opacity??1,n.opacity??1,s));for(let a=0;a<$N;a++){const r=`border${LN[a]}Radius`;let i=VN(t,r),o=VN(n,r);void 0===i&&void 0===o||(i||(i=0),o||(o=0),0===i||0===o||UN(i)===UN(o)?(e[r]=Math.max(Ov(FN(i),FN(o),s),0),(ry.test(o)||ry.test(i))&&(e[r]+="%")):e[r]=o)}(t.rotate||n.rotate)&&(e.rotate=Ov(t.rotate||0,n.rotate||0,s))}(r,s,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Cy(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=jy.update(()=>{jN.hasAnimatedSinceResize=!0,sw.layout++,this.motionValue||(this.motionValue=Nx(0)),this.currentAnimation=function(e,t,n){const s=mx(e)?e:Nx(e);return s.start(Ik("",s,t,n)),s.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{sw.layout--},onComplete:()=>{sw.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:s,latestValues:r}=e;if(t&&n&&s){if(this!==e&&this.layout&&s&&Mj(this.options.animationType,this.layout.layoutBox,s.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Zk(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const s=Zk(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+s}HN(t,n),Yv(t,r),tN(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new aj);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this.getStack();s&&s.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const s={};n.z&&uj("z",e,s,this.animationValues);for(let r=0;r<lj.length;r++)uj(`rotate${lj[r]}`,e,s,this.animationValues),uj(`skew${lj[r]}`,e,s,this.animationValues);e.render();for(const r in s)e.setStaticValue(r,s[r]),this.animationValues&&(this.animationValues[r]=s[r]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const n=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=Ib(t?.pointerEvents)||"",void(e.transform=n?n(this.latestValues,""):"none");const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=Ib(t?.pointerEvents)||""),void(this.hasProjected&&!$v(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1));e.visibility="";const r=s.animationValues||s.latestValues;this.applyTransformsToTarget();let i=function(e,t,n){let s="";const r=e.x.translate/t.x,i=e.y.translate/t.y,a=n?.z||0;if((r||i||a)&&(s=`translate3d(${r}px, ${i}px, ${a}px) `),1===t.x&&1===t.y||(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:i,skewX:a,skewY:o}=n;e&&(s=`perspective(${e}px) ${s}`),t&&(s+=`rotate(${t}deg) `),r&&(s+=`rotateX(${r}deg) `),i&&(s+=`rotateY(${i}deg) `),a&&(s+=`skewX(${a}deg) `),o&&(s+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(s+=`scale(${o}, ${l})`),s||"none"}(this.projectionDeltaWithTransform,this.treeScale,r);n&&(i=n(r,i)),e.transform=i;const{x:a,y:o}=this.projectionDelta;e.transformOrigin=`${100*a.origin}% ${100*o.origin}% 0`,s.animationValues?e.opacity=s===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:e.opacity=s===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const l in Kx){if(void 0===r[l])continue;const{correct:t,applyTo:n,isCSSVariable:a}=Kx[l],o="none"===i?r[l]:t(r[l],s);if(n){const t=n.length;for(let s=0;s<t;s++)e[n[s]]=o}else a?this.options.visualElement.renderState.vars[l]=o:e[l]=o}this.options.layoutId&&(e.pointerEvents=s===this?Ib(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(yj),this.root.sharedNodes.clear()}}}function mj(e){e.updateLayout()}function pj(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=e.layout,{animationType:r}=e.options,i=t.source!==e.layout.source;"size"===r?iN(e=>{const s=i?t.measuredBox[e]:t.layoutBox[e],r=Zk(s);s.min=n[e].min,s.max=s.min+r}):Mj(r,t.layoutBox,n)&&iN(s=>{const r=i?t.measuredBox[s]:t.layoutBox[s],a=Zk(n[s]);r.max=r.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[s].max=e.relativeTarget[s].min+a)});const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};tN(a,n,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};i?tN(o,e.applyTransform(s,!0),t.measuredBox):tN(o,n,t.layoutBox);const l=!ej(a);let c=!1;if(!e.resumeFrom){const s=e.getClosestProjectingParent();if(s&&!s.resumeFrom){const{snapshot:r,layout:i}=s;if(r&&i){const a={x:{min:0,max:0},y:{min:0,max:0}};rN(a,t.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};rN(o,n,i.layoutBox),sj(a,o)||(c=!0),s.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=a,e.relativeParent=s)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function fj(e){ky.value&&oj.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function gj(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function vj(e){e.clearSnapshot()}function yj(e){e.clearMeasurements()}function xj(e){e.isLayoutDirty=!1}function bj(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function wj(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function kj(e){e.resolveTargetDelta()}function Nj(e){e.calcProjection()}function jj(e){e.resetSkewAndRotation()}function Cj(e){e.removeLeadSnapshot()}function Sj(e,t,n){e.translate=Ov(t.translate,0,n),e.scale=Ov(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function _j(e,t,n,s){e.min=Ov(t.min,n.min,s),e.max=Ov(t.max,n.max,s)}function Tj(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Ij={duration:.45,ease:[.4,0,.1,1]},Ej=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Aj=Ej("applewebkit/")&&!Ej("chrome/")?Math.round:xy;function Pj(e){e.min=Aj(e.min),e.max=Aj(e.max)}function Mj(e,t,n){return"position"===e||"preserve-aspect"===e&&(s=rj(t),r=rj(n),i=.2,!(Math.abs(s-r)<=i));var s,r,i}function Dj(e){return e!==e.root&&e.scroll?.wasRoot}const Oj=hj({attachResizeListener:(e,t)=>Yk(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Rj={current:void 0},Lj=hj({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Rj.current){const e=new Oj({});e.mount(window),e.setOptions({layoutScroll:!0}),Rj.current=e}return Rj.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),$j={pan:{Feature:class extends qk{constructor(){super(...arguments),this.removePointerDownListener=xy}onPointerDown(e){this.session=new lN(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:aN(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:NN(e),onStart:NN(t),onMove:n,onEnd:(e,t)=>{delete this.session,s&&jy.postRender(()=>s(e,t))}}}mount(){this.removePointerDownListener=Jk(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends qk{constructor(e){super(e),this.removeGroupControls=xy,this.removeListeners=xy,this.controls=new wN(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xy}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Lj,MeasureLayout:EN}};function Fj(e,t){const n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"===typeof e){let s=document;t&&(s=t.current);const r=n?.[e]??s.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}(e),s=new AbortController;return[n,{passive:!0,...t,signal:s.signal},()=>s.abort()]}function Uj(e){return!("touch"===e.pointerType||Qk())}function Vj(e,t,n){const{props:s}=e;e.animationState&&s.whileHover&&e.animationState.setActive("whileHover","Start"===n);const r=s["onHover"+n];r&&jy.postRender(()=>r(t,Xk(t)))}const Bj=(e,t)=>!!t&&(e===t||Bj(e,t.parentElement)),zj=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const qj=new WeakSet;function Wj(e){return t=>{"Enter"===t.key&&e(t)}}function Hj(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Gj(e){return Kk(e)&&!Qk()}function Qj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[s,r,i]=Fj(e,n),a=e=>{const s=e.currentTarget;if(!Gj(e))return;qj.add(s);const i=t(s,e),a=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),qj.has(s)&&qj.delete(s),Gj(e)&&"function"===typeof i&&i(e,{success:t})},o=e=>{a(e,s===window||s===document||n.useGlobalTarget||Bj(s,e.target))},l=e=>{a(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return s.forEach(e=>{var t;(n.useGlobalTarget?window:e).addEventListener("pointerdown",a,r),PN(t=e)&&"offsetHeight"in t&&(e.addEventListener("focus",e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const s=Wj(()=>{if(qj.has(n))return;Hj(n,"down");const e=Wj(()=>{Hj(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>Hj(n,"cancel"),t)});n.addEventListener("keydown",s,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),t)})(e,r)),function(e){return zj.has(e.tagName)||-1!==e.tabIndex}(e)||e.hasAttribute("tabindex")||(e.tabIndex=0))}),i}function Yj(e,t,n){const{props:s}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&s.whileTap&&e.animationState.setActive("whileTap","Start"===n);const r=s["onTap"+("End"===n?"":n)];r&&jy.postRender(()=>r(t,Xk(t)))}const Kj=new WeakMap,Xj=new WeakMap,Jj=e=>{const t=Kj.get(e.target);t&&t(e)},Zj=e=>{e.forEach(Jj)};function eC(e,t,n){const s=function(e){let{root:t,...n}=e;const s=t||document;Xj.has(s)||Xj.set(s,{});const r=Xj.get(s),i=JSON.stringify(n);return r[i]||(r[i]=new IntersectionObserver(Zj,{root:t,...n})),r[i]}(t);return Kj.set(e,n),s.observe(e),()=>{Kj.delete(e),s.unobserve(e)}}const tC={some:0,all:1};const nC={inView:{Feature:class extends qk{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:s="some",once:r}=e,i={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof s?s:tC[s]};return eC(this.node.current,i,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:s}=this.node.getProps(),i=t?n:s;i&&i(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends qk{mount(){const{current:e}=this.node;e&&(this.unmount=Qj(e,(e,t)=>(Yj(this.node,t,"Start"),(e,t)=>{let{success:n}=t;return Yj(this.node,e,n?"End":"Cancel")}),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends qk{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ew(Yk(this.node.current,"focus",()=>this.onFocus()),Yk(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends qk{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[s,r,i]=Fj(e,n),a=e=>{if(!Uj(e))return;const{target:n}=e,s=t(n,e);if("function"!==typeof s||!n)return;const i=e=>{Uj(e)&&(s(e),n.removeEventListener("pointerleave",i))};n.addEventListener("pointerleave",i,r)};return s.forEach(e=>{e.addEventListener("pointerenter",a,r)}),i}(e,(e,t)=>(Vj(this.node,t,"Start"),e=>Vj(this.node,e,"End"))))}unmount(){}}}},sC=qb({...Hk,...nC,...$j,...{layout:{ProjectionNode:Lj,MeasureLayout:EN}}},ub),rC=32,iC=e.memo(e=>{var t,n;let{movement:s,citySlots:r,allMovements:i=[]}=e;if(!s)return null;const a="returning"===s.status;let o=a?s.targetCoords:s.originCoords,l=a?s.originCoords:s.targetCoords;if((!o||!l)&&r){const e=a?s.targetSlotId||s.targetVillageId||s.targetRuinId||s.targetTownId:s.originCityId,t=a?s.originCityId:s.targetSlotId||s.targetVillageId||s.targetRuinId||s.targetTownId;o||(o=r[e]),l||(l=r[t])}if(!o||!l)return null;const c=(null===(t=s.departureTime)||void 0===t?void 0:t.toDate().getTime())||Date.now(),u=(null===(n=s.arrivalTime)||void 0===n?void 0:n.toDate().getTime())||Date.now(),d=Date.now();let h=0;h=d<c?0:d>u?1:(d-c)/(u-c);const m=o.x*rC+16,p=o.y*rC+16,f=l.x*rC+16,g=l.y*rC+16,v=m+(f-m)*h,y=p+(g-p)*h,x=Math.max(0,(u-d)/1e3),b=s.units?Object.values(s.units).reduce((e,t)=>e+t,0):0,w=Math.min(24,8+2*Math.sqrt(b)),k={attack:{color:"#ef4444",icon:"\u2694\ufe0f",lineColor:"#ef4444"},attack_village:{color:"#ef4444",icon:"\u2694\ufe0f",lineColor:"#ef4444"},attack_ruin:{color:"#ef4444",icon:"\u2694\ufe0f",lineColor:"#ef4444"},attack_god_town:{color:"#ef4444",icon:"\u2694\ufe0f",lineColor:"#ef4444"},reinforce:{color:"#3b82f6",icon:"\ud83d\udee1\ufe0f",lineColor:"#3b82f6"},scout:{color:"#10b981",icon:"\ud83d\udc41\ufe0f",lineColor:"#10b981"},trade:{color:"#f59e0b",icon:"\ud83d\udcb0",lineColor:"#f59e0b"},return:{color:"#a855f7",icon:"\u21a9\ufe0f",lineColor:"#a855f7"},default:{color:"#6b7280",icon:"\u27a1\ufe0f",lineColor:"#6b7280"}},N=k[a?"return":s.type]||k.default,j=Array.isArray(i)?i.filter(e=>!(!e||e.id===s.id)&&(e.originCityId===s.originCityId&&e.targetCityId===s.targetCityId||e.originCityId===s.targetCityId&&e.targetCityId===s.originCityId)):[],C=(()=>{if(0===j.length)return N.lineColor;const e=[N.lineColor];j.forEach(t=>{if(!t)return;const n=k[t.type]||k.default;e.push(n.lineColor)});const t=e.reduce((e,t)=>{if(!t)return e;const n=t.replace("#",""),s=parseInt(n.substring(0,2),16),r=parseInt(n.substring(2,4),16),i=parseInt(n.substring(4,6),16);return{r:e.r+s,g:e.g+r,b:e.b+i,count:e.count+1}},{r:0,g:0,b:0,count:0}),n=Math.round(t.r/t.count),s=Math.round(t.g/t.count),r=Math.round(t.b/t.count);return`#${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}`})(),S=3+1.5*j.length;return(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("div",{className:"absolute z-20",style:{left:m,top:p,width:Math.sqrt(Math.pow(f-m,2)+Math.pow(g-p,2)),height:S,backgroundColor:C,opacity:.7,transformOrigin:"0 0",transform:`rotate(${Math.atan2(g-p,f-m)}rad)`}}),(0,Lm.jsx)(sC.div,{className:"absolute z-30 flex items-center justify-center",style:{left:v-w/2,top:y-w/2,width:w,height:w,backgroundColor:`${N.color}80`,borderRadius:"50%",border:`2px solid ${N.color}`,fontSize:.6*w},animate:{x:[0,(f-m)*(1-h)],y:[0,(g-p)*(1-h)]},transition:{duration:x,ease:"linear"},whileHover:{scale:1.2},children:N.icon})]})}),aC=iC,oC={animations:!0,showVisuals:!0,showGrid:!0},lC=t=>{let{mapGrid:n,worldState:s,pan:r,zoom:i,viewportSize:a,onCitySlotClick:o,onVillageClick:l,onRuinClick:c,onGodTownClick:u,onWonderSpotClick:d,onConstructingWonderClick:h,isPlacingDummyCity:m,movements:p,combinedSlots:f,villages:g,ruins:v,godTowns:y,playerAlliance:x,conqueredVillages:b,gameSettings:w=oC,cityPoints:k,scoutedCities:N,controlledIslands:j}=t;const{playerCities:C}=up(),S=(0,e.useMemo)(()=>{const e={};return Object.values({...f,...g,...v,...y}).forEach(t=>{t&&t.id&&(e[t.id]=t)}),Object.values(C||{}).forEach(t=>{t&&t.id&&(e[t.id]=t)}),e},[f,g,v,y,C]);if(!n||null===s||void 0===s||!s.islands||0===a.width)return null;const _=32*i,T=Math.max(0,Math.floor(-r.x/_)),I=Math.min(s.width,Math.ceil((-r.x+a.width)/_)),E=Math.max(0,Math.floor(-r.y/_)),A=Math.min(s.height,Math.ceil((-r.y+a.height)/_)),P=[];for(let e=E;e<A;e++)for(let t=T;t<I;t++){const r=n[e][t];let i;switch(r.type){case"city_slot":const e=s.islands.find(e=>e.id===r.data.islandId);i=(0,Lm.jsx)(dv,{slotData:r.data,onClick:o,isPlacingDummyCity:m,playerAlliance:x,gameSettings:w,cityPoints:k,scoutedCities:N,islandCenterX:e?e.x:0});break;case"village":i=(0,Lm.jsx)(hv,{villageData:r.data,onClick:l,conqueredVillages:b,gameSettings:w});break;case"ruin":i=(0,Lm.jsx)(mv,{ruinData:r.data,onClick:c,gameSettings:w});break;case"god_town":i=(0,Lm.jsx)(pv,{townData:r.data,onClick:u,gameSettings:w});break;case"wonder_spot":i=(0,Lm.jsx)(fv,{spotData:r.data,onClick:d,playerAlliance:x,controlledIslands:j});break;case"constructing_wonder":i=(0,Lm.jsx)(gv,{wonderData:r.data,onClick:h});break;case"land":i=(0,Lm.jsx)(uv,{tileData:r.data,gameSettings:w});break;default:i=(0,Lm.jsx)(cv,{gameSettings:w})}P.push((0,Lm.jsx)("div",{className:"map-tile",style:{position:"absolute",left:32*t,top:32*e,width:32,height:32},children:i},`tile-${t}-${e}`))}return w.animations&&p.forEach(e=>{P.push((0,Lm.jsx)(aC,{movement:e,citySlots:S,allMovements:p},`movement-${e.id}`))}),(0,Lm.jsx)(Lm.Fragment,{children:P})},cC=e=>{let{actions:t,centerAction:n,position:s,onClose:r}=e;const i=2*Math.PI/t.length;return s?(0,Lm.jsx)("div",{className:"radial-menu-overlay",onClick:r,children:(0,Lm.jsxs)("div",{className:"radial-menu-container",style:{left:`${s.x}px`,top:`${s.y}px`},onClick:e=>e.stopPropagation(),children:[n&&(0,Lm.jsx)("button",{className:"radial-menu-item radial-menu-center-button",onClick:e=>{e.stopPropagation(),n.handler(),r()},title:n.label,children:(0,Lm.jsx)("span",{className:"radial-menu-icon-wrapper",children:(0,Lm.jsx)("span",{className:"radial-menu-icon",children:n.icon})})}),t.map((e,t)=>{const n=t*i-Math.PI/2,s=50*Math.cos(n),a=50*Math.sin(n);return(0,Lm.jsx)("button",{className:"radial-menu-item",style:{transform:`translate(${s}px, ${a}px)`},onClick:t=>{t.stopPropagation(),e.handler(),r()},title:e.label,children:(0,Lm.jsx)("span",{className:"radial-menu-icon-wrapper",children:(0,Lm.jsx)("span",{className:"radial-menu-icon",children:e.icon})})},t)})]})}):null},uC=JSON.parse('{"qol_research_0":{"name":"Advanced Cartography","description":"Your troops travel 5% faster on the world map.","effect":{"type":"speed_boost_all","value":0.05}},"qol_research_1":{"name":"Efficient Logistics","description":"Your transport ships can carry 10% more units.","effect":{"type":"transport_capacity_boost","value":0.1}},"qol_research_2":{"name":"Scouting Techniques","description":"Your scouts are 10% more effective.","effect":{"type":"scout_power_boost","value":0.1}}}'),dC=t=>{let{city:n,onClose:s,onGoTo:r,onAction:i,isVillageTarget:a}=t;const{currentUser:o}=Fm(),{setActiveCityId:l}=up(),c=(0,e.useMemo)(()=>!(!n||!n.reinforcements)&&Object.values(n.reinforcements).some(e=>e.ownerId===o.uid),[n,o.uid]);if(!n)return null;const u=n.ownerId===o.uid,d={wood:gf,stone:vf,silver:yf},h=n.isRuinTarget,m=h&&n.ownerId&&"ruins"!==n.ownerId,p=h?uC[n.researchReward]:null,f=h?"Ancient Ruins":a?`Farming Village: ${n.name||"Unnamed Village"} (Level ${n.level||"?"})`:`City: ${n.cityName||"Unnamed City"}`,g=`Owner: ${n.ownerUsername||"Unknown"}`;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"other-city-modal-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"other-city-modal-header",children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl",children:f}),(0,Lm.jsx)("button",{onClick:s,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"other-city-modal-content",children:[!m&&(0,Lm.jsx)("p",{className:"mb-2",children:g}),n.ownerFaction&&(0,Lm.jsxs)("p",{className:"mb-6",children:["Faction: ",n.ownerFaction]}),(a||h)&&(0,Lm.jsxs)("div",{className:"info-box",children:[a&&(0,Lm.jsxs)("div",{className:"flex justify-center items-center space-x-4",children:[(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("span",{className:"text-sm capitalize",children:"Demands"}),(0,Lm.jsx)("img",{src:d[n.demands],alt:n.demands,className:"w-10 h-10"})]}),(0,Lm.jsx)("span",{className:"text-3xl font-bold",children:"\u2192"}),(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("span",{className:"text-sm capitalize",children:"Supplies"}),(0,Lm.jsx)("img",{src:d[n.supplies],alt:n.supplies,className:"w-10 h-10"})]})]}),h&&!m&&p&&(0,Lm.jsxs)("div",{className:"text-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-yellow-700",children:"Potential Reward:"}),(0,Lm.jsx)("p",{className:"text-sm",children:p.name}),(0,Lm.jsxs)("p",{className:"text-xs italic",children:['"',p.description,'"']})]}),m&&(0,Lm.jsxs)("div",{className:"text-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-green-700",children:"Conquered by:"}),(0,Lm.jsx)("p",{className:"text-lg",children:n.ownerUsername}),n.isConqueredByYou&&p&&(0,Lm.jsxs)("div",{className:"mt-2 border-t border-gray-600 pt-2",children:[(0,Lm.jsx)("p",{className:"font-bold text-yellow-700",children:"Research Unlocked:"}),(0,Lm.jsx)("p",{className:"text-sm",children:p.name}),(0,Lm.jsxs)("p",{className:"text-xs italic",children:['"',p.description,'"']})]})]}),n.troops&&Object.keys(n.troops).length>0&&!m&&(0,Lm.jsx)("div",{className:"mt-4 border-t border-gray-600 pt-2",children:(0,Lm.jsx)(sg,{units:n.troops,unitsData:qm,title:h?"Guardians":"Village Troops"})})]}),!h&&(0,Lm.jsx)("div",{className:"info-box",children:(0,Lm.jsx)(sg,{units:n.units,reinforcements:n.reinforcements,title:"Garrison",cityOwnerId:n.ownerId})}),(0,Lm.jsx)("div",{className:"action-buttons-grid",children:a||h&&!m?(0,Lm.jsx)("button",{onClick:()=>i("attack",n),className:"action-btn attack-btn col-span-2",children:"Attack"}):h?null:(0,Lm.jsx)(Lm.Fragment,{children:u?(0,Lm.jsx)("button",{onClick:()=>{l(n.id),s()},className:"action-btn col-span-2",children:"Go to City"}):(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("button",{onClick:()=>i("attack",n),className:"action-btn attack-btn",children:"Attack"}),(0,Lm.jsx)("button",{onClick:()=>i("reinforce",n),className:"action-btn reinforce-btn",children:"Reinforce"}),c&&(0,Lm.jsx)("button",{onClick:()=>i("withdraw",n),className:"action-btn",children:"Withdraw Troops"}),(0,Lm.jsx)("button",{onClick:()=>i("scout",n),className:"action-btn",children:"Scout"}),(0,Lm.jsx)("button",{onClick:()=>i("trade",n),className:"action-btn",children:"Trade"}),(0,Lm.jsx)("button",{onClick:()=>i("castSpell",n),className:"action-btn spell-btn",children:"Cast Spell"}),(0,Lm.jsx)("button",{onClick:()=>i("profile",n),className:"action-btn",children:"Profile"}),(0,Lm.jsx)("button",{onClick:()=>{r&&r(n.x,n.y),s()},className:"action-btn",children:"Go To"})]})})})]})]})})},hC=(e,t,n,s,r,i,a,o,l)=>{const c=Object.entries(e||{}).some(e=>{var t,s;let[r,i]=e;return i>0&&(null===(t=qm[r])||void 0===t?void 0:t.type)===n&&(null===(s=qm[r])||void 0===s?void 0:s.attack)>0}),u=Object.entries(t||{}).some(e=>{var t;let[s,r]=e;return r>0&&(null===(t=qm[s])||void 0===t?void 0:t.type)===n});if(!u)return{attackerWon:!0,attackerLosses:{},defenderLosses:{}};if(!c&&!o)return{attackerWon:!1,attackerLosses:{},defenderLosses:{}};let d={...e},h={...t};const m=(e,t,s,r,i,a)=>{let o=0,l=0,c=0,u=0;const d=a?Hm[a]:null;for(const h in e){const a=e[h]||0;if(0===a)continue;const m=qm[h];if(!m||m.type!==n)continue;let p=m.attack,f=m.defense;d&&"land_attack"===d.passive.effect.subtype&&"land"===m.type&&(p*=1+d.passive.effect.value);for(const e in t){if((t[e]||0)>0){const t=qm[e];m.counters&&t&&m.counters.includes(e)&&(p*=1.2),t&&t.counters&&t.counters.includes(h)&&(f*=.8)}}const g=a*(s?p:f);h===r?l+=g:h===i?c+=g:u+=g,o+=g}return{totalPower:o,phalanxPower:l,supportPower:c,otherPower:u}},p=m(d,h,!0,s,r,o),f=m(h,d,!1,i,a,l);let g=p.phalanxPower+.5*p.supportPower+.2*p.otherPower,v=f.phalanxPower+.5*f.supportPower+.2*f.otherPower;const y=Math.min(1,v/(g||1)),x=Math.min(1,g/(v||1)),b=(e,t,s,r)=>{const i=Object.values(e).reduce((e,t)=>e+t,0);if(0===i)return{};const a={};let o=Math.floor(i*t);if(s&&e[s]&&o>0){const t=Math.min(e[s],Math.ceil(.6*o));a[s]=t,o-=t}if(r&&e[r]&&o>0){const t=Math.min(e[r],Math.ceil(.3*o));a[r]=(a[r]||0)+t,o-=t}const l=Object.keys(e).filter(e=>{var t;return e!==s&&e!==r&&(null===(t=qm[e])||void 0===t?void 0:t.type)===n});if(o>0&&l.length>0){let t=l.reduce((t,n)=>t+(e[n]||0)-(a[n]||0),0);0===t&&(t=1);for(const n of l)if(o>0){const s=(e[n]||0)-(a[n]||0),r=Math.floor(o*(s/t)),i=Math.min(s,r);a[n]=(a[n]||0)+i,o-=i}if(o>0){const t=l.reduce((t,n)=>(e[n]||0)-(a[n]||0)>(e[t]||0)-(a[t]||0)?n:t,l[0]);t&&(a[t]=(a[t]||0)+o)}}for(const n in a)a[n]>(e[n]||0)&&(a[n]=e[n]||0);return a},w=b(d,y,s,r),k=b(h,x,i,a);for(const N in w)d[N]=Math.max(0,(d[N]||0)-w[N]);for(const N in k)h[N]=Math.max(0,(h[N]||0)-k[N]);return{attackerWon:m(d,h,!0,null,null,o).totalPower>=m(h,d,!1,null,null,l).totalPower,attackerLosses:w,defenderLosses:k}};function mC(e){if(e.troops&&Object.keys(e.troops).length>0)return e.troops;let t={};switch(e.level||1){case 1:default:t={swordsman:15,archer:10};break;case 2:t={swordsman:25,archer:15,slinger:5};break;case 3:t={swordsman:40,archer:25,slinger:10,hoplite:5};break;case 4:t={swordsman:60,archer:40,slinger:20,hoplite:15,cavalry:5};break;case 5:t={swordsman:100,archer:75,slinger:50,hoplite:40,cavalry:20}}return t}function pC(e,t,n,s,r,i,a,o,l,c){let u={},d={},h=!1,m={wood:0,stone:0,silver:0},p={},f=null;const g=n||{};if(s){const n=hC(e,t,"naval",null,null,null,null);if(u={...n.attackerLosses},d={...n.defenderLosses},n.attackerWon){const n={...e};for(const e in u)n[e]=Math.max(0,(n[e]||0)-u[e]);const s=hC(n,t,"land",r,i,a,o,l,c);for(const e in s.attackerLosses)u[e]=(u[e]||0)+s.attackerLosses[e];for(const e in s.defenderLosses)d[e]=(d[e]||0)+s.defenderLosses[e];h=s.attackerWon,s.attackerWon&&(m.wood=Math.floor(.25*(g.wood||0)),m.stone=Math.floor(.25*(g.stone||0)),m.silver=Math.floor(.25*(g.silver||0)))}else for(const t in e)"land"===qm[t].type&&(u[t]=(u[t]||0)+e[t])}else{const n=hC(e,t,"land",r,i,a,o,l,c);u=n.attackerLosses,d=n.defenderLosses,h=n.attackerWon,n.attackerWon&&(m.wood=Math.floor(.25*(g.wood||0)),m.stone=Math.floor(.25*(g.stone||0)),m.silver=Math.floor(.25*(g.silver||0)))}const v=Object.entries(e).filter(e=>{var t;let[n]=e;return"land"===(null===(t=qm[n])||void 0===t?void 0:t.type)}).every(e=>{let[t,n]=e;return(u[t]||0)>=n}),y=Object.entries(t).filter(e=>{var t;let[n]=e;return"land"===(null===(t=qm[n])||void 0===t?void 0:t.type)}).every(e=>{let[t,n]=e;return(d[t]||0)>=n});h&&c&&y?f={heroId:c,capturedBy:"attacker"}:!h&&l&&v&&(f={heroId:l,capturedBy:"defender"});for(const k in u){var x;const e=u[k];if("land"===(null===(x=qm[k])||void 0===x?void 0:x.type)){const t=Math.floor(.15*e);t>0&&(p[k]=t,u[k]=e-t)}}const b=Object.entries(d).reduce((e,t)=>{var n;let[s,r]=t;return e+((null===(n=qm[s])||void 0===n?void 0:n.cost.population)||0)*r},0),w=Object.entries(u).reduce((e,t)=>{var n;let[s,r]=t;return e+((null===(n=qm[s])||void 0===n?void 0:n.cost.population)||0)*r},0);return{attackerWon:h,attackerLosses:u,defenderLosses:d,plunder:m,wounded:p,attackerBattlePoints:b,defenderBattlePoints:w,capturedHero:f}}var fC=n(1230);const gC=[{name:"5 minutes",duration:300,multiplier:.125,happinessCost:0},{name:"40 minutes",duration:2400,multiplier:1,happinessCost:2},{name:"2 hours",duration:7200,multiplier:3,happinessCost:5},{name:"4 hours",duration:14400,multiplier:4,happinessCost:10}],vC=t=>{var n,s;let{village:r,onClose:i,worldId:a,marketCapacity:o}=t;const{currentUser:l,userProfile:c}=Fm(),{gameState:u,setGameState:d,countCitiesOnIsland:h,activeCityId:m}=up(),[p,f]=(0,e.useState)(r),[g,v]=(0,e.useState)(r),[y,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(""),[k,N]=(0,e.useState)(1/0),[j,C]=(0,e.useState)("demand"),[S,_]=(0,e.useState)(0),[T,I]=(0,e.useState)(0),E={wood:gf,stone:vf,silver:yf};(0,e.useEffect)(()=>{if(!a||null===p||void 0===p||!p.id||!l)return;const e=pm(eh(Om,"users",l.uid,"games",a,"conqueredVillages",p.id),e=>{e.exists()?f(t=>({...t,...e.data()})):i()}),t=pm(eh(Om,"worlds",a,"villages",p.id),e=>{e.exists()&&v(e.data())});return()=>{e(),t()}},[a,p.id,l,i]),(0,e.useEffect)(()=>{if(!a||null===p||void 0===p||!p.id||!g)return;const e=setInterval(async()=>{const e=eh(Om,"worlds",a,"villages",p.id);try{await wm(Om,async t=>{var n;const s=await t.get(e);if(!s.exists())return;const r=s.data(),i=(null===(n=r.lastUpdated)||void 0===n?void 0:n.toDate())||new Date,a=((new Date).getTime()-i.getTime())/36e5;if(a>0){const n={...r.resources||{}},s=A(r.level),i=P(r.level);Object.keys(s).forEach(e=>{n[e]=Math.min(i[e],(n[e]||0)+s[e]*a)}),t.update(e,{resources:n,lastUpdated:km()})}})}catch(t){console.error("Error updating village resources:",t)}},3e5);return()=>clearInterval(e)},[a,p.id,g]),(0,e.useEffect)(()=>{const e=setInterval(async()=>{if(!a||null===p||void 0===p||!p.id||!l)return;const e=eh(Om,"users",l.uid,"games",a,"conqueredVillages",p.id);try{await wm(Om,async t=>{var n;const s=await t.get(e);if(!s.exists())return;const r=s.data();if(r.happiness>=100)return;const i=(null===(n=r.happinessLastUpdated)||void 0===n?void 0:n.toDate())||new Date,a=((new Date).getTime()-i.getTime())/6e4*(2/60);if(a>0){const n=Math.min(100,(r.happiness||0)+a);n>r.happiness&&t.update(e,{happiness:n,happinessLastUpdated:km()})}})}catch(t){console.error("Error regenerating village happiness:",t)}},6e4);return()=>clearInterval(e)},[a,null===p||void 0===p?void 0:p.id,l]);const A=e=>({wood:100*e,stone:100*e,silver:Math.floor(50*e)}),P=e=>({wood:1e3+500*(e-1),stone:1e3+500*(e-1),silver:1e3+500*(e-1)});(0,e.useEffect)(()=>{if(p&&p.lastCollected){const e=()=>{const e=p.lastCollected.toDate().getTime();N(Math.floor((Date.now()-e)/1e3))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}},[p]),(0,e.useEffect)(()=>{if(p&&p.lastPlundered){const e=()=>{const e=p.lastPlundered.toDate().getTime()+12e5,t=Math.max(0,e-Date.now());I(t/1e3)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}I(0)},[p]);const M=e=>({wood:Math.floor(200*Math.pow(1.6,e-1)),stone:Math.floor(200*Math.pow(1.6,e-1)),silver:Math.floor(100*Math.pow(1.8,e-1))}),D=(0,e.useMemo)(()=>{const e=h(p.islandId)>1?1.2:1;return gC.map(t=>{var n,s,r;return{...t,yield:{wood:g?Math.floor(((null===(n=g.demandYield)||void 0===n?void 0:n.wood)||0)*t.multiplier*p.level*e):0,stone:g?Math.floor(((null===(s=g.demandYield)||void 0===s?void 0:s.stone)||0)*t.multiplier*p.level*e):0,silver:g?Math.floor(((null===(r=g.demandYield)||void 0===r?void 0:r.silver)||0)*t.multiplier*p.level*e):0}}})},[p.level,p.islandId,g,h]),O=M(p.level+1),R=u&&u.resources.wood>=O.wood&&u.resources.stone>=O.stone&&u.resources.silver>=O.silver,L=g&&u?Math.min(u.resources[g.demands]||0,Math.floor(((null===(n=g.resources)||void 0===n?void 0:n[g.supplies])||0)*(g.tradeRatio||1)),o||0):0,$=p.lastPlundered?new Date(p.lastPlundered.toDate().getTime()+12e5):null;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",onClick:i,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl text-center border border-gray-600 pointer-events-auto",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-yellow-400",children:`Farming Village: ${(null===g||void 0===g?void 0:g.name)||p.name} (Level ${p.level})`}),(0,Lm.jsxs)("h3",{className:"text-xl font-semibold text-white",children:["Happiness: ",(0,Lm.jsxs)("span",{className:"text-green-400",children:[Math.floor(void 0!==p.happiness?p.happiness:100),"%"]})]})]}),(0,Lm.jsxs)("div",{className:"flex border-b border-gray-600 my-4",children:[(0,Lm.jsx)("button",{onClick:()=>C("demand"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("demand"===j?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Demand"}),(0,Lm.jsx)("button",{onClick:()=>C("plunder"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("plunder"===j?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Plunder"}),(0,Lm.jsx)("button",{onClick:()=>C("trade"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("trade"===j?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Trade"}),(0,Lm.jsx)("button",{onClick:()=>C("upgrade"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("upgrade"===j?"bg-gray-700 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:"Upgrade"})]}),(0,Lm.jsxs)("div",{className:"p-4 text-white",children:["demand"===j&&(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg text-center mb-2",children:"Demand Resources"}),(0,Lm.jsx)("p",{className:"text-center text-gray-400 text-sm mb-4",children:"Choose an option to demand resources. Shorter times yield fewer resources."}),(0,Lm.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:D.map(e=>{const t=k>=e.duration;return(0,Lm.jsxs)("div",{className:"bg-gray-900 border border-gray-700 p-2 rounded-lg text-center flex flex-col justify-between shadow-md",children:[(0,Lm.jsx)("div",{className:"relative h-16 mb-2 flex justify-center items-center",children:(0,Lm.jsx)("img",{src:fC,alt:"resources",className:"w-16 h-16"})}),(0,Lm.jsxs)("div",{className:"text-xs space-y-1 mb-2 text-left",children:[(0,Lm.jsxs)("p",{className:"flex justify-between px-1",children:[(0,Lm.jsx)("span",{children:"Wood:"})," ",(0,Lm.jsx)("span",{className:"font-bold text-yellow-300",children:e.yield.wood})]}),(0,Lm.jsxs)("p",{className:"flex justify-between px-1",children:[(0,Lm.jsx)("span",{children:"Stone:"})," ",(0,Lm.jsx)("span",{className:"font-bold text-gray-300",children:e.yield.stone})]}),(0,Lm.jsxs)("p",{className:"flex justify-between px-1",children:[(0,Lm.jsx)("span",{children:"Silver:"})," ",(0,Lm.jsx)("span",{className:"font-bold text-blue-300",children:e.yield.silver})]})]}),(0,Lm.jsx)("div",{className:"mt-auto",children:t?(0,Lm.jsxs)("button",{onClick:()=>(async e=>{if(y||!g)return;x(!0),w("");const t=eh(Om,"users",l.uid,"games",a,"conqueredVillages",p.id),n=eh(Om,"users",l.uid,"games",a,"cities",m),s=h(p.islandId)>1,r=s?1.2:1;try{const i=await wm(Om,async s=>{var i;const a=await s.get(t),o=await s.get(n);if(!a.exists()||!o.exists())throw new Error("Your village or active city state not found.");const l=a.data(),c=o.data();if(Date.now()<((null===(i=l.lastCollected)||void 0===i?void 0:i.toDate().getTime())||0)+1e3*e.duration)throw new Error("Not enough time has passed for this demand option.");const u={...c.resources},d=Math.floor(1500*Math.pow(1.4,c.buildings.warehouse.level-1)),h={wood:Math.floor((g.demandYield.wood||0)*e.multiplier*l.level*r),stone:Math.floor((g.demandYield.stone||0)*e.multiplier*l.level*r),silver:Math.floor((g.demandYield.silver||0)*e.multiplier*l.level*r)};for(const[e,t]of Object.entries(h))u[e]=Math.min(d,(u[e]||0)+t);const m=e.happinessCost||0,p=Math.max(0,(l.happiness||100)-m);return s.update(n,{resources:u}),s.update(t,{lastCollected:km(),happiness:p,happinessLastUpdated:km()}),{...c,resources:u}});d(i);let a="Successfully demanded resources! Village happiness decreased.";s&&(a+=" (+20% bonus for multiple cities on this island!)"),w(a)}catch(i){w(`Failed to demand resources: ${i.message}`)}finally{x(!1)}})(e),disabled:y,className:"btn btn-confirm w-full text-sm py-1",children:["Demand (",e.name,")"]}):(0,Lm.jsx)("div",{className:"text-center text-sm py-1 px-2 bg-gray-800 rounded",children:(0,Lm.jsx)("div",{className:"font-mono text-red-400",children:(0,Lm.jsx)(Bf,{arrivalTime:{toDate:()=>new Date(p.lastCollected.toDate().getTime()+1e3*e.duration)}})})})})]},e.name)})})]}),"plunder"===j&&(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg text-center mb-2 text-red-400",children:"Plunder Village"}),(0,Lm.jsx)("p",{className:"text-center text-gray-400 text-sm mb-4",children:"Forcefully take resources from the village. This action is much faster and yields more than demanding, but it will significantly lower happiness and risks a revolt."}),(0,Lm.jsxs)("div",{className:"bg-gray-900 p-4 rounded-lg",children:[(0,Lm.jsxs)("p",{className:"mb-2",children:["Current Happiness: ",(0,Lm.jsxs)("span",{className:"font-bold text-green-400",children:[Math.floor(void 0!==p.happiness?p.happiness:100),"%"]})]}),(0,Lm.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Plundering a village with 40% or less happiness will cause it to revolt, and you will lose control of it."}),(0,Lm.jsx)("button",{onClick:async()=>{if(y)return;if(T>0)return void w("You must wait before plundering again.");x(!0),w("");const e=eh(Om,"users",l.uid,"games",a,"conqueredVillages",p.id),t=eh(Om,"users",l.uid,"games",a,"cities",m),n=eh(Om,"worlds",a,"villages",p.id),s=Jd(Om,"users",l.uid,"worlds",a,"reports");try{const r=await wm(Om,async r=>{const i=await r.get(e),a=await r.get(t),o=await r.get(n);if(!i.exists()||!a.exists()||!o.exists())throw new Error("Required data not found.");const u=i.data(),d=a.data(),h=o.data(),p=void 0!==u.happiness?u.happiness:100,f={wood:Math.floor(.5*(h.resources.wood||0)),stone:Math.floor(.5*(h.resources.stone||0)),silver:Math.floor(.5*(h.resources.silver||0))},g={...d.resources},v={...h.resources},y=Math.floor(1500*Math.pow(1.4,d.buildings.warehouse.level-1));for(const e in f)g[e]=Math.min(y,g[e]+f[e]),v[e]-=f[e];if(r.update(t,{resources:g}),r.update(n,{resources:v}),p<=40){const n=function(e){const t={};if(!e)return t;const n=Object.entries(e).reduce((e,t)=>{var n;let[s,r]=t;return e+((null===(n=qm[s])||void 0===n?void 0:n.cost.population)||0)*r},0);if(0===n)return t;let s=.05*n;for(const i in e){var r;if("land"===(null===(r=qm[i])||void 0===r?void 0:r.type)){const r=qm[i].cost.population;if(r>0){const a=r*e[i]/n,o=Math.round(s/r*a);t[i]=Math.min(e[i],o)}}}return t}(d.units),i={...d.units};for(const e in n)i[e]-=n[e];r.update(t,{units:i}),r.delete(e);const a={type:"attack_village",title:`Revolt at ${h.name}!`,timestamp:km(),outcome:{attackerWon:!1,message:"Your plunder attempt on a low-happiness village caused a revolt! You have lost control and suffered casualties, but secured the resources.",plunder:f},attacker:{cityId:m,cityName:d.cityName,ownerId:l.uid,username:c.username,x:d.x,y:d.y,units:{},losses:n},defender:{villageName:h.name,x:h.x,y:h.y},read:!1};return r.set(eh(s),a),{...d,units:i,resources:g}}{const t=Math.max(0,p-40);r.update(e,{happiness:t,happinessLastUpdated:km(),lastPlundered:km()});const n={type:"attack_village",title:`Plunder of ${h.name} successful!`,timestamp:km(),outcome:{attackerWon:!0,plunder:f},attacker:{cityId:m,cityName:d.cityName,ownerId:l.uid,username:c.username,x:d.x,y:d.y},defender:{villageName:h.name,x:h.x,y:h.y},read:!1};return r.set(eh(s),n),{...d,resources:g}}});d(r),w("Plunder successful! Resources have been seized.")}catch(r){w(`Plunder failed: ${r.message}`)}finally{x(!1)}},disabled:y||T>0,className:"btn btn-danger w-full text-lg py-2",children:y?"Plundering...":T>0?(0,Lm.jsx)(Bf,{arrivalTime:$}):"Launch Plunder Raid (-40 Happiness)"})]})]}),"trade"===j&&(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg text-center mb-2",children:"Trade with Village"}),g?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"flex justify-center items-center space-x-4 my-4",children:[(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("span",{className:"text-sm text-gray-400 capitalize",children:"You Give"}),(0,Lm.jsx)("img",{src:E[g.demands],alt:g.demands,className:"w-12 h-12"})]}),(0,Lm.jsx)("span",{className:"text-3xl text-gray-400 font-bold",children:"\u2192"}),(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("span",{className:"text-sm text-gray-400 capitalize",children:"You Receive"}),(0,Lm.jsx)("img",{src:E[g.supplies],alt:g.supplies,className:"w-12 h-12"})]})]}),(0,Lm.jsxs)("p",{className:"text-center text-gray-400 text-sm mb-4",children:["Trade Ratio: ",g.tradeRatio,":1 | Your Market Capacity: ",o,(0,Lm.jsx)("span",{className:"block mt-2 text-xs text-red-400 italic",children:"(Trade amount is also limited by the village's current supplies)"})]}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,Lm.jsxs)("span",{className:"capitalize",children:["Your ",g.demands,": ",Math.floor(u.resources[g.demands]||0)]}),(0,Lm.jsxs)("span",{className:"capitalize",children:["Village's ",g.supplies,": ",Math.floor((null===(s=g.resources)||void 0===s?void 0:s[g.supplies])||0)]})]}),(0,Lm.jsx)("input",{type:"range",min:"0",max:L||0,value:S,onChange:e=>_(Number(e.target.value)),className:"w-full"}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,Lm.jsxs)("span",{className:"capitalize",children:["You give: ",(0,Lm.jsxs)("span",{className:"font-bold text-red-400",children:[S," ",g.demands]})]}),(0,Lm.jsxs)("span",{className:"capitalize",children:["You receive: ",(0,Lm.jsxs)("span",{className:"font-bold text-green-400",children:[Math.floor(S/(g.tradeRatio||1))," ",g.supplies]})]})]}),(0,Lm.jsx)("button",{onClick:async()=>{if(y||!g||S<=0)return;if(S>o)return void w(`Trade amount cannot exceed your market capacity of ${o}.`);x(!0),w("");const e=eh(Om,"users",l.uid,"games",a,"cities",m),t=eh(Om,"worlds",a,"villages",p.id);try{const n=await wm(Om,async n=>{const s=await n.get(e),r=await n.get(t);if(!s.exists()||!r.exists())throw new Error("Game state or village data not found.");const i=s.data(),a=r.data(),o=a.demands,l=a.supplies,c=Math.floor(S/a.tradeRatio);if(i.resources[o]<S)throw new Error(`Not enough ${o} to trade.`);if(a.resources[l]<c)throw new Error(`The village does not have enough ${l} to trade.`);const u={...i.resources};u[o]-=S,u[l]+=c;const d={...a.resources};return d[o]+=S,d[l]-=c,n.update(e,{resources:u}),n.update(t,{resources:d}),{...i,resources:u}});d(n),w(`Successfully traded ${S} ${g.demands} for ${Math.floor(S/g.tradeRatio)} ${g.supplies}.`),_(0)}catch(n){w(`Trade failed: ${n.message}`)}finally{x(!1)}},disabled:y||S<=0||L<=0,className:"btn btn-confirm w-full mt-4 py-2",children:"Trade"})]})]}):(0,Lm.jsx)("p",{className:"text-center text-gray-400 p-8",children:"Loading trade information..."})]}),"upgrade"===j&&(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"mb-4 text-center",children:"Invest resources to upgrade this village for better yields."}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg mb-4",children:[(0,Lm.jsxs)("h4",{className:"font-bold text-lg",children:["Cost to Upgrade to Level ",p.level+1,":"]}),(0,Lm.jsxs)("div",{className:"flex justify-center items-center space-x-4 mt-2 text-yellow-300",children:[(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("img",{src:gf,alt:"Wood",className:"w-6 h-6"}),(0,Lm.jsx)("span",{children:O.wood})]}),(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("img",{src:vf,alt:"Stone",className:"w-6 h-6"}),(0,Lm.jsx)("span",{children:O.stone})]}),(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("img",{src:yf,alt:"Silver",className:"w-6 h-6"}),(0,Lm.jsx)("span",{children:O.silver})]})]})]}),(0,Lm.jsx)("button",{onClick:async()=>{if(y)return;x(!0),w("");const e=eh(Om,"users",l.uid,"games",a,"conqueredVillages",p.id),t=eh(Om,"users",l.uid,"games",a,"cities",m),n=p.level+1,s=M(n);try{const r=await wm(Om,async r=>{const i=await r.get(e),a=await r.get(t);if(!i.exists()||!a.exists())throw new Error("Your village or city state could not be found.");const o=a.data();if(o.resources.wood<s.wood||o.resources.stone<s.stone||o.resources.silver<s.silver)throw new Error("Not enough resources in your city to upgrade the village.");const l={wood:o.resources.wood-s.wood,stone:o.resources.stone-s.stone,silver:o.resources.silver-s.silver};return r.update(t,{resources:l}),r.update(e,{level:n}),{...o,resources:l}});d(r),w(`Successfully upgraded village to level ${n}!`)}catch(r){console.error("Error upgrading village: ",r),w(`Failed to upgrade village: ${r.message}`)}finally{x(!1)}},disabled:y||!R,className:"btn btn-primary py-3 px-4 w-40",children:y?"Processing...":"Upgrade Village"})]}),b&&(0,Lm.jsx)("p",{className:"text-green-400 mt-4 text-center",children:b})]}),(0,Lm.jsx)("button",{onClick:i,className:"btn btn-primary px-6 py-2 mt-4",children:"Close"})]})})},yC=e=>{let{selectedResources:t,currentResources:n,handleResourceChange:s}=e;const r={wood:gf,stone:vf,silver:yf};return(0,Lm.jsxs)("div",{className:"unit-selection-section space-y-2",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg text-yellow-700 mb-2",children:"Select Resources"}),(0,Lm.jsx)("div",{className:"flex justify-around items-end w-full",children:Object.keys(t).map(e=>(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("img",{src:r[e],alt:e,className:"w-12 h-12 mb-1 bg-black/10 rounded"}),(0,Lm.jsx)("input",{type:"number",value:t[e]||0,onChange:t=>s(e,t.target.value),className:"bg-white/50 border border-yellow-800/50 p-1 rounded text-gray-800 text-center w-20 hide-number-spinners",min:"0",max:n[e]})]},e))})]})},xC=e=>{var t;let{selectedResources:n,gameState:s,handleResourceChange:r}=e;const i=(null===(t=s.cave)||void 0===t?void 0:t.silver)||0;return(0,Lm.jsxs)("div",{className:"unit-selection-section space-y-2",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg text-yellow-700 mb-2",children:"Silver for Espionage"}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsxs)("span",{className:"capitalize",children:["Silver in Cave (",Math.floor(i),")"]}),(0,Lm.jsx)("input",{type:"number",value:n.silver||0,onChange:e=>r("silver",e.target.value),className:"bg-white/50 border border-yellow-800/50 p-1 rounded text-gray-800 w-32"})]})]})},bC={};[n(3542),n(634),n(4731)].forEach(e=>{e.keys().forEach(t=>{const n=t.replace("./","");bC[n]=e(t)})});const wC=t=>{let{weather:n,windSpeed:s}=t;const[r,i]=(0,e.useState)("");return(0,e.useEffect)(()=>{let e="";switch(n){case"Clear":e="0-3 knots";break;case"Windy":e="3-6 knots";break;case"Rainy":e="6-9 knots";break;case"Stormy":e="9-10 knots";break;default:e="N/A"}i(e)},[n]),(0,Lm.jsx)("div",{className:"text-gray-500 text-sm mt-2 flex items-center justify-center",title:`${n} | Wind: ${s.toFixed(2)} knots (${r})`,children:(0,Lm.jsxs)("span",{children:[{Clear:"\u2600\ufe0f",Rainy:"\ud83c\udf27\ufe0f",Windy:"\ud83d\udca8",Foggy:"\ud83c\udf2b\ufe0f",Stormy:"\u26c8\ufe0f"}[n]," ",n," | Wind: ",r]})})},kC=t=>{let{mode:n,targetCity:s,playerCity:r,playerUnits:i,playerResources:a,travelTimeInfo:o,onSend:l,onClose:c,setMessage:u}=t;const{gameState:d,worldState:h}=up(),[m,p]=(0,e.useState)(0),f=i||(null===d||void 0===d?void 0:d.units)||{},g=a||(null===d||void 0===d?void 0:d.resources)||{},v=(null===d||void 0===d?void 0:d.heroes)||{},[y,x]=(0,e.useState)({}),[b,w]=(0,e.useState)(null),[k,N]=(0,e.useState)({wood:0,stone:0,silver:0}),[j,C]=(0,e.useState)({front:"",mid:"",back:""});(0,e.useEffect)(()=>{if(null!==h&&void 0!==h&&h.weather){let e=0,t=0;switch(h.weather){case"Clear":e=0,t=3;break;case"Windy":e=3,t=6;break;case"Rainy":e=6,t=9;break;case"Stormy":e=9,t=10}p(Math.random()*(t-e)+e)}},[null===h||void 0===h?void 0:h.weather]);const S=(0,e.useMemo)(()=>{let e=0;for(const s in y){var t,n;"naval"===(null===(t=qm[s])||void 0===t?void 0:t.type)&&null!==(n=qm[s])&&void 0!==n&&n.capacity&&(e+=y[s]*qm[s].capacity)}return e},[y]),_=(0,e.useMemo)(()=>{let e=0;for(const r in y){var t,n,s;"land"===(null===(t=qm[r])||void 0===t?void 0:t.type)&&null!==(n=qm[r])&&void 0!==n&&null!==(s=n.cost)&&void 0!==s&&s.population&&(e+=y[r]*qm[r].cost.population)}return e},[y]);(0,e.useEffect)(()=>{const e={...j};let t=!1;for(const n in e){const s=e[n];!s||y[s]&&0!==y[s]||(e[n]="",t=!0)}t&&C(e)},[y,j]);const T=(e,t)=>{const n=Math.max(0,Math.min(f[e]||0,parseInt(t,10)||0));x(t=>({...t,[e]:n}))},I=(e,t)=>{const n=y[e]||0;T(e,n===t?0:t)},E=(e,t)=>{const s=parseInt(t,10)||0;let r=s;if("scout"===n&&"silver"===e){var i;const e=(null===(i=d.cave)||void 0===i?void 0:i.silver)||0;r=Math.max(0,Math.min(e,s))}else r=Math.max(0,Math.min(g[e]||0,s));N(t=>({...t,[e]:r}))},A=(0,e.useMemo)(()=>{if("trade"===n||"scout"===n)return 10;const e=Object.entries(y).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t]=e;return qm[t].speed});return e.length>0?Math.min(...e):null},[y,n]),P=(0,e.useMemo)(()=>{if(null===o||void 0===o||!o.distance||!A)return"N/A";const e=Object.keys(y).some(e=>{var t;return"land"===(null===(t=qm[e])||void 0===t?void 0:t.type)&&y[e]>0}),t=Object.keys(y).some(e=>{var t;return"naval"===(null===(t=qm[e])||void 0===t?void 0:t.type)&&y[e]>0}),s=[];e&&s.push("land"),t&&s.push("naval");return function(e){if(e===1/0)return"N/A";if(isNaN(e))return"Invalid Time";const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60),r=e=>e.toString().padStart(2,"0");return`${r(t)}:${r(n)}:${r(s)}`}(Tg(o.distance,A,n,h,s,m))},[A,null===o||void 0===o?void 0:o.distance,n,h,y,m]);return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:c,children:(0,Lm.jsxs)("div",{className:"movement-modal-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("h3",{className:"movement-modal-header capitalize",children:[n," ",s?s.cityName||s.name:""]}),(0,Lm.jsx)("div",{className:"movement-modal-content",children:(()=>{var e;const t=null===d||void 0===d||null===(e=d.playerInfo)||void 0===e?void 0:e.nation,s=t?$p(t):[],r=Object.keys(qm).filter(e=>{const t=qm[e];return t.mythical&&t.god===d.god}),i=[...new Set([...s,...r])].map(e=>({id:e,...qm[e],currentCount:f[e]||0})),a=(t?Fp(t):[]).map(e=>({id:e,...qm[e],currentCount:f[e]||0})),o=Object.keys(v).filter(e=>v[e].active&&(v[e].cityId===d.id||!v[e].cityId)),l=Object.keys(y).filter(e=>{var t;return y[e]>0&&"land"===(null===(t=qm[e])||void 0===t?void 0:t.type)}),c=[{name:"front",label:"Front Line"},{name:"mid",label:"Mid Line"},{name:"back",label:"Back Line"}],u=S>0?_/S*100:0,h=u>100?"bg-red-500":"bg-green-500";return"attack"===n||"reinforce"===n?(0,Lm.jsxs)("div",{className:"space-y-4",children:[o.length>0&&(0,Lm.jsxs)("div",{className:"unit-selection-section",children:[(0,Lm.jsx)("h4",{className:"unit-selection-header",children:"Heroes"}),(0,Lm.jsx)("div",{className:"unit-grid",children:o.map(e=>{const t=Hm[e];return(0,Lm.jsx)("div",{className:"unit-item",children:(0,Lm.jsx)("div",{className:"unit-image-container "+(b===e?"border-2 border-yellow-400":""),title:t.name,onClick:()=>w(t=>t===e?null:e),children:(0,Lm.jsx)("img",{src:bC[t.image],alt:t.name,className:"unit-image"})})},e)})})]}),i.length>0&&(0,Lm.jsxs)("div",{className:"unit-selection-section",children:[(0,Lm.jsx)("h4",{className:"unit-selection-header",children:"Land Units"}),(0,Lm.jsx)("div",{className:"unit-grid",children:i.map(e=>(0,Lm.jsxs)("div",{className:"unit-item",children:[(0,Lm.jsxs)("div",{className:"unit-image-container",title:`Select all/none of ${e.name}`,onClick:()=>I(e.id,e.currentCount),children:[(0,Lm.jsx)("img",{src:bC[e.image],alt:e.name,className:"unit-image"}),(0,Lm.jsx)("span",{className:"unit-count-badge",children:e.currentCount})]}),(0,Lm.jsx)("input",{type:"number",value:y[e.id]||0,onChange:t=>T(e.id,t.target.value),className:"unit-input hide-number-spinners",min:"0",max:e.currentCount})]},e.id))})]}),a.length>0&&(0,Lm.jsxs)("div",{className:"unit-selection-section",children:[(0,Lm.jsx)("h4",{className:"unit-selection-header",children:"Naval Units"}),(0,Lm.jsx)("div",{className:"unit-grid",children:a.map(e=>(0,Lm.jsxs)("div",{className:"unit-item",children:[(0,Lm.jsxs)("div",{className:"unit-image-container",title:`Select all/none of ${e.name}`,onClick:()=>I(e.id,e.currentCount),children:[(0,Lm.jsx)("img",{src:bC[e.image],alt:e.name,className:"unit-image"}),(0,Lm.jsx)("span",{className:"unit-count-badge",children:e.currentCount})]}),(0,Lm.jsx)("input",{type:"number",value:y[e.id]||0,onChange:t=>T(e.id,t.target.value),className:"unit-input hide-number-spinners",min:"0",max:e.currentCount})]},e.id))})]}),S>0&&(0,Lm.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(0,Lm.jsx)("h4",{className:"text-lg font-bold",children:"Transport Capacity"}),(0,Lm.jsxs)("div",{className:"w-full bg-gray-700 rounded-full h-6 relative",children:[(0,Lm.jsx)("div",{className:`h-full rounded-full ${h}`,style:{width:`${Math.min(100,u)}%`}}),(0,Lm.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center text-white text-sm font-bold",children:[_," / ",S]})]}),u>100&&(0,Lm.jsx)("p",{className:"text-red-500 text-sm mt-1",children:"Over capacity!"})]}),"attack"===n&&l.length>0&&(0,Lm.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(0,Lm.jsx)("h4",{className:"text-lg font-bold mb-2",children:"Attack Formation"}),c.map(e=>(0,Lm.jsxs)("div",{className:"flex flex-col space-y-2 mt-2",children:[(0,Lm.jsxs)("label",{children:[e.label,":"]}),(0,Lm.jsxs)("select",{value:j[e.name],onChange:t=>{return n=e.name,s=t.target.value,void C(e=>({...e,[n]:s}));var n,s},className:"bg-gray-700 text-white rounded p-2",children:[(0,Lm.jsx)("option",{value:"",children:"None"}),l.filter(t=>!Object.entries(j).some(n=>{let[s,r]=n;return r===t&&s!==e.name})).map(e=>(0,Lm.jsx)("option",{value:e,children:qm[e].name},e))]})]},e.name))]}),"attack"===n&&0===l.length&&(0,Lm.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,Lm.jsx)("p",{className:"text-gray-400",children:"Select land units to configure attack formation."})})]}):"scout"===n?(0,Lm.jsx)(xC,{selectedResources:k,gameState:d,handleResourceChange:E}):"trade"===n?(0,Lm.jsx)(yC,{selectedResources:k,currentResources:g,handleResourceChange:E}):null})()}),(0,Lm.jsxs)("div",{className:"movement-modal-footer",children:[(0,Lm.jsxs)("p",{className:"mb-2",children:["Travel Time: ",(0,Lm.jsx)("span",{className:"font-bold text-yellow-600",children:P})]}),(null===h||void 0===h?void 0:h.weather)&&(0,Lm.jsx)(wC,{weather:h.weather,windSpeed:m}),(0,Lm.jsx)("button",{onClick:()=>{let e=Object.values(y).reduce((e,t)=>e+t,0),t=Object.values(k).reduce((e,t)=>e+t,0);if(("attack"===n||"reinforce"===n)&&0===e&&!b)return void u("Please select at least one unit or a hero to send.");if("scout"===n){var r;const e=k.silver||0;if(e<=0)return void u("Please enter an amount of silver for scouting.");if(e>((null===(r=d.cave)||void 0===r?void 0:r.silver)||0))return void u("Not enough silver in the cave for scouting.")}if("trade"===n&&0===t)return void u("Please select at least one resource to trade.");const i=Object.keys(y).some(e=>{var t;return"land"===(null===(t=qm[e])||void 0===t?void 0:t.type)&&y[e]>0}),a=Object.keys(y).some(e=>{var t;return"naval"===(null===(t=qm[e])||void 0===t?void 0:t.type)&&y[e]>0});if(i&&a&&_>S)return void u(`Not enough transport ship capacity. You need ${_-S} more capacity.`);if("attack"===n){const e=Object.values(j).filter(e=>""!==e),t=new Set(e);if(e.length!==t.size)return void u("Each attack formation layer must have a unique unit selected.");for(const n in j){var o;const e=j[n];if(""!==e&&0===(y[e]||0))return void u(`Your selected ${n} unit (${qm[e].name}) has 0 troops in the current selection. Please adjust unit counts or selection.`);if(""!==e&&"land"!==(null===(o=qm[e])||void 0===o?void 0:o.type))return void u(`The unit selected for ${n} (${qm[e].name}) must be a land unit.`)}}const h={};"scout"===n?h.silver=k.silver:"trade"===n&&Object.assign(h,k),l({mode:n,targetCity:s,units:"scout"===n||"trade"===n?{}:y,hero:b,resources:h,travelTime:P,attackFormation:"attack"===n?j:{}}),c()},className:"btn btn-primary w-full py-2 mt-4",children:"Send"})]})]})})},NC=e=>{let{movements:t,onClose:n,combinedSlots:s,villages:r,onCancel:i,onRush:a,isAdmin:o}=e;const{gameSettings:l}=up(),c={...s,...r},u=t.filter(e=>(!l.hideReturningReports||"returning"!==e.status)&&!(e=>!!e&&("trade"===e.type||!("returning"!==e.status||!e.resources||!Object.values(e.resources).some(e=>e>0)||e.units&&!Object.values(e.units).every(e=>0===e))))(e));return(0,Lm.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"movements-panel-bg w-full max-w-4xl rounded-lg",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("div",{className:"movements-header rounded-t-sm",children:(0,Lm.jsx)("h3",{children:"Movement Overview"})}),(0,Lm.jsx)("div",{className:"max-h-[60vh] overflow-y-auto",children:u.length>0?u.map(e=>(0,Lm.jsx)("div",{className:"flex items-center",children:(0,Lm.jsx)(Ug,{movement:e,citySlots:c,onCancel:i,onRush:a,isAdmin:o})},e.id)):(0,Lm.jsx)("p",{className:"p-8 text-center text-gray-700 italic",children:"No active movements."})})]})})},jC={},CC=n(3542);CC.keys().forEach(e=>{const t=e.replace("./","");jC[t]=CC(e)});const SC=e=>{let{city:t,onClose:n,onOpenWithdraw:s}=e;const{currentUser:r}=Fm(),i=t.reinforcements||{},a=e=>{let[t,n]=e;const s=qm[t];if(!s||!s.image)return null;const r=jC[s.image];return r?(0,Lm.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Lm.jsx)("img",{src:r,alt:s.name,className:"w-8 h-8 object-contain"}),(0,Lm.jsxs)("span",{children:[s.name,": ",n]})]},t):null},o=Object.values(i).some(e=>e.ownerId===r.uid);return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-2xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsxs)("h3",{className:"font-title text-3xl text-white",children:["Reinforcements in ",t.cityName]}),(0,Lm.jsx)("button",{onClick:n,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4",children:Object.keys(i).length>0?Object.entries(i).map(e=>{let[t,n]=e;return(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsxs)("h4",{className:"font-bold text-yellow-400 mb-2",children:["From: ",n.originCityName]}),(0,Lm.jsx)("div",{className:"space-y-1",children:Object.entries(n.units||{}).map(a)})]},t)}):(0,Lm.jsx)("p",{className:"text-center text-gray-400",children:"No reinforcements in this city."})}),(0,Lm.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-600 flex justify-end",children:o&&(0,Lm.jsx)("button",{onClick:()=>s(t),className:"btn btn-confirm py-2 px-6",children:"Withdraw Troops"})})]})})},_C=e=>{let{modalState:t,closeModal:n,gameState:s,playerCity:r,travelTimeInfo:i,handleSendMovement:a,handleCancelMovement:o,setMessage:l,goToCoordinates:c,handleActionClick:u,worldId:d,movements:h,combinedSlots:m,villages:p,handleRushMovement:f,userProfile:g,onCastSpell:v,onActionClick:y,marketCapacity:x,onEnterCity:b,onSwitchCity:w,onWithdraw:k}=e;const{currentUser:N}=Fm(),{selectedCity:j}=t;return(0,Lm.jsxs)(Lm.Fragment,{children:[(()=>{if(!j)return null;if(j.isRuinTarget||j.isVillageTarget)return(0,Lm.jsx)(dC,{city:j,playerCity:r,travelTimeInfo:i,onSendMovement:a,onClose:()=>n("city"),onAction:u,onGoTo:c,gameState:s,onCastSpell:v,isVillageTarget:j.isVillageTarget});const e=j.ownerId===N.uid,t=(null===s||void 0===s?void 0:s.id)===j.id,o=j.reinforcements&&Object.keys(j.reinforcements).length>0;let l=[];e?t?(l=[{label:"Enter City",icon:"\ud83c\udfdb\ufe0f",handler:()=>b(j.id)},{label:"Center on Map",icon:"\ud83d\udccd",handler:()=>c(j.x,j.y)}],o&&l.push({label:"Withdraw Troops",icon:"\ud83d\udee1\ufe0f",handler:()=>k(j)})):l=[{label:"Enter City",icon:"\ud83c\udfdb\ufe0f",handler:()=>b(j.id)},{label:"Select City",icon:"\u2705",handler:()=>w(j.id)},{label:"Reinforce",icon:"\ud83d\udee1\ufe0f",handler:()=>u("reinforce",j)},{label:"Trade",icon:"\u2696\ufe0f",handler:()=>u("trade",j)},...o?[{label:"Withdraw Troops",icon:"\ud83d\udee1\ufe0f",handler:()=>k(j)}]:[],{label:"Center on Map",icon:"\ud83d\udccd",handler:()=>c(j.x,j.y)}]:l=[{label:"Attack",icon:"\u2694\ufe0f",handler:()=>u("attack",j)},{label:"Reinforce",icon:"\ud83d\udee1\ufe0f",handler:()=>u("reinforce",j)},{label:"Scout",icon:"\ud83d\udc41\ufe0f",handler:()=>u("scout",j)},{label:"Trade",icon:"\u2696\ufe0f",handler:()=>u("trade",j)},{label:"Cast Spell",icon:"\u2728",handler:()=>v(null,j)},{label:"Profile",icon:"\ud83d\udc64",handler:()=>u("profile",j)}];const d=l.find(e=>"Select City"===e.label),h=l.filter(e=>"Select City"!==e.label);return(0,Lm.jsx)(cC,{actions:h,centerAction:d,position:j.position,onClose:()=>n("city")})})(),t.selectedVillage&&(0,Lm.jsx)(vC,{village:t.selectedVillage,onClose:()=>n("village"),onActionClick:u,playerCity:r,worldId:d,marketCapacity:x}),t.actionDetails&&(0,Lm.jsx)(kC,{mode:t.actionDetails.mode,targetCity:t.actionDetails.city,onClose:()=>n("action"),onSend:a,playerCity:r,gameState:s,travelTimeInfo:i,setMessage:l}),t.isMovementsPanelOpen&&(0,Lm.jsx)(NC,{movements:h,onClose:()=>n("movements"),combinedSlots:m,villages:p,goToCoordinates:c,onCancel:o,onRush:f,isAdmin:null===g||void 0===g?void 0:g.is_admin}),t.isReinforcementsModalOpen&&(0,Lm.jsx)(SC,{city:t.reinforcementsModalData,onClose:()=>n("reinforcements"),onOpenWithdraw:k})]})},TC=175,IC=t=>{let{mouseCoords:n,pan:s,zoom:r,viewportSize:i,worldState:a,allCities:o,ruins:l,playerAlliance:c}=t;const u=(0,e.useRef)(null),{currentUser:d}=Fm(),h=(()=>{if(!i.width||!a)return"Unknown Sea";const e=(-s.x+i.width/2)/(32*r),t=(-s.y+i.height/2)/(32*r),n=Math.floor(e/100);return`Sea ${Math.floor(t/100)}${n}`})();return(0,e.useEffect)(()=>{const e=u.current;if(!e||!a||!i.width||!d)return;const t=e.getContext("2d"),{width:n,height:h,islands:m}=a,p=TC/n,f=TC/h;t.fillStyle="#1e3a8a",t.fillRect(0,0,TC,TC),t.fillStyle="#2a623d",m.forEach(e=>{t.beginPath(),t.arc(e.x*p,e.y*f,e.radius*Math.min(p,f),0,2*Math.PI),t.fill()}),l&&(t.fillStyle="#a855f7",Object.values(l).forEach(e=>{t.fillRect(e.x*p-1,e.y*f-1,3,3)})),o&&Object.values(o).forEach(e=>{if(!e.ownerId)return;let n="#f59e0b";if(e.ownerId===d.uid)n="#facc15";else if(c&&e.alliance){var s,r,i,a;e.alliance===c.tag?n="#3b82f6":null!==(s=c.diplomacy)&&void 0!==s&&null!==(r=s.allies)&&void 0!==r&&r.some(t=>t.tag===e.alliance)?n="#22c55e":null!==(i=c.diplomacy)&&void 0!==i&&null!==(a=i.enemies)&&void 0!==a&&a.some(t=>t.tag===e.alliance)&&(n="#ef4444")}t.fillStyle=n,t.fillRect(e.x*p-1,e.y*f-1,3,3)});const g=-s.x/(32*r)*p,v=-s.y/(32*r)*f,y=i.width/(32*r)*p,x=i.height/(32*r)*f;t.strokeStyle="#ffffff",t.lineWidth=1,t.strokeRect(g,v,y,x)},[a,o,l,c,s,r,i,d]),(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("div",{className:"minimap-container",children:(0,Lm.jsx)("canvas",{ref:u,width:TC,height:TC,className:"minimap-canvas"})}),(0,Lm.jsx)("div",{className:"coords-info-container",children:(0,Lm.jsxs)("p",{children:[h," (",n.x,", ",n.y,")"]})})]})},EC={},AC=n(3542);AC.keys().forEach(e=>{const t=e.replace("./","");EC[t]=AC(e)});const PC=t=>{let{city:n,onClose:s,onWithdrawTroops:r}=t;const{currentUser:i}=Fm(),[a,o]=(0,e.useState)({}),l=Object.entries(n.reinforcements||{}).filter(e=>{let[,t]=e;return t.ownerId===i.uid});return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-2xl border-2 border-gray-600 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsxs)("h3",{className:"font-title text-3xl text-white",children:["Withdraw Your Troops from ",n.cityName]}),(0,Lm.jsx)("button",{onClick:s,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4",children:l.length>0?l.map(e=>{let[t,s]=e;return(0,Lm.jsxs)("div",{className:"bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsxs)("h4",{className:"font-bold text-yellow-400 mb-2",children:["From: ",s.originCityName]}),(0,Lm.jsx)("div",{className:"space-y-2",children:Object.entries(s.units||{}).map(e=>{var s;let[r,i]=e;const l=qm[r];return(0,Lm.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lm.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Lm.jsx)("img",{src:EC[l.image],alt:l.name,className:"w-10 h-10 object-contain"}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-bold text-white",children:l.name}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-400",children:["Count: ",i]})]})]}),(0,Lm.jsx)("input",{type:"number",value:(null===(s=a[t])||void 0===s?void 0:s[r])||"",onChange:e=>((e,t,s)=>{var r,i,a;const l=(null===(r=n.reinforcements)||void 0===r||null===(i=r[e])||void 0===i||null===(a=i.units)||void 0===a?void 0:a[t])||0,c=Math.max(0,Math.min(l,parseInt(s,10)||0));o(n=>({...n,[e]:{...n[e],[t]:c}}))})(t,r,e.target.value),className:"bg-gray-800 text-white rounded p-2 w-24 text-center",placeholder:"Amount",max:i,min:"0"})]},r)})})]},t)}):(0,Lm.jsx)("p",{className:"text-center text-gray-400",children:"You have no troops to withdraw from this city."})}),(0,Lm.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-600 flex justify-end gap-4",children:[(0,Lm.jsx)("button",{onClick:()=>{const e=n.reinforcements||{},t={};for(const n in e)e[n].ownerId===i.uid&&(t[n]={...e[n].units});Object.keys(t).length>0&&(r(n,t),s())},className:"btn btn-primary py-2 px-6",children:"Withdraw All"}),(0,Lm.jsx)("button",{onClick:()=>{Object.values(a).some(e=>Object.values(e).some(e=>e>0))&&(r(n,a),s())},className:"btn btn-confirm py-2 px-6",children:"Withdraw Selected Troops"})]})]})})},MC=t=>{let{onClose:n,islandId:s,coords:r}=t;const{startWonder:i}=sp(),[a,o]=(0,e.useState)(null),[l,c]=(0,e.useState)(""),[u,d]=(0,e.useState)(!1),h=5e4,m=5e4,p=25e3;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-2xl border-2 border-gray-600 text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold",children:"Construct an Alliance Wonder"}),(0,Lm.jsx)("button",{onClick:n,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),l&&(0,Lm.jsx)("p",{className:"text-center text-yellow-400 mb-4",children:l}),(0,Lm.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Select a wonder to build on this island. The initial cost will be deducted from your active city's resources."}),(0,Lm.jsxs)("p",{className:"text-center font-bold mb-4",children:["Start Cost: ",h,"W, ",m,"S, ",p,"Ag"]}),(0,Lm.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(ip).map(e=>{let[t,n]=e;return(0,Lm.jsxs)("div",{onClick:()=>o(t),className:"p-4 rounded-lg cursor-pointer border-2 "+(a===t?"bg-gray-600 border-yellow-500":"bg-gray-700 border-gray-600 hover:border-yellow-400"),children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg",children:n.name}),(0,Lm.jsx)("p",{className:"text-sm text-gray-400",children:n.description})]},t)})}),(0,Lm.jsx)("button",{onClick:async()=>{if(a){d(!0),c("Beginning construction...");try{await i(a,s,r),c("Construction has begun!"),n()}catch(e){c(`Failed to start wonder: ${e.message}`),d(!1)}}else c("Please select a wonder to build.")},disabled:!a||u,className:"btn btn-confirm w-full mt-6",children:u?"Constructing...":"Begin Construction"})]})})},DC=t=>{var n;let{onClose:s}=t;const{playerAlliance:r,donateToWonder:i,claimWonderLevel:a}=sp(),{currentUser:o}=Fm(),[l,c]=(0,e.useState)({wood:0,stone:0,silver:0}),[u,d]=(0,e.useState)(""),h=(null===r||void 0===r||null===(n=r.leader)||void 0===n?void 0:n.uid)===(null===o||void 0===o?void 0:o.uid),m=null===r||void 0===r?void 0:r.allianceWonder,p=m?ip[m.id]:null;if(!m||!p)return null;const f=e=>{const{name:t,value:n}=e.target;c(e=>({...e,[t]:parseInt(n)||0}))},g=m.level+1,v=(e=>{if(!p)return{wood:0,stone:0,silver:0};const t=Math.pow(1.5,e);return{wood:Math.floor(1e5*t),stone:Math.floor(1e5*t),silver:Math.floor(5e4*t)}})(m.level),y=((e,t)=>{var n;return(null===e||void 0===e||null===(n=e.wonderProgress)||void 0===n?void 0:n[t])||{wood:0,stone:0,silver:0}})(r,m.id),x=(y.wood||0)+(y.stone||0)+(y.silver||0),b=(v.wood||0)+(v.stone||0)+(v.silver||0),w=b>0?x/b*100:0;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-lg border-2 border-gray-600 text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsxs)("h3",{className:"text-xl font-bold",children:[p.name," (Level ",m.level,")"]}),(0,Lm.jsx)("button",{onClick:s,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),u&&(0,Lm.jsx)("p",{className:"text-center text-yellow-400 mb-4",children:u}),(0,Lm.jsx)("p",{className:"text-sm italic mb-4",children:p.description}),(0,Lm.jsxs)("div",{className:"w-full bg-gray-700 rounded-full h-8 mb-4 relative",children:[(0,Lm.jsx)("div",{className:"bg-yellow-500 h-full rounded-full transition-all duration-500",style:{width:`${Math.min(100,w)}%`}}),(0,Lm.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-white font-bold",children:[Math.min(100,w).toFixed(1),"% to Level ",g]})]}),(0,Lm.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-sm text-center mb-4",children:[(0,Lm.jsxs)("div",{children:["Wood: ",y.wood.toLocaleString()," / ",v.wood.toLocaleString()]}),(0,Lm.jsxs)("div",{children:["Stone: ",y.stone.toLocaleString()," / ",v.stone.toLocaleString()]}),(0,Lm.jsxs)("div",{children:["Silver: ",y.silver.toLocaleString()," / ",v.silver.toLocaleString()]})]}),h&&(0,Lm.jsx)("button",{onClick:async()=>{if(d(""),h)try{await a(m.id),d(`Wonder upgraded to level ${m.level+1}!`)}catch(e){d(`Claim failed: ${e.message}`)}},disabled:w<100,className:"btn btn-confirm w-full mb-4",children:w>=100?`Claim Level ${g}`:"Requires more resources"}),(0,Lm.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Lm.jsx)("h5",{className:"font-bold text-lg mb-2",children:"Donate Resources"}),(0,Lm.jsxs)("div",{className:"flex gap-2",children:[(0,Lm.jsx)("input",{type:"number",name:"wood",value:l.wood,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Wood"}),(0,Lm.jsx)("input",{type:"number",name:"stone",value:l.stone,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Stone"}),(0,Lm.jsx)("input",{type:"number",name:"silver",value:l.silver,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Silver"})]}),(0,Lm.jsx)("button",{onClick:async()=>{d("");try{await i(m.id,l),d("Donation successful!"),c({wood:0,stone:0,silver:0})}catch(e){d(`Donation failed: ${e.message}`)}},className:"btn btn-primary w-full mt-4",children:"Donate"})]})]})})},OC=32,RC=10,LC=(t,n,s,r,i)=>{const{currentUser:a,userProfile:o}=Fm(),{worldId:l,gameState:c,playerCity:u,setGameState:d,worldState:h,playerCities:m}=up(),[p,f]=(0,e.useState)(null),g=(0,e.useCallback)((e,s)=>{["attack","reinforce","scout","trade"].includes(e)?(t("action",{mode:e,city:s}),n("city"),n("village")):"withdraw"===e?(t("withdraw",s),n("city")):"message"===e?(t("messages",{city:s}),n("city")):"castSpell"===e?(t("divinePowers",{targetCity:s}),n("city")):"profile"===e?(t("profile",{userId:s.ownerId}),n("city")):["information","rally"].includes(e)&&i(`${e.charAt(0).toUpperCase()+e.slice(1)} is not yet implemented.`)},[t,n,i]),v=(0,e.useCallback)(async e=>{const{mode:t,targetCity:n,units:s,resources:r,attackFormation:m,hero:p}=e;if(!u)return void i("Cannot send movement: Your city data could not be found.");if(n.isVillageTarget&&u.islandId!==n.islandId)return void i("You can only attack villages from a city on the same island.");const f=!(!n.isRuinTarget&&!n.isGodTownTarget)||u.islandId!==n.islandId;let g=!1,v=!1,y=!1,x=0,b=0;for(const i in s)if(s[i]>0){const e=qm[i];"land"===e.type?(g=!0,b+=s[i],e.flying&&(y=!0)):"naval"===e.type&&(v=!0,x+=(e.capacity||0)*s[i])}if(f&&g&&!v&&!y)return void i("Ground troops cannot travel across the sea without transport ships.");if(f&&g&&x<b&&!y)return void i(`Not enough transport ship capacity. Need ${b-x} more capacity.`);const w=[];g&&w.push("land"),v&&w.push("naval"),y&&w.push("flying");const k=Cm(Om),N=eh(Jd(Om,"worlds",l,"movements")),j=n.ownerId||a.uid,C=j===a.uid;let S=null;if(!n.isVillageTarget&&!n.isRuinTarget&&!n.isGodTownTarget&&j)if(C)S=n.id;else{const e=Bh(Jd(Om,`users/${j}/games`,l,"cities"),qh("slotId","==",n.id),Yh(1));try{const t=await cm(e);if(t.empty)return void i("Error: Could not find the target city's data. It may have been conquered or deleted.");S=t.docs[0].id}catch(F){return console.error("Error fetching target city doc ID:",F),void i("An error occurred while trying to target the city.")}}const _=_g(u,n),T=Object.entries(s||{}).filter(e=>{let[,t]=e;return t>0});if(0===T.length&&!["trade","scout"].includes(t)&&!p)return void i("No units or hero selected for movement.");const I=Tg(_,T.length>0?Math.min(...T.map(e=>{let[t]=e;return qm[t].speed})):10,t,h,w),E=new Date(Date.now()+1e3*I),A=new Date(Date.now()+3e4);let P;P="attack"===t&&n.isGodTownTarget?{type:"attack_god_town",originCityId:u.id,originCoords:{x:u.x,y:u.y},originOwnerId:a.uid,originCityName:u.cityName,originOwnerUsername:o.username,targetTownId:n.id,targetTownName:n.name,targetCoords:{x:n.x,y:n.y},units:s,hero:p,departureTime:km(),arrivalTime:E,cancellableUntil:A,status:"moving",attackFormation:m||{},involvedParties:[a.uid],isGodTownTarget:!0,isCrossIsland:!0}:"attack"===t&&n.isVillageTarget?{type:"attack_village",originCityId:u.id,originCoords:{x:u.x,y:u.y},originOwnerId:a.uid,originCityName:u.cityName,originOwnerUsername:o.username,targetVillageId:n.id,targetVillageName:n.name,targetCoords:{x:n.x,y:n.y},units:s,hero:p,resources:r||{},departureTime:km(),arrivalTime:E,cancellableUntil:A,status:"moving",attackFormation:m||{},involvedParties:[a.uid],isVillageTarget:!0,isCrossIsland:!1}:"attack"===t&&n.isRuinTarget?{type:"attack_ruin",originCityId:u.id,originCoords:{x:u.x,y:u.y},originOwnerId:a.uid,originCityName:u.cityName,originOwnerUsername:o.username,targetRuinId:n.id,targetRuinName:n.name,targetCoords:{x:n.x,y:n.y},units:s,hero:p,departureTime:km(),arrivalTime:E,cancellableUntil:A,status:"moving",attackFormation:m||{},involvedParties:[a.uid],isRuinTarget:!0,isCrossIsland:!0}:{type:t,originCityId:u.id,originCoords:{x:u.x,y:u.y},originOwnerId:a.uid,originCityName:u.cityName,originOwnerUsername:o.username,targetCityId:S,targetSlotId:C?n.slotId:n.id,targetCoords:{x:n.x,y:n.y},targetOwnerId:j,ownerUsername:n.ownerUsername||o.username,targetCityName:n.cityName,units:s,hero:p,resources:r||{},departureTime:km(),arrivalTime:E,cancellableUntil:A,status:"moving",attackFormation:m||{},involvedParties:"scout"===t?[a.uid]:[a.uid,j].filter(e=>e),isVillageTarget:!!n.isVillageTarget,isCrossIsland:f},k.set(N,P);const M=eh(Om,`users/${a.uid}/games`,l,"cities",u.id),D={...c.units};for(const i in s)D[i]=(D[i]||0)-s[i];const O={...c.resources},R={...c.cave};if("scout"===t)r&&r.silver&&(R.silver=(R.silver||0)-r.silver);else if(r)for(const i in r)O[i]-=r[i];const L=c.heroes?{...c.heroes}:{};p&&L[p]&&(L[p].cityId=u.id),k.update(M,{units:D,resources:O,cave:R,heroes:L});const $={...c,units:D,resources:O,cave:R,heroes:L};try{await k.commit(),d($),i(`Movement sent to ${n.cityName||n.name}!`)}catch(F){console.error("Error sending movement:",F),i(`Failed to send movement: ${F.message}`)}},[a,o,l,c,u,d,i,h]),y=(0,e.useCallback)(async e=>{const t=eh(Om,"worlds",l,"movements",e);try{await wm(Om,async e=>{const n=await e.get(t);if(!n.exists())throw new Error("Movement data not found.");const s=n.data(),r=s.cancellableUntil,i=null!==r&&void 0!==r&&r.toDate?r.toDate():new Date(r);if(new Date>i)throw new Error("The grace period to cancel this movement has passed.");const a=Date.now(),o=s.departureTime,l=null!==o&&void 0!==o&&o.toDate?o.toDate().getTime():new Date(o).getTime(),c=new Date(a+(a-l));e.update(t,{status:"returning",arrivalTime:c,departureTime:km(),cancellableUntil:new Date(0)})}),i("Movement is now returning.")}catch(n){console.error("Error cancelling movement:",n),i(`Could not cancel movement: ${n.message}`)}},[l,i]),x=(0,e.useCallback)(async(e,t)=>{if(null===o||void 0===o||!o.is_admin)return void i("You are not authorized to perform this action.");i("Creating dummy city...");const n=eh(Om,"worlds",l,"citySlots",e),s=`dummy_${tp()}`,a=`DummyPlayer_${Math.floor(1e4*Math.random())}`,c=eh(Jd(Om,`users/${s}/games`,l,"cities"));try{const o=await om(n);if(!o.exists()||null!==o.data().ownerId)throw new Error("Slot is already taken.");const l=Cm(Om),u=`${a}'s Outpost`;l.update(n,{ownerId:s,ownerUsername:a,cityName:u});const d={};Object.keys(zm).forEach(e=>{d[e]={level:0}}),d.senate={level:1};const h={id:c.id,slotId:e,cityName:u,playerInfo:{religion:"Dummy",nation:"Dummy"},resources:{wood:500,stone:500,silver:100},buildings:d,units:{swordsman:10},lastUpdated:Date.now()};l.set(c,h),await l.commit(),i(`Dummy city "${u}" created successfully!`),r(t.x,t.y)}catch(u){console.error("Error creating dummy city:",u),i(`Failed to create dummy city: ${u.message}`)}},[o,l,r,i]),b=(0,e.useCallback)(async(e,t)=>{if(!e||!e.ownerId)return void i("Invalid city data for withdrawal.");const n=e.ownerId,s=e.slotId||e.id,r=Cm(Om);for(const i in t){const s=t[i];if(Object.values(s).every(e=>0===e))continue;const o=eh(Jd(Om,"worlds",l,"movements")),c=m[i];if(!c){console.error(`Could not find origin city with ID ${i} for withdrawal.`);continue}const u=_g(e,c),d=Object.keys(s).map(e=>qm[e].speed),h=Tg(u,Math.min(...d)),p=new Date(Date.now()+1e3*h),f={type:"return",status:"returning",originCityId:i,originCoords:{x:c.x,y:c.y},originOwnerId:a.uid,originCityName:c.cityName,targetCityId:e.id,targetCoords:{x:e.x,y:e.y},units:s,departureTime:km(),arrivalTime:p,involvedParties:[a.uid,n]};r.set(o,f)}try{await wm(Om,async e=>{const r=Bh(Jd(Om,`users/${n}/games`,l,"cities"),qh("slotId","==",s),Yh(1)),i=await cm(r);if(i.empty)return void console.warn(`Could not find city doc for slotId ${s} to update reinforcements.`);const a=i.docs[0].id,o=eh(Om,`users/${n}/games`,l,"cities",a),c=eh(Om,"worlds",l,"citySlots",s),u=await e.get(o);if(!u.exists())throw new Error("Reinforced city data not found.");const d=u.data().reinforcements||{},h=JSON.parse(JSON.stringify(d));for(const n in t){var m;const e=t[n];for(const t in e){var p,f;null!==(p=h[n])&&void 0!==p&&null!==(f=p.units)&&void 0!==f&&f[t]&&(h[n].units[t]-=e[t],h[n].units[t]<=0&&delete h[n].units[t])}0===Object.keys((null===(m=h[n])||void 0===m?void 0:m.units)||{}).length&&delete h[n]}e.update(o,{reinforcements:h}),e.update(c,{reinforcements:h})}),await r.commit()}catch(o){console.error("Error withdrawing troops:",o),i(`Failed to withdraw troops: ${o.message}`)}},[a,l,m,i]);return{travelTimeInfo:p,setTravelTimeInfo:f,handleActionClick:g,handleSendMovement:v,handleCancelMovement:y,handleCreateDummyCity:x,handleWithdrawTroops:b}},$C=()=>{const[t,n]=(0,e.useState)(!1),[s,r]=(0,e.useState)(0),[i,a]=(0,e.useState)(0),[o,l]=(0,e.useState)(!1);return{isPlacingDummyCity:t,setIsPlacingDummyCity:n,unreadReportsCount:s,setUnreadReportsCount:r,unreadMessagesCount:i,setUnreadMessagesCount:a,isSettingsModalOpen:o,setIsSettingsModalOpen:l}};let FC={cityPoints:null,scoutedCities:null,timestamp:0};const UC={"island_1.png":Kg,"island_2.png":Xg},VC=t=>{let{showCity:n,openModal:s,closeModal:r,modalState:i,unreadReportsCount:a,unreadMessagesCount:o,quests:l,claimReward:c,handleMessageAction:u,panToCoords:d,setPanToCoords:h,handleGoToCityFromProfile:m,movements:p,onCancelTrain:f,onCancelMovement:g,isUnderAttack:v,incomingAttackCount:y,onRenameCity:x,centerOnCity:b,onGodTownClick:w,handleOpenEvents:k,onSwitchCity:N,battlePoints:j,initialMapAction:C,setInitialMapAction:S}=t;const{currentUser:_,userProfile:T}=Fm(),{worldState:I,gameState:E,setGameState:A,worldId:P,playerCity:M,playerCities:D,conqueredVillages:O,conqueredRuins:R,gameSettings:L,activeCityId:$,playerCityPoints:F}=up(),{playerAlliance:U}=sp(),V=(0,e.useRef)(null),B=(0,e.useRef)(null),{isPlacingDummyCity:z,setIsPlacingDummyCity:q}=$C(),{pan:W,zoom:H,viewportSize:G,borderOpacity:Q,isPanning:Y,handleMouseDown:K,goToCoordinates:X}=((t,n,s,r)=>{const[i,a]=(0,e.useState)({x:0,y:0}),[o,l]=(0,e.useState)(.15),[c,u]=(0,e.useState)(.15),[d,h]=(0,e.useState)(!1),[m,p]=(0,e.useState)({x:0,y:0}),[f,g]=(0,e.useState)({top:0,bottom:0,left:0,right:0}),[v,y]=(0,e.useState)({width:0,height:0}),x=(0,e.useCallback)((e,n)=>{if(!t.current||null===s||void 0===s||!s.islands)return e;const r=s.width*OC,i=s.height*OC,{clientWidth:a,clientHeight:o}=t.current,l=a-r*n,c=o-i*n;return g({left:Math.max(0,Math.min(1,e.x/0)),right:Math.max(0,Math.min(1,(l-e.x)/0)),top:Math.max(0,Math.min(1,e.y/0)),bottom:Math.max(0,Math.min(1,(c-e.y)/0))}),{x:Math.min(0,Math.max(l-0,e.x)),y:Math.min(0,Math.max(c-0,e.y))}},[s,t]),b=(0,e.useCallback)((e,n)=>{if(!t.current)return;const{clientWidth:s,clientHeight:r}=t.current,i=x({x:-e*OC*o+s/2-OC*o/2,y:-n*OC*o+r/2-OC*o/2},o);a(i)},[o,x,t]),w=(0,e.useCallback)(()=>{r&&b(r.x,r.y)},[r,b]);(0,e.useEffect)(()=>{const e=t.current;if(!e||null===s||void 0===s||!s.islands)return;const n=()=>{y({width:e.clientWidth,height:e.clientHeight});const t=Math.max(e.clientWidth/(s.width*OC),e.clientHeight/(s.height*OC),.15);u(t),l(e=>Math.max(t,e))};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[s,t]),(0,e.useEffect)(()=>{r&&w()},[null===r||void 0===r?void 0:r.id]),(0,e.useEffect)(()=>{const e=n.current;e&&(e.style.transform=`translate(${i.x}px, ${i.y}px) scale(${o})`)},[i,o,n]);const k=(0,e.useCallback)(e=>{if(!t.current)return;e.preventDefault();const n=.002*-e.deltaY,s=Math.max(c,Math.min(3,o+n)),r=t.current.getBoundingClientRect(),u=e.clientX-r.left,d=e.clientY-r.top,h=(u-i.x)/o,m=(d-i.y)/o,p=x({x:u-h*s,y:d-m*s},s);l(s),a(p)},[o,i,x,c,t]);(0,e.useEffect)(()=>{const e=t.current;return e&&e.addEventListener("wheel",k,{passive:!1}),()=>{e&&e.removeEventListener("wheel",k)}},[k,t]);const N=(0,e.useCallback)(e=>{0===e.button&&(p({x:e.clientX-i.x,y:e.clientY-i.y}),h(!0))},[i]);return(0,e.useEffect)(()=>{const e=e=>{if(!d)return;const t=x({x:e.clientX-m.x,y:e.clientY-m.y},o);a(t)},t=()=>h(!1);return d&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[d,m,o,x]),{pan:i,zoom:o,viewportSize:v,borderOpacity:f,isPanning:d,handleMouseDown:N,goToCoordinates:b,centerOnCity:w}})(V,B,I,M),{visibleSlots:J,visibleVillages:Z,visibleRuins:ee,invalidateChunkCache:te}=((t,n,s,r,i,a)=>{const[o,l]=(0,e.useState)({}),[c,u]=(0,e.useState)({}),[d,h]=(0,e.useState)({}),[m,p]=(0,e.useState)({}),f=(0,e.useRef)({}),g=(0,e.useCallback)((e,t)=>{const n=`${Math.floor(e/RC)},${Math.floor(t/RC)}`;l(e=>{const t={...e};return delete t[n],t})},[]);return(0,e.useEffect)(()=>()=>{Object.values(f.current).forEach(e=>{Array.isArray(e)&&e.forEach(e=>e())}),f.current={}},[]),(0,e.useEffect)(()=>{if(!s||0===a.width||i<=0||!n)return;const e=32*i,t=Math.floor(-r.x/e)-1,o=Math.ceil((-r.x+a.width)/e)+1,c=Math.floor(-r.y/e)-1,u=Math.ceil((-r.y+a.height)/e)+1,d=new Set;for(let n=c;n<=u;n++)for(let e=t;e<=o;e++){const t=`${Math.floor(e/RC)},${Math.floor(n/RC)}`;d.add(t)}Object.keys(f.current).forEach(e=>{d.has(e)||(f.current[e].forEach(e=>e()),delete f.current[e])}),d.forEach(e=>{if(!f.current[e]){const[t,s]=e.split(",").map(Number),r=[];["citySlots","villages","ruins"].forEach(i=>{const a=pm(Bh(Jd(Om,"worlds",n,i),qh("x",">=",t*RC),qh("x","<",(t+1)*RC),qh("y",">=",s*RC),qh("y","<",(s+1)*RC)),t=>{const n={};t.forEach(e=>{n[e.id]={id:e.id,...e.data()}}),l(t=>({...t,[e]:{...t[e],[i]:n}}))},t=>{console.error(`Error fetching ${i} for chunk ${e}:`,t)});r.push(a)}),f.current[e]=r}})},[r,i,a,s,n]),(0,e.useEffect)(()=>{if(0===a.width)return;const e=32*i,t=Math.floor(-r.x/e),n=Math.ceil((-r.x+a.width)/e),s=Math.floor(-r.y/e),l=Math.ceil((-r.y+a.height)/e),c={},d={},m={};Object.values(o).forEach(e=>{Object.values(e.citySlots||{}).forEach(e=>{e.x>=t&&e.x<=n&&e.y>=s&&e.y<=l&&(c[e.id]=e)}),Object.values(e.villages||{}).forEach(e=>{e.x>=t&&e.x<=n&&e.y>=s&&e.y<=l&&(d[e.id]=e)}),Object.values(e.ruins||{}).forEach(e=>{e.x>=t&&e.x<=n&&e.y>=s&&e.y<=l&&(m[e.id]=e)})}),u(c),h(d),p(m)},[o,r,i,a]),{visibleSlots:c,visibleVillages:d,visibleRuins:m,invalidateChunkCache:g}})(0,P,I,W,H,G),[ne,se]=(0,e.useState)(""),{travelTimeInfo:re,setTravelTimeInfo:ie,handleActionClick:ae,handleSendMovement:oe,handleCreateDummyCity:le,handleWithdrawTroops:ce}=LC(s,r,0,te,se),{getFarmCapacity:ue,calculateUsedPopulation:de,calculateHappiness:he,getMarketCapacity:me,calculateTotalPoints:pe,getProductionRates:fe,getWarehouseCapacity:ge}=lp(P),[ve,ye]=(0,e.useState)({}),[xe,be]=(0,e.useState)({}),[we,ke]=(0,e.useState)({x:0,y:0}),[Ne,je]=(0,e.useState)({}),[Ce,Se]=(0,e.useState)({}),[_e,Te]=(0,e.useState)(null),[Ie,Ee]=(0,e.useState)(null),[Ae,Pe]=(0,e.useState)(null),[Me,De]=(0,e.useState)({}),[Oe,Re]=(0,e.useState)([]),[Le,$e]=(0,e.useState)(null);(0,e.useEffect)(()=>{if(!P)return;const e=pm(Bh(Jd(Om,"worlds",P,"alliances"),qh("allianceWonder","!=",null)),e=>{const t=[];e.forEach(e=>{t.push({...e.data().allianceWonder,allianceName:e.data().name,allianceTag:e.data().tag,allianceId:e.id})}),Re(t)});return()=>e()},[P]),(0,e.useEffect)(()=>{if(!P)return;const e=pm(Jd(Om,"worlds",P,"citySlots"),e=>{const t={};e.forEach(e=>{t[e.id]={id:e.id,...e.data()}}),Pe(t)}),t=pm(Jd(Om,"worlds",P,"godTowns"),e=>{const t={};e.docs.forEach(e=>{t[e.id]={id:e.id,...e.data()}}),De(t)});return()=>{e(),t()}},[P]),(0,e.useEffect)(()=>{const e=V.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),s=t.clientX-n.left,r=t.clientY-n.top,i=Math.floor((-W.x+s)/(32*H)),a=Math.floor((-W.y+r)/(32*H));ke({x:i,y:a})};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[W,H]);const Fe=(0,e.useCallback)(async()=>{if(!P||!I)return{};const e={},t=Bh(Zd(Om,"games"),qh("worldName","==",I.name)),n=await cm(t);for(const s of n.docs){const t=s.ref.parent.parent.id;if(t===_.uid)continue;const n=Jd(Om,`users/${t}/games`,P,"cities"),r=await cm(n);for(const s of r.docs){const t=s.data();if(t.slotId){const n=pe(t);e[t.slotId]=n}}}return e},[P,I,pe,_.uid]),Ue=(0,e.useCallback)(async()=>{if(!_||!P)return{};const e=Bh(Jd(Om,"users",_.uid,"worlds",P,"reports"),Gh("timestamp","desc")),t=await cm(e),n={};return t.forEach(e=>{const t=e.data();if("scout"===t.type&&t.scoutSucceeded){const e=t.targetSlotId;e&&!n[e]&&(n[e]=t.units)}}),n},[_,P]);(0,e.useEffect)(()=>{const e=Date.now();if(e-FC.timestamp<9e5&&FC.cityPoints)ye(FC.cityPoints),be(FC.scoutedCities);else{(async()=>{const t=await Fe(),n=await Ue();ye(t),be(n),FC={cityPoints:t,scoutedCities:n,timestamp:e}})()}},[Fe,Ue]),(0,e.useEffect)(()=>{d&&(X(d.x,d.y),h(null))},[d,X,h]);const{onCitySlotClick:Ve,onVillageClick:Be,onRuinClick:ze}=(e=>{let{playerCity:t,isPlacingDummyCity:n,handleCreateDummyCity:s,setTravelTimeInfo:r,openModal:i,closeModal:a,setMessage:o,conqueredVillages:l,conqueredRuins:c}=e;return{onCitySlotClick:(e,l)=>{if(t)if(a("village"),!n||l.ownerId)if(l.ownerId){const n=_g(t,l);r({distance:n});const s=l,a=e.currentTarget.getBoundingClientRect(),o={...s,position:{x:a.left+a.width/2,y:a.top+a.height/2}};i("city",o)}else o("This plot is empty. Future updates will allow colonization!");else s(l.id,l);else o("Your city data is still loading. Please wait a moment.")},onVillageClick:(e,n)=>{if(t)if(a("city"),t.islandId===n.islandId)if(l&&l[n.id])i("village",{...n,...l[n.id]});else{const e=_g(t,n);r({distance:e});const s={id:n.id,name:n.name,cityName:n.name,ownerId:null,ownerUsername:"Neutral",x:n.x,y:n.y,islandId:n.islandId,isVillageTarget:!0,troops:mC(n),level:n.level||1,demands:n.demands,supplies:n.supplies,tradeRatio:n.tradeRatio};i("city",s)}else o("You can only interact with villages on islands where you have a city.");else o("Your city data is still loading. Please wait a moment.")},onRuinClick:(e,n)=>{if(!t)return void o("Your city data is still loading. Please wait a moment.");a("city"),a("village");const s=_g(t,n);r({distance:s});const l=c&&c[n.id],u={id:n.id,name:n.name,cityName:n.name,ownerId:n.ownerId||"ruins",ownerUsername:n.ownerUsername||"Ancient Guardians",x:n.x,y:n.y,isRuinTarget:!0,troops:n.troops,researchReward:n.researchReward,isConqueredByYou:!!l};i("city",u)}}})({playerCity:M,currentUser:_,isPlacingDummyCity:z,handleCreateDummyCity:le,showCity:n,setTravelTimeInfo:ie,openModal:s,closeModal:r,setMessage:se,conqueredVillages:O,conqueredRuins:R,playerAlliance:U,activeCityId:$}),{availablePopulation:qe,happiness:We,marketCapacity:He}=(0,e.useMemo)(()=>{var e,t;if(null===E||void 0===E||!E.buildings)return{availablePopulation:0,happiness:0,marketCapacity:0};return{availablePopulation:ue(null===(e=E.buildings.farm)||void 0===e?void 0:e.level)-de(E.buildings,E.units,E.specialBuilding),happiness:he(E.buildings),marketCapacity:me(null===(t=E.buildings.market)||void 0===t?void 0:t.level)}},[E,ue,de,he,me]),Ge=(0,e.useMemo)(()=>E?fe(E.buildings):{wood:0,stone:0,silver:0},[E,fe]),Qe=(0,e.useMemo)(()=>{const e={...J};for(const t in D){const n=D[t];if(n&&n.slotId){const t=e[n.slotId]||{};e[n.slotId]={...t,...n,ownerId:_.uid,ownerUsername:T.username}}}return e},[J,D,_.uid,T.username]);(0,e.useEffect)(()=>{if("open_city_modal"===(null===C||void 0===C?void 0:C.type)){const{coords:e}=C,t=parseFloat(e.x),n=parseFloat(e.y),s=Object.values(Qe).find(e=>e.x===t&&e.y===n);s&&Ve(null,s),S(null)}},[C,S,Qe,Ve]);const Ye=(0,e.useMemo)(()=>({...Qe,...Z,...ee}),[Qe,Z,ee]),Ke=(0,e.useCallback)(async e=>{null!==T&&void 0!==T&&T.is_admin&&await dm(eh(Om,"worlds",P,"movements",e),{arrivalTime:new Date})},[T,P]),Xe=async(e,t)=>{const n=E;if(null===n||void 0===n||!n.god||(n.worship[n.god]||0)<e.favorCost)return void se("Not enough favor.");const s=Cm(Om),i=eh(Om,`users/${_.uid}/games`,P),a={...n.worship,[n.god]:n.worship[n.god]-e.favorCost};s.update(i,{worship:a});const o=!t,l=o?_.uid:t.ownerId,c=eh(Om,`users/${l}/games`,P),u=await om(c);if(!u.exists())return se("Target city's data not found."),await s.commit(),void A({...E,worship:a});const d=u.data();let h="",m="";switch(e.effect.type){case"add_resources":case"add_multiple_resources":{const t="add_resources"===e.effect.type?{[e.effect.resource]:e.effect.amount}:e.effect.resources,n={...d.resources};let r=[];for(const e in t)n[e]=(n[e]||0)+t[e],r.push(`${t[e]} ${e}`);s.update(c,{resources:n}),m=o?`You blessed yourself with ${r.join(" & ")}!`:`You blessed ${d.cityName} with ${r.join(" & ")}.`,o||(h=`Your city ${d.cityName} was blessed with ${r.join(" & ")} by ${T.username}!`);break}case"damage_building":{if(o)break;const t={...d.buildings},n=Object.keys(t).filter(e=>t[e].level>0);if(n.length>0){var p;const r=n[Math.floor(Math.random()*n.length)];t[r].level=Math.max(0,t[r].level-e.effect.amount),h=`Your ${null===(p=zm[r])||void 0===p?void 0:p.name} in ${d.cityName} was damaged by divine power from ${T.username}!`,m=`You damaged a building in ${d.cityName}.`,s.update(c,{buildings:t})}else m=`You tried to damage a building in ${d.cityName}, but there were none.`;break}default:return void se("Spell effect not implemented.")}const f={type:"spell_cast",title:`Spell cast: ${e.name}`,timestamp:km(),outcome:{message:m},read:!1};if(s.set(eh(Jd(Om,`users/${_.uid}/reports`)),f),!o){const e={type:"spell_received",title:"Divine Intervention!",timestamp:km(),outcome:{message:h,from:M.cityName},read:!1};s.set(eh(Jd(Om,`users/${l}/reports`)),e)}try{await s.commit(),se(`${e.name} has been cast!`),r("divinePowers"),A(o?(await om(i)).data():{...E,worship:a})}catch(g){console.error("Error casting spell:",g),se("Failed to cast spell.")}};(0,e.useEffect)(()=>{if(null===I||void 0===I||!I.islands||!Ae)return;const e={},t={};I.islands.forEach(n=>{e[n.id]=0,t[n.id]={}}),Object.values(Ae).forEach(n=>{if(n.islandId&&e.hasOwnProperty(n.islandId)&&(e[n.islandId]++,n.ownerId&&n.alliance)){const e=n.alliance;t[n.islandId][e]||(t[n.islandId][e]=0),t[n.islandId][e]++}});const n={};for(const s in e)if(e[s]>0)for(const r in t[s])t[s][r]===e[s]&&(n[s]=r);je(n)},[I,Ae]),(0,e.useEffect)(()=>{if(null===I||void 0===I||!I.islands||!Ae||!Z)return void Se({});const e={};I.islands.forEach(t=>{if(Oe.some(e=>e.islandId===t.id))return;const n=Math.round(t.x),s=Math.round(t.y);let r=null,i=null;for(let e=0;e<2*t.radius&&!r;e++)for(let a=-e;a<=e&&!r;a++)for(let o=-e;o<=e;o++){if(a*a+o*o>e*e)continue;const l=n+a,c=s+o;if(l<0||l>=I.width||c<0||c>=I.height)continue;if(Math.pow(l-t.x,2)+Math.pow(c-t.y,2)>Math.pow(t.radius,2))continue;if(Object.values(Ae).some(e=>e&&e.x===l&&e.y===c))continue;const u=Object.values(Z).some(e=>e&&e.x===l&&e.y===c);if(!u){r={x:l,y:c,islandId:t.id};break}i||(i={x:l,y:c,islandId:t.id})}const a=r||i;a&&(e[t.id]=a)}),Se(e)},[I,Ae,Z,Oe]);const Je=(0,e.useMemo)(()=>{if(null===I||void 0===I||!I.islands)return null;const e=Array(I.height).fill(null).map(()=>Array(I.width).fill({type:"water"}));I.islands.forEach(t=>{if(!t.imageName){const n=Math.round(t.x),s=Math.round(t.y);for(let r=-Math.floor(t.radius);r<=Math.ceil(t.radius);r++)for(let i=-Math.floor(t.radius);i<=Math.ceil(t.radius);i++)if(r*r+i*i<=t.radius*t.radius){const t=n+i,a=s+r;a>=0&&a<I.height&&t>=0&&t<I.width&&(e[a][t]={type:"land",data:{hasImage:!1}})}}});const t=(t,n)=>{Object.values(t).forEach(t=>{if(void 0!==t.x&&void 0!==t.y){const s=Math.round(t.x),r=Math.round(t.y);r>=0&&r<I.height&&s>=0&&s<I.width&&(e[r][s]&&"water"!==e[r][s].type||(e[r][s]={type:"land",data:{hasImage:!0}}),e[r][s]={type:n,data:{...t,...e[r][s].data}})}})};return t(Qe,"city_slot"),t(Z,"village"),Object.values(ee).forEach(t=>{var n;const s=Math.round(t.x),r=Math.round(t.y);null!==(n=e[r])&&void 0!==n&&n[s]&&(e[r][s]={type:"ruin",data:t})}),Object.values(Me).forEach(t=>{var n;const s=Math.round(t.x),r=Math.round(t.y);null!==(n=e[r])&&void 0!==n&&n[s]&&(e[r][s]={type:"god_town",data:t})}),Object.values(Ce).forEach(t=>{var n;null!==(n=e[t.y])&&void 0!==n&&n[t.x]&&(e[t.y][t.x]={type:"wonder_spot",data:t})}),Oe.forEach(t=>{var n;void 0!==t.x&&null!==(n=e[t.y])&&void 0!==n&&n[t.x]&&(e[t.y][t.x]={type:"constructing_wonder",data:t})}),e},[I,Qe,Z,ee,Me,Ce,Oe]),Ze=(0,e.useMemo)(()=>({...ve,...F}),[ve,F]);return(0,Lm.jsxs)("div",{className:"w-full h-screen flex flex-col bg-gray-900 map-view-wrapper relative",children:[v&&(0,Lm.jsx)("div",{className:"screen-glow-attack"}),(0,Lm.jsx)(Qg,{onOpenQuests:()=>s("quests"),quests:l}),(0,Lm.jsx)("div",{className:"flex-grow flex flex-row overflow-visible",children:(0,Lm.jsxs)("div",{className:"main-content flex-grow relative map-surface",children:[(0,Lm.jsx)(Hg,{view:"map",gameState:E,availablePopulation:qe,happiness:We,worldState:I,productionRates:Ge,getWarehouseCapacity:ge,movements:p,onCancelTrain:f,onCancelMovement:g,combinedSlots:Ye,onOpenMovements:()=>s("movements"),isUnderAttack:v,incomingAttackCount:y,onRenameCity:x,onSwitchCity:N,battlePoints:j}),(0,Lm.jsx)(Ig,{onToggleView:()=>{$?n($):se("No active city to view.")},view:"map",onOpenReports:()=>s("reports"),onOpenAlliance:()=>s("alliance"),onOpenForum:()=>s("allianceForum"),onOpenMessages:()=>s("messages"),onOpenSettings:()=>s("settings"),onOpenProfile:()=>s("profile"),onOpenLeaderboard:()=>s("leaderboard"),onOpenQuests:()=>s("quests"),unreadReportsCount:a,unreadMessagesCount:o,isAdmin:null===T||void 0===T?void 0:T.is_admin,onToggleDummyCityPlacement:()=>{q(e=>!e),se(z?"Dummy city placement OFF.":"Dummy city placement ON.")},isAllianceMember:!!U,handleOpenEvents:k}),(0,Lm.jsx)(og,{gameState:E,className:"absolute top-1/2 right-4 transform -translate-y-1/2 z-20 flex flex-col gap-4",onOpenPowers:()=>s("divinePowers")}),(0,Lm.jsx)(IC,{mouseCoords:we,pan:W,zoom:H,viewportSize:G,worldState:I,allCities:Qe,ruins:ee,playerAlliance:U}),(0,Lm.jsxs)("div",{className:"map-viewport",ref:V,onMouseDown:K,style:{cursor:Y?"grabbing":z?"crosshair":"grab"},children:[(0,Lm.jsx)("div",{className:"map-border top",style:{opacity:Q.top}}),(0,Lm.jsx)("div",{className:"map-border bottom",style:{opacity:Q.bottom}}),(0,Lm.jsx)("div",{className:"map-border left",style:{opacity:Q.left}}),(0,Lm.jsx)("div",{className:"map-border right",style:{opacity:Q.right}}),(0,Lm.jsx)("div",{className:"absolute inset-0 z-0",children:(0,Lm.jsxs)("div",{ref:B,className:"map-surface",style:{width:32*(null===I||void 0===I?void 0:I.width),height:32*(null===I||void 0===I?void 0:I.height),transformOrigin:"0 0"},children:[(null===I||void 0===I?void 0:I.islands)&&L.showVisuals&&I.islands.map(e=>e.imageName&&(0,Lm.jsx)("img",{src:UC[e.imageName],alt:e.name,style:{position:"absolute",left:32*(e.x-e.radius),top:32*(e.y-e.radius),width:2*e.radius*32,height:2*e.radius*32,pointerEvents:"none",zIndex:1}},e.id)),(0,Lm.jsx)("div",{style:{position:"relative",zIndex:2},children:(0,Lm.jsx)(lC,{mapGrid:Je,worldState:I,pan:W,zoom:H,viewportSize:G,onCitySlotClick:Ve,onVillageClick:Be,onRuinClick:ze,onGodTownClick:w,onWonderSpotClick:e=>{var t;(null===U||void 0===U||null===(t=U.leader)||void 0===t?void 0:t.uid)===_.uid?U.allianceWonder?se("Your alliance is already building a wonder elsewhere."):Te({islandId:e.islandId,coords:{x:e.x,y:e.y}}):se("Only the alliance leader can begin construction of a wonder.")},onConstructingWonderClick:e=>{if(U&&U.id===e.allianceId)Ee(e);else{const t=ip[e.id];$e({title:t.name,message:`Level ${e.level}. Being built by ${e.allianceName} [${e.allianceTag}].`})}},isPlacingDummyCity:z,movements:p,combinedSlots:Qe,villages:Z,ruins:ee,godTowns:Me,playerAlliance:U,conqueredVillages:O,gameSettings:L,cityPoints:Ze,scoutedCities:xe,controlledIslands:Ne})})]})})]})]})}),ne&&(0,Lm.jsx)(Sp,{message:ne,onClose:()=>se("")}),Le&&(0,Lm.jsx)(Sp,{title:Le.title,message:Le.message,onClose:()=>$e(null)}),(0,Lm.jsx)(_C,{modalState:i,closeModal:r,gameState:E,playerCity:M,travelTimeInfo:re,handleSendMovement:oe,handleCancelMovement:g,setMessage:se,goToCoordinates:X,handleActionClick:ae,worldId:P,movements:p,combinedSlots:Ye,villages:Z,handleRushMovement:Ke,userProfile:T,onCastSpell:Xe,onActionClick:u,marketCapacity:He,onEnterCity:e=>{N(e),n(),r("city")},onSwitchCity:N,onWithdraw:e=>{s("withdraw",e)}}),i.isDivinePowersOpen&&(0,Lm.jsx)(ug,{godName:E.god,playerReligion:E.playerInfo.religion,favor:E.worship[E.god]||0,onCastSpell:e=>Xe(e,i.divinePowersTarget),onClose:()=>r("divinePowers"),targetType:i.divinePowersTarget?"other":"self"}),i.isWithdrawModalOpen&&(0,Lm.jsx)(PC,{city:i.withdrawModalData,onClose:()=>r("withdraw"),onWithdrawTroops:ce}),_e&&(0,Lm.jsx)(MC,{onClose:()=>Te(null),..._e}),Ie&&(0,Lm.jsx)(DC,{onClose:()=>Ee(null)})]})},BC=e=>{let{message:t="Loading..."}=e;return(0,Lm.jsxs)("div",{className:"w-full h-screen flex flex-col items-center justify-center bg-gray-900 text-white",children:[(0,Lm.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"}),(0,Lm.jsx)("p",{className:"mt-4 text-lg font-semibold",children:t})]})},zC=t=>{let{isVisible:n,onClose:s}=t;const{currentUser:r,userProfile:i}=Fm(),{worldId:a}=up(),{playerAlliance:o}=sp(),[l,c]=(0,e.useState)([]),[u,d]=(0,e.useState)(""),[h,m]=(0,e.useState)("world"),p=(0,e.useRef)(null),[f,g]=(0,e.useState)({x:20,y:window.innerHeight-540}),[v,y]=(0,e.useState)(!1),[x,b]=(0,e.useState)({x:0,y:0}),w=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(!a)return;let e;if("world"===h)e=Jd(Om,"worlds",a,"chat");else{if("alliance"!==h||!o)return void c([]);e=Jd(Om,"worlds",a,"alliances",o.id,"chat")}const t=pm(Bh(e,Gh("timestamp","asc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));c(t)});return()=>t()},[a,h,o]),(0,e.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[l]);const k=(0,e.useCallback)(e=>{v&&g({x:e.clientX-x.x,y:e.clientY-x.y})},[v,x,g]),N=()=>{y(!1)};return(0,e.useEffect)(()=>(v?(window.addEventListener("mousemove",k),window.addEventListener("mouseup",N)):(window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",N)),()=>{window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",N)}),[v,k]),n?(0,Lm.jsxs)("div",{className:"chat-window",ref:w,style:{top:`${f.y}px`,left:`${f.x}px`},children:[(0,Lm.jsxs)("div",{className:"chat-header",onMouseDown:e=>{e.target.classList.contains("chat-header")&&(y(!0),b({x:e.clientX-f.x,y:e.clientY-f.y}))},children:[(0,Lm.jsx)("h4",{children:"Chat"}),(0,Lm.jsx)("button",{onClick:s,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"chat-tabs",children:[(0,Lm.jsx)("button",{className:"chat-tab "+("world"===h?"active":""),onClick:()=>m("world"),children:"World"}),(0,Lm.jsx)("button",{className:"chat-tab "+("alliance"===h?"active":""),onClick:()=>m("alliance"),disabled:!o,title:o?"Alliance Chat":"You are not in an alliance",children:"Alliance"})]}),(0,Lm.jsxs)("div",{className:"messages-container",children:[l.map(e=>(0,Lm.jsxs)("div",{className:"message "+(e.uid===r.uid?"sent":"received"),children:[(0,Lm.jsxs)("span",{className:"author",children:[e.authorName,":"]}),(0,Lm.jsx)("p",{children:e.text})]},e.id)),(0,Lm.jsx)("div",{ref:p})]}),(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),""===u.trim()||!a||!r||!i)return;let t;if("world"===h)t=Jd(Om,"worlds",a,"chat");else{if("alliance"!==h||!o)return;t=Jd(Om,"worlds",a,"alliances",o.id,"chat")}await mm(t,{text:u,timestamp:km(),uid:r.uid,authorName:i.username}),d("")},className:"send-message-form",children:[(0,Lm.jsx)("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"Type a message...",maxLength:"75"}),(0,Lm.jsx)("button",{type:"submit",children:"Send"})]})]}):null},qC=t=>{const{getHospitalCapacity:n}=lp(t),s=(0,e.useCallback)(async e=>{console.log(`Processing movement ID: ${e.id}`);const s={id:e.id,...e.data()};console.log("Full movement data:",JSON.stringify(s,null,2));const r=Cm(Om),i=eh(Om,`users/${s.originOwnerId}/games`,t,"cities",s.originCityId);let a;s.targetOwnerId&&s.targetCityId&&(a=eh(Om,`users/${s.targetOwnerId}/games`,t,"cities",s.targetCityId));const[o,l]=await Promise.all([om(i),a?om(a):Promise.resolve(null)]),c=eh(Om,`users/${s.originOwnerId}/games`,t),u=s.targetOwnerId?eh(Om,`users/${s.targetOwnerId}/games`,t):null,[d,h]=await Promise.all([om(c),u?om(u):Promise.resolve(null)]),m=d.exists()?d.data():{},p=null!==h&&void 0!==h&&h.exists()?h.data():{},f=m.alliance?om(eh(Om,"worlds",t,"alliances",m.alliance)):Promise.resolve(null),g=p.alliance?om(eh(Om,"worlds",t,"alliances",p.alliance)):Promise.resolve(null),[v,y]=await Promise.all([f,g]),x=null!==v&&void 0!==v&&v.exists()?{id:v.id,name:v.data().name}:null,b=null!==y&&void 0!==y&&y.exists()?{id:y.id,name:y.data().name}:null;if(!o.exists())return console.log(`Origin city ${s.originOwnerId} for owner ${s.originOwnerId} not found. Deleting movement.`),r.delete(e.ref),void await r.commit();const w=o.data();if("returning"===s.status){var k,N;console.log(`Movement ${s.id} is returning.`);const a={...w},o={...a.units};for(const e in s.units)o[e]=(o[e]||0)+s.units[e];if(s.hero){const e={...a.heroes||{}};e[s.hero]&&(e[s.hero].cityId=null),r.update(i,{heroes:e})}const l=(P=null===(k=a.buildings.warehouse)||void 0===k?void 0:k.level)?Math.floor(1500*Math.pow(1.4,P-1)):0,c={...a.resources};if(s.resources)for(const e in s.resources)c[e]=(c[e]||0)+s.resources[e];c.wood=Math.min(l,c.wood||0),c.stone=Math.min(l,c.stone||0),c.silver=Math.min(l,c.silver||0);const u={...a.wounded};let d=Object.values(u).reduce((e,t)=>e+t,0);const h=n((null===(N=a.buildings.hospital)||void 0===N?void 0:N.level)||0);if(s.wounded)for(const e in s.wounded){const t=s.wounded[e];if(d<h){const n=h-d,s=Math.min(n,t);u[e]=(u[e]||0)+s,d+=s}}const m={type:"return",title:`Troops returned to ${w.cityName}`,timestamp:km(),units:s.units,hero:s.hero||null,resources:s.resources||{},wounded:s.wounded||{},read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),m),r.update(i,{units:o,resources:c,wounded:u}),r.delete(e.ref),await r.commit(),console.log(`Movement ${s.id} processed and deleted.`)}else if("moving"===s.status){console.log(`Movement ${s.id} is moving with type: ${s.type}`);const n=null!==l&&void 0!==l&&l.exists()?l.data():null;switch(s.type){case"attack_god_town":{console.log(`Processing God Town attack: ${s.id}`);const n=eh(Om,"worlds",t,"godTowns",s.targetTownId),i=await om(n);if(!i.exists()||"city"!==i.data().stage){const t=s.arrivalTime.toMillis()-s.departureTime.toMillis(),n=new Date(s.arrivalTime.toDate().getTime()+t);r.update(e.ref,{status:"returning",arrivalTime:n,involvedParties:[s.originOwnerId]});break}const a=i.data(),o=pC(s.units,a.troops,{},!1),l=5*Object.values(o.defenderLosses).reduce((e,t)=>e+t,0),c=Math.max(0,(a.health||1e4)-l),u=Math.floor(l/10),d={wood:10*u,stone:10*u,silver:5*u},h=eh(Om,"worlds",t,"godTowns",s.targetTownId,"playerProgress",s.originOwnerId),m=await om(h),p=m.exists()?m.data().damageDealt:0;r.set(h,{damageDealt:p+l},{merge:!0});const f={type:"attack_god_town",title:`Attack on ${a.name}`,timestamp:km(),outcome:o,rewards:{warPoints:u,resources:d},read:!1};if(0===c)r.delete(n),f.rewards.message="You have vanquished the City of the Gods! It has vanished from the world.";else{const e={...a.troops};for(const t in o.defenderLosses)e[t]=Math.max(0,(e[t]||0)-o.defenderLosses[t]);r.update(n,{health:c,troops:e})}r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),f);const g={};for(const e in s.units){const t=s.units[e]-(o.attackerLosses[e]||0);t>0&&(g[e]=t)}const v=s.arrivalTime.toMillis()-s.departureTime.toMillis(),y=new Date(s.arrivalTime.toDate().getTime()+v);r.update(e.ref,{status:"returning",units:g,resources:d,arrivalTime:y,involvedParties:[s.originOwnerId]});break}case"attack_village":{console.log(`Processing village attack: ${s.id}`);const n=eh(Om,"worlds",t,"villages",s.targetVillageId),i=await om(n);if(!i.exists()){console.log(`Village ${s.targetVillageId} not found.`),r.delete(e.ref);const n={type:"attack_village",title:"Attack on missing village",timestamp:km(),outcome:{message:"The village was no longer there."},read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),n);break}const a=i.data(),o=mC(a),l=pC(s.units,o,a.resources,!1);if(console.log("Village combat resolved:",l),l.attackerWon){console.log("Attacker won. Conquering/farming village.");const e=eh(Om,`users/${s.originOwnerId}/games/${t}/conqueredVillages`,s.targetVillageId);r.set(e,{level:a.level,lastCollected:km(),happiness:100,happinessLastUpdated:km()},{merge:!0})}const c={...l};delete c.attackerBattlePoints,delete c.defenderBattlePoints;const u={type:"attack_village",title:`Attack on ${a.name}`,timestamp:km(),outcome:c,attacker:{cityId:s.originCityId,cityName:w.cityName,units:s.units,losses:l.attackerLosses,ownerId:s.originOwnerId,username:s.originOwnerUsername||"Unknown Player",allianceId:x?x.id:null,allianceName:x?x.name:null,x:w.x,y:w.y},defender:{villageId:s.targetVillageId,villageName:a.name,troops:o,losses:l.defenderLosses,x:a.x,y:a.y},read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),u);const d={};let h=!1;for(const e in s.units){const t=s.units[e]-(l.attackerLosses[e]||0)-(l.wounded[e]||0);t>0&&(d[e]=t,h=!0)}if(h||Object.keys(l.wounded).length>0){console.log("Survivors/wounded are returning.");const t=s.arrivalTime.toMillis()-s.departureTime.toMillis(),n=new Date(s.arrivalTime.toDate().getTime()+t);r.update(e.ref,{status:"returning",units:d,resources:l.plunder,wounded:l.wounded,arrivalTime:n,involvedParties:[s.originOwnerId]})}else console.log("No survivors. Deleting movement."),r.delete(e.ref);break}case"attack_ruin":{console.log(`Processing ruin attack: ${s.id}`);const n=eh(Om,"worlds",t,"ruins",s.targetRuinId),a=await om(n);if(!a.exists()){console.log(`Ruin ${s.targetRuinId} not found.`),r.delete(e.ref);const n={type:"attack_ruin",title:"Attack on vanished ruins",timestamp:km(),outcome:{message:"The ruins crumbled into the sea before your fleet arrived."},read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),n);break}const o=a.data();if(o.ownerId){r.delete(e.ref);break}const l=pC(s.units,o.troops,{},!0);if(l.attackerBattlePoints>0){const e=eh(Om,`users/${s.originOwnerId}/games`,t),n=await om(e);if(n.exists()){const t=n.data().battlePoints||0;r.update(e,{battlePoints:t+l.attackerBattlePoints})}}if(l.attackerWon){const e={...w};e.research||(e.research={}),e.research[o.researchReward]=!0,r.update(i,{research:e.research}),r.update(n,{ownerId:s.originOwnerId,ownerUsername:s.originOwnerUsername});const a=eh(Om,`users/${s.originOwnerId}/games/${t}/conqueredRuins`,s.targetRuinId);r.set(a,{conqueredAt:km(),researchReward:o.researchReward})}else{const e={...o.troops};for(const t in l.defenderLosses)e[t]=Math.max(0,(e[t]||0)-l.defenderLosses[t]);r.update(n,{troops:e})}const c={type:"attack_ruin",title:`Attack on ${o.name}`,timestamp:km(),outcome:l,attacker:{cityId:s.originCityId,cityName:w.cityName,units:s.units,losses:l.attackerLosses,ownerId:s.originOwnerId,username:s.originOwnerUsername||"Unknown Player",allianceId:x?x.id:null,allianceName:x?x.name:null,x:w.x,y:w.y},defender:{ruinId:s.targetRuinId,ruinName:o.name,troops:o.troops,losses:l.defenderLosses,x:o.x,y:o.y},reward:l.attackerWon?o.researchReward:null,read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),c);const u={};let d=!1;for(const e in s.units){const t=s.units[e]-(l.attackerLosses[e]||0)-(l.wounded[e]||0);t>0&&(u[e]=t,d=!0)}if(d||Object.keys(l.wounded).length>0){const t=s.arrivalTime.toMillis()-s.departureTime.toMillis(),n=new Date(s.arrivalTime.toDate().getTime()+t);r.update(e.ref,{status:"returning",units:u,wounded:l.wounded,arrivalTime:n,involvedParties:[s.originOwnerId]})}else r.delete(e.ref);break}case"attack":{var j,C;if(!n){console.log(`Target game state not found for movement ${s.id}. Deleting.`),r.delete(e.ref);break}const o=pC(s.units,n.units,n.resources,!!s.isCrossIsland,null===(j=s.attackFormation)||void 0===j?void 0:j.front,null===(C=s.attackFormation)||void 0===C?void 0:C.mid,null,null,s.hero,Object.keys(n.heroes||{}).find(e=>n.heroes[e].cityId===s.targetCityId)||null);if(o.capturedHero){const{heroId:e,capturedBy:t}=o.capturedHero,l={captureId:tp(),heroId:e,capturedAt:km()};if("attacker"===t){var S,_;l.ownerId=s.targetOwnerId,l.ownerUsername=s.ownerUsername,l.originCityName=s.targetCityName;const e=(null===(S=w.buildings.prison)||void 0===S?void 0:S.level)||0,t=e>0?e+4:0,n=(null===(_=w.prisoners)||void 0===_?void 0:_.length)||0;e>0&&n<t&&r.update(i,{prisoners:Nm(l)})}else{var T,I;l.ownerId=s.originOwnerId,l.ownerUsername=s.originOwnerUsername,l.originCityName=s.originCityName;const e=(null===(T=n.buildings.prison)||void 0===T?void 0:T.level)||0,t=e>0?e+4:0,i=(null===(I=n.prisoners)||void 0===I?void 0:I.length)||0;e>0&&i<t&&r.update(a,{prisoners:Nm(l)})}}await wm(Om,async e=>{const n=eh(Om,`users/${s.originOwnerId}/games`,t),r=eh(Om,`users/${s.targetOwnerId}/games`,t),i=await e.get(n),a=await e.get(r);if(i.exists()&&o.attackerBattlePoints>0){const t=i.data().battlePoints||0;e.update(n,{battlePoints:t+o.attackerBattlePoints})}if(a.exists()&&o.defenderBattlePoints>0){const t=a.data().battlePoints||0;e.update(r,{battlePoints:t+o.defenderBattlePoints})}});const l={...n.units};for(const e in o.defenderLosses)l[e]=Math.max(0,(l[e]||0)-o.defenderLosses[e]);const c={...n.resources};o.attackerWon&&(c.wood=Math.max(0,c.wood-o.plunder.wood),c.stone=Math.max(0,c.stone-o.plunder.stone),c.silver=Math.max(0,c.silver-o.plunder.silver));const u={};for(const e in s.units){const t=s.units[e]-(o.attackerLosses[e]||0)-(o.wounded[e]||0);t>0&&(u[e]=t)}const d=Object.keys(u).some(e=>{const t=qm[e];return t&&("land"===t.type||t.mythical)}),h={type:"attack",title:`Attack on ${n.cityName}`,timestamp:km(),outcome:o,attacker:{cityId:s.originCityId,cityName:w.cityName,units:s.units,hero:s.hero||null,losses:o.attackerLosses,ownerId:s.originOwnerId,username:s.originOwnerUsername||"Unknown Player",allianceId:x?x.id:null,allianceName:x?x.name:null,x:w.x,y:w.y},defender:{cityId:s.targetCityId,cityName:n.cityName,units:d?n.units:{},hero:Object.keys(n.heroes||{}).find(e=>n.heroes[e].cityId===s.targetCityId)||null,losses:d?o.defenderLosses:{},ownerId:s.targetOwnerId,username:s.ownerUsername||"Unknown Player",allianceId:b?b.id:null,allianceName:b?b.name:null,x:n.x,y:n.y},read:!1};d||(h.outcome.message="Your forces were annihilated. No information could be gathered from the battle.");const m={...h,title:`Defense against ${w.cityName}`,read:!1,outcome:{...o,attackerWon:!o.attackerWon},defender:{cityId:s.targetCityId,cityName:n.cityName,units:n.units,hero:Object.keys(n.heroes||{}).find(e=>n.heroes[e].cityId===s.targetCityId)||null,losses:o.defenderLosses,ownerId:s.targetOwnerId,username:s.ownerUsername||"Unknown Player",allianceId:b?b.id:null,allianceName:b?b.name:null,x:n.x,y:n.y}};if(r.update(a,{units:l,resources:c}),r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),h),s.targetOwnerId&&r.set(eh(Jd(Om,`users/${s.targetOwnerId}/worlds/${t}/reports`)),m),Object.keys(u).length>0||Object.keys(o.wounded).length>0){const t=s.arrivalTime.toMillis()-s.departureTime.toMillis(),n=new Date(s.arrivalTime.toDate().getTime()+t);r.update(e.ref,{status:"returning",units:u,resources:o.plunder,wounded:o.wounded,arrivalTime:n,involvedParties:[s.originOwnerId]})}else r.delete(e.ref);break}case"scout":{var E;if(!n){console.log(`Target game state not found for movement ${s.id}. Deleting.`),r.delete(e.ref);break}const i=(null===(E=s.resources)||void 0===E?void 0:E.silver)||0,o=function(e,t){var n;const s=(t+1)/(t+2*((null===(n=e.cave)||void 0===n?void 0:n.silver)||0)+1);var r;return Math.random()<s&&s>.5?{success:!0,message:"Scouting successful! Detailed report obtained.",targetCityName:e.cityName,targetOwnerUsername:(null===(r=e.playerInfo)||void 0===r?void 0:r.username)||"Unknown",resources:{...e.resources},units:{...e.units},buildings:{...e.buildings},god:e.god||"None"}:{success:!1,message:"Scouting failed! Your spy was detected.",silverGained:Math.floor(.5*t)}}(n,i);if(o.success){const e={type:"scout",title:`Scout report of ${n.cityName}`,timestamp:km(),scoutSucceeded:!0,...o,targetOwnerUsername:s.ownerUsername,attacker:{cityId:s.originCityId,cityName:w.cityName,ownerId:s.originOwnerId,username:s.originOwnerUsername,allianceId:x?x.id:null,allianceName:x?x.name:null,x:w.x,y:w.y},defender:{cityId:s.targetCityId,cityName:n.cityName,ownerId:s.targetOwnerId,username:s.ownerUsername,allianceId:b?b.id:null,allianceName:b?b.name:null,x:n.x,y:n.y},read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),e)}else{var A;const e={type:"scout",title:`Scouting ${n.cityName} failed`,timestamp:km(),scoutSucceeded:!1,message:o.message,read:!1};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),e);const i={...n.cave,silver:((null===(A=n.cave)||void 0===A?void 0:A.silver)||0)+o.silverGained};r.update(a,{cave:i});const l={type:"spy_caught",title:`Caught a spy from ${w.cityName}!`,timestamp:km(),originCity:w.cityName,silverGained:o.silverGained,read:!1};r.set(eh(Jd(Om,`users/${s.targetOwnerId}/worlds/${t}/reports`)),l)}r.delete(e.ref);break}case"reinforce":{if(!n||!s.targetSlotId){console.log(`Target game state or slot ID not found for movement ${s.id}. Deleting.`),r.delete(e.ref);break}const i=eh(Om,"worlds",t,"citySlots",s.targetSlotId);await wm(Om,async r=>{const o=await r.get(a),l=await r.get(i);if(!o.exists()||!l.exists())throw new Error("Target city or slot data not found.");const c={...o.data().reinforcements||{}},u=s.originCityId;c[u]||(c[u]={ownerId:s.originOwnerId,originCityName:s.originCityName,units:{}});for(const e in s.units)c[u].units[e]=(c[u].units[e]||0)+s.units[e];r.update(a,{reinforcements:c}),r.update(i,{reinforcements:c});const d={type:"reinforce",title:`Reinforcement to ${n.cityName}`,timestamp:km(),units:s.units,read:!1,originCityName:w.cityName,targetCityName:n.cityName,originPlayer:{username:s.originOwnerUsername,id:s.originOwnerId,cityId:s.originCityId,x:w.x,y:w.y},targetPlayer:{username:s.ownerUsername,id:s.targetOwnerId,cityId:s.targetCityId,x:n.x,y:n.y}};if(r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),d),s.targetOwnerId){const e={...d,title:`Reinforcements from ${w.cityName}`};r.set(eh(Jd(Om,`users/${s.targetOwnerId}/worlds/${t}/reports`)),e)}r.delete(e.ref)});break}case"trade":{if(!n){console.log(`Target game state not found for movement ${s.id}. Deleting.`),r.delete(e.ref);break}const i={...n.resources};for(const e in s.resources)i[e]=(i[e]||0)+s.resources[e];r.update(a,{resources:i});const o={type:"trade",title:`Trade to ${n.cityName}`,timestamp:km(),resources:s.resources,read:!1,originCityName:w.cityName,targetCityName:n.cityName,originPlayer:{username:s.originOwnerUsername,id:s.originOwnerId,cityId:s.originCityId,x:w.x,y:w.y},targetPlayer:{username:s.ownerUsername,id:s.targetOwnerId,cityId:s.targetCityId,x:n.x,y:n.y}};r.set(eh(Jd(Om,`users/${s.originOwnerId}/worlds/${t}/reports`)),o);const l={type:"trade",title:`Trade from ${w.cityName}`,timestamp:km(),resources:s.resources,read:!1,originCityName:w.cityName,targetCityName:n.cityName,originPlayer:{username:s.originOwnerUsername,id:s.originOwnerId,cityId:s.originCityId,x:w.x,y:w.y},targetPlayer:{username:s.ownerUsername,id:s.targetOwnerId,cityId:s.targetCityId,x:n.x,y:n.y}};r.set(eh(Jd(Om,`users/${s.targetOwnerId}/worlds/${t}/reports`)),l),r.delete(e.ref);break}default:console.log(`Unknown movement type: ${s.type}. Deleting movement ${s.id}`),r.delete(e.ref)}}var P;await r.commit(),console.log(`Batch commit successful for movement ${s.id}`)},[t,n]);(0,e.useEffect)(()=>{const e=setInterval(async()=>{if(!t)return;const e=Bh(Jd(Om,"worlds",t,"movements"),qh("arrivalTime","<=",new Date)),n=await cm(e);if(!n.empty){console.log(`Found ${n.docs.length} arrived movements to process.`);for(const e of n.docs)try{await s(e)}catch(r){console.error("Error processing movement:",e.id,r)}}},5e3);return()=>clearInterval(e)},[t,s])},WC=JSON.parse('{"build_timber_camp_2":{"title":"First Steps","description":"Secure your wood supply by upgrading your Timber Camp.","type":"building","targetId":"timber_camp","targetLevel":2,"rewards":{"resources":{"wood":100}}},"build_timber_camp_5":{"title":"Woody","description":"Get that wood.","type":"building","targetId":"timber_camp","targetLevel":5,"rewards":{"resources":{"wood":200}}}}'),HC=t=>{const{currentUser:n}=Fm(),{worldId:s,activeCityId:r}=up(),[i,a]=(0,e.useState)(null),[o,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!1);(0,e.useEffect)(()=>{if(!n||!s)return;const e=eh(Om,`users/${n.uid}/games/${s}/quests`,"progress"),t=pm(e,t=>{if(t.exists())a(t.data());else{const t={completed:{},claimed:{}};um(e,t).then(()=>{a(t)})}});return()=>t()},[n,s]),(0,e.useEffect)(()=>{if(!t||!i)return void l([]);const e=Object.entries(WC).map(e=>{var n;let[s,r]=e,a=!1;if(i.completed[s])a=!0;else switch(r.type){case"building":(null===(n=t.buildings[r.targetId])||void 0===n?void 0:n.level)>=r.targetLevel&&(a=!0);break;case"units":const e=Object.entries(t.units||{}).reduce((e,t)=>{let[n,s]=t;return(e=>{for(const t in Rp)for(const n in Rp[t])if(Rp[t][n]===e)return n;return null})(n)===r.targetId||n===r.targetId?e+s:e},0);e>=r.targetCount&&(a=!0)}return{id:s,...r,isComplete:a,isClaimed:!!i.claimed[s]}});l(e)},[t,i]);const d=(0,e.useCallback)(async e=>{if(c)return;if(!n||!s||!r)return;const t=o.find(t=>t.id===e);if(!t||!t.isComplete||t.isClaimed)return void console.error("Quest not available for claiming.");u(!0);const i=eh(Om,`users/${n.uid}/games/${s}/cities`,r),a=eh(Om,`users/${n.uid}/games/${s}/quests`,"progress");try{await wm(Om,async n=>{var s,r;const o=await n.get(i),l=await n.get(a);if(!o.exists()||!l.exists())throw new Error("City or quest data not found.");const c=o.data(),u=l.data(),d=(h=null===(s=c.buildings.warehouse)||void 0===s?void 0:s.level)?Math.floor(1500*Math.pow(1.4,h-1)):0;var h;const m={...c.resources},p={...c.units},f=null===(r=c.playerInfo)||void 0===r?void 0:r.nation;if(t.rewards.resources)for(const e in t.rewards.resources)m[e]=Math.min(d,(m[e]||0)+t.rewards.resources[e]);if(t.rewards.units)for(const e in t.rewards.units)if(e.startsWith("generic_")){if(!f){console.error("Player nation not found for generic unit reward.");continue}const n=Lp(f,e);p[n]=(p[n]||0)+t.rewards.units[e]}else p[e]=(p[e]||0)+t.rewards.units[e];const g={...u};g.claimed[e]=!0,g.completed[e]||(g.completed[e]=!0),n.update(i,{resources:m,units:p}),n.set(a,g)})}catch(l){console.error("Error claiming quest reward:",l)}finally{u(!1)}},[n,s,r,o,c]);return{quests:o,claimReward:d,isClaiming:c}},GC=e=>{if(!e)return"";let t=e;return t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=t.replace(/\n/g,"<br />"),t=t.replace(/\[b\](.*?)\[\/b\]/gs,"<strong>$1</strong>"),t=t.replace(/\[i\](.*?)\[\/i\]/gs,"<em>$1</em>"),t=t.replace(/\[u\](.*?)\[\/u\]/gs,"<u>$1</u>"),t=t.replace(/\[color=(.*?)\](.*?)\[\/color\]/gs,'<span style="color: $1;">$2</span>'),t=t.replace(/\[size=(.*?)\](.*?)\[\/size\]/gs,'<span style="font-size: $1px;">$2</span>'),t=t.replace(/\[quote\](.*?)\[\/quote\]/gs,'<blockquote class="bbcode-quote">$1</blockquote>'),t=t.replace(/\[spoiler\](.*?)\[\/spoiler\]/gs,"<details><summary>Spoiler</summary>$1</details>"),t=t.replace(/\[img\](.*?)\[\/img\]/gs,'<img src="$1" alt="User Image" style="max-width: 100%;" />'),t=t.replace(/\[url\](.*?)\[\/url\]/gs,'<a href="$1" target="_blank">$1</a>'),t=t.replace(/\[url=(.*?)\](.*?)\[\/url\]/gs,'<a href="$1" target="_blank">$2</a>'),t=t.replace(/\[action=([^,\]]+),allianceId=([^\]]+)\](.*?)\[\/action\]/gs,(e,t,n,s)=>`<span class="bbcode-action" data-action-type="${t}" data-action-id="${n}">${s}</span>`),t=t.replace(/\[report\](.*?)\[\/report\]/gs,'<div class="shared-report-placeholder" data-report-id="$1"></div>'),t=t.replace(/\[player id=([^\]]+)\](.*?)\[\/player\]/gs,'<span class="bbcode-action" data-action-type="profile" data-action-id="$1">$2</span>'),t=t.replace(/\[alliance id=([^\]]+)\](.*?)\[\/alliance\]/gs,'<span class="bbcode-action" data-action-type="alliance_profile" data-action-id="$1">$2</span>'),t=t.replace(/\[city id=([^ ]+) owner=([^ ]+) x=([\d.]+) y=([\d.]+)\](.*?)\[\/city\]/gs,'<span class="bbcode-action" data-action-type="city_link" data-action-id="$1" data-action-owner-id="$2" data-action-coords-x="$3" data-action-coords-y="$4">$5</span>'),t=t.replace(/\[attack attacker="([^"]*)" attacker_city="([^"]*)" defender="([^"]*)" defender_city="([^"]*)"\]/gs,"<b>Attack Report</b><br/>Attacker: $1 ($2)<br/>Defender: $3 ($4)"),t=t.replace(/\[trade from_player="([^"]*)" from_city="([^"]*)" to_player="([^"]*)" to_city="([^"]*)"\]/gs,"<b>Trade Report</b><br/>From: $1 ($2)<br/>To: $3 ($4)"),t=t.replace(/\[scout attacker="([^"]*)" attacker_city="([^"]*)" attacker_alliance="([^"]*)" defender="([^"]*)" defender_city="([^"]*)" defender_alliance="([^"]*)"\]/gs,"<b>Scout Report</b><br/>Scout from: $1 ($2) [$3]<br/>Scouted: $4 ($5) [$6]"),t},QC={};[n(3542),n(634),n(326),n(5316),n(4731)].forEach(e=>{e.keys().forEach(t=>{const n=e.id.includes("/resources")?`resources/${t.replace("./","")}`:e.id.includes("/buildings")?`buildings/${t.replace("./","")}`:e.id.includes("/gods")?`gods/${t.replace("./","")}`:e.id.includes("/heroes")?`heroes/${t.replace("./","")}`:t.replace("./","");QC[n]=e(t)})});const YC=t=>{let{onClose:n,onActionClick:s}=t;const{currentUser:r}=Fm(),{worldId:i,gameSettings:a}=up(),[o,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(null),[d,h]=(0,e.useState)("Combat"),[m,p]=(0,e.useState)(""),f={Combat:["attack","attack_village","attack_ruin","attack_god_town"],Reinforce:["reinforce"],Trade:["trade"],Scout:["scout","spy_caught"],Misc:["return","spell_cast","spell_received","spell_fail"]};(0,e.useEffect)(()=>{if(!r||!i)return;const e=pm(Bh(Jd(Om,"users",r.uid,"worlds",i,"reports"),Gh("timestamp","desc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));l(t)});return()=>e()},[r,i]);const g=e=>{var t;switch(e.type){case"attack":case"attack_village":case"attack_ruin":case"attack_god_town":return null!==(t=e.outcome)&&void 0!==t&&t.attackerWon?"text-green-600":"text-red-600";case"scout":return e.scoutSucceeded?"text-green-600":"text-red-600";case"spy_caught":case"spell_fail":return"text-red-600";case"spell_cast":case"spell_received":return"text-purple-600";case"return":case"reinforce":return"text-blue-600";case"trade":return"text-yellow-600";default:return"text-gray-800"}},v=e=>{let t=e.title||"Untitled Report";var n;"attack"!==e.type&&"attack_village"!==e.type&&"attack_ruin"!==e.type&&"attack_god_town"!==e.type||(t+=null!==(n=e.outcome)&&void 0!==n&&n.attackerWon?" (Victory)":" (Defeat)");return t},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||0===Object.keys(e).length)return"None";const n=Object.entries(e).map(e=>{var t;let[n,s]=e;return`${s} ${(null===(t=qm[n])||void 0===t?void 0:t.name)||n}`}).join(", ");return t?(0,Lm.jsx)("span",{className:"text-red-600 font-semibold",children:n}):n},x=e=>e&&QC[e]?QC[e]:(console.warn(`Image not found: ${e}`),""),b=e=>e&&0!==Object.keys(e).length?(0,Lm.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:Object.entries(e).map(e=>{let[t,n]=e;if(n>0){const e=qm[t],s=x((null===e||void 0===e?void 0:e.image)||"");return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[s&&(0,Lm.jsx)("img",{src:s,alt:(null===e||void 0===e?void 0:e.name)||t,className:"w-8 h-8"}),(0,Lm.jsx)("span",{className:"text-sm",children:n})]},t)}return null})}):null,w=e=>{if(!e)return null;const t=Hm[e];if(!t)return null;const n=x(`heroes/${t.image}`);return(0,Lm.jsxs)("div",{className:"flex flex-col items-center mt-2",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Hero"}),(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[n&&(0,Lm.jsx)("img",{src:n,alt:t.name,className:"w-10 h-10"}),(0,Lm.jsx)("span",{className:"text-sm",children:t.name})]})]})},k=e=>Object.entries(e||{}).map(e=>{let[t,n]=e;const s=x(`resources/${t}.png`);return(0,Lm.jsxs)("div",{className:"flex flex-col items-center mx-2",children:[s&&(0,Lm.jsx)("img",{src:s,alt:t,className:"w-8 h-8"}),(0,Lm.jsx)("span",{className:"text-sm",children:Math.floor(n)})]},t)}),N=o.filter(e=>{var t;return(!a.hideReturningReports||"return"!==e.type)&&(null===(t=f[d])||void 0===t?void 0:t.includes(e.type))});return(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,Lm.jsxs)("div",{className:"reports-container",children:[(0,Lm.jsx)("div",{className:"reports-header",children:(0,Lm.jsx)("button",{onClick:n,className:"close-btn",children:"\xd7"})}),(0,Lm.jsxs)("div",{className:"flex flex-grow overflow-hidden",children:[(0,Lm.jsxs)("div",{className:"w-1/3 border-r-2 border-[#8B4513] flex flex-col",children:[(0,Lm.jsx)("div",{className:"reports-tabs",children:Object.keys(f).map(e=>{const t=o.filter(t=>f[e].includes(t.type)&&!t.read).length,n=t>0;return(0,Lm.jsxs)("button",{onClick:()=>(e=>{h(e),u(null)})(e),className:`tab-btn ${d===e?"active":""} ${n?"glowing-tab":""}`,children:[e,n&&(0,Lm.jsx)("span",{className:"tab-badge",children:t})]},e)})}),(0,Lm.jsx)("ul",{className:"overflow-y-auto reports-list",children:N.length>0?N.map(e=>{var t;return(0,Lm.jsxs)("li",{className:`report-item ${c&&c.id===e.id?"selected":""} ${e.read?"":"unread"}`,onClick:()=>(async e=>{if(u(e),!e.read){const t=eh(Om,"users",r.uid,"worlds",i,"reports",e.id);await dm(t,{read:!0})}})(e),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsx)("span",{className:`truncate pr-2 ${g(e)}`,children:v(e)}),(0,Lm.jsxs)("div",{className:"flex gap-2",children:[(0,Lm.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{p("");try{const t=eh(Om,"worlds",i,"shared_reports",e.id);await um(t,e);let n=`[report]${e.id}[/report]`;if("attack"===e.type||"attack_village"===e.type||"attack_ruin"===e.type||"attack_god_town"===e.type){const t=e.attacker||{},s=e.defender||{},r=s.username||s.villageName||s.ruinName||"The Gods",i=s.cityName||s.villageName||s.ruinName||"City of the Gods";n=`[attack attacker="${t.username}" attacker_city="${t.cityName}" defender="${r}" defender_city="${i}"][/attack]`}else if("trade"===e.type){const t=e.originPlayer||{},s=e.targetPlayer||{};n=`[trade from_player="${t.username}" from_city="${e.originCityName}" to_player="${s.username}" to_city="${e.targetCityName}"][/trade]`}else if("scout"===e.type&&e.scoutSucceeded){const t=e.attacker||{},s=e.defender||{};n=`[scout attacker="${t.username}" attacker_city="${t.cityName}" attacker_alliance="${t.allianceName||"N/A"}" defender="${s.username}" defender_city="${s.cityName}" defender_alliance="${s.allianceName||"N/A"}"][/scout]`}navigator.clipboard.writeText(n),p("Report shared! BBCode copied to clipboard."),setTimeout(()=>p(""),3e3)}catch(t){console.error("Error sharing report:",t),p("Failed to share report.")}})(e)},className:"text-blue-500 hover:text-blue-400",children:"Share"}),(0,Lm.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{const t=eh(Om,"users",r.uid,"worlds",i,"reports",e);await hm(t),c&&c.id===e&&u(null)})(e.id)},className:"delete-btn",children:"\xd7"})]})]}),(0,Lm.jsx)("p",{className:"text-xs text-gray-500",children:null===(t=e.timestamp)||void 0===t?void 0:t.toDate().toLocaleString()})]},e.id)}):(0,Lm.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No reports in this category."})})]}),(0,Lm.jsxs)("div",{className:"w-2/3 p-4 overflow-y-auto report-outcome-container",onClick:e=>{const t=e.target;if(t.classList.contains("bbcode-action")&&s){let{actionType:e,actionId:n,actionOwnerId:r,actionCoordsX:i,actionCoordsY:a}=t.dataset;s(e,"city_link"===e?{cityId:n,ownerId:r,coords:{x:i,y:a}}:n||{x:i,y:a})}},children:[m&&(0,Lm.jsx)("p",{className:"text-center text-green-500 mb-2",children:m}),c?(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"text-lg font-bold mb-2",children:c.title||"Report Details"}),(0,Lm.jsx)("div",{className:"space-y-2",children:(e=>{var t,n,s;const r=e.outcome||{},i=e.attacker||{},a=e.defender||{};switch(e.type){case"attack_god_town":case"attack":case"attack_village":const l=e.title.startsWith("Attack")?r.attackerBattlePoints:r.defenderBattlePoints;return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-2xl mb-4 "+(r.attackerWon?"text-green-600":"text-red-600"),children:r.attackerWon?"Victory!":"Defeat!"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[(0,Lm.jsxs)("div",{className:"flex flex-col items-center w-1/3",children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",dangerouslySetInnerHTML:{__html:GC(`[city id=${i.cityId} owner=${i.ownerId} x=${i.x} y=${i.y}]${i.cityName}[/city]`)}}),(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[player id=${i.ownerId}]${i.username}[/player]`)}}),i.allianceId&&(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[alliance id=${i.allianceId}]${i.allianceName||i.allianceId}[/alliance]`)}})]}),(0,Lm.jsx)("div",{className:"w-1/3 text-center",children:(0,Lm.jsx)("img",{src:x("swordman.png"),alt:"Attack Icon",className:"mx-auto h-12 w-auto"})}),(0,Lm.jsx)("div",{className:"flex flex-col items-center w-1/3",children:a.cityName?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",dangerouslySetInnerHTML:{__html:GC(`[city id=${a.cityId} owner=${a.ownerId} x=${a.x} y=${a.y}]${a.cityName}[/city]`)}}),(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[player id=${a.ownerId}]${a.username}[/player]`)}}),a.allianceId&&(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[alliance id=${a.allianceId}]${a.allianceName||a.allianceId}[/alliance]`)}})]}):(0,Lm.jsx)("p",{className:"font-bold text-lg",children:a.villageName||a.ruinName||"Unknown Target"})})]}),(0,Lm.jsxs)("div",{className:"w-full grid grid-cols-2 gap-4 text-sm mt-4",children:[(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Attacker Units"}),b(i.units),w(i.hero),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",y(r.attackerLosses,!0)]}),r.wounded&&Object.keys(r.wounded).length>0&&(0,Lm.jsxs)("p",{className:"mt-2 text-orange-600",children:[(0,Lm.jsx)("strong",{children:"Wounded:"})," ",y(r.wounded)]})]}),(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Defender Units"}),r.message?(0,Lm.jsx)("p",{className:"text-gray-500 italic",children:"Unknown"}):(0,Lm.jsxs)(Lm.Fragment,{children:[b(a.units||a.troops),w(a.hero),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",y(r.defenderLosses,!0)]})]})]})]}),r.attackerWon&&r.plunder&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-green-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-green-700 mb-2",children:"Plundered Resources"}),(0,Lm.jsx)("div",{className:"flex justify-center",children:k(r.plunder)})]}),r.capturedHero&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-red-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-red-700 mb-2",children:"Hero Captured!"}),(0,Lm.jsxs)("p",{children:[null===(t=Hm[r.capturedHero.heroId])||void 0===t?void 0:t.name," was captured by the ",r.capturedHero.capturedBy,"."]})]}),"number"===typeof l&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-blue-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-blue-700 mb-2",children:"Battle Points Gained"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-center",children:[(0,Lm.jsx)("img",{src:wg,alt:"Battle Points",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("p",{children:l.toLocaleString()})]})]}),(0,Lm.jsx)("p",{className:"text-gray-500 mt-4 italic",children:r.message||""})]});case"attack_ruin":return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-2xl mb-4 "+(r.attackerWon?"text-green-600":"text-red-600"),children:r.attackerWon?"Victory!":"Defeat!"}),(0,Lm.jsxs)("div",{className:"w-full grid grid-cols-2 gap-4 text-sm mt-4",children:[(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Attacker Units"}),b(i.units),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",y(r.attackerLosses,!0)]})]}),(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Guardian Units"}),b(a.troops),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",y(r.defenderLosses,!0)]})]})]}),"number"===typeof r.attackerBattlePoints&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-blue-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-blue-700 mb-2",children:"Battle Points Gained"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-center",children:[(0,Lm.jsx)("img",{src:wg,alt:"Battle Points",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("p",{children:r.attackerBattlePoints.toLocaleString()})]})]}),e.reward&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-green-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-green-700 mb-2",children:"Research Unlocked!"}),(0,Lm.jsx)("p",{children:null===(n=uC[e.reward])||void 0===n?void 0:n.name})]})]});case"scout":const c=e.god&&e.playerReligion?null===(s=lf[e.playerReligion.toLowerCase()])||void 0===s?void 0:s[e.god]:null;return(0,Lm.jsx)("div",{className:"space-y-3",children:e.scoutSucceeded?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"font-bold text-green-600 text-lg",children:"Scout Successful!"}),c&&(0,Lm.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"Worshipped God:"})," ",c.name]}),(0,Lm.jsx)("img",{src:x(`gods/${c.image}`),alt:c.name,className:"w-8 h-8"})]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Resources:"}),(0,Lm.jsx)("div",{className:"flex flex-wrap gap-2",children:k(e.resources)})]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Units:"}),b(e.units)]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Buildings:"}),(o=e.buildings,o&&0!==Object.keys(o).length?(0,Lm.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:Object.entries(o).map(e=>{let[t,n]=e;if(n.level>0){const e=zm[t],s=x(`buildings/${null===e||void 0===e?void 0:e.image}`||"");return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[s&&(0,Lm.jsx)("img",{src:s,alt:(null===e||void 0===e?void 0:e.name)||t,className:"w-8 h-8"}),(0,Lm.jsxs)("span",{className:"text-sm",children:[(null===e||void 0===e?void 0:e.name)||t," (Lvl ",n.level,")"]})]},t)}return null})}):null)]})]}):(0,Lm.jsx)("p",{className:"font-bold text-red-600",children:e.message||"Scout Failed!"})});case"spell_cast":case"spell_received":case"spell_fail":return(0,Lm.jsxs)("div",{className:"space-y-2 text-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",children:e.title}),(0,Lm.jsx)("p",{children:r.message}),r.from&&(0,Lm.jsxs)("p",{className:"text-sm text-gray-500",children:["From: ",r.from]})]});case"return":return(0,Lm.jsxs)("div",{className:"space-y-1",children:[(0,Lm.jsx)("p",{className:"font-bold text-blue-600",children:"Troops Returned"}),(0,Lm.jsx)("p",{children:(0,Lm.jsx)("strong",{children:"Surviving Units:"})}),b(e.units),e.wounded&&Object.keys(e.wounded).length>0&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"font-bold text-orange-600 mt-2",children:"Wounded Units:"}),b(e.wounded)]}),(0,Lm.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,Lm.jsx)("strong",{children:"Loot:"})," ",k(e.resources)]})]});case"spy_caught":return(0,Lm.jsxs)("div",{className:"space-y-1",children:[(0,Lm.jsx)("p",{className:"font-bold text-red-600",children:"Spy Detected!"}),(0,Lm.jsxs)("p",{children:["A spy from ",e.originCityName||"an unknown city"," was detected."]}),e.silverGained>0&&(0,Lm.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Lm.jsx)("p",{children:"You gained:"})," ",k({silver:e.silverGained})]})]});case"reinforce":const u=e.originPlayer||{},d=e.targetPlayer||{};return(0,Lm.jsxs)("div",{className:"space-y-1",children:[(0,Lm.jsx)("p",{className:"font-bold text-blue-600",children:"Reinforcement Arrived"}),(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"From:"})," ",(0,Lm.jsx)("span",{dangerouslySetInnerHTML:{__html:GC(`[city id=${u.cityId} owner=${u.id} x=${u.x} y=${u.y}]${e.originCityName}[/city]`)}})]}),(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"To:"})," ",(0,Lm.jsx)("span",{dangerouslySetInnerHTML:{__html:GC(`[city id=${d.cityId} owner=${d.id} x=${d.x} y=${d.y}]${e.targetCityName}[/city]`)}})]}),(0,Lm.jsx)("p",{children:(0,Lm.jsx)("strong",{children:"Units:"})}),b(e.units)]});case"trade":const h=e.originPlayer||{},m=e.targetPlayer||{};return(0,Lm.jsxs)("div",{className:"space-y-1",children:[(0,Lm.jsx)("p",{className:"font-bold text-yellow-600",children:"Trade Complete"}),(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"From:"})," ",(0,Lm.jsx)("span",{dangerouslySetInnerHTML:{__html:GC(`[city id=${h.cityId} owner=${h.id} x=${h.x} y=${h.y}]${e.originCityName}[/city]`)}})]}),(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"To:"})," ",(0,Lm.jsx)("span",{dangerouslySetInnerHTML:{__html:GC(`[city id=${m.cityId} owner=${m.id} x=${m.x} y=${m.y}]${e.targetCityName}[/city]`)}})]}),(0,Lm.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,Lm.jsx)("strong",{children:"Resources:"})," ",k(e.resources)]})]});default:return(0,Lm.jsx)("p",{children:"Report type not recognized."})}var o})(c)})]}):(0,Lm.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Lm.jsx)("p",{className:"text-gray-500",children:"Select a report to view its details."})})]})]})]})})},KC={};[n(3542),n(634),n(326),n(5316)].forEach(e=>{e.keys().forEach(t=>{const n=e.id.includes("/resources")?`resources/${t.replace("./","")}`:e.id.includes("/buildings")?`buildings/${t.replace("./","")}`:e.id.includes("/gods")?`gods/${t.replace("./","")}`:t.replace("./","");KC[n]=e(t)})});const XC=t=>{var n;let{reportId:s,onClose:r,worldId:i,isEmbedded:a,onActionClick:o}=t;const l=up(),c=i||(null===l||void 0===l?void 0:l.worldId),[u,d]=(0,e.useState)(null),[h,m]=(0,e.useState)(!0),[p,f]=(0,e.useState)("");(0,e.useEffect)(()=>{(async()=>{if(!c||!s)return f("Invalid report information."),void m(!1);try{const e=eh(Om,"worlds",c,"shared_reports",s),t=await om(e);t.exists()?d(t.data()):f("This report could not be found. It may have been deleted or is no longer shared.")}catch(e){f("An error occurred while fetching the report."),console.error(e)}m(!1)})()},[c,s]);const g=e=>{if(!o)return;const t=e.target;if(t.classList.contains("bbcode-action")){const{actionType:e,actionId:n,actionOwnerId:s,actionCoordsX:r,actionCoordsY:i}=t.dataset;if("city_link"===e)o(e,{cityId:n,ownerId:s,coords:{x:r,y:i}});else{const t=n||{x:r,y:i};e&&t&&o(e,t)}}},v=e=>e&&0!==Object.keys(e).length?Object.entries(e).map(e=>{var t;let[n,s]=e;return`${s} ${(null===(t=qm[n])||void 0===t?void 0:t.name)||n}`}).join(", "):"None",y=e=>e&&KC[e]?KC[e]:"",x=e=>e&&0!==Object.keys(e).length?(0,Lm.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:Object.entries(e).map(e=>{let[t,n]=e;if(n>0){const e=qm[t],s=y((null===e||void 0===e?void 0:e.image)||"");return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[s&&(0,Lm.jsx)("img",{src:s,alt:(null===e||void 0===e?void 0:e.name)||t,className:"w-8 h-8"}),(0,Lm.jsx)("span",{className:"text-sm",children:n})]},t)}return null})}):null,b=e=>Object.entries(e||{}).map(e=>{let[t,n]=e;const s=y(`resources/${t}.png`);return(0,Lm.jsxs)("div",{className:"flex flex-col items-center mx-2",children:[s&&(0,Lm.jsx)("img",{src:s,alt:t,className:"w-8 h-8"}),(0,Lm.jsx)("span",{className:"text-sm",children:Math.floor(n)})]},t)}),w=e=>{var t,n;const s=e.outcome||{},r=e.attacker||{},i=e.defender||{};switch(e.type){case"attack_god_town":case"attack":case"attack_village":const o=e.title.startsWith("Attack")?s.attackerBattlePoints:s.defenderBattlePoints;return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-2xl mb-4 "+(s.attackerWon?"text-green-600":"text-red-600"),children:s.attackerWon?"Victory!":"Defeat!"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[(0,Lm.jsxs)("div",{className:"flex flex-col items-center w-1/3",children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",dangerouslySetInnerHTML:{__html:GC(`[city id=${r.cityId} owner=${r.ownerId} x=${r.x} y=${r.y}]${r.cityName}[/city]`)}}),(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[player id=${r.ownerId}]${r.username}[/player]`)}}),r.allianceId&&(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[alliance id=${r.allianceId}]${r.allianceName||r.allianceId}[/alliance]`)}})]}),(0,Lm.jsx)("div",{className:"w-1/3 text-center",children:(0,Lm.jsx)("img",{src:y("swordman.png"),alt:"Attack Icon",className:"mx-auto h-12 w-auto"})}),(0,Lm.jsx)("div",{className:"flex flex-col items-center w-1/3",children:i.cityName?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"font-bold text-lg",dangerouslySetInnerHTML:{__html:GC(`[city id=${i.cityId} owner=${i.ownerId} x=${i.x} y=${i.y}]${i.cityName}[/city]`)}}),(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[player id=${i.ownerId}]${i.username}[/player]`)}}),i.allianceId&&(0,Lm.jsx)("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:GC(`[alliance id=${i.allianceId}]${i.allianceName||i.allianceId}[/alliance]`)}})]}):(0,Lm.jsx)("p",{className:"font-bold text-lg",children:i.villageName||i.ruinName||"Unknown Target"})})]}),(0,Lm.jsxs)("div",{className:"w-full grid grid-cols-2 gap-4 text-sm mt-4",children:[(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Attacker Units"}),x(r.units),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",v(s.attackerLosses)]}),s.wounded&&Object.keys(s.wounded).length>0&&(0,Lm.jsxs)("p",{className:"mt-2 text-orange-600",children:[(0,Lm.jsx)("strong",{children:"Wounded:"})," ",v(s.wounded)]})]}),(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Defender Units"}),s.message?(0,Lm.jsx)("p",{className:"text-gray-500 italic",children:"Unknown"}):(0,Lm.jsxs)(Lm.Fragment,{children:[x(i.units||i.troops),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",v(s.defenderLosses)]})]})]})]}),s.attackerWon&&s.plunder&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-green-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-green-700 mb-2",children:"Plundered Resources"}),(0,Lm.jsx)("div",{className:"flex justify-center",children:b(s.plunder)})]}),"number"===typeof o&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-blue-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-blue-700 mb-2",children:"Battle Points Gained"}),(0,Lm.jsxs)("div",{className:"flex items-center justify-center",children:[(0,Lm.jsx)("img",{src:wg,alt:"Battle Points",className:"w-6 h-6 mr-2"}),(0,Lm.jsx)("p",{children:o.toLocaleString()})]})]}),s.message&&(0,Lm.jsx)("p",{className:"text-gray-500 mt-4 italic",children:s.message})]});case"attack_ruin":return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[(0,Lm.jsx)("p",{className:"font-bold text-2xl mb-4 "+(s.attackerWon?"text-green-600":"text-red-600"),children:s.attackerWon?"Victory!":"Defeat!"}),(0,Lm.jsxs)("div",{className:"w-full grid grid-cols-2 gap-4 text-sm mt-4",children:[(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Attacker Units"}),x(r.units),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",v(s.attackerLosses)]})]}),(0,Lm.jsxs)("div",{className:"p-3 bg-black/5 rounded flex flex-col items-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-yellow-700 mb-2",children:"Guardian Units"}),x(i.troops),(0,Lm.jsxs)("p",{className:"mt-2",children:[(0,Lm.jsx)("strong",{children:"Losses:"})," ",v(s.defenderLosses)]})]})]}),e.reward&&(0,Lm.jsxs)("div",{className:"w-full p-3 bg-green-800/10 rounded mt-4 text-center",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg text-green-700 mb-2",children:"Research Unlocked!"}),(0,Lm.jsx)("p",{children:null===(t=uC[e.reward])||void 0===t?void 0:t.name})]})]});case"scout":const l=e.god&&e.playerReligion?null===(n=lf[e.playerReligion.toLowerCase()])||void 0===n?void 0:n[e.god]:null;return(0,Lm.jsx)("div",{className:"space-y-3",children:e.scoutSucceeded?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"font-bold text-green-600 text-lg",children:"Scout Successful!"}),l&&(0,Lm.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,Lm.jsxs)("p",{children:[(0,Lm.jsx)("strong",{children:"Worshipped God:"})," ",l.name]}),(0,Lm.jsx)("img",{src:y(`gods/${l.image}`),alt:l.name,className:"w-8 h-8"})]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Resources:"}),(0,Lm.jsx)("div",{className:"flex flex-wrap gap-2",children:b(e.resources)})]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Units:"}),x(e.units)]}),(0,Lm.jsxs)("div",{className:"mt-4",children:[(0,Lm.jsx)("h5",{className:"font-semibold text-yellow-700",children:"Buildings:"}),(a=e.buildings,a&&0!==Object.keys(a).length?(0,Lm.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:Object.entries(a).map(e=>{let[t,n]=e;if(n.level>0){const e=zm[t],s=y(`buildings/${null===e||void 0===e?void 0:e.image}`||"");return(0,Lm.jsxs)("div",{className:"flex flex-col items-center",children:[s&&(0,Lm.jsx)("img",{src:s,alt:(null===e||void 0===e?void 0:e.name)||t,className:"w-8 h-8"}),(0,Lm.jsxs)("span",{className:"text-sm",children:[(null===e||void 0===e?void 0:e.name)||t," (Lvl ",n.level,")"]})]},t)}return null})}):null)]})]}):(0,Lm.jsx)("p",{className:"font-bold text-red-600",children:e.message||"Scout Failed!"})});default:return(0,Lm.jsx)("p",{children:"This type of report cannot be shared."})}var a};return a?h?(0,Lm.jsx)("div",{className:"text-xs",children:"Loading report..."}):p?(0,Lm.jsx)("div",{className:"text-xs text-red-500",children:p}):u?(0,Lm.jsxs)("div",{className:"p-2 border border-yellow-800/50 my-2",onClick:g,children:[(0,Lm.jsx)("h4",{className:"font-bold text-center text-sm mb-2",children:u.title}),w(u)]}):null:(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center",onClick:r,children:(0,Lm.jsxs)("div",{className:"reports-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"reports-header",children:[(0,Lm.jsx)("h2",{className:"font-title text-3xl",children:"Shared Report"}),(0,Lm.jsx)("button",{onClick:r,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"p-4 overflow-y-auto",onClick:g,children:[h&&(0,Lm.jsx)("p",{children:"Loading report..."}),p&&(0,Lm.jsx)("p",{className:"text-red-500 text-center",children:p}),u&&(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"text-lg font-bold mb-2 text-center",children:u.title}),(0,Lm.jsx)("p",{className:"text-xs text-center text-gray-500 mb-4",children:null===(n=u.timestamp)||void 0===n?void 0:n.toDate().toLocaleString()}),w(u)]})]})]})})};var JC=n(7950);let ZC={allPlayers:null,timestamp:0};const eS=t=>{let{isLeader:n}=t;const{worldId:s}=up(),{playerAlliance:r,sendAllianceInvitation:i,revokeAllianceInvitation:a,handleApplication:o}=sp(),{userProfile:l}=Fm(),[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)([]),[m,p]=(0,e.useState)([]),[f,g]=(0,e.useState)(""),[v,y]=(0,e.useState)([]),[x,b]=(0,e.useState)([]);(0,e.useEffect)(()=>{(async()=>{const e=Date.now();if(e-ZC.timestamp<6e5&&ZC.allPlayers)y(ZC.allPlayers);else{const t=Jd(Om,"users"),n=(await cm(t)).docs.map(e=>e.data().username).filter(e=>e!==l.username);y(n),ZC.allPlayers=n,ZC.timestamp=e}})()},[l.username]),(0,e.useEffect)(()=>{if(!s||null===r||void 0===r||!r.id)return;const e=pm(Jd(Om,"worlds",s,"alliances",r.id,"invitations"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));h(t)}),t=pm(eh(Om,"worlds",s,"alliances",r.id),e=>{e.exists()&&p(e.data().applications||[])});return()=>{e(),t()}},[s,r]);const w=async(e,t)=>{try{await o(e,r.id,t),g(`Application ${t}ed.`)}catch(n){g(`Error: ${n.message}`)}},k=n;return(0,Lm.jsxs)("div",{className:"p-4 alliance-bg-light alliance-text-light rounded-lg",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Invitations & Applications"}),!k&&(0,Lm.jsx)("p",{className:"text-red-400 mb-4",children:"You do not have permission to manage invitations."}),k&&(0,Lm.jsxs)("div",{className:"mb-6 space-y-2 autocomplete-suggestions-container",children:[(0,Lm.jsx)("p",{className:"font-semibold",children:"Invite a Player"}),(0,Lm.jsxs)("div",{className:"flex gap-2",children:[(0,Lm.jsx)("input",{type:"text",value:c,onChange:e=>{const t=e.target.value;if(u(t),t.length>0){const e=v.filter(e=>e.toLowerCase().startsWith(t.toLowerCase()));b(e)}else b([])},placeholder:"Player Username",className:"w-full bg-gray-900 p-2 rounded text-white",autoComplete:"off"}),(0,Lm.jsx)("button",{onClick:async()=>{if(c.trim()){g("");try{const e=Bh(Jd(Om,"users"),qh("username","==",c.trim())),t=await cm(e);if(t.empty)return void g("Player not found.");const n=t.docs[0].id;if(d.find(e=>e.invitedUserId===n))return void g("An invitation has already been sent to this player.");await i(n),g(`Invitation sent to ${c}!`),u("")}catch(e){g(e.message),console.error(e)}}else g("Please enter a player name.")},className:"btn btn-confirm flex-shrink-0",children:"Invite"})]}),x.length>0&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list dark",children:x.map(e=>(0,Lm.jsx)("li",{onClick:()=>(u(e),void b([])),children:e},e))})]}),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-semibold mb-2",children:"Pending Invitations"}),d.length>0?(0,Lm.jsx)("ul",{className:"space-y-2",children:d.map(e=>(0,Lm.jsxs)("li",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[(0,Lm.jsx)("span",{children:e.invitedUsername}),k&&(0,Lm.jsx)("button",{onClick:()=>(async e=>{await a(e),g("Invitation revoked.")})(e.invitedUserId),className:"btn btn-danger text-sm px-2 py-1",children:"Revoke"})]},e.id))}):(0,Lm.jsx)("p",{className:"text-gray-400 text-sm italic",children:"No invitations have been sent."})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("p",{className:"font-semibold mb-2",children:"Applications"}),m.length>0?(0,Lm.jsx)("ul",{className:"space-y-2",children:m.map(e=>(0,Lm.jsxs)("li",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[(0,Lm.jsx)("span",{children:e.username}),k&&(0,Lm.jsxs)("div",{className:"flex gap-1",children:[(0,Lm.jsx)("button",{onClick:()=>w(e,"accept"),className:"btn btn-confirm text-xs px-2 py-1",children:"Accept"}),(0,Lm.jsx)("button",{onClick:()=>w(e,"reject"),className:"btn btn-danger text-xs px-2 py-1",children:"Reject"})]})]},e.userId))}):(0,Lm.jsx)("p",{className:"text-gray-400 text-sm italic",children:"No pending applications."})]})]}),f&&(0,Lm.jsx)("p",{className:"text-green-400 mt-2 text-sm",children:f})]})},tS=t=>{let{onClose:n,initialRecipientId:s=null,initialRecipientUsername:r=null,onActionClick:i}=t;const{currentUser:a,userProfile:o}=Fm(),{worldId:l}=up(),[c,u]=(0,e.useState)([]),[d,h]=(0,e.useState)(null),[m,p]=(0,e.useState)([]),[f,g]=(0,e.useState)(""),[v,y]=(0,e.useState)(""),[x,b]=(0,e.useState)(!1),w=(0,e.useRef)(null),k=(0,e.useRef)(null),[N,j]=(0,e.useState)([]),[C,S]=(0,e.useState)([]);(0,e.useEffect)(()=>{(async()=>{const e=Date.now();if(e-ZC.timestamp<6e5&&ZC.allPlayers)j(ZC.allPlayers);else{const t=Jd(Om,"users"),n=(await cm(t)).docs.map(e=>e.data().username).filter(e=>e!==o.username);j(n),ZC.allPlayers=n,ZC.timestamp=e}})()},[o.username]);const _=(0,e.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&t){const t=Bh(Jd(Om,"worlds",l,"conversations"),qh("participants","in",[[a.uid,e],[e,a.uid]])),n=await cm(t);if(!n.empty)return h({id:n.docs[0].id,...n.docs[0].data()}),void b(!1)}h(null),b(!0),t&&y(t)},[a,l]);(0,e.useEffect)(()=>{if(!a||!l)return;const e=pm(Bh(Jd(Om,"worlds",l,"conversations"),qh("participants","array-contains",a.uid)),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));t.sort((e,t)=>{var n,s,r,i;return((null===(n=t.lastMessage)||void 0===n||null===(s=n.timestamp)||void 0===s?void 0:s.toDate())||0)-((null===(r=e.lastMessage)||void 0===r||null===(i=r.timestamp)||void 0===i?void 0:i.toDate())||0)}),u(t)});return()=>e()},[a,l]),(0,e.useEffect)(()=>{s&&r&&_(s,r)},[s,r,_]),(0,e.useEffect)(()=>{if(d){const e=pm(Bh(Jd(Om,"worlds",l,"conversations",d.id,"messages"),Gh("timestamp","asc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));p(t)});return dm(eh(Om,"worlds",l,"conversations",d.id),{readBy:Nm(a.uid)}),()=>e()}},[d,l,a.uid]),(0,e.useEffect)(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[m]),(0,e.useEffect)(()=>{if(k.current){k.current.querySelectorAll(".shared-report-placeholder").forEach(e=>{const t=e.dataset.reportId;t&&JC.render((0,Lm.jsx)(XC,{reportId:t,worldId:l,onClose:()=>{},isEmbedded:!0,onActionClick:i}),e)})}},[m,l,i]);const T=e=>{if(!e||!e.participants||!e.participantUsernames)return"Unknown";const t=e.participants.find(e=>e!==a.uid);return e.participantUsernames[t]||"Unknown"},I=!!d&&"System"===T(d);return(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,Lm.jsxs)("div",{className:"papyrus-bg papyrus-text",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("div",{className:"messages-header",children:(0,Lm.jsx)("button",{onClick:n,className:"papyrus-text text-3xl font-bold hover:text-red-700",children:"\xd7"})}),(0,Lm.jsxs)("div",{className:"messages-body",children:[(0,Lm.jsxs)("div",{className:"messages-left-panel",children:[(0,Lm.jsx)("div",{className:"p-2 border-b-2 border-[#8B4513]",children:(0,Lm.jsx)("button",{onClick:()=>_(),className:"w-full papyrus-btn",children:"New Scroll"})}),(0,Lm.jsx)("ul",{className:"overflow-y-auto",children:c.map(e=>{var t,n;const s=(null===(t=e.lastMessage)||void 0===t?void 0:t.senderId)!==a.uid&&!e.readBy.includes(a.uid);return(0,Lm.jsxs)("li",{className:`papyrus-list-item ${(null===d||void 0===d?void 0:d.id)===e.id?"selected":""} ${s?"unread glowing-message":""}`,onClick:()=>(async e=>{h(e),b(!1)})(e),children:[(0,Lm.jsx)("p",{className:"font-title text-lg",children:T(e)}),(0,Lm.jsx)("p",{className:"text-sm truncate",children:null===(n=e.lastMessage)||void 0===n?void 0:n.text})]},e.id)})})]}),(0,Lm.jsx)("div",{className:"messages-right-panel",children:d||x?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("div",{className:"p-4 border-b-2 border-[#8B4513] autocomplete-suggestions-container",children:x?(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("input",{type:"text",value:v,onChange:e=>{const t=e.target.value;if(y(t),t.length>0){const e=N.filter(e=>e.toLowerCase().startsWith(t.toLowerCase()));S(e)}else S([])},placeholder:"Scribe the recipient's name...",className:"w-full papyrus-input text-lg",autoComplete:"off"}),C.length>0&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:C.map(e=>(0,Lm.jsx)("li",{onClick:()=>(y(e),void S([])),children:e},e))})]}):(0,Lm.jsx)("h3",{className:"font-bold text-lg font-title",children:T(d)})}),(0,Lm.jsxs)("div",{ref:k,className:"flex-grow overflow-y-auto p-4 space-y-4",onClick:e=>{const t=e.target;if(t.classList.contains("bbcode-action")&&i){const{actionType:e,actionId:s,actionOwnerId:r,actionCoordsX:a,actionCoordsY:o}=t.dataset;if("city_link"===e)i(e,{cityId:s,ownerId:r,coords:{x:a,y:o}});else{const t=s||{x:a,y:o};e&&t&&i(e,t)}n()}},children:[m.map(e=>{var t;return(0,Lm.jsx)("div",{className:"flex "+(e.senderId===a.uid?"justify-end":"justify-start"),children:(0,Lm.jsxs)("div",{className:""+(e.senderId===a.uid?"papyrus-message-sent":"papyrus-message-received"),children:[(0,Lm.jsx)("p",{className:"font-bold text-sm font-title",children:e.senderUsername}),(0,Lm.jsx)("div",{dangerouslySetInnerHTML:{__html:GC(e.text)}}),(0,Lm.jsx)("p",{className:"text-xs text-gray-700/70 mt-1 text-right",children:null===(t=e.timestamp)||void 0===t?void 0:t.toDate().toLocaleTimeString()})]})},e.id)}),(0,Lm.jsx)("div",{ref:w})]}),!I&&(0,Lm.jsx)("div",{className:"p-4 border-t-2 border-[#8B4513] mt-auto",children:(0,Lm.jsxs)("div",{className:"flex",children:[(0,Lm.jsx)(vg,{value:f,onChange:g}),(0,Lm.jsx)("button",{onClick:async()=>{if(I)return;if(""===f.trim()||!d&&!v)return;let e=null===d||void 0===d?void 0:d.id;if(x){if("system"===v.toLowerCase())return void alert("You cannot send messages to the System.");const t=Bh(Jd(Om,"users"),qh("username","==",v)),n=await cm(t);if(n.empty)return void alert("Recipient not found.");const s=n.docs[0].data(),r=n.docs[0].id;if(r===a.uid)return void alert("You cannot send a message to yourself.");const i=Bh(Jd(Om,"worlds",l,"conversations"),qh("participants","in",[[a.uid,r],[r,a.uid]])),c=await cm(i);if(c.empty){const t=eh(Jd(Om,"worlds",l,"conversations"));await um(t,{participants:[a.uid,r],participantUsernames:{[a.uid]:o.username,[r]:s.username},lastMessage:{text:f,senderId:a.uid,timestamp:km()},readBy:[a.uid]}),e=t.id}else e=c.docs[0].id}const t=eh(Om,"worlds",l,"conversations",e);if(await mm(Jd(t,"messages"),{text:f,senderId:a.uid,senderUsername:o.username,timestamp:km()}),await dm(t,{lastMessage:{text:f,senderId:a.uid,timestamp:km()},readBy:[a.uid]}),g(""),x){b(!1),y("");const e=await om(t);h({id:e.id,...e.data()})}},className:"papyrus-btn ml-2",children:"Send"})]})})]}):(0,Lm.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Lm.jsx)("p",{className:"text-gray-500 italic",children:"Select a conversation or start a new one."})})})]})]})})},nS=()=>{const{worldId:t}=up(),{playerAlliance:n}=sp(),[s,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{if(!t||!n)return;const e=pm(Bh(Jd(Om,"worlds",t,"alliances",n.id,"events"),Gh("timestamp","desc")),e=>{r(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()},[t,n]),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Lm.jsx)("div",{className:"space-y-6",children:(0,Lm.jsxs)("div",{className:"alliance-bg-light alliance-text-light p-4 rounded-lg",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Internal Bulletin (Private)"}),(0,Lm.jsx)("p",{className:"whitespace-pre-wrap",children:n.settings.privateDescription||"No private description provided."})]})}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Recent Events"}),(0,Lm.jsx)("ul",{className:"space-y-2 max-h-64 overflow-y-auto bg-gray-700/50 p-3 rounded-lg",children:s.length>0?s.map(e=>{var t;return(0,Lm.jsxs)("li",{className:"p-2 bg-gray-800/60 rounded",children:[(0,Lm.jsx)("p",{className:"text-sm",children:e.text}),(0,Lm.jsx)("p",{className:"text-xs text-gray-400 text-right",children:null===(t=e.timestamp)||void 0===t?void 0:t.toDate().toLocaleString()})]},e.id)}):(0,Lm.jsx)("li",{className:"text-gray-500 italic text-center p-4",children:"No recent events."})})]})]})},sS=()=>{var t;const{playerAlliance:n,donateToAllianceResearch:s,recommendAllianceResearch:r}=sp(),{currentUser:i}=Fm(),[a,o]=(0,e.useState)({wood:0,stone:0,silver:0}),[l,c]=(0,e.useState)(null),[u,d]=(0,e.useState)(""),h=n.members.find(e=>e.uid===i.uid),m=n.ranks.find(e=>e.id===(null===h||void 0===h?void 0:h.rank)),p=null===m||void 0===m||null===(t=m.permissions)||void 0===t?void 0:t.recommendResearch,f=e=>{o({...a,[e.target.name]:parseInt(e.target.value)||0})};return(0,Lm.jsxs)("div",{className:"bg-amber-100 text-gray-900 p-4 rounded-lg shadow-md",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-2 border-b border-amber-300 pb-2",children:"Alliance Research"}),u&&(0,Lm.jsx)("p",{className:"text-center text-amber-800 mb-4",children:u}),(0,Lm.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(mp).map(e=>{var t,s;let[i,a]=e;const o=(null===(t=n.research[i])||void 0===t?void 0:t.level)||0,l=(null===(s=n.research[i])||void 0===s?void 0:s.progress)||{},u={wood:Math.floor(a.baseCost.wood*Math.pow(a.costMultiplier,o)),stone:Math.floor(a.baseCost.stone*Math.pow(a.costMultiplier,o)),silver:Math.floor(a.baseCost.silver*Math.pow(a.costMultiplier,o))},h=n.recommendedResearch===i;return(0,Lm.jsxs)("div",{className:"p-4 rounded-lg transition-all border "+(h?"bg-yellow-300 text-gray-900 border-yellow-400 shadow-md":"bg-amber-50 text-gray-900 border-amber-200"),children:[(0,Lm.jsxs)("h4",{className:"font-bold",children:[a.name," (Level ",o,")"]}),(0,Lm.jsx)("p",{className:"text-sm text-amber-800",children:a.description}),o<a.maxLevel?(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"my-2",children:[(0,Lm.jsx)("p",{children:"Progress:"}),(0,Lm.jsxs)("p",{className:"text-xs",children:["Wood: ",l.wood||0," / ",u.wood]}),(0,Lm.jsxs)("p",{className:"text-xs",children:["Stone: ",l.stone||0," / ",u.stone]}),(0,Lm.jsxs)("p",{className:"text-xs",children:["Silver: ",l.silver||0," / ",u.silver]})]}),(0,Lm.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,Lm.jsx)("button",{onClick:()=>c(i),className:"btn btn-sm btn-primary",children:"Donate"}),p&&(0,Lm.jsx)("button",{onClick:()=>(async e=>{try{await r(e),d("Research recommendation updated!"),setTimeout(()=>d(""),3e3)}catch(t){d(`Error: ${t.message}`),setTimeout(()=>d(""),3e3)}})(i),className:"btn btn-sm btn-secondary",children:h?"Recommended":"Recommend"})]})]}):(0,Lm.jsx)("p",{className:"text-green-400 font-bold mt-2",children:"Max Level Reached"})]},i)})}),l&&(0,Lm.jsxs)("div",{className:"mt-4 p-4 bg-gray-800 rounded",children:[(0,Lm.jsxs)("h4",{className:"font-bold",children:["Donate to ",mp[l].name]}),(0,Lm.jsxs)("div",{className:"flex gap-2 my-2",children:[(0,Lm.jsx)("input",{type:"number",name:"wood",value:a.wood,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Wood"}),(0,Lm.jsx)("input",{type:"number",name:"stone",value:a.stone,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Stone"}),(0,Lm.jsx)("input",{type:"number",name:"silver",value:a.silver,onChange:f,className:"w-full bg-gray-900 p-1 rounded",placeholder:"Silver"})]}),(0,Lm.jsx)("button",{onClick:()=>(s(l,a),void o({wood:0,stone:0,silver:0})),className:"btn btn-confirm",children:"Confirm Donation"}),(0,Lm.jsx)("button",{onClick:()=>c(null),className:"btn btn-secondary ml-2",children:"Cancel"})]})]})},rS={alliances:null,allCities:null,timestamp:0};let iS={cities:null,timestamp:0};const aS=()=>{const{playerAlliance:t,sendAllyRequest:n,declareEnemy:s,handleDiplomacyResponse:r,proposeTreaty:i}=sp(),{worldId:a}=up(),[o,l]=(0,e.useState)(""),[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)("resources"),[f,g]=(0,e.useState)({wood:0,stone:0,silver:0}),[v,y]=(0,e.useState)(""),[x,b]=(0,e.useState)("declare_war"),[w,k]=(0,e.useState)(""),[N,j]=(0,e.useState)("resources"),[C,S]=(0,e.useState)({wood:0,stone:0,silver:0}),[_,T]=(0,e.useState)(""),[I,E]=(0,e.useState)("declare_war"),[A,P]=(0,e.useState)(""),[M,D]=(0,e.useState)("once"),[O,R]=(0,e.useState)(1),[L,$]=(0,e.useState)(""),[F,U]=(0,e.useState)([]),[V,B]=(0,e.useState)([]),[z,q]=(0,e.useState)([]),[W,H]=(0,e.useState)([]),[G,Q]=(0,e.useState)(null);(0,e.useEffect)(()=>{if(!a||!t)return;(async()=>{const e=Date.now(),n=3e5;if(e-rS.timestamp<n&&rS.alliances&&rS.allCities)U(rS.alliances.filter(e=>e!==t.tag)),B(rS.allCities);else{const n=Jd(Om,"worlds",a,"alliances"),s=(await cm(n)).docs.map(e=>e.data().tag);U(s.filter(e=>e!==t.tag)),rS.alliances=s;const r=Bh(Jd(Om,"worlds",a,"citySlots"),qh("ownerId","!=",null)),i=(await cm(r)).docs.map(e=>({name:e.data().cityName,x:e.data().x,y:e.data().y}));B(i),rS.allCities=i,rS.timestamp=e}if(e-iS.timestamp<n&&iS.cities)q(iS.cities);else{const n=t.members.map(async e=>{const t=Jd(Om,`users/${e.uid}/games`,a,"cities");return(await cm(t)).docs.map(t=>({owner:e.username,...t.data()}))}),s=(await Promise.all(n)).flat();q(s),iS.cities=s,iS.timestamp=e}})()},[a,t]);const Y=(e,t,n)=>{t(e),Q(n);let s=[];if(s="demandCity"===n?V.map(e=>e.name):F,e.length>0&&s.length>0){const t=s.filter(t=>t.toLowerCase().startsWith(e.toLowerCase()));H(t.slice(0,5))}else H([])},K=e=>{"targetTag"===G&&l(e),"treatyTargetTag"===G&&h(e),"offerTargetAlliance"===G&&k(e),"demandTargetAlliance"===G&&P(e),"demandCity"===G&&T(e),H([]),Q(null)},X=async(e,t)=>{u("");try{await r(e,t),u("Diplomatic status updated.")}catch(n){u(n.message)}},J=t.diplomacy||{},Z=J.requests||[],ee=J.allies||[],te=J.enemies||[],ne=e=>["declare_war","form_pact","coordinated_attack"].includes(e);return(0,Lm.jsxs)("div",{className:"bg-amber-100 text-gray-900 p-4 rounded-lg shadow-md space-y-6",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4 border-b border-amber-300 pb-2",children:"Diplomacy"}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg mb-6 border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold mb-2 text-gray-900",children:"Make a Declaration"}),(0,Lm.jsxs)("div",{className:"flex gap-2 autocomplete-suggestions-container",children:[(0,Lm.jsx)("input",{type:"text",value:o,onChange:e=>Y(e.target.value,l,"targetTag"),placeholder:"Enter Alliance Tag",className:"w-full bg-white text-gray-900 p-2 rounded border border-amber-300",maxLength:"5",autoComplete:"off"}),W.length>0&&"targetTag"===G&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:W.map(e=>(0,Lm.jsx)("li",{onClick:()=>K(e),children:e},e))}),(0,Lm.jsx)("button",{onClick:async()=>{if(o.trim()){u("");try{await n(o.trim().toUpperCase()),u(`Ally request sent to [${o.trim().toUpperCase()}]`),l("")}catch(e){u(e.message)}}},className:"btn btn-confirm bg-green-600 hover:bg-green-700 text-white",children:"Ally Request"}),(0,Lm.jsx)("button",{onClick:async()=>{if(o.trim()){u("");try{await s(o.trim().toUpperCase()),u(`[${o.trim().toUpperCase()}] has been declared as an enemy.`),l("")}catch(e){u(e.message)}}},className:"btn btn-danger bg-red-600 hover:bg-red-700 text-white",children:"Declare Enemy"})]})]}),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Lm.jsxs)("div",{className:"bg-amber-50 p-3 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold mb-2 text-gray-900",children:"Incoming Requests"}),(0,Lm.jsx)("ul",{className:"space-y-2",children:Z.length>0?Z.map(e=>(0,Lm.jsxs)("li",{className:"bg-white text-gray-900 p-2 rounded flex justify-between items-center border border-amber-200",children:[(0,Lm.jsxs)("span",{children:[e.name," [",e.tag,"]"]}),(0,Lm.jsxs)("div",{className:"flex gap-1",children:[(0,Lm.jsx)("button",{onClick:()=>X(e.id,"accept"),className:"btn btn-confirm bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1",children:"\u2713"}),(0,Lm.jsx)("button",{onClick:()=>X(e.id,"reject"),className:"btn btn-danger bg-red-600 hover:bg-red-700 text-white text-xs px-2 py-1",children:"\u2717"})]})]},e.id)):(0,Lm.jsx)("li",{className:"text-amber-800 italic",children:"None"})})]}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-3 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold mb-2 text-gray-900",children:"Allies"}),(0,Lm.jsx)("ul",{className:"space-y-2",children:ee.length>0?ee.map(e=>(0,Lm.jsxs)("li",{className:"bg-white text-gray-900 p-2 rounded flex justify-between items-center border border-amber-200",children:[(0,Lm.jsxs)("span",{children:[e.name," [",e.tag,"]"]}),(0,Lm.jsx)("button",{onClick:()=>X(e.id,"removeAlly"),className:"btn btn-danger bg-red-600 hover:bg-red-700 text-white text-xs px-2 py-1",children:"Remove"})]},e.id)):(0,Lm.jsx)("li",{className:"text-amber-800 italic",children:"None"})})]}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-3 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold mb-2 text-gray-900",children:"Enemies"}),(0,Lm.jsx)("ul",{className:"space-y-2",children:te.length>0?te.map(e=>(0,Lm.jsxs)("li",{className:"bg-white text-gray-900 p-2 rounded flex justify-between items-center border border-amber-200",children:[(0,Lm.jsxs)("span",{children:[e.name," [",e.tag,"]"]}),(0,Lm.jsx)("button",{onClick:()=>X(e.id,"removeEnemy"),className:"btn btn-primary bg-blue-600 hover:bg-blue-700 text-white text-xs px-2 py-1",children:"Remove"})]},e.id)):(0,Lm.jsx)("li",{className:"text-amber-800 italic",children:"None"})})]})]})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4 border-b border-amber-300 pb-2",children:"Treaties"}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold mb-2 text-gray-900",children:"Propose a Treaty"}),(0,Lm.jsxs)("div",{className:"space-y-3",children:[(0,Lm.jsxs)("div",{className:"autocomplete-suggestions-container",children:[(0,Lm.jsx)("input",{type:"text",value:d,onChange:e=>Y(e.target.value,h,"treatyTargetTag"),placeholder:"Target Alliance Tag",className:"w-full p-2 rounded border border-amber-300",autoComplete:"off"}),W.length>0&&"treatyTargetTag"===G&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:W.map(e=>(0,Lm.jsx)("li",{onClick:()=>K(e),children:e},e))})]}),(0,Lm.jsxs)("div",{className:"border p-2 rounded",children:[(0,Lm.jsx)("h5",{className:"font-semibold",children:"You Offer:"}),(0,Lm.jsxs)("select",{value:m,onChange:e=>p(e.target.value),children:[(0,Lm.jsx)("option",{value:"resources",children:"Resources"}),(0,Lm.jsx)("option",{value:"alliance_action",children:"Alliance Action"}),(0,Lm.jsx)("option",{value:"city",children:"City"})]}),"resources"===m?(0,Lm.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[(0,Lm.jsx)("input",{type:"number",value:f.wood,onChange:e=>g(t=>({...t,wood:parseInt(e.target.value)||0})),placeholder:"Wood"}),(0,Lm.jsx)("input",{type:"number",value:f.stone,onChange:e=>g(t=>({...t,stone:parseInt(e.target.value)||0})),placeholder:"Stone"}),(0,Lm.jsx)("input",{type:"number",value:f.silver,onChange:e=>g(t=>({...t,silver:parseInt(e.target.value)||0})),placeholder:"Silver"})]}):"city"===m?(0,Lm.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"w-full p-2 rounded border border-amber-300 mt-2",children:[(0,Lm.jsx)("option",{value:"",children:"Select a city to offer"}),Object.values(z.reduce((e,t)=>((e[t.owner]=e[t.owner]||[]).push(t),e),{})).map((e,t)=>(0,Lm.jsx)("optgroup",{label:e[0].owner,children:e.map(e=>(0,Lm.jsxs)("option",{value:e.id,children:[e.cityName," (",e.x,",",e.y,")"]},e.id))},t))]}):(0,Lm.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2 autocomplete-suggestions-container",children:[(0,Lm.jsxs)("select",{value:x,onChange:e=>b(e.target.value),children:[(0,Lm.jsx)("option",{value:"declare_war",children:"Declare War On"}),(0,Lm.jsx)("option",{value:"form_pact",children:"Form Pact With"}),(0,Lm.jsx)("option",{value:"non_aggression",children:"Non-Aggression Pact"}),(0,Lm.jsx)("option",{value:"coordinated_attack",children:"Coordinated Attack On"}),(0,Lm.jsx)("option",{value:"offer_peace",children:"Offer Peace"})]}),ne(x)&&(0,Lm.jsx)("input",{type:"text",value:w,onChange:e=>Y(e.target.value,k,"offerTargetAlliance"),placeholder:"Target Alliance Tag",autoComplete:"off"}),W.length>0&&"offerTargetAlliance"===G&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:W.map(e=>(0,Lm.jsx)("li",{onClick:()=>K(e),children:e},e))})]})]}),(0,Lm.jsxs)("div",{className:"border p-2 rounded",children:[(0,Lm.jsx)("h5",{className:"font-semibold",children:"You Demand:"}),(0,Lm.jsxs)("select",{value:N,onChange:e=>j(e.target.value),children:[(0,Lm.jsx)("option",{value:"resources",children:"Resources"}),(0,Lm.jsx)("option",{value:"alliance_action",children:"Alliance Action"}),(0,Lm.jsx)("option",{value:"city",children:"City"})]}),"resources"===N?(0,Lm.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[(0,Lm.jsx)("input",{type:"number",value:C.wood,onChange:e=>S(t=>({...t,wood:parseInt(e.target.value)||0})),placeholder:"Wood"}),(0,Lm.jsx)("input",{type:"number",value:C.stone,onChange:e=>S(t=>({...t,stone:parseInt(e.target.value)||0})),placeholder:"Stone"}),(0,Lm.jsx)("input",{type:"number",value:C.silver,onChange:e=>S(t=>({...t,silver:parseInt(e.target.value)||0})),placeholder:"Silver"})]}):"city"===N?(0,Lm.jsxs)("div",{className:"autocomplete-suggestions-container mt-2",children:[(0,Lm.jsx)("input",{type:"text",value:_,onChange:e=>Y(e.target.value,T,"demandCity"),placeholder:"Enter City Name",className:"w-full p-2 rounded border border-amber-300",autoComplete:"off"}),W.length>0&&"demandCity"===G&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:W.map(e=>(0,Lm.jsx)("li",{onClick:()=>K(e),children:e},e))})]}):(0,Lm.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2 autocomplete-suggestions-container",children:[(0,Lm.jsxs)("select",{value:I,onChange:e=>E(e.target.value),children:[(0,Lm.jsx)("option",{value:"declare_war",children:"Declare War On"}),(0,Lm.jsx)("option",{value:"form_pact",children:"Form Pact With"}),(0,Lm.jsx)("option",{value:"non_aggression",children:"Non-Aggression Pact"}),(0,Lm.jsx)("option",{value:"coordinated_attack",children:"Coordinated Attack On"}),(0,Lm.jsx)("option",{value:"demand_surrender",children:"Demand Surrender"})]}),ne(I)&&(0,Lm.jsx)("input",{type:"text",value:A,onChange:e=>Y(e.target.value,P,"demandTargetAlliance"),placeholder:"Target Alliance Tag",autoComplete:"off"}),W.length>0&&"demandTargetAlliance"===G&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:W.map(e=>(0,Lm.jsx)("li",{onClick:()=>K(e),children:e},e))})]})]}),(0,Lm.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,Lm.jsxs)("select",{value:M,onChange:e=>D(e.target.value),children:[(0,Lm.jsx)("option",{value:"once",children:"Once"}),(0,Lm.jsx)("option",{value:"daily",children:"Daily"}),(0,Lm.jsx)("option",{value:"weekly",children:"Weekly"})]}),"once"!==M&&(0,Lm.jsx)("input",{type:"number",value:O,onChange:e=>R(parseInt(e.target.value)||1),placeholder:"Occurrences"})]}),(0,Lm.jsx)(vg,{value:L,onChange:$}),(0,Lm.jsx)("button",{onClick:async()=>{if(d.trim()){u("");try{let e,t;if("resources"===m)e={type:"resources",data:f};else if("city"===m){if(!v)throw new Error("You must select a city to offer.");const t=z.find(e=>e.id===v);if(!t)throw new Error("Offered city not found in alliance.");e={type:"city",cityId:v,cityName:t.cityName,coords:`${t.x},${t.y}`}}else e={type:"alliance_action",action:x,target:w};if("resources"===N)t={type:"resources",data:C};else if("city"===N){const e=V.find(e=>e.name.toLowerCase()===_.toLowerCase());if(!e)throw new Error("The demanded city does not exist or could not be found.");t={type:"city",coords:`${e.x},${e.y}`,cityName:e.name}}else t={type:"alliance_action",action:I,target:A};const n={offer:e,demand:t,frequency:M,occurrences:"once"===M?1:O,message:L};await i(d.trim().toUpperCase(),n),u(`Treaty proposed to [${d.trim().toUpperCase()}]`),h("")}catch(e){u(`Failed to propose treaty: ${e.message}`)}}else u("Please enter a target alliance tag for the treaty.")},className:"btn btn-confirm w-full",children:"Propose Treaty"})]})]})]}),c&&(0,Lm.jsx)("p",{className:"text-sm mt-2 text-amber-800",children:c})]})},oS=t=>{let{alliance:n,onClose:s,updateSettings:r,isLeader:i}=t;const{updateAllianceSettings:a}=sp(),[o,l]=(0,e.useState)(n.name),[c,u]=(0,e.useState)(n.settings.description),[d,h]=(0,e.useState)(n.settings.privateDescription||""),[m,p]=(0,e.useState)(n.settings.status),[f,g]=(0,e.useState)("");return(0,Lm.jsxs)("div",{className:"settings-container",children:[(0,Lm.jsxs)("div",{className:"settings-section",children:[(0,Lm.jsx)("h3",{children:"Alliance Information"}),(0,Lm.jsxs)("div",{className:"form-group",children:[(0,Lm.jsx)("label",{children:"Alliance Name"}),(0,Lm.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),className:"settings-input",disabled:!i})]}),(0,Lm.jsxs)("div",{className:"form-group",children:[(0,Lm.jsx)("label",{children:"Alliance Description (Public)"}),(0,Lm.jsx)(vg,{value:c,onChange:u,disabled:!i})]}),(0,Lm.jsxs)("div",{className:"form-group",children:[(0,Lm.jsx)("label",{children:"Alliance Description (Private)"}),(0,Lm.jsx)(vg,{value:d,onChange:h,disabled:!i})]})]}),(0,Lm.jsxs)("div",{className:"settings-section",children:[(0,Lm.jsx)("h3",{children:"Membership Settings"}),(0,Lm.jsxs)("div",{className:"form-group",children:[(0,Lm.jsxs)("label",{children:["Alliance Status ",(()=>{switch(m){case"open":return(0,Lm.jsx)("span",{className:"status-badge status-open",children:"Open"});case"invite_only":return(0,Lm.jsx)("span",{className:"status-badge status-invite_only",children:"Invite Only"});case"closed":return(0,Lm.jsx)("span",{className:"status-badge status-closed",children:"Closed"});default:return null}})()]}),(0,Lm.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"settings-input alliance-text-dark alliance-bg-dark",disabled:!i,children:[(0,Lm.jsx)("option",{value:"open",children:"Open (Anyone can join)"}),(0,Lm.jsx)("option",{value:"invite_only",children:"Invite Only (Join by invite or application)"}),(0,Lm.jsx)("option",{value:"closed",children:"Closed (Join by invite only)"})]})]})]}),f&&(0,Lm.jsx)("div",{className:"message "+(f.includes("success")?"success":"error"),children:f}),i&&(0,Lm.jsx)("div",{className:"actions",children:(0,Lm.jsx)("button",{onClick:()=>{i&&(""!==o.trim()&&""!==c.trim()?(a({name:o,description:c,privateDescription:d,status:m}),g("Settings saved successfully!")):g("Name and description cannot be empty."))},className:"save-button",children:"Save Settings"})})]})},lS=t=>{let{alliance:n,isLeader:s}=t;const{createAllianceRank:r,updateAllianceMemberRank:i,updateRanksOrder:a,updateAllianceRank:o,deleteAllianceRank:l}=sp(),{userProfile:c}=Fm(),{worldId:u}=up(),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)({manageRanks:!1,manageSettings:!1,manageDiplomacy:!1,inviteMembers:!1,kickMembers:!1,recommendResearch:!1,viewSecretForums:!1,manageBank:!1,withdrawFromBank:!1,proposeTreaties:!1,viewMemberActivity:!1}),[f,g]=(0,e.useState)(""),[v,y]=(0,e.useState)(null),[x,b]=(0,e.useState)(null),w=Object.keys(m),k=async(e,t)=>{if(!s||0===e)return;const r=[...n.ranks],i=r[e];if("up"===t&&e>1)r.splice(e,1),r.splice(e-1,0,i);else{if(!("down"===t&&e<r.length-1))return;r.splice(e,1),r.splice(e+1,0,i)}try{await a(r),g("Rank order updated."),setTimeout(()=>g(""),3e3)}catch(o){g("Failed to update rank order."),console.error(o)}},N=()=>{b(null)},j=async()=>{if(x&&x.name.trim())if(n.ranks.some(e=>e.name.toLowerCase()===x.name.trim().toLowerCase()&&e.id!==x.id))g("A rank with this name already exists.");else try{await o(x.id,{name:x.name,permissions:x.permissions}),g("Rank updated successfully."),b(null)}catch(e){g(`Error updating rank: ${e.message}`)}else g("Rank name cannot be empty.")},C=e=>{const t=Object.entries(e||{}).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t.replace(/([A-Z])/g," $1").toLowerCase()});return 0===t.length?"No special permissions.":`Permissions: ${t.join(", ")}`},S=(0,e.useMemo)(()=>[...n.members||[]].sort((e,t)=>"Leader"===e.rank?-1:"Leader"===t.rank?1:e.username.localeCompare(t.username)),[n.members]);return(0,Lm.jsxs)("div",{className:"bg-amber-100 text-gray-900 p-4 rounded-lg shadow-md",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4 border-b border-amber-300 pb-2",children:"Alliance Ranks"}),!s&&(0,Lm.jsx)("p",{className:"text-red-600 mb-4",children:"Only the leader can manage ranks."}),(0,Lm.jsxs)("div",{className:"space-y-6",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg mb-2 text-gray-900",children:"Current Ranks"}),(0,Lm.jsx)("ul",{className:"space-y-2",children:n.ranks.map((e,t)=>(0,Lm.jsx)("li",{className:"bg-white text-gray-900 p-3 rounded border border-amber-200",children:(null===x||void 0===x?void 0:x.id)===e.id?(0,Lm.jsxs)("div",{className:"w-full",children:[(0,Lm.jsx)("input",{type:"text",value:x.name,onChange:e=>b(t=>({...t,name:e.target.value})),className:"w-full bg-amber-50 text-gray-900 p-2 rounded border border-amber-300 mb-2"}),(0,Lm.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm mb-2",children:w.map(e=>(0,Lm.jsxs)("div",{className:"flex items-center",children:[(0,Lm.jsx)("input",{type:"checkbox",id:`edit-${e}`,checked:x.permissions[e],onChange:t=>b(n=>({...n,permissions:{...n.permissions,[e]:t.target.checked}})),className:"mr-2"}),(0,Lm.jsx)("label",{htmlFor:`edit-${e}`,className:"capitalize text-gray-900",children:e.replace(/([A-Z])/g," $1")})]},e))}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,Lm.jsx)("button",{onClick:N,className:"btn btn-secondary",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:j,className:"btn btn-confirm",children:"Save"})]})]}):(0,Lm.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,Lm.jsxs)("div",{title:C(e.permissions),children:[(0,Lm.jsx)("p",{className:"font-bold",children:e.name}),(0,Lm.jsx)("p",{className:"text-xs text-amber-800 mt-1",children:C(e.permissions)})]}),(0,Lm.jsx)("div",{className:"flex items-center gap-2",children:s&&"Leader"!==e.id&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("button",{onClick:()=>(e=>{b({...e})})(e),className:"text-xs btn btn-primary px-2 py-1",children:"Edit"}),(0,Lm.jsx)("button",{onClick:()=>(async e=>{if(g(""),window.confirm(`Are you sure you want to delete the rank "${e}"? This cannot be undone.`))try{await l(e),g("Rank deleted successfully.")}catch(t){g(`Error deleting rank: ${t.message}`)}})(e.id),className:"text-xs btn btn-danger px-2 py-1",children:"Delete"}),(0,Lm.jsxs)("div",{className:"flex flex-col",children:[(0,Lm.jsx)("button",{onClick:()=>k(t,"up"),disabled:t<=1,className:"text-gray-600 hover:text-black disabled:opacity-50",children:"\u25b2"}),(0,Lm.jsx)("button",{onClick:()=>k(t,"down"),disabled:t===n.ranks.length-1,className:"text-gray-600 hover:text-black disabled:opacity-50",children:"\u25bc"})]})]})})]})},e.id))})]}),s&&n.ranks.length<10&&(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg mb-2 text-gray-900",children:"Create New Rank"}),(0,Lm.jsxs)("div",{className:"space-y-2",children:[(0,Lm.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"New Rank Name",className:"w-full bg-white text-gray-900 p-2 rounded border border-amber-300"}),(0,Lm.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:w.map(e=>(0,Lm.jsxs)("div",{className:"flex items-center",children:[(0,Lm.jsx)("input",{type:"checkbox",id:e,checked:m[e],onChange:t=>p(n=>({...n,[e]:t.target.checked})),className:"mr-2"}),(0,Lm.jsx)("label",{htmlFor:e,className:"capitalize text-gray-900",children:e.replace(/([A-Z])/g," $1")})]},e))}),(0,Lm.jsx)("button",{onClick:()=>{s&&(g(""),""!==d.trim()?n.ranks.some(e=>e.name.toLowerCase()===d.trim().toLowerCase())?g("A rank with this name already exists."):n.ranks.length>=10?g("Maximum of 10 ranks reached."):(r({id:d.trim(),name:d.trim(),permissions:m}),h(""),p({manageRanks:!1,manageSettings:!1,manageDiplomacy:!1,inviteMembers:!1,kickMembers:!1,recommendResearch:!1,viewSecretForums:!1,manageBank:!1,withdrawFromBank:!1,proposeTreaties:!1,viewMemberActivity:!1}),g("Rank created!")):g("Rank name cannot be empty."))},className:"btn btn-confirm bg-green-600 hover:bg-green-700 text-white w-full",children:"Create Rank"})]})]}),f&&(0,Lm.jsx)("p",{className:"text-amber-800 mt-2 text-sm text-center",children:f}),(0,Lm.jsxs)("div",{className:"mt-6 bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg mb-2 text-gray-900",children:"Assign Ranks"}),(0,Lm.jsx)("ul",{className:"space-y-2",children:S.map(e=>(0,Lm.jsxs)("li",{className:"flex justify-between items-center bg-white text-gray-900 p-2 rounded border border-amber-200",children:[(0,Lm.jsx)("span",{children:e.username}),(0,Lm.jsx)("div",{className:"flex items-center gap-2",children:s&&e.uid!==n.leader.uid?v===e.uid?(0,Lm.jsx)("select",{value:e.rank,onChange:t=>{(async(e,t)=>{if(s){g("");try{const s=n.members.find(t=>t.uid===e),r=s.rank;if(await i(e,t),r!==t){const e=n.ranks.findIndex(e=>e.id===r),i=n.ranks.findIndex(e=>e.id===t);if(-1!==e&&-1!==i){const r=i<e?"promoted":"demoted",a=s.username,o=`${c.username} has ${r} ${a} to ${t}.`,l=Jd(Om,"worlds",u,"alliances",n.id,"events");await mm(l,{type:"rank_change",text:o,timestamp:km()})}}g("Member rank updated successfully!"),setTimeout(()=>g(""),3e3)}catch(r){g("Failed to update rank. Please try again."),console.error("Error updating member rank:",r)}}})(e.uid,t.target.value),y(null)},onBlur:()=>y(null),autoFocus:!0,className:"bg-white text-gray-900 p-1 rounded text-sm border border-amber-300",children:n.ranks.map(e=>(0,Lm.jsx)("option",{value:e.id,children:e.name},e.id))}):(0,Lm.jsx)("button",{onClick:()=>y(e.uid),className:"text-sm text-amber-800 hover:underline cursor-pointer bg-transparent border-none p-0",children:e.rank}):(0,Lm.jsx)("span",{className:"text-sm text-amber-800",children:e.rank})})]},e.uid))})]})]})]})},cS=e=>{let{message:t,onConfirm:n,onCancel:s}=e;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600 text-white",children:[(0,Lm.jsx)("p",{className:"mb-6 text-lg",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-danger",children:"Confirm"})]})]})})},uS=t=>{var n,s;let{onClose:r}=t;const{playerAlliance:i,leaveAlliance:a,disbandAlliance:o}=sp(),{currentUser:l}=Fm(),[c,u]=(0,e.useState)(null),d=(null===l||void 0===l?void 0:l.uid)===(null===i||void 0===i||null===(n=i.leader)||void 0===n?void 0:n.uid),h=1===(null===i||void 0===i||null===(s=i.members)||void 0===s?void 0:s.length);return(0,Lm.jsxs)("div",{className:"p-4 alliance-bg-light alliance-text-light rounded-lg",children:[c&&(0,Lm.jsx)(cS,{message:c.message,onConfirm:c.action,onCancel:()=>u(null)}),(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Alliance Properties"}),(0,Lm.jsxs)("div",{className:"space-y-4",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg mb-2",children:"Leave Alliance"}),(0,Lm.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:d&&!h?"As the leader, you must pass leadership to another member before you can leave.":"If you leave, you will need to be invited or apply to join another alliance."}),(0,Lm.jsx)("button",{onClick:()=>{u({message:"Are you sure you want to leave this alliance?",action:async()=>{try{await a(),r()}catch(e){console.error(e)}finally{u(null)}}})},className:"btn btn-danger",disabled:d&&!h,children:d&&h?"Leave and Disband":"Leave Alliance"})]}),d&&(0,Lm.jsxs)("div",{className:"border-t border-gray-600 pt-4",children:[(0,Lm.jsx)("h4",{className:"font-semibold text-lg mb-2 text-red-400",children:"Disband Alliance"}),(0,Lm.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"This will permanently delete the alliance for all members. This action cannot be undone."}),(0,Lm.jsx)("button",{onClick:()=>{u({message:"Are you sure you want to disband the alliance? This action is permanent and cannot be undone.",action:async()=>{try{await o(),r()}catch(e){console.error(e)}finally{u(null)}}})},className:"btn btn-danger",children:"Disband Alliance"})]})]})]})},dS=()=>{var t;const{playerAlliance:n,donateToBank:s,distributeFromBank:r}=sp(),{currentUser:i}=Fm(),{gameState:a,worldId:o}=up(),[l,c]=(0,e.useState)({wood:0,stone:0,silver:0}),[u,d]=(0,e.useState)({wood:0,stone:0,silver:0}),[h,m]=(0,e.useState)(""),[p,f]=(0,e.useState)(""),[g,v]=(0,e.useState)([]),[y,x]=(0,e.useState)(""),[b,w]=(0,e.useState)([]),k=n.bank||{wood:0,stone:0,silver:0},N=(0,e.useMemo)(()=>{var e,t,s;if(!n)return 0;const r=(null===(e=n.research)||void 0===e||null===(t=e.reinforced_vaults)||void 0===t?void 0:t.level)||0;return 1e6+((null===(s=mp.reinforced_vaults)||void 0===s?void 0:s.effect.value)||0)*r},[n]),j=(0,e.useMemo)(()=>{if(!n||!i)return null;const e=n.members.find(e=>e.uid===i.uid);return e?n.ranks.find(t=>t.id===e.rank):null},[n,i]),C=null===j||void 0===j||null===(t=j.permissions)||void 0===t?void 0:t.manageBank;(0,e.useEffect)(()=>{if(!n||!o)return;const e=pm(Bh(Jd(Om,"worlds",o,"alliances",n.id,"bank_logs"),Gh("timestamp","desc")),e=>{v(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()},[n,o]);const S=e=>{const{name:t,value:n}=e.target,s=Math.max(0,Math.min(a.resources[t]||0,parseInt(n)||0));c(e=>({...e,[t]:s}))},_=e=>{const{name:t,value:n}=e.target,s=Math.max(0,Math.min(k[t]||0,parseInt(n)||0));d(e=>({...e,[t]:s}))},T=(e,t)=>{const n=Math.floor((k[e]||0)*t);d(t=>({...t,[e]:n}))};return(0,Lm.jsxs)("div",{className:"bg-amber-100 text-gray-900 p-4 rounded-lg shadow-md",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-4 border-b border-amber-300 pb-2",children:"Alliance Bank"}),y&&(0,Lm.jsx)("p",{className:"text-center text-amber-800 mb-4",children:y}),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg mb-2",children:"Bank Holdings"}),(0,Lm.jsxs)("p",{className:"text-sm text-gray-600",children:["Capacity: ",N.toLocaleString()," per resource"]}),(0,Lm.jsxs)("p",{children:["Wood: ",(k.wood||0).toLocaleString()]}),(0,Lm.jsxs)("p",{children:["Stone: ",(k.stone||0).toLocaleString()]}),(0,Lm.jsxs)("p",{children:["Silver: ",(k.silver||0).toLocaleString()]})]}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg mb-2",children:"Donate Resources"}),(0,Lm.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"5 min cooldown | 50,000 daily limit"}),(0,Lm.jsxs)("div",{className:"space-y-2",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsxs)("label",{children:["Wood (Your: ",Math.floor(a.resources.wood||0),")"]}),(0,Lm.jsx)("input",{type:"number",name:"wood",value:l.wood,onChange:S,className:"w-full p-1 rounded border border-amber-300"})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsxs)("label",{children:["Stone (Your: ",Math.floor(a.resources.stone||0),")"]}),(0,Lm.jsx)("input",{type:"number",name:"stone",value:l.stone,onChange:S,className:"w-full p-1 rounded border border-amber-300"})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsxs)("label",{children:["Silver (Your: ",Math.floor(a.resources.silver||0),")"]}),(0,Lm.jsx)("input",{type:"number",name:"silver",value:l.silver,onChange:S,className:"w-full p-1 rounded border border-amber-300"})]}),(0,Lm.jsx)("button",{onClick:async()=>{x("");try{await s(l),x("Donation successful!"),c({wood:0,stone:0,silver:0})}catch(e){x(`Donation failed: ${e.message}`)}},className:"btn btn-confirm w-full",children:"Donate"})]})]}),C&&(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200 md:col-span-2",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg mb-2",children:"Distribute Resources"}),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4 items-end",children:[(0,Lm.jsxs)("div",{className:"md:col-span-2 autocomplete-suggestions-container",children:[(0,Lm.jsx)("label",{children:"Member"}),(0,Lm.jsx)("input",{type:"text",value:h,onChange:e=>{const t=e.target.value;if(m(t),f(""),t.length>0){const e=n.members.filter(e=>e.uid!==i.uid).filter(e=>e.username.toLowerCase().startsWith(t.toLowerCase()));w(e)}else w([])},placeholder:"Player Username",className:"w-full p-1 rounded border border-amber-300",autoComplete:"off"}),b.length>0&&(0,Lm.jsx)("ul",{className:"autocomplete-suggestions-list light",children:b.map(e=>(0,Lm.jsx)("li",{onClick:()=>(e=>{m(e.username),f(e.uid),w([])})(e),children:e.username},e.uid))})]}),(0,Lm.jsxs)("div",{className:"md:col-span-5 grid grid-cols-3 gap-x-4",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("label",{children:"Wood"}),(0,Lm.jsx)("input",{type:"number",name:"wood",value:u.wood,onChange:_,className:"w-full p-1 rounded border border-amber-300 mb-1"}),(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("button",{onClick:()=>T("wood",.25),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"25%"}),(0,Lm.jsx)("button",{onClick:()=>T("wood",.5),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"50%"}),(0,Lm.jsx)("button",{onClick:()=>T("wood",1),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"Max"})]})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("label",{children:"Stone"}),(0,Lm.jsx)("input",{type:"number",name:"stone",value:u.stone,onChange:_,className:"w-full p-1 rounded border border-amber-300 mb-1"}),(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("button",{onClick:()=>T("stone",.25),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"25%"}),(0,Lm.jsx)("button",{onClick:()=>T("stone",.5),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"50%"}),(0,Lm.jsx)("button",{onClick:()=>T("stone",1),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"Max"})]})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("label",{children:"Silver"}),(0,Lm.jsx)("input",{type:"number",name:"silver",value:u.silver,onChange:_,className:"w-full p-1 rounded border border-amber-300 mb-1"}),(0,Lm.jsxs)("div",{className:"flex items-center gap-1",children:[(0,Lm.jsx)("button",{onClick:()=>T("silver",.25),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"25%"}),(0,Lm.jsx)("button",{onClick:()=>T("silver",.5),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"50%"}),(0,Lm.jsx)("button",{onClick:()=>T("silver",1),className:"btn btn-secondary text-xs px-1 py-0.5 flex-1",children:"Max"})]})]})]})]}),(0,Lm.jsx)("button",{onClick:async()=>{if(x(""),p)try{await r(p,u),x("Distribution successful!"),d({wood:0,stone:0,silver:0}),m(""),f("")}catch(e){x(`Distribution failed: ${e.message}`)}else x("Please select a valid member to distribute resources to.")},className:"btn btn-primary w-full mt-4",children:"Distribute"})]}),(0,Lm.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200 md:col-span-2",children:[(0,Lm.jsx)("h4",{className:"font-bold text-lg mb-2",children:"Transaction History"}),(0,Lm.jsx)("ul",{className:"space-y-2 max-h-48 overflow-y-auto",children:g.map(e=>{var t;return(0,Lm.jsxs)("li",{className:"text-sm p-2 bg-white rounded border border-amber-200",children:["donation"===e.type?(0,Lm.jsxs)("span",{children:[(0,Lm.jsx)("strong",{children:e.user})," donated ",Object.entries(e.resources).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;return`${n.toLocaleString()} ${t}`}).join(", "),"."]}):(0,Lm.jsxs)("span",{children:[(0,Lm.jsx)("strong",{children:e.from})," sent ",Object.entries(e.resources).filter(e=>{let[,t]=e;return t>0}).map(e=>{let[t,n]=e;return`${n.toLocaleString()} ${t}`}).join(", ")," to ",(0,Lm.jsx)("strong",{children:e.to}),"."]}),(0,Lm.jsx)("span",{className:"text-xs text-gray-500 float-right",children:null===(t=e.timestamp)||void 0===t?void 0:t.toDate().toLocaleTimeString()})]},e.id)})})]})]})]})},hS={playerPointsMap:null,timestamp:0},mS=t=>{let{onAllianceClick:n,onOpenCreate:s}=t;const{worldId:r,worldState:i}=up(),{applyToAlliance:a,joinOpenAlliance:o}=sp(),[l,c]=(0,e.useState)([]),[u,d]=(0,e.useState)(!0),[h,m]=(0,e.useState)("");(0,e.useEffect)(()=>{if(!r||!i)return;let e=new Map,t=!1;const n=pm(Bh(Jd(Om,"worlds",r,"alliances"),qh("settings.status","in",["open","invite_only"])),async n=>{d(!0);const s=n.docs.map(e=>({id:e.id,...e.data()})),r=Date.now();if(r-hS.timestamp>3e5||!hS.playerPointsMap){if(!t){t=!0;const n=Bh(Zd(Om,"games"),qh("worldName","==",i.name));(await cm(n)).forEach(t=>{const n=t.ref.parent.parent.id;e.set(n,t.data().totalPoints||0)}),hS.playerPointsMap=e,hS.timestamp=r,t=!1}}else e=hS.playerPointsMap;const a=s.map(t=>{let n=0;for(const s of t.members)n+=e.get(s.uid)||0;return{...t,totalPoints:n}});c(a),d(!1)});return()=>n()},[r,i]);return u?(0,Lm.jsx)("div",{className:"text-center p-4",children:"Loading alliances..."}):(0,Lm.jsxs)("div",{className:"text-gray-900",children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold",children:"Available Alliances"}),(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary",children:"Create Your Own"})]}),h&&(0,Lm.jsx)("p",{className:"text-center p-2 bg-yellow-200 rounded mb-4",children:h}),(0,Lm.jsxs)("table",{className:"w-full text-left",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{className:"bg-gray-300",children:[(0,Lm.jsx)("th",{className:"p-2",children:"Tag"}),(0,Lm.jsx)("th",{className:"p-2",children:"Name"}),(0,Lm.jsx)("th",{className:"p-2 text-center",children:"Members"}),(0,Lm.jsx)("th",{className:"p-2 text-right",children:"Points"})]})}),(0,Lm.jsx)("tbody",{children:l.map(e=>(0,Lm.jsxs)("tr",{className:"border-b border-gray-300",children:[(0,Lm.jsxs)("td",{className:"p-2 font-bold",children:["[",e.tag,"]"]}),(0,Lm.jsx)("td",{className:"p-2",children:(0,Lm.jsx)("button",{onClick:()=>n(e.id),className:"font-bold text-blue-600 hover:underline",children:e.name})}),(0,Lm.jsxs)("td",{className:"p-2 text-center",children:[e.members.length," / 25"]}),(0,Lm.jsx)("td",{className:"p-2 text-right",children:e.totalPoints.toLocaleString()}),(0,Lm.jsx)("td",{className:"p-2 text-center",children:(0,Lm.jsx)("button",{onClick:()=>(async e=>{m("");try{"open"===e.settings.status?await o(e.id):(await a(e.id),m(`Application sent to ${e.name}!`))}catch(t){console.error("Error performing alliance action:",t),m(`Action failed: ${t.message}`)}})(e),className:"btn btn-confirm text-sm px-3 py-1",children:"open"===e.settings.status?"Join":"Apply"})})]},e.id))})]})]})},pS=t=>{let{onClose:n}=t;const{createAlliance:s}=sp(),[r,i]=(0,e.useState)(""),[a,o]=(0,e.useState)(""),[l,c]=(0,e.useState)("");return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border-2 border-gray-600 text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Create an Alliance"}),(0,Lm.jsx)("button",{onClick:n,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),l&&(0,Lm.jsx)("p",{className:"text-red-500 text-center mb-4",children:l}),(0,Lm.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,Lm.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"Alliance Name",className:"w-full bg-gray-900 p-2 rounded"}),(0,Lm.jsx)("input",{type:"text",value:a,onChange:e=>o(e.target.value),placeholder:"Alliance Tag (e.g., ABC)",maxLength:"5",className:"w-full bg-gray-900 p-2 rounded"}),(0,Lm.jsx)("button",{onClick:async()=>{if(c(""),r.trim()&&a.trim())try{await s(r.trim(),a.trim()),n()}catch(e){c(e.message)}else c("Both name and tag are required.")},className:"btn btn-confirm",children:"Create Alliance"})]})]})})},fS=t=>{let{onClose:n,onOpenAllianceProfile:s,openModal:r}=t;const{playerAlliance:i}=sp(),{currentUser:a}=Fm(),[o,l]=(0,e.useState)(i?"overview":"suggestions"),[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)({x:(window.innerWidth-1e3)/2,y:.1*window.innerHeight/2}),[m,p]=(0,e.useState)(!1),[f,g]=(0,e.useState)({x:0,y:0}),v=(0,e.useRef)(null),y=(0,e.useCallback)(e=>{m&&h({x:e.clientX-f.x,y:e.clientY-f.y})},[m,f]),x=()=>{p(!1)};(0,e.useEffect)(()=>(m?(window.addEventListener("mousemove",y),window.addEventListener("mouseup",x)):(window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",x)),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",x)}),[m,y]);const b=()=>{u(!0)},w=()=>{u(!1),n()};if(c)return(0,Lm.jsx)(pS,{onClose:w});if(!i)return(0,Lm.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4",onClick:n,children:(0,Lm.jsxs)("div",{className:"alliance-modal",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"alliance-modal-header",children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Join an Alliance"}),(0,Lm.jsx)("button",{onClick:n,className:"close-button",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"alliance-modal-content",children:(0,Lm.jsx)(mS,{onAllianceClick:s,onOpenCreate:b})})]})});const k=a.uid===i.leader.uid;return(0,Lm.jsxs)("div",{className:"alliance-modal",ref:v,style:{position:"fixed",top:`${d.y}px`,left:`${d.x}px`,zIndex:50},onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"alliance-modal-header",onMouseDown:e=>{(e.target.classList.contains("alliance-modal-header")||e.target.parentElement.classList.contains("alliance-modal-header"))&&(p(!0),g({x:e.clientX-d.x,y:e.clientY-d.y}))},children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-white",children:i.name}),(0,Lm.jsxs)("p",{className:"text-gray-300",children:["[",i.tag,"]"]})]}),(0,Lm.jsx)("button",{onClick:n,className:"close-button",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"alliance-modal-tabs",children:[(0,Lm.jsx)("button",{onClick:()=>l("overview"),className:"overview"===o?"active":"",children:"Overview"}),(0,Lm.jsx)("button",{onClick:()=>l("members"),className:"members"===o?"active":"",children:"Members"}),(0,Lm.jsx)("button",{onClick:()=>l("research"),className:"research"===o?"active":"",children:"Research"}),(0,Lm.jsx)("button",{onClick:()=>l("diplomacy"),className:"diplomacy"===o?"active":"",children:"Diplomacy"}),(0,Lm.jsx)("button",{onClick:()=>l("bank"),className:"bank"===o?"active":"",children:"Bank"}),(0,Lm.jsx)("button",{onClick:()=>l("properties"),className:"properties"===o?"active":"",children:"Properties"}),k&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("button",{onClick:()=>l("settings"),className:"settings"===o?"active":"",children:"Settings"}),(0,Lm.jsx)("button",{onClick:()=>l("invitations"),className:"invitations"===o?"active":"",children:"Invitations"}),(0,Lm.jsx)("button",{onClick:()=>l("ranks"),className:"ranks"===o?"active":"",children:"Ranks"})]})]}),(0,Lm.jsx)("div",{className:"alliance-modal-content",children:(()=>{switch(o){case"overview":default:return(0,Lm.jsx)(nS,{});case"members":return(0,Lm.jsx)(vp,{});case"research":return(0,Lm.jsx)(sS,{});case"diplomacy":return(0,Lm.jsx)(aS,{});case"bank":return(0,Lm.jsx)(dS,{});case"properties":return(0,Lm.jsx)(uS,{onClose:n});case"settings":return(0,Lm.jsx)(oS,{alliance:i,isLeader:k});case"invitations":return(0,Lm.jsx)(eS,{alliance:i,isLeader:k});case"ranks":return(0,Lm.jsx)(lS,{alliance:i,isLeader:k})}})()})]})},gS=e=>{let{message:t,onConfirm:n,onCancel:s}=e;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600 text-white",children:[(0,Lm.jsx)("p",{className:"mb-6 text-lg",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Lm.jsx)("button",{onClick:s,className:"forum-btn",children:"Cancel"}),(0,Lm.jsx)("button",{onClick:n,className:"forum-btn",children:"Confirm"})]})]})})},vS=t=>{var n,s;let{onClose:r,onActionClick:i}=t;const{currentUser:a,userProfile:o}=Fm(),{worldId:l}=up(),{playerAlliance:c}=sp(),[u,d]=(0,e.useState)([]),[h,m]=(0,e.useState)(null),[p,f]=(0,e.useState)([]),[g,v]=(0,e.useState)(null),[y,x]=(0,e.useState)([]),[b,w]=(0,e.useState)(""),[k,N]=(0,e.useState)(!1),[j,C]=(0,e.useState)(""),[S,_]=(0,e.useState)(""),[T,I]=(0,e.useState)(!1),[E,A]=(0,e.useState)(!1),[P,M]=(0,e.useState)(null),[D,O]=(0,e.useState)(""),[R,L]=(0,e.useState)(null),[$,F]=(0,e.useState)(null),U=(0,e.useRef)(null),V=(0,e.useRef)(null),B=(null===a||void 0===a?void 0:a.uid)===(null===c||void 0===c||null===(n=c.leader)||void 0===n?void 0:n.uid),z=(0,e.useMemo)(()=>{if(!c||!a)return null;const e=c.members.find(e=>e.uid===a.uid);return e?c.ranks.find(t=>t.id===e.rank):null},[c,a]),q=(null===z||void 0===z||null===(s=z.permissions)||void 0===s?void 0:s.viewSecretForums)||B;(0,e.useEffect)(()=>{if(!l||!c)return;const e=pm(Bh(Jd(Om,"worlds",l,"alliances",c.id,"forums"),Gh("createdAt","asc")),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));d(t),!h&&t.length>0&&m(t[0])});return()=>e()},[l,c,h]),(0,e.useEffect)(()=>{if(!h)return;const e=pm(Bh(Jd(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads"),Gh("lastReplyAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()},[h,l,c]),(0,e.useEffect)(()=>{if(!g)return void x([]);const e=pm(Bh(Jd(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads",g.id,"posts"),Gh("createdAt","asc")),e=>{x(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()},[g,h,l,c]),(0,e.useEffect)(()=>{var e;null===(e=U.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[y]),(0,e.useEffect)(()=>{if(V.current){V.current.querySelectorAll(".shared-report-placeholder").forEach(e=>{const t=e.dataset.reportId;t&&JC.render((0,Lm.jsx)(XC,{reportId:t,worldId:l,onClose:()=>{},isEmbedded:!0,onActionClick:i}),e)})}},[y,l,i]);const W=async e=>{if(e.preventDefault(),!j.trim()||!S.trim()||!h)return;const t=eh(Jd(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads"));await um(t,{title:j,creatorId:a.uid,creatorUsername:o.username,createdAt:km(),lastReplyAt:km(),lastReplyBy:o.username,lastReplyById:a.uid,replyCount:0});const n=Jd(t,"posts");await mm(n,{content:S,authorId:a.uid,authorUsername:o.username,createdAt:km()}),C(""),_(""),A(!1)},H=async e=>{if(e.preventDefault(),!S.trim()||!g)return;const t=eh(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads",g.id),n=Jd(t,"posts");await mm(n,{content:S,authorId:a.uid,authorUsername:o.username,createdAt:km()}),await dm(t,{lastReplyAt:km(),lastReplyBy:o.username,lastReplyById:a.uid,replyCount:(g.replyCount||0)+1}),_("")},G=()=>{M(null),O("")},Q=async e=>{if(e.preventDefault(),!D.trim()||!P)return;const t=eh(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads",g.id,"posts",P);await dm(t,{content:D,editedAt:km()}),G()},Y=e=>{const t=e.target;if(t.classList.contains("bbcode-action")&&i){const{actionType:e,actionId:n,actionOwnerId:s,actionCoordsX:a,actionCoordsY:o}=t.dataset;if("city_link"===e)i(e,{cityId:n,ownerId:s,coords:{x:a,y:o}});else{const t=n||{x:a,y:o};e&&t&&i(e,t)}r()}},K=(0,e.useMemo)(()=>u.filter(e=>!e.isSecret||q),[u,q]);return c?(0,Lm.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:r,children:[R&&(0,Lm.jsx)(gS,{message:R.message,onConfirm:R.onConfirm,onCancel:()=>L(null)}),(0,Lm.jsxs)("div",{className:"forum-container w-full max-w-5xl h-5/6 flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"p-4 flex justify-between items-center",children:[(0,Lm.jsx)("h2",{className:"font-title text-3xl",children:"Alliance Forum"}),(0,Lm.jsx)("button",{onClick:r,className:"text-3xl leading-none hover:text-red-700",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"forum-tabs-container",children:[K.map(e=>(0,Lm.jsx)("div",{className:"relative group",children:(null===$||void 0===$?void 0:$.id)===e.id?(0,Lm.jsxs)("form",{onSubmit:t=>(async(e,t)=>{if(e.preventDefault(),!$||!$.name.trim()||!B)return;const n=eh(Om,"worlds",l,"alliances",c.id,"forums",t);await dm(n,{name:$.name,isSecret:$.isSecret}),F(null)})(t,e.id),className:"p-1 flex items-center",children:[(0,Lm.jsx)("input",{type:"text",value:$.name,onChange:e=>F(t=>({...t,name:e.target.value})),className:"bg-white/20 text-white p-1 rounded text-sm",autoFocus:!0}),(0,Lm.jsxs)("label",{className:"flex items-center ml-2 text-sm text-white",children:[(0,Lm.jsx)("input",{type:"checkbox",checked:$.isSecret,onChange:e=>F(t=>({...t,isSecret:e.target.checked})),className:"mr-1"}),"Secret"]}),(0,Lm.jsx)("button",{type:"submit",className:"ml-2 text-white text-xl",children:"\u2713"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>F(null),className:"ml-1 text-white text-xl",children:"x"})]}):(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("button",{onClick:()=>m(e),className:"forum-tab "+((null===h||void 0===h?void 0:h.id)===e.id?"active":""),children:[e.name," ",e.isSecret&&"\ud83d\udd12"]}),B&&(0,Lm.jsxs)("div",{className:"absolute top-0 right-0 flex opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,Lm.jsx)("button",{onClick:()=>F({id:e.id,name:e.name,isSecret:e.isSecret||!1}),className:"text-white text-xs p-1",children:"\u270f\ufe0f"}),(0,Lm.jsx)("button",{onClick:()=>{return t=e.id,void L({message:"Are you sure you want to delete this forum and all its threads? This cannot be undone.",onConfirm:async()=>{if(!B)return;const e=eh(Om,"worlds",l,"alliances",c.id,"forums",t),n=Jd(e,"threads"),s=await cm(n),r=Cm(Om);for(const t of s.docs){const e=Jd(t.ref,"posts");(await cm(e)).forEach(e=>{r.delete(e.ref)}),r.delete(t.ref)}r.delete(e),await r.commit(),(null===h||void 0===h?void 0:h.id)===t&&(m(null),f([]),v(null)),L(null)}});var t},className:"text-white text-xs p-1",children:"\ud83d\uddd1\ufe0f"})]})]})},e.id)),B&&(T?(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!b.trim()||!B)return;const t=Jd(Om,"worlds",l,"alliances",c.id,"forums");await mm(t,{name:b,isSecret:k,createdAt:km()}),w(""),N(!1),I(!1)},className:"p-1 flex items-center",children:[(0,Lm.jsx)("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"New Forum Name",className:"bg-white/20 text-white p-1 rounded text-sm"}),(0,Lm.jsxs)("label",{className:"flex items-center ml-2 text-sm text-white",children:[(0,Lm.jsx)("input",{type:"checkbox",checked:k,onChange:e=>N(e.target.checked),className:"mr-1"}),"Secret"]}),(0,Lm.jsx)("button",{type:"submit",className:"ml-2 text-white text-xl",children:"+"}),(0,Lm.jsx)("button",{type:"button",onClick:()=>I(!1),className:"ml-1 text-white text-xl",children:"x"})]}):(0,Lm.jsx)("button",{onClick:()=>I(!0),className:"forum-tab new-forum-btn",children:"+"}))]}),(0,Lm.jsx)("div",{className:"overflow-y-auto flex-grow p-4",children:E?(0,Lm.jsxs)("div",{className:"p-4",children:[(0,Lm.jsxs)("h3",{className:"forum-header -m-4 mb-4 p-2",children:["Create New Thread in ",null===h||void 0===h?void 0:h.name]}),(0,Lm.jsxs)("form",{onSubmit:W,className:"space-y-3",children:[(0,Lm.jsx)("input",{type:"text",value:j,onChange:e=>C(e.target.value),placeholder:"Thread Title",className:"w-full bg-yellow-50/50 p-2 rounded border border-yellow-800/50 text-gray-800"}),(0,Lm.jsx)(vg,{value:S,onChange:_}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,Lm.jsx)("button",{type:"button",onClick:()=>A(!1),className:"forum-btn",children:"Cancel"}),(0,Lm.jsx)("button",{type:"submit",className:"forum-btn",children:"Create"})]})]})]}):g?(0,Lm.jsxs)("div",{className:"flex flex-col h-full",children:[(0,Lm.jsxs)("div",{className:"forum-header -m-6 mb-4 p-2 flex items-center",children:[(0,Lm.jsx)("button",{onClick:()=>v(null),className:"text-yellow-300 hover:text-white mr-4 text-sm",children:"< Back"}),(0,Lm.jsx)("span",{className:"font-bold",children:g.title})]}),(0,Lm.jsxs)("div",{ref:V,className:"space-y-4 mb-4 flex-grow overflow-y-auto p-2",onClick:Y,children:[y.map(e=>{var t;return(0,Lm.jsxs)("div",{className:"post-item",children:[(0,Lm.jsx)("p",{className:"post-author",dangerouslySetInnerHTML:{__html:GC(`[player id=${e.authorId}]${e.authorUsername}[/player]`)}}),P===e.id?(0,Lm.jsxs)("form",{onSubmit:Q,children:[(0,Lm.jsx)(vg,{value:D,onChange:O}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,Lm.jsx)("button",{type:"button",onClick:G,className:"forum-btn",children:"Cancel"}),(0,Lm.jsx)("button",{type:"submit",className:"forum-btn",children:"Save"})]})]}):(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("div",{className:"post-content",dangerouslySetInnerHTML:{__html:GC(e.content)}}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lm.jsxs)("p",{className:"post-timestamp",children:[null===(t=e.createdAt)||void 0===t?void 0:t.toDate().toLocaleString(),e.editedAt&&(0,Lm.jsx)("em",{className:"ml-2",children:"(edited)"})]}),a.uid===e.authorId&&(0,Lm.jsxs)("div",{className:"post-actions",children:[(0,Lm.jsx)("button",{onClick:()=>(e=>{M(e.id),O(e.content)})(e),className:"post-action-btn",children:"Edit"}),(0,Lm.jsx)("button",{onClick:()=>{return t=e.id,void L({message:"Are you sure you want to delete this post?",onConfirm:async()=>{if(!g)return;const e=eh(Om,"worlds",l,"alliances",c.id,"forums",h.id,"threads",g.id,"posts",t);await hm(e),L(null)}});var t},className:"post-action-btn",children:"Delete"})]})]})]})]},e.id)}),(0,Lm.jsx)("div",{ref:U})]}),(0,Lm.jsxs)("form",{onSubmit:H,className:"mt-auto flex-shrink-0 p-2 reply-form",children:[(0,Lm.jsx)(vg,{value:S,onChange:_}),(0,Lm.jsx)("div",{className:"flex justify-end mt-2",children:(0,Lm.jsx)("button",{type:"submit",className:"forum-btn",children:"Post Reply"})})]})]}):(0,Lm.jsxs)("div",{children:[(0,Lm.jsxs)("table",{className:"forum-table",children:[(0,Lm.jsx)("thead",{children:(0,Lm.jsxs)("tr",{children:[(0,Lm.jsx)("th",{className:"w-2/3",children:"Theme"}),(0,Lm.jsx)("th",{className:"text-center",children:"Replies"}),(0,Lm.jsx)("th",{children:"Last Post"})]})}),(0,Lm.jsx)("tbody",{children:p.map(e=>{var t,n;return(0,Lm.jsxs)("tr",{onClick:()=>v(e),children:[(0,Lm.jsxs)("td",{children:[(0,Lm.jsx)("p",{className:"font-bold",children:e.title}),(0,Lm.jsx)("p",{className:"text-xs",dangerouslySetInnerHTML:{__html:`by ${GC(`[player id=${e.creatorId}]${e.creatorUsername}[/player]`)} on ${null===(t=e.createdAt)||void 0===t?void 0:t.toDate().toLocaleDateString()}`}})]}),(0,Lm.jsx)("td",{className:"text-center",children:e.replyCount||0}),(0,Lm.jsxs)("td",{children:[(0,Lm.jsx)("p",{className:"font-bold text-sm",dangerouslySetInnerHTML:{__html:e.lastReplyById?GC(`[player id=${e.lastReplyById}]${e.lastReplyBy}[/player]`):e.lastReplyBy}}),(0,Lm.jsx)("p",{className:"text-xs",children:null===(n=e.lastReplyAt)||void 0===n?void 0:n.toDate().toLocaleString()})]})]},e.id)})})]}),(0,Lm.jsx)("div",{className:"mt-4 flex justify-start gap-4",children:u.length>0&&(0,Lm.jsx)("button",{onClick:()=>A(!0),className:"forum-btn",children:"New Thread"})})]})})]})]}):(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:r,children:(0,Lm.jsxs)("div",{className:"forum-container w-full max-w-lg h-auto flex flex-col items-center justify-center p-8",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("p",{className:"text-2xl text-center",children:"You must be in an alliance to view the forum."}),(0,Lm.jsx)("button",{onClick:r,className:"forum-btn mt-6",children:"Close"})]})})},yS=e=>{let{message:t,onConfirm:n,onCancel:s,confirmText:r="Confirm",cancelText:i="Cancel"}=e;return(0,Lm.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600 text-white",children:[(0,Lm.jsx)("p",{className:"mb-6 text-lg",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary px-6 py-2",children:i}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-danger px-6 py-2",children:r})]})]})})},xS=t=>{var n,s,r;let{onClose:i}=t;const{gameSettings:a,setGameSettings:o,worldId:l,playerCity:c,activeCityId:u}=up(),{currentUser:d}=Fm(),[h,m]=(0,e.useState)("gameplay"),[p,f]=(0,e.useState)(null),g=e=>{const{name:t,type:n,checked:s,value:r}=e.target;o(e=>({...e,[t]:"checkbox"===n?s:r}))},v=e=>{const{name:t,value:n}=e.target;o(e=>({...e,workerPresets:{...e.workerPresets,[t]:parseInt(n,10)||0}}))},y=async()=>{if(!l||!d||!c||!u)return console.error("Missing world, user, or city data for reset."),void f(null);const e=Cm(Om),t=tp(),n=eh(Om,"worlds",l,"ruins",t),s={id:t,x:c.x,y:c.y,name:`Abandoned City of ${c.cityName}`,ownerId:"ruins",ownerUsername:"Ancient Guardians",troops:{hoplite:50,swordsman:50,archer:30},researchReward:`qol_research_${Math.floor(3*Math.random())}`};e.set(n,s);const r=eh(Om,"worlds",l,"citySlots",c.slotId);e.update(r,{ownerId:null,ownerUsername:null,cityName:"Unclaimed",ownerFaction:null,alliance:null,allianceName:null});const a=eh(Om,`users/${d.uid}/games`,l),o=async t=>{const n=Bh(Jd(a,t));(await cm(n)).docs.forEach(t=>{e.delete(t.ref)})};await o("cities"),await o("conqueredVillages"),await o("conqueredRuins"),await o("quests"),e.delete(a);try{await e.commit(),f(null),i()}catch(h){console.error("Error resetting game:",h),f({message:`Failed to reset game: ${h.message}`,onConfirm:()=>f(null),onCancel:()=>f(null),confirmText:"OK",cancelText:null})}};return(0,Lm.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:i,children:[p&&(0,Lm.jsx)(yS,{message:p.message,onConfirm:p.onConfirm,onCancel:p.onCancel,confirmText:p.confirmText,cancelText:p.cancelText}),(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border-2 border-gray-600 text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lm.jsx)("h2",{className:"text-2xl font-bold text-center text-yellow-400",children:"Game Settings"}),(0,Lm.jsx)("button",{onClick:i,className:"text-gray-400 text-3xl leading-none hover:text-white",children:"\xd7"})]}),(0,Lm.jsxs)("div",{className:"settings-tabs mb-4 flex border-b border-gray-600",children:[(0,Lm.jsx)("button",{onClick:()=>m("gameplay"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("gameplay"===h?"bg-gray-700 text-white":"text-gray-400 hover:bg-gray-700"),children:"Gameplay"}),(0,Lm.jsx)("button",{onClick:()=>m("display"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("display"===h?"bg-gray-700 text-white":"text-gray-400 hover:bg-gray-700"),children:"Display"}),(0,Lm.jsx)("button",{onClick:()=>m("notifications"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("notifications"===h?"bg-gray-700 text-white":"text-gray-400 hover:bg-gray-700"),children:"Notifications"}),(0,Lm.jsx)("button",{onClick:()=>m("account"),className:"flex-1 p-2 text-lg font-bold transition-colors "+("account"===h?"bg-gray-700 text-white":"text-gray-400 hover:bg-gray-700"),children:"Account"})]}),(0,Lm.jsxs)("div",{className:"space-y-4",children:["gameplay"===h&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"showVisuals",className:"text-lg font-semibold",children:"Enable Visuals"}),(0,Lm.jsx)("input",{type:"checkbox",id:"showVisuals",name:"showVisuals",checked:a.showVisuals,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"showGrid",className:"text-lg font-semibold",children:"Enable Grid"}),(0,Lm.jsx)("input",{type:"checkbox",id:"showGrid",name:"showGrid",checked:a.showGrid,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"animations",className:"text-lg font-semibold",children:"Enable Animations"}),(0,Lm.jsx)("input",{type:"checkbox",id:"animations",name:"animations",checked:a.animations,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]})]}),"display"===h&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"theme",className:"text-lg font-semibold",children:"Theme"}),(0,Lm.jsxs)("select",{id:"theme",name:"theme",value:a.theme,onChange:g,className:"bg-gray-600 text-white p-2 rounded",children:[(0,Lm.jsx)("option",{value:"dark",children:"Dark"}),(0,Lm.jsx)("option",{value:"light",children:"Light"})]})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"mapZoomSensitivity",className:"text-lg font-semibold",children:"Map Zoom Sensitivity"}),(0,Lm.jsx)("input",{type:"range",id:"mapZoomSensitivity",name:"mapZoomSensitivity",min:"0.1",max:"1",step:"0.1",value:a.mapZoomSensitivity,onChange:g,className:"w-1/2"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"hideCompletedQuestsIcon",className:"text-lg font-semibold",children:"Hide Quest Icon When Done"}),(0,Lm.jsx)("input",{type:"checkbox",id:"hideCompletedQuestsIcon",name:"hideCompletedQuestsIcon",checked:a.hideCompletedQuestsIcon||!1,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]})]}),"automation"===h&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("h3",{className:"text-xl font-semibold text-center",children:"Worker Presets"}),(0,Lm.jsx)("p",{className:"text-sm text-gray-400 text-center mb-4",children:"Set the desired number of workers for each resource building. You can apply these presets from the Senate."}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"timber_camp_preset",className:"text-lg font-semibold",children:"Timber Camp"}),(0,Lm.jsx)("input",{type:"number",id:"timber_camp_preset",name:"timber_camp",value:(null===(n=a.workerPresets)||void 0===n?void 0:n.timber_camp)||0,onChange:v,className:"bg-gray-600 text-white p-2 rounded w-24 text-center",min:"0"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"quarry_preset",className:"text-lg font-semibold",children:"Quarry"}),(0,Lm.jsx)("input",{type:"number",id:"quarry_preset",name:"quarry",value:(null===(s=a.workerPresets)||void 0===s?void 0:s.quarry)||0,onChange:v,className:"bg-gray-600 text-white p-2 rounded w-24 text-center",min:"0"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"silver_mine_preset",className:"text-lg font-semibold",children:"Silver Mine"}),(0,Lm.jsx)("input",{type:"number",id:"silver_mine_preset",name:"silver_mine",value:(null===(r=a.workerPresets)||void 0===r?void 0:r.silver_mine)||0,onChange:v,className:"bg-gray-600 text-white p-2 rounded w-24 text-center",min:"0"})]})]}),"notifications"===h&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"attackNotifications",className:"text-lg font-semibold",children:"Incoming Attack Alerts"}),(0,Lm.jsx)("input",{type:"checkbox",id:"attackNotifications",name:"attackNotifications",checked:a.attackNotifications,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"tradeNotifications",className:"text-lg font-semibold",children:"Trade Completed Alerts"}),(0,Lm.jsx)("input",{type:"checkbox",id:"tradeNotifications",name:"tradeNotifications",checked:a.tradeNotifications,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"unitCompleteNotifications",className:"text-lg font-semibold",children:"Recruitment Complete"}),(0,Lm.jsx)("input",{type:"checkbox",id:"unitCompleteNotifications",name:"unitCompleteNotifications",checked:a.unitCompleteNotifications,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]}),(0,Lm.jsxs)("div",{className:"flex justify-between items-center bg-gray-700 p-3 rounded-lg",children:[(0,Lm.jsx)("label",{htmlFor:"hideReturningReports",className:"text-lg font-semibold",children:"Hide Returning Troop Reports"}),(0,Lm.jsx)("input",{type:"checkbox",id:"hideReturningReports",name:"hideReturningReports",checked:a.hideReturningReports||!1,onChange:g,className:"w-6 h-6 rounded text-blue-600 bg-gray-600 border-gray-500 focus:ring-blue-500"})]})]}),"account"===h&&(0,Lm.jsxs)(Lm.Fragment,{children:[(0,Lm.jsx)("p",{className:"text-sm text-gray-400",children:"Warning: This action is irreversible!"}),(0,Lm.jsx)("button",{onClick:()=>f({message:"Are you absolutely sure you want to reset your game? This will destroy all your cities and cannot be undone.",onConfirm:y,onCancel:()=>f(null),confirmText:"Reset Forever",cancelText:"Cancel"}),className:"btn btn-danger w-full py-2",children:"Reset Game"})]})]}),(0,Lm.jsx)("div",{className:"mt-6 flex justify-center space-x-4",children:(0,Lm.jsx)("button",{onClick:()=>{i()},className:"btn btn-confirm py-2 px-6",children:"Close"})})]})]})},bS={},wS=t=>{let{onClose:n,viewUserId:s,onGoToCity:r,onInviteToAlliance:i,onOpenAllianceProfile:a}=t;const{currentUser:o,userProfile:l,updateUserProfile:c}=Fm(),{worldId:u}=up(),{playerAlliance:d}=sp(),{calculateTotalPoints:h}=lp(u),[m,p]=(0,e.useState)(null),[f,g]=(0,e.useState)(null),[v,y]=(0,e.useState)([]),[x,b]=(0,e.useState)(0),[w,k]=(0,e.useState)(0),[N,j]=(0,e.useState)(0),[C,S]=(0,e.useState)(!0),[_,T]=(0,e.useState)(""),[I,E]=(0,e.useState)(""),[A,P]=(0,e.useState)(!1),M=!s||s===o.uid;(0,e.useEffect)(()=>{const e=s||o.uid,t=Date.now();if(bS[e]&&t-bS[e].timestamp<12e5){const t=bS[e].data;p(t.profileData),g(t.gameData),y(t.cities),b(t.points),k(t.totalAttack),j(t.totalDefense),T(t.profileData.description||""),E(t.profileData.imageUrl||""),S(!1)}else(async()=>{S(!0);const e=s||o.uid;try{const t=eh(Om,"users",e),n=await om(t);let s=null;n.exists()&&(s=n.data(),p(s),T(s.description||""),E(s.imageUrl||""));const r=eh(Om,`users/${e}/games`,u),i=await om(r),a=i.exists()?i.data():null;g(a);const o=Jd(Om,`users/${e}/games`,u,"cities"),l=(await cm(o)).docs.map(e=>({id:e.id,...e.data()}));y(l);let c=0,d=0,m=0;for(const e of l)if(c+=h(e),e.units)for(const[t,n]of Object.entries(e.units)){const e=qm[t];e&&(d+=(e.attack||0)*n,m+=(e.defense||0)*n)}b(c),k(d),j(m),bS[e]={data:{profileData:s,gameData:a,cities:l,points:c,totalAttack:d,totalDefense:m},timestamp:Date.now()}}catch(t){console.error("Error fetching user data:",t)}S(!1)})()},[s,o.uid,u,h]);if(C)return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsx)("div",{className:"text-white",children:"Loading Profile..."})});const D=M?l:m,O=(e,t)=>void 0===e||void 0===t?"?":`${Math.floor(t/10)}${Math.floor(e/10)}`,R=(e=>{if(!d||M)return!1;const t=d.members.find(e=>e.uid===o.uid);if(!t)return!1;const n=d.ranks.find(e=>e.id===t.rank);return(null===n||void 0===n||null===(e=n.permissions)||void 0===e?void 0:e.inviteMembers)||!1})();return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"profile-papyrus !h-auto max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("button",{onClick:n,className:"profile-close-button",children:"\xd7"}),(0,Lm.jsxs)("div",{className:"profile-grid",children:[(0,Lm.jsxs)("div",{className:"profile-left-column",children:[(0,Lm.jsxs)("div",{className:"profile-box",children:[(0,Lm.jsx)("div",{className:"profile-box-header",children:null===D||void 0===D?void 0:D.username}),(0,Lm.jsx)("div",{className:"player-info-content",children:null!==f&&void 0!==f&&f.alliance?(0,Lm.jsxs)("button",{onClick:()=>a(f.alliance),className:"text-blue-400 hover:underline font-bold",children:["[",f.alliance,"]"]}):"No Alliance"}),(0,Lm.jsxs)("div",{className:"player-stats",children:[(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\u2694\ufe0f Attack Points"})," ",(0,Lm.jsx)("span",{children:w.toLocaleString()})]}),(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\ud83d\udee1\ufe0f Defense Points"})," ",(0,Lm.jsx)("span",{children:N.toLocaleString()})]}),(0,Lm.jsxs)("div",{className:"stat-item",children:[(0,Lm.jsx)("span",{children:"\ud83c\udfc6 Total Points"})," ",(0,Lm.jsx)("span",{children:x.toLocaleString()})]})]})]}),(0,Lm.jsxs)("div",{className:"profile-box flex-grow min-h-0",children:[(0,Lm.jsxs)("div",{className:"profile-box-header flex justify-between items-center",children:[(0,Lm.jsxs)("span",{children:["Cities (",v.length,")"]}),(0,Lm.jsx)("button",{className:"text-xs bg-gray-500/50 px-2 py-0.5 rounded",children:"BBCode"})]}),(0,Lm.jsx)("div",{className:"cities-list overflow-y-auto",children:v.length>0?v.map(e=>(0,Lm.jsxs)("div",{className:"city-item",children:[(0,Lm.jsx)("button",{onClick:()=>r(e.x,e.y),className:"city-name-btn",children:e.cityName}),(0,Lm.jsxs)("span",{children:[h(e).toLocaleString()," points | Ocean ",O(e.x,e.y)]})]},e.id)):(0,Lm.jsx)("p",{className:"text-sm text-center p-4",children:"No cities in this world."})})]})]}),(0,Lm.jsx)("div",{className:"profile-right-column",children:(0,Lm.jsxs)("div",{className:"profile-box",children:[(0,Lm.jsx)("div",{className:"profile-box-header",children:"Profile"}),(0,Lm.jsxs)("div",{className:"profile-description-box",children:[(0,Lm.jsx)("img",{src:(null===D||void 0===D?void 0:D.imageUrl)||yg,onError:e=>{e.target.onerror=null,e.target.src=yg},alt:"Profile Avatar",className:"profile-avatar-large"}),(0,Lm.jsx)("div",{className:"profile-description-text",children:A?(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!M)return;const t={description:_,imageUrl:I};try{await c(t),P(!1)}catch(n){console.error("Failed to update profile.",n)}},className:"h-full flex flex-col",children:[(0,Lm.jsx)(vg,{value:_,onChange:T}),(0,Lm.jsx)("input",{type:"text",value:I,onChange:e=>E(e.target.value),placeholder:"Image URL",className:"w-full mt-2 bg-white/50 border border-yellow-800/50 p-1"}),(0,Lm.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,Lm.jsx)("button",{type:"button",onClick:()=>P(!1),className:"btn-cancel",children:"Cancel"}),(0,Lm.jsx)("button",{type:"submit",className:"btn-save",children:"Save"})]})]}):(0,Lm.jsx)("p",{children:(null===D||void 0===D?void 0:D.description)||"This player has not written a profile text."})})]})]})})]}),M&&!A&&(0,Lm.jsx)("button",{onClick:()=>P(!0),className:"profile-edit-button",children:"Edit Profile"}),R&&(0,Lm.jsx)("button",{onClick:()=>i(s),className:"profile-edit-button",children:"Invite to Alliance"})]})})},kS=e=>{var t;let{quests:n,claimReward:s,isClaiming:r,onClose:i,cityState:a}=e;const o=n.filter(e=>!e.isClaimed),l=null===a||void 0===a||null===(t=a.playerInfo)||void 0===t?void 0:t.nation,c=e=>{const t=[];if(e.resources)for(const r in e.resources)t.push(`${e.resources[r]} ${r}`);if(e.units&&l)for(const r in e.units){const i=e.units[r];let a;if(r.startsWith("generic_")){var n;const e=Lp(l,r);a=(null===(n=qm[e])||void 0===n?void 0:n.name)||e}else{var s;a=(null===(s=qm[r])||void 0===s?void 0:s.name)||r}t.push(`${i} ${a}`)}return t.join(", ")};return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:i,children:(0,Lm.jsxs)("div",{className:"quest-modal-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsxs)("div",{className:"quest-modal-header",children:[(0,Lm.jsx)("h2",{children:"Quests"}),(0,Lm.jsx)("button",{onClick:i,className:"close-btn",children:"\xd7"})]}),(0,Lm.jsx)("div",{className:"quest-modal-content",children:o.length>0?o.map(e=>(0,Lm.jsxs)("div",{className:"quest-item",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"quest-title",children:e.title}),(0,Lm.jsx)("p",{className:"quest-description",children:e.description}),(0,Lm.jsxs)("div",{className:"quest-rewards",children:["Reward: ",c(e.rewards)]})]}),(0,Lm.jsx)("button",{onClick:()=>s(e.id),disabled:!e.isComplete||r,className:"quest-claim-btn",children:r?"Claiming...":e.isComplete?"Claim":"In Progress"})]},e.id)):(0,Lm.jsx)("p",{className:"text-center",children:"No active quests."})})]})})},NS=t=>{let{onClose:n}=t;const{worldState:s,worldId:r}=up(),[i,a]=(0,e.useState)("");return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:n,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md border-2 border-gray-600",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl text-white mb-4",children:"Admin Event Triggers"}),i&&(0,Lm.jsx)("p",{className:"text-center text-yellow-400 mb-4",children:i}),(0,Lm.jsxs)("div",{className:"space-y-4",children:[(0,Lm.jsx)("button",{onClick:async()=>{if(s){a("Spawning a God Town...");try{const e=pg(s.islands,s.width,s.height,1);if(0===Object.keys(e).length)throw new Error("Failed to find a suitable location in the sea. Try again.");const[t,n]=Object.entries(e)[0],i=eh(Om,"worlds",r,"godTowns",t);await um(i,n),a(`God Town spawned as "Strange Ruins" at (${n.x}, ${n.y})!`)}catch(e){console.error("Error spawning God Town:",e),a(`Failed to spawn God Town: ${e.message}`)}}else a("World data is not loaded.")},className:"btn btn-primary w-full py-2 bg-purple-600 hover:bg-purple-500",children:"Spawn God Town Event"}),(0,Lm.jsx)("button",{onClick:async()=>{a("Searching for ruins to transform...");try{const e=Bh(Jd(Om,"worlds",r,"godTowns"),qh("stage","==","ruins"),Yh(1)),t=await cm(e);if(t.empty)return void a("No God Town ruins found to transform.");const n=t.docs[0];await dm(n.ref,{stage:"city",name:"City of the Gods"}),a(`Ruins at (${n.data().x}, ${n.data().y}) transformed into a city!`)}catch(e){console.error("Error transforming ruins:",e),a(`Failed to transform ruins: ${e.message}`)}},className:"btn btn-primary w-full py-2 bg-green-600 hover:bg-green-500",children:"Instantly Transform Ruins"}),(0,Lm.jsx)("button",{onClick:async()=>{a("Searching for a God Town to despawn...");try{const e=Bh(Jd(Om,"worlds",r,"godTowns"),Yh(1)),t=await cm(e);if(t.empty)return void a("No God Towns found to despawn.");const n=t.docs[0];await hm(n.ref),a(`God Town at (${n.data().x}, ${n.data().y}) has been despawned.`)}catch(e){console.error("Error despawning God Town:",e),a(`Failed to despawn God Town: ${e.message}`)}},className:"btn btn-danger w-full py-2",children:"Despawn God Town Event"})]})]})})},jS=JSON.parse('{"puzzle_1":{"question":"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?","answer":"A map"},"puzzle_2":{"question":"What has an eye, but cannot see?","answer":"A needle"},"puzzle_3":{"question":"What is full of holes but still holds water?","answer":"A sponge"}}'),CS=t=>{let{puzzleId:n,onSolve:s}=t;const[r,i]=(0,e.useState)(null),[a,o]=(0,e.useState)(""),[l,c]=(0,e.useState)("");(0,e.useEffect)(()=>{jS[n]&&i(jS[n])},[n]);return r?(0,Lm.jsxs)("div",{className:"p-4 bg-black/10 rounded mt-4",children:[(0,Lm.jsxs)("p",{className:"italic",children:['"',r.question,'"']}),(0,Lm.jsxs)("div",{className:"flex mt-4",children:[(0,Lm.jsx)("input",{type:"text",value:a,onChange:e=>o(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your answer..."}),(0,Lm.jsx)("button",{onClick:()=>{a.toLowerCase().trim()===r.answer.toLowerCase().trim()?(c("Correct! The way is open."),s()):c("Incorrect. The guardians ponder your answer...")},className:"btn btn-primary ml-2",children:"Submit"})]}),l&&(0,Lm.jsx)("p",{className:"text-center mt-2",children:l})]}):(0,Lm.jsx)("div",{children:"Loading puzzle..."})},SS=t=>{let{townId:n,onClose:s,onAttack:r}=t;const{currentUser:i}=Fm(),{worldId:a}=up(),[o,l]=(0,e.useState)(null),[c,u]=(0,e.useState)(null),[d,h]=(0,e.useState)(!0);(0,e.useEffect)(()=>{if(!a||!n||!i)return void h(!1);const e=pm(eh(Om,"worlds",a,"godTowns",n),e=>{e.exists()?l({id:e.id,...e.data()}):s()}),t=eh(Om,"worlds",a,"godTowns",n,"playerProgress",i.uid),r=pm(t,async e=>{if(e.exists())u(e.data());else{const e={puzzleSolved:!1,damageDealt:0};try{await um(t,e),u(e)}catch(n){console.error("Failed to create player progress doc:",n)}}});return()=>{e(),r()}},[a,n,i,s]),(0,e.useEffect)(()=>{null!==o&&null!==c&&h(!1)},[o,c]);const m=async()=>{if(!a||!n||!i)return;const e=eh(Om,"worlds",a,"godTowns",n,"playerProgress",i.uid);await dm(e,{puzzleSolved:!0}),u(e=>({...e,puzzleSolved:!0}))};if(d)return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:(0,Lm.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg text-white",children:"Loading..."})});if(!o)return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg text-white",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("p",{children:"Could not load God Town information."}),(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary mt-4",children:"Close"})]})});return(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",onClick:s,children:(0,Lm.jsxs)("div",{className:"other-city-modal-container",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("div",{className:"other-city-modal-header",children:(0,Lm.jsx)("button",{onClick:s,className:"close-btn",children:"\xd7"})}),(0,Lm.jsx)("div",{className:"other-city-modal-content",children:"ruins"===o.stage?(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl",children:"Strange Ruins"}),(0,Lm.jsx)("p",{children:"These ancient ruins hum with a mysterious power. It seems they are slowly reforming into something grander."}),(0,Lm.jsxs)("p",{className:"mt-4",children:["Time until transformation:",(0,Lm.jsx)("span",{className:"font-bold text-yellow-400 ml-2",children:(0,Lm.jsx)(Bf,{arrivalTime:o.transformationTime})})]})]}):"city"===o.stage?null!==c&&void 0!==c&&c.puzzleSolved?(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl",children:o.name}),(0,Lm.jsx)("p",{children:"The city is vulnerable. Attack to earn war points and resources!"}),(0,Lm.jsx)("div",{className:"my-4",children:(0,Lm.jsx)(sg,{units:o.troops||{},title:"Garrison"})}),(0,Lm.jsx)("button",{onClick:()=>r(o),className:"btn btn-danger mt-4",children:"Attack"})]}):(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h3",{className:"font-title text-2xl",children:"The God Town's Challenge"}),(0,Lm.jsx)("p",{children:"To prove your worthiness to attack, you must first solve a riddle posed by the town's ancient guardians."}),(0,Lm.jsx)(CS,{puzzleId:o.puzzleId,onSolve:m})]}):(0,Lm.jsx)("p",{children:"The God Town has been conquered and has settled on a new island!"})})]})})};var _S=n(2601),TS=n(7712);let IS={villages:null,ruins:null,lastFetchTimestamp:0};const ES=t=>{var n,s,r,i;let{onBackToWorlds:a}=t;const{activeCityId:o,setActiveCityId:l,worldId:c,loading:u,gameState:d,playerCities:h,conqueredVillages:m,renameCity:p,playerCity:f,playerGameData:g}=up(),{currentUser:v,userProfile:y}=Fm(),{acceptAllianceInvitation:x,declineAllianceInvitation:b,sendAllianceInvitation:w}=sp(),[k,N]=(0,e.useState)("city"),[j,C]=(0,e.useState)(!1),[S,_]=(0,e.useState)(null),[T,I]=(0,e.useState)(null),[E,A]=(0,e.useState)(null),[P,M]=(0,e.useState)(null),[D,O]=(0,e.useState)([]),[R,L]=(0,e.useState)({}),[$,F]=(0,e.useState)({}),[U,V]=(0,e.useState)({}),B=(0,e.useRef)(),z=(0,e.useRef)();qC(c);const{modalState:q,openModal:W,closeModal:H}=(()=>{const[t,n]=(0,e.useState)({selectedCity:null,selectedVillage:null,actionDetails:null,isMovementsPanelOpen:!1,isReportsPanelOpen:!1,isAllianceModalOpen:!1,isAllianceCreationOpen:!1,isMessagesPanelOpen:!1,isDivinePowersOpen:!1,divinePowersTarget:null,isProfileModalOpen:!1,isAllianceForumOpen:!1,isLeaderboardOpen:!1,isAllianceProfileOpen:!1,isQuestsModalOpen:!1,isSettingsModalOpen:!1,isRecruitmentPanelOpen:!1,isTradesPanelOpen:!1,isWithdrawModalOpen:!1,withdrawModalData:null,isReinforcementsModalOpen:!1,reinforcementsModalData:null,isEventTriggerOpen:!1,viewingProfileId:null,viewingAllianceId:null});return{modalState:t,openModal:(e,t)=>{n(n=>{switch(e){case"city":return{...n,selectedCity:t};case"village":return{...n,selectedVillage:t};case"action":return{...n,actionDetails:t};case"movements":return{...n,isMovementsPanelOpen:!0};case"reports":return{...n,isReportsPanelOpen:!0};case"alliance":return{...n,isAllianceModalOpen:!0};case"allianceCreation":return{...n,isAllianceCreationOpen:!0};case"messages":return{...n,isMessagesPanelOpen:!0};case"divinePowers":return{...n,isDivinePowersOpen:!0,divinePowersTarget:(null===t||void 0===t?void 0:t.targetCity)||null};case"profile":return{...n,isProfileModalOpen:!0,viewingProfileId:(null===t||void 0===t?void 0:t.userId)||null};case"allianceForum":return{...n,isAllianceForumOpen:!0};case"leaderboard":return{...n,isLeaderboardOpen:!0};case"allianceProfile":return{...n,isAllianceProfileOpen:!0,viewingAllianceId:(null===t||void 0===t?void 0:t.allianceId)||null};case"quests":return{...n,isQuestsModalOpen:!0};case"settings":return{...n,isSettingsModalOpen:!0};case"recruitment":return{...n,isRecruitmentPanelOpen:!0};case"trades":return{...n,isTradesPanelOpen:!0};case"eventTrigger":return{...n,isEventTriggerOpen:!0};case"withdraw":return{...n,isWithdrawModalOpen:!0,withdrawModalData:t};case"reinforcements":return{...n,isReinforcementsModalOpen:!0,reinforcementsModalData:t};default:return n}})},closeModal:e=>{n(t=>{switch(e){case"city":return{...t,selectedCity:null};case"village":return{...t,selectedVillage:null};case"action":return{...t,actionDetails:null};case"movements":return{...t,isMovementsPanelOpen:!1};case"reports":return{...t,isReportsPanelOpen:!1};case"alliance":return{...t,isAllianceModalOpen:!1};case"allianceCreation":return{...t,isAllianceCreationOpen:!1};case"messages":return{...t,isMessagesPanelOpen:!1};case"divinePowers":return{...t,isDivinePowersOpen:!1,divinePowersTarget:null};case"profile":return{...t,isProfileModalOpen:!1,viewingProfileId:null};case"allianceForum":return{...t,isAllianceForumOpen:!1};case"leaderboard":return{...t,isLeaderboardOpen:!1};case"allianceProfile":return{...t,isAllianceProfileOpen:!1,viewingAllianceId:null};case"quests":return{...t,isQuestsModalOpen:!1};case"settings":return{...t,isSettingsModalOpen:!1};case"recruitment":return{...t,isRecruitmentPanelOpen:!1};case"trades":return{...t,isTradesPanelOpen:!1};case"eventTrigger":return{...t,isEventTriggerOpen:!1};case"withdraw":return{...t,isWithdrawModalOpen:!1,withdrawModalData:null};case"reinforcements":return{...t,isReinforcementsModalOpen:!1,reinforcementsModalData:null};default:return t}})}}})(),{modalState:G,openModal:Q,closeModal:Y,setModalState:K}=(()=>{const[t,n]=(0,e.useState)({selectedBuildingId:null,isSenateViewOpen:!1,isBarracksMenuOpen:!1,isShipyardMenuOpen:!1,isTempleMenuOpen:!1,isDivineTempleMenuOpen:!1,isCaveMenuOpen:!1,isAcademyMenuOpen:!1,isHospitalMenuOpen:!1,isCheatMenuOpen:!1,isDivinePowersOpen:!1,isMarketMenuOpen:!1,isSpecialBuildingMenuOpen:!1,isSpecialBuildingPanelOpen:!1,isHeroesAltarOpen:!1,isWorkerPresetPanelOpen:!1,isPrisonMenuOpen:!1});return{modalState:t,setModalState:n,openModal:e=>n(t=>({...t,[e]:!0})),closeModal:e=>n(t=>({...t,[e]:!1,selectedBuildingId:null}))}})(),{unreadReportsCount:X,setUnreadReportsCount:J,unreadMessagesCount:Z,setUnreadMessagesCount:ee}=$C(),te=(0,e.useCallback)(e=>{e&&l(e),N("city")},[l]),{handleCancelMovement:ne,handleActionClick:se}=LC(W,H,0,()=>{}),re=(0,e.useCallback)(()=>{"map"===k&&f&&_({x:f.x,y:f.y})},[k,f]),ie=(0,e.useCallback)(e=>{l(e)},[l]);(0,e.useEffect)(()=>{if("map"===k){const e=o!==B.current,t=k!==z.current;if(e||t){const e=h[o];e&&_({x:e.x,y:e.y})}}B.current=o,z.current=k},[o,k,h]),(0,e.useEffect)(()=>{if(!v||!c)return;const e=eh(Om,"users",v.uid),t=eh(Om,`users/${v.uid}/games`,c),n=async()=>{const n=km();try{await dm(e,{lastSeen:n}),await dm(t,{lastSeen:n})}catch(s){"not-found"!==s.code&&console.error("Failed to update presence:",s)}};n();const s=setInterval(n,18e4),r=()=>{v&&(dm(e,{lastSeen:null}),dm(t,{lastSeen:null}))};return window.addEventListener("beforeunload",r),()=>{clearInterval(s),window.removeEventListener("beforeunload",r)}},[v,c]);const ae=(0,e.useCallback)(e=>{const t=Object.values(h).sort((e,t)=>e.cityName.localeCompare(t.cityName)),n=t.map(e=>e.id);if(n.length<=1)return;const s=n.indexOf(o);let r;r="right"===e?(s+1)%n.length:(s-1+n.length)%n.length;const i=n[r];ie(i)},[h,o,ie]);var oe;oe={view:k,toggleView:()=>{N(e=>"city"===e?"map":"city")},openAlliance:()=>W("alliance"),openQuests:()=>W("quests"),centerOnCity:re,openForum:()=>W("allianceForum"),openMessages:()=>W("messages"),openLeaderboard:()=>W("leaderboard"),openProfile:()=>W("profile"),openSettings:()=>W("settings"),cycleCityLeft:()=>ae("left"),cycleCityRight:()=>ae("right"),openSenate:()=>Q("isSenateViewOpen"),openBarracks:()=>Q("isBarracksMenuOpen"),openShipyard:()=>Q("isShipyardMenuOpen"),openAcademy:()=>Q("isAcademyMenuOpen"),openMarket:()=>Q("isMarketMenuOpen"),openTemple:()=>Q("isTempleMenuOpen")},(0,e.useEffect)(()=>{const e=e=>{var t,n,s,r,i,a,o,l,c,u,d,h,m,p,f,g,v;const y=document.activeElement;if("INPUT"!==y.tagName&&"TEXTAREA"!==y.tagName&&!y.isContentEditable){switch(e.key.toLowerCase()){case"m":null===(t=oe.toggleView)||void 0===t||t.call(oe);break;case"g":null===(n=oe.openAlliance)||void 0===n||n.call(oe);break;case"q":null===(s=oe.openQuests)||void 0===s||s.call(oe);break;case" ":e.preventDefault(),null===(r=oe.centerOnCity)||void 0===r||r.call(oe);break;case"f":null===(i=oe.openForum)||void 0===i||i.call(oe);break;case"i":null===(a=oe.openMessages)||void 0===a||a.call(oe);break;case"l":null===(o=oe.openLeaderboard)||void 0===o||o.call(oe);break;case"p":null===(l=oe.openProfile)||void 0===l||l.call(oe);break;case"o":null===(c=oe.openSettings)||void 0===c||c.call(oe);break;case"arrowleft":null===(u=oe.cycleCityLeft)||void 0===u||u.call(oe);break;case"arrowright":null===(d=oe.cycleCityRight)||void 0===d||d.call(oe)}if("city"===oe.view)switch(e.key.toLowerCase()){case"s":null===(h=oe.openSenate)||void 0===h||h.call(oe);break;case"b":null===(m=oe.openBarracks)||void 0===m||m.call(oe);break;case"h":null===(p=oe.openShipyard)||void 0===p||p.call(oe);break;case"u":null===(f=oe.openAcademy)||void 0===f||f.call(oe);break;case"k":null===(g=oe.openMarket)||void 0===g||g.call(oe);break;case"t":null===(v=oe.openTemple)||void 0===v||v.call(oe)}}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[oe]),(0,e.useEffect)(()=>{if(!c||!v)return;const e=pm(Bh(Jd(Om,"worlds",c,"movements"),qh("involvedParties","array-contains",v.uid)),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));O(t.sort((e,t)=>e.arrivalTime.toMillis()-t.arrivalTime.toMillis()))});(async()=>{const e=Date.now();if(e-IS.lastFetchTimestamp<9e5&&IS.villages&&IS.ruins)return L(IS.villages),void F(IS.ruins);const t=Jd(Om,"worlds",c,"villages"),n=await cm(t),s={};n.forEach(e=>{s[e.id]={id:e.id,...e.data()}}),L(s),IS.villages=s;const r=Jd(Om,"worlds",c,"ruins"),i=await cm(r),a={};i.forEach(e=>{a[e.id]={id:e.id,...e.data()}}),F(a),IS.ruins=a,IS.lastFetchTimestamp=e})();const t=pm(Jd(Om,"worlds",c,"godTowns"),e=>{const t={};e.docs.forEach(e=>{t[e.id]={id:e.id,...e.data()}}),V(t)});return()=>{e(),t()}},[c,v]);const le=(0,e.useCallback)(async(e,t)=>{const n=e.cityId,s=h[n],r="heal"===t?"healQueue":`${t}Queue`,i="heal"===t?"heal_cost":"cost",a="heal"===t?"wounded":"units";if(!s||!s[r])return;const o=eh(Om,"users",v.uid,"games",c,"cities",n);try{await wm(Om,async n=>{var s;const l=await n.get(o);if(!l.exists())throw new Error("City data not found.");const c=l.data(),u=c[r].findIndex(t=>t.id===e.id);if(-1===u)throw new Error("Item not found in queue.");const d=[...c[r]],h=d.splice(u,1)[0],m=qm[h.unitId],p=(f=null===(s=c.buildings.warehouse)||void 0===s?void 0:s.level)?Math.floor(1500*Math.pow(1.4,f-1)):0;var f;const g={...c.resources};g.wood=Math.min(p,g.wood+(m[i].wood||0)*h.amount),g.stone=Math.min(p,g.stone+(m[i].stone||0)*h.amount),g.silver=Math.min(p,g.silver+(m[i].silver||0)*h.amount);const v={...c[a]};"heal"===t&&(v[h.unitId]=(v[h.unitId]||0)+h.amount);for(let e=u;e<d.length;e++){const n=0===e?Date.now():d[e-1].endTime.toDate?d[e-1].endTime.toDate().getTime():new Date(d[e-1].endTime).getTime(),s=d[e],r=qm[s.unitId],i=("heal"===t?r.heal_time:r.cost.time)*s.amount;d[e].endTime=new Date(n+1e3*i)}const y={resources:g,[r]:d};"heal"===t&&(y.wounded=v),n.update(o,y)})}catch(l){console.error("Error cancelling training:",l)}},[c,v,h]),ce=(0,e.useCallback)(async e=>{null!==y&&void 0!==y&&y.is_admin&&await dm(eh(Om,"worlds",c,"movements",e),{arrivalTime:new Date})},[y,c]);((t,n,s,r)=>{(0,e.useEffect)(()=>{if(!t||!n)return;const e=pm(Bh(Jd(Om,"users",t.uid,"worlds",n,"reports"),qh("read","==",!1)),e=>{s(e.size)}),i=pm(Bh(Jd(Om,"worlds",n,"conversations"),qh("participants","array-contains",t.uid)),e=>{let n=0;e.forEach(e=>{const s=e.data();s.lastMessage&&s.lastMessage.senderId!==t.uid&&!s.readBy.includes(t.uid)&&n++}),r(n)});return()=>{e(),i()}},[t,n,s,r])})(v,c,J,ee);const{quests:ue,claimReward:de,isClaiming:he}=HC(d),{incomingAttackCount:me,isUnderAttack:pe}=(0,e.useMemo)(()=>{if(!D||!h)return{incomingAttackCount:0,isUnderAttack:!1};const e=Object.keys(h),t=D.filter(t=>"attack"===t.type&&e.includes(t.targetCityId)&&"moving"===t.status||"attack_village"===t.type&&t.targetVillageId&&m[t.targetVillageId]&&"moving"===t.status).length;return{incomingAttackCount:t,isUnderAttack:t>0}},[D,h,m]),fe=(0,e.useMemo)(()=>({...h,...R,...$}),[h,R,$]),ge=e=>W("profile",{userId:e}),ve=e=>W("allianceProfile",{allianceId:e}),ye=(0,e.useCallback)((e,t)=>{N("map"),_({x:e,y:t}),H("profile")},[H]),xe=()=>{W("eventTrigger")},be=(e,t)=>{switch(H("reports"),T&&I(null),H("allianceForum"),H("messages"),e){case"city_link":if(t.ownerId===v.uid){const e=h[t.cityId];e&&(H("reports"),t.cityId===o?W("ownActiveCity",e):W("ownInactiveCity",e))}else M({type:"open_city_modal",coords:t.coords}),N("map"),H("reports");break;case"profile":ge(t);break;case"alliance_profile":ve(t);break;case"go_to_city":N("map"),_({x:parseFloat(t.x),y:parseFloat(t.y)});break;case"go_to_city_and_open_modal":H("reports"),M({type:"open_city_modal",coords:t}),N("map");break;case"accept_invite":x(t).catch(e=>alert(e.message));break;case"decline_invite":b(t).catch(e=>alert(e.message));break;case"view_report":I(t);break;case"viewReinforcements":W("reinforcements",t);break;default:console.warn(`Unhandled action type: ${e}`)}};return u?(0,Lm.jsx)(BC,{message:"Loading Game..."}):(0,Lm.jsxs)("div",{className:"w-full h-screen bg-gray-900 text-white relative",children:["city"===k&&(0,Lm.jsx)(Yg,{showMap:()=>N("map"),worldId:c,openModal:W,unreadReportsCount:X,unreadMessagesCount:Z,isUnderAttack:pe,incomingAttackCount:me,handleOpenAlliance:()=>W("alliance"),handleOpenProfile:ge,movements:D,onCancelTrain:le,onCancelMovement:ne,combinedSlots:fe,onRenameCity:p,quests:ue,handleOpenEvents:xe,onSwitchCity:ie,battlePoints:(null===g||void 0===g?void 0:g.battlePoints)||0,cityModalState:G,openCityModal:Q,closeCityModal:Y,setCityModalState:K}),"map"===k&&(0,Lm.jsx)(VC,{showCity:te,openModal:W,closeModal:H,modalState:q,unreadReportsCount:X,unreadMessagesCount:Z,quests:ue,claimReward:de,handleMessageAction:be,panToCoords:S,setPanToCoords:_,handleGoToCityFromProfile:ye,movements:D,villages:R,ruins:$,godTowns:U,onCancelTrain:le,onCancelMovement:ne,isUnderAttack:pe,incomingAttackCount:me,onRenameCity:p,centerOnCity:re,onGodTownClick:e=>{A(e)},handleOpenEvents:xe,onSwitchCity:ie,battlePoints:(null===g||void 0===g?void 0:g.battlePoints)||0,initialMapAction:P,setInitialMapAction:M}),q.isReportsPanelOpen&&(0,Lm.jsx)(YC,{onClose:()=>H("reports"),onActionClick:be}),q.isMessagesPanelOpen&&(0,Lm.jsx)(tS,{onClose:()=>H("messages"),onActionClick:be,initialRecipientId:null===(n=q.actionDetails)||void 0===n||null===(s=n.city)||void 0===s?void 0:s.ownerId,initialRecipientUsername:null===(r=q.actionDetails)||void 0===r||null===(i=r.city)||void 0===i?void 0:i.ownerUsername}),q.isAllianceModalOpen&&(0,Lm.jsx)(fS,{onClose:()=>H("alliance"),onOpenAllianceProfile:ve,openModal:W}),q.isAllianceCreationOpen&&(0,Lm.jsx)(pS,{onClose:()=>H("allianceCreation")}),q.isAllianceForumOpen&&(0,Lm.jsx)(vS,{onClose:()=>H("allianceForum"),onActionClick:be}),q.isQuestsModalOpen&&(0,Lm.jsx)(kS,{quests:ue,claimReward:de,isClaiming:he,onClose:()=>H("quests"),cityState:d}),q.isProfileModalOpen&&(0,Lm.jsx)(bg,{onClose:()=>H("profile"),viewUserId:q.viewingProfileId,onGoToCity:ye,onInviteToAlliance:e=>w(e).catch(e=>alert(e.message)),onOpenAllianceProfile:ve}),q.isLeaderboardOpen&&(0,Lm.jsx)(Ng,{onClose:()=>H("leaderboard"),onOpenProfile:ge,onOpenAllianceProfile:ve}),q.isAllianceProfileOpen&&(0,Lm.jsx)(wS,{allianceId:q.viewingAllianceId,onClose:()=>H("allianceProfile"),onOpenProfile:ge}),q.isSettingsModalOpen&&(0,Lm.jsx)(xS,{onClose:()=>H("settings")}),q.isEventTriggerOpen&&(null===y||void 0===y?void 0:y.is_admin)&&(0,Lm.jsx)(NS,{onClose:()=>H("eventTrigger")}),T&&(0,Lm.jsx)(XC,{reportId:T,onClose:()=>I(null),onActionClick:be}),E&&(0,Lm.jsx)(SS,{townId:E,onClose:()=>A(null),onAttack:e=>{const t={id:e.id,name:e.name,cityName:e.name,x:e.x,y:e.y,isGodTownTarget:!0,...e};se("attack",t),A(null)}}),q.isMovementsPanelOpen&&(0,Lm.jsx)(NC,{movements:D,onClose:()=>H("movements"),combinedSlots:fe,villages:R,onCancel:ne,onRush:ce,isAdmin:null===y||void 0===y?void 0:y.is_admin}),(0,Lm.jsxs)("div",{className:"chat-container",children:[(0,Lm.jsx)("button",{onClick:()=>C(e=>!e),className:"chat-toggle-button",children:"\ud83d\udcac"}),(0,Lm.jsx)(zC,{isVisible:j,onClose:()=>C(!1)})]}),(0,Lm.jsxs)("div",{className:"absolute bottom-4 left-4 z-30 flex flex-col space-y-2",children:["map"===k&&(0,Lm.jsx)("button",{onClick:a,className:"p-2 rounded-full shadow-lg hover:bg-blue-500 transition-colors",title:"Back to Worlds",children:(0,Lm.jsx)("img",{src:TS,alt:"Back to Worlds",className:"w-8 h-8"})}),(0,Lm.jsx)("button",{onClick:async()=>{if(v){const e=eh(Om,"users",v.uid),t=eh(Om,`users/${v.uid}/games`,c);await dm(e,{lastSeen:null}),await dm(t,{lastSeen:null})}ts(Dm)},className:"p-2 rounded-full shadow-lg hover:bg-blue-500 transition-colors",title:"Logout",children:(0,Lm.jsx)("img",{src:_S,alt:"Logout",className:"w-8 h-8"})})]})]})},AS=e=>{let{message:t,onConfirm:n,onCancel:s,confirmText:r="Confirm",cancelText:i="Cancel"}=e;return t?(0,Lm.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",onClick:s,children:(0,Lm.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center border border-gray-600",onClick:e=>e.stopPropagation(),children:[(0,Lm.jsx)("p",{className:"mb-6 text-lg text-gray-300",children:t}),(0,Lm.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,Lm.jsx)("button",{onClick:s,className:"btn btn-primary px-6 py-2",children:i}),(0,Lm.jsx)("button",{onClick:n,className:"btn btn-danger px-6 py-2",children:r})]})]})}):null},PS=t=>{let{onWorldSelected:n}=t;const{currentUser:s,userProfile:r}=Fm(),[i,a]=(0,e.useState)([]),[o,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)(""),[f,g]=(0,e.useState)(!1),[v,y]=(0,e.useState)(null);(0,e.useEffect)(()=>{u(!0);const e=pm(Jd(Om,"worlds"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));a(t)},e=>{console.error("Error fetching worlds:",e),h("Could not load world list.")});let t;if(s){const e=Jd(Om,`users/${s.uid}/games`);t=pm(e,e=>{const t=e.docs.map(e=>e.id);l(t),u(!1)},e=>{console.error("Error fetching user games:",e),u(!1)})}else u(!1);return()=>{e(),t&&t()}},[s]);if(c)return(0,Lm.jsx)("div",{className:"text-white text-center p-10",children:"Loading Worlds..."});const x=i.filter(e=>!o.includes(e.id)),b=i.filter(e=>o.includes(e.id));return(0,Lm.jsxs)("div",{className:"w-full min-h-screen flex items-center justify-center p-4 world-selection-container",children:[(0,Lm.jsx)(Sp,{message:d,onClose:()=>h("")}),v&&(0,Lm.jsx)(AS,{message:`Are you sure you want to permanently delete the world "${v.name}"? This will delete all your cities and progress within it.`,onConfirm:()=>(async(e,t)=>{h(`Deleting world "${t}"... This may take a moment.`);try{const n=eh(Om,"worlds",e),s=async e=>{const t=Bh(e,Yh(500)),n=await cm(t);if(0===n.size)return 0;const s=Cm(Om);return n.docs.forEach(e=>s.delete(e.ref)),await s.commit(),n.size};let r;const i=Jd(Om,"worlds",e,"citySlots");for(;(r=await s(i))>0;)console.log(`Deleted ${r} city slots...`);const o=Jd(Om,"worlds",e,"villages");for(;(r=await s(o))>0;)console.log(`Deleted ${r} villages...`);const l=Jd(Om,"worlds",e,"ruins");for(;(r=await s(l))>0;)console.log(`Deleted ${r} ruins...`);await hm(n),h(`World "${t}" has been deleted successfully.`);const c=Jd(Om,"worlds"),u=(await cm(c)).docs.map(e=>({id:e.id,...e.data()}));a(u)}catch(n){console.error("Error deleting world:",n),h(`Failed to delete world: ${n.message}`)}finally{y(null)}})(v.id,v.name),onCancel:()=>y(null),confirmText:"Delete World"}),(0,Lm.jsxs)("div",{className:"world-selection-window w-full max-w-4xl p-8 relative",children:[(0,Lm.jsx)("button",{onClick:()=>ts(Dm),className:"absolute top-4 right-4 text-sm text-red-400 hover:text-red-300 px-3 py-1 rounded",children:(0,Lm.jsx)("img",{src:_S,alt:"Logout",className:"w-8 h-8"})}),(0,Lm.jsx)("h1",{className:"font-title text-4xl text-center mb-8",children:"SELECT A WORLD"}),(0,Lm.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h2",{className:"font-title text-2xl mb-4",children:"YOUR WORLDS"}),b.length>0?b.map(e=>(0,Lm.jsxs)("div",{className:"selection-card p-4 rounded-lg text-center mb-2 flex justify-between items-center",children:[(0,Lm.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>n(e.id),children:[(0,Lm.jsx)("img",{src:TS,alt:"World",className:"w-8 h-8 mr-4"}),(0,Lm.jsx)("h3",{className:"text-xl font-bold flex-grow text-left",children:e.name})]}),(null===r||void 0===r?void 0:r.is_admin)&&(0,Lm.jsx)("button",{onClick:()=>y(e),className:"btn btn-danger px-3 py-1 text-xs rounded",children:"Delete"})]},e.id)):(0,Lm.jsx)("p",{children:"You have not joined any worlds yet."})]}),(0,Lm.jsxs)("div",{children:[(0,Lm.jsx)("h2",{className:"font-title text-2xl mb-4",children:"JOIN A NEW WORLD"}),x.length>0?x.map(e=>(0,Lm.jsxs)("div",{className:"selection-card p-4 rounded-lg text-center mb-2 flex justify-between items-center",children:[(0,Lm.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>n(e.id),children:[(0,Lm.jsx)("img",{src:TS,alt:"World",className:"w-8 h-8 mr-4"}),(0,Lm.jsx)("h3",{className:"text-xl font-bold flex-grow text-left",children:e.name})]}),(null===r||void 0===r?void 0:r.is_admin)&&(0,Lm.jsx)("button",{onClick:()=>y(e),className:"btn btn-danger px-3 py-1 text-xs rounded",children:"Delete"})]},e.id)):(0,Lm.jsx)("p",{children:"No new worlds are available to join."})]})]}),(null===r||void 0===r?void 0:r.is_admin)&&(0,Lm.jsxs)("div",{className:"mt-12 border-t border-gray-700 pt-8",children:[(0,Lm.jsx)("h2",{className:"font-title text-2xl mb-4",children:"ADMIN PANEL"}),(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m.trim()){g(!0),h("Creating a new world, this may take a moment...");try{const e=m.trim().toLowerCase().replace(/\s+/g,"-"),t=eh(Om,"worlds",e);if((await om(t)).exists())return h(`A world with the ID '${e}' already exists. Please choose a different name.`),void g(!1);const s=100,r=100,i=((e,t,n)=>{const s=[];if(1===n){const n=Math.min(e,t)/2.5;return s.push({id:"island-0",name:"The Central Isle",x:Math.floor(e/2),y:Math.floor(t/2),radius:n,imageName:dg[Math.floor(Math.random()*dg.length)]}),s}const r=(e,t)=>{for(const n of t){const t=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),s=10+2*Math.random();if(t<e.radius+n.radius+s)return!0}return!1};for(let i=0;i<n;i++){let n={},a=!0,o=0;for(;a&&o<20;){const l=2*Math.random()+6,c=e-20-2*l,u=t-20-2*l;if(c<=0||u<=0){console.error("Map is too small to generate islands with the specified margins.");break}const d=Math.floor(Math.random()*c),h=Math.floor(Math.random()*u);n={id:`island-${Date.now()}-${i}`,name:`Island ${i+1}`,x:10+l+d,y:10+l+h,radius:l,imageName:dg[Math.floor(Math.random()*dg.length)]},a=r(n,s),o++}a||s.push(n)}return s})(s,r,4),a=((e,t,n)=>{const s={};let r=0;return e.forEach(e=>{const i=hg[e.imageName];i&&i.citySlots.forEach(i=>{const a=Math.round(e.x+i.x),o=Math.round(e.y+i.y);if(a>=0&&a<t&&o>=0&&o<n){const t=`${e.id}-slot-${r++}`;s[t]={islandId:e.id,x:a,y:o,ownerId:null,cityName:"Unclaimed",ownerEmail:null,ownerUsername:null,ownerFaction:null}}})}),s})(i,s,r),o=((e,t)=>{const n={},s=new Set(Object.values(t).map(e=>`${e.x},${e.y}`));let r=0;const i=[300,1200,5400,14400];return e.forEach(e=>{const t=hg[e.imageName];if(t)t.villages.forEach(t=>{const a=Math.round(e.x+t.x),o=Math.round(e.y+t.y);if(s.has(`${a},${o}`))return;const l=`v${e.id}-${r++}`,c=["wood","stone","silver"];let u=c.splice(Math.floor(Math.random()*c.length),1)[0],d=c.splice(Math.floor(Math.random()*c.length),1)[0];n[l]={id:l,x:a,y:o,islandId:e.id,name:mg[Math.floor(Math.random()*mg.length)],level:1,demandYield:{wood:50,stone:50,silver:20},resources:{wood:500,stone:500,silver:500},maxResources:1200,lastDemandTime:0,demandCooldown:i[Math.floor(Math.random()*i.length)],troops:{swordsman:15,archer:10},tradeRatio:1.25,demands:u,supplies:d},s.add(`${a},${o}`)});else{const t=Math.round(e.x),r=Math.round(e.y),i=Math.min(Math.floor(e.radius),5);for(let a=0;a<i;a++){const i=2*Math.random()*Math.PI,o=Math.random()*(e.radius-3),l=Math.round(t+o*Math.cos(i)),c=Math.round(r+o*Math.sin(i));if(!s.has(`${l},${c}`)){const t=`v${e.id}-${a}`;n[t]={id:t,x:l,y:c,islandId:e.id,name:"Inland Hamlet",level:1},s.add(`${l},${c}`)}}}}),n})(i,a),l=((e,t,n)=>{const s={},r=Math.floor(t*n/500),i=(t,n)=>{for(const s of e)if(Math.pow(t-s.x,2)+Math.pow(n-s.y,2)<=Math.pow(s.radius+3,2))return!0;return!1};for(let a=0;a<r;a++){let e,r,o=0;do{e=Math.floor(Math.random()*t),r=Math.floor(Math.random()*n),o++}while(i(e,r)&&o<100);if(o<100){const t=`ruin-${e}-${r}`;s[t]={id:t,x:e,y:r,name:"Forgotten Ruins",type:"ruin",troops:{hoplite:100+Math.floor(50*Math.random()),cavalry:50+Math.floor(25*Math.random()),trireme:20+Math.floor(10*Math.random())},researchReward:"qol_research_"+a%3}}}return s})(i,s,r),c={name:m.trim(),islands:i,width:s,height:r,createdAt:km(),season:"Spring",weather:"Clear",seasonLastUpdate:km(),weatherLastUpdate:km()};await Cm(Om).set(t,c).commit();const u=400,d=Jd(Om,"worlds",e,"citySlots"),p=Object.entries(a);for(let n=0;n<p.length;n+=u){const e=Cm(Om),t=p.slice(n,n+u);h(`Creating world... writing city data ${n+t.length}/${p.length}`);for(const[n,s]of t){const t=eh(d,n);e.set(t,s)}await e.commit()}const f=Jd(Om,"worlds",e,"villages"),v=Object.entries(o);for(let n=0;n<v.length;n+=u){const e=Cm(Om),t=v.slice(n,n+u);h(`Creating world... writing village data ${n+t.length}/${v.length}`);for(const[n,s]of t){const t=eh(f,n);e.set(t,{...s,lastCollected:km()})}await e.commit()}const y=Jd(Om,"worlds",e,"ruins"),x=Object.entries(l);for(let n=0;n<x.length;n+=u){const e=Cm(Om),t=x.slice(n,n+u);h(`Creating world... writing ancient ruins ${n+t.length}/${x.length}`);for(const[n,s]of t){const t=eh(y,n);e.set(t,s)}await e.commit()}h("World created successfully!"),n(e)}catch(t){console.error("Error creating world:",t),h(`Failed to create world: ${t.message}`)}g(!1),p("")}else h("Please enter a world name.")},className:"flex flex-col sm:flex-row gap-4 mb-4",children:[(0,Lm.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"Enter new world name",className:"flex-grow bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:f}),(0,Lm.jsx)("button",{type:"submit",className:"btn btn-confirm px-6 py-2",disabled:f,children:f?"Creating...":"Create New World"})]})]})]})]})},MS={Greek:["Athenian","Spartan","Corinthian"],Roman:["Julian","Cornelian","Fabian"],Egyptian:["Ptolemaic","Nubian","Bedouin"]},DS=t=>{let{onCityFounded:n}=t;const{currentUser:s,userProfile:r}=Fm(),{worldId:i,worldState:a,setActiveCityId:o,playerCities:l}=up(),[c,u]=(0,e.useState)(null),[d,h]=(0,e.useState)(""),[m,p]=(0,e.useState)(""),[f,g]=(0,e.useState)(!1),[v,y]=(0,e.useState)(null),[x,b]=(0,e.useState)(null),[w,k]=(0,e.useState)(1);(0,e.useEffect)(()=>{null!==r&&void 0!==r&&r.username&&h(`${r.username}'s Capital`)},[r]);const N=(0,e.useCallback)(async()=>{if(null===a||void 0===a||!a.islands||!i)return null;const e=Bh(Jd(Om,"worlds",i,"citySlots"),qh("ownerId","==",null),Yh(10));try{const t=await cm(e);if(!t.empty){const e=t.docs[Math.floor(Math.random()*t.docs.length)];return{id:e.id,...e.data()}}}catch(t){console.error("Error finding an empty slot:",t)}return null},[i,a]),j=(0,e.useCallback)(async()=>{if(!v||!x)return void p("Please select a religion and nation to continue.");g(!0),p("Finding a suitable location...");const e=await N();e?(u(e),p(`Location found at (${e.x}, ${e.y}). Give your new city a name.`),k(2)):p("Could not find an available city slot. This world might be full."),g(!1)},[N,v,x]);return 1===w?(0,Lm.jsx)("div",{className:"w-full min-h-screen flex items-center justify-center p-4 bg-gray-900 text-white",children:(0,Lm.jsx)("div",{className:"w-full max-w-2xl",children:(0,Lm.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg shadow-2xl",children:[(0,Lm.jsx)("h1",{className:"font-title text-4xl text-center text-gray-300 mb-6",children:"Choose Your Path"}),(0,Lm.jsx)("p",{className:"text-center text-gray-400 mb-8",children:"Your choice of Religion and Nation will define your journey in this world."}),m&&(0,Lm.jsx)("p",{className:"text-center text-red-400 mb-4",children:m}),(0,Lm.jsxs)("div",{className:"mb-8",children:[(0,Lm.jsx)("h2",{className:"font-title text-2xl text-gray-300 mb-4",children:"Select Religion"}),(0,Lm.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.keys(MS).map(e=>(0,Lm.jsx)("div",{onClick:()=>{y(e),b(null)},className:"selection-card p-4 rounded-lg text-center "+(v===e?"selected":""),children:(0,Lm.jsx)("h3",{className:"text-xl font-bold",children:e})},e))})]}),v&&(0,Lm.jsxs)("div",{className:"mb-8",children:[(0,Lm.jsx)("h2",{className:"font-title text-2xl text-gray-300 mb-4",children:"Select Nation"}),(0,Lm.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:MS[v].map(e=>(0,Lm.jsx)("div",{onClick:()=>b(e),className:"selection-card p-4 rounded-lg text-center "+(x===e?"selected":""),children:(0,Lm.jsx)("h3",{className:"text-xl font-bold",children:e})},e))})]}),(0,Lm.jsx)("button",{onClick:j,disabled:!v||!x||f,className:"w-full btn btn-confirm font-bold py-3 rounded-lg disabled:btn-disabled",children:f?"Searching for land...":"Continue"})]})})}):(0,Lm.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-gray-900 text-white",children:(0,Lm.jsxs)("div",{className:"w-full max-w-md text-center p-8 bg-gray-800 rounded-lg shadow-2xl",children:[(0,Lm.jsx)("h2",{className:"font-title text-4xl mb-4",children:"Found Your First City"}),(0,Lm.jsx)("p",{className:"text-gray-400 mb-6",children:m}),c&&(0,Lm.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!d.trim()||!c||!r||!v||!x)return void p("Cannot found city: missing required information.");g(!0),p("Founding your city...");const t=eh(Om,"worlds",i,"citySlots",c.id),h=eh(Om,`users/${s.uid}/games`,i),m=eh(Jd(h,"cities"));try{const e=await om(t);if(!e.exists()||null!==e.data().ownerId)throw new Error("This location was taken. Please try again.");const i=Cm(Om);let u=d.trim();const p=Object.values(l).map(e=>e.cityName);let f=u;if(p.includes(f)){let e,t=2;const n=u.replace(/ Colony \d+$/,"").trim();do{e=`${n} Colony ${t}`,t++}while(p.includes(e));f=e}i.update(t,{ownerId:s.uid,ownerUsername:r.username,cityName:f}),i.set(h,{worldName:a.name,joinedAt:km(),citySlotIds:[c.id],battlePoints:0});const g={};Object.keys(zm).forEach(e=>{g[e]={level:0}}),["senate","farm","warehouse","timber_camp","quarry","silver_mine","cave"].forEach(e=>{g[e].level=1});const y={id:m.id,slotId:c.id,x:c.x,y:c.y,islandId:c.islandId,cityName:f,playerInfo:{religion:v,nation:x},resources:{wood:1e3,stone:1e3,silver:500},buildings:g,units:{},wounded:{},research:{},worship:{},cave:{silver:0},buildQueue:[],unitQueue:[],researchQueue:[],healQueue:[],lastUpdated:Date.now()};i.set(m,y),await i.commit(),o(m.id),n&&"function"===typeof n&&n()}catch(f){console.error("Error founding city: ",f),p(`Failed to found city: ${f.message}`),u(null),k(1),g(!1)}},className:"flex flex-col gap-4",children:[(0,Lm.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-center text-lg",required:!0}),(0,Lm.jsx)("button",{type:"submit",disabled:f,className:"btn btn-confirm px-8 py-3 text-lg",children:f?"Claiming Land...":"Found City"})]})]})})},OS=e=>{let{onBackToWorlds:t}=e;const{playerHasCities:n,worldState:s,loading:r}=up();return r?(0,Lm.jsx)(BC,{message:"Loading World Data..."}):s?n?(0,Lm.jsx)(ES,{onBackToWorlds:t}):(0,Lm.jsx)(DS,{onCityFounded:()=>{}}):(0,Lm.jsxs)("div",{className:"text-white text-center p-10",children:[(0,Lm.jsx)("p",{children:"Error: Could not load the selected world."}),(0,Lm.jsx)("button",{onClick:t,className:"btn btn-primary mt-4",children:"Back to World Selection"})]})};const RS=function(){const[t,n]=(0,e.useState)(null),{currentUser:s,loading:r}=Fm();return r?(0,Lm.jsx)(BC,{message:"Authenticating..."}):s?t?(0,Lm.jsx)(Cp,{children:(0,Lm.jsx)(dp,{worldId:t,children:(0,Lm.jsx)(kp,{children:(0,Lm.jsx)(OS,{onBackToWorlds:()=>n(null)})})})}):(0,Lm.jsx)(PS,{onWorldSelected:n}):(0,Lm.jsx)(Ip,{})};t.createRoot(document.getElementById("root")).render((0,Lm.jsx)(e.StrictMode,{children:(0,Lm.jsx)(Um,{children:(0,Lm.jsx)("div",{className:"bg-gray-900 text-white min-h-screen font-sans",children:(0,Lm.jsx)(RS,{})})})}))})()})();
//# sourceMappingURL=main.8861ab69.js.map